(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1603:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),i=n(8),s=n(195),r=n(18);t.autoUpdateTimezone=function(e){var t=this;return function(n,a){return o.__awaiter(t,void 0,void 0,(function(){var t,c,d,u,p;return o.__generator(this,(function(l){return t=i.getCurrentUser(a()),c=s.getUserTimezone(a(),t.id),d=c.automaticTimezone!==e,c.useAutomaticTimezone&&d&&(u={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:c.manualTimezone},p=o.__assign(o.__assign({},t),{timezone:u}),r.updateMe(p)(n,a)),[2]}))}))}}},2452:function(e,t,n){"use strict";n.r(t);n(129);var o=n(264),i=n(10),s=n(1603),r=n(11),a=n(15),c=n(8),d=n(98),u=n(1710),p=n(14),l=n(127),m=n.n(l),h=n(5),w=n.n(h),f=n(1266),b=n(40),v=n(199),g=n.n(v),L=n(1282),U=n(1411),T=n(17),k=n(1283),O=n(197),C=n(23),z=n(1610),E=n(1397);function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _=C.a.dispatch,R=C.a.getState;class S extends w.a.PureComponent{constructor(e){super(e),j(this,"onDesktopMessageListener",({origin:e,data:{type:t,message:n={}}={}}={})=>{if(this.props.currentUser&&e===window.location.origin)switch(t){case"register-desktop":{const{version:e}=n;window.desktop||(window.desktop={}),window.desktop.version=g.a.valid(g.a.coerce(e));break}case"user-activity-update":{const{userIsActive:e,manual:t}=n;!0!==e&&!1!==e||z.a.userUpdateActiveStatus(e,t);break}case"notification-clicked":{const{channel:e,teamId:t}=n;window.focus(),this.props.actions.getChannelURLAction(e,t);break}}}),j(this,"handleBackSpace",e=>{8!==e.which||["input","textarea"].includes(e.target.tagName.toLowerCase())||e.preventDefault()}),j(this,"handleBeforeUnload",()=>{window.removeEventListener("beforeunload",this.handleBeforeUnload),document.cookie.indexOf("MMUSERID=")>-1&&Object(b.viewChannel)("",this.props.currentChannelId||"")(_,R),U.a()});const t=document.getElementById("root");t&&(t.className+=" channel-view")}isValidState(){return null!=this.props.currentUser}componentDidMount(){if(U.b(),this.props.enableTimezone&&this.props.actions.autoUpdateTimezone(Object(O.a)()),window.addEventListener("beforeunload",this.handleBeforeUnload),window.addEventListener("focus",this.onFocusListener),window.addEventListener("blur",this.onBlurListener),window.addEventListener("message",this.onDesktopMessageListener),window.postMessage({type:"webapp-ready"},window.location.origin),T.i()?document.body.classList.add("ios"):T.b()&&document.body.classList.add("android"),!this.props.currentUser){const e=document.getElementById("root");e&&e.setAttribute("class",""),L.e("/login?redirect_to="+encodeURIComponent(this.props.location.pathname),!0,!1)}window.addEventListener("keydown",this.handleBackSpace),this.isValidState()&&E.a.signalLogin()}componentWillUnmount(){U.a(),window.removeEventListener("keydown",this.handleBackSpace),window.removeEventListener("focus",this.onFocusListener),window.removeEventListener("blur",this.onBlurListener),window.removeEventListener("message",this.onDesktopMessageListener)}render(){if(!this.isValidState())return w.a.createElement(k.a,null);if(this.props.mfaRequired){if("/mfa/setup"!==this.props.location.pathname)return w.a.createElement(f.c,{to:"/mfa/setup"})}else if("/mfa/confirm"===this.props.location.pathname);else if(this.props.showTermsOfService&&"/terms_of_service"!==this.props.location.pathname)return w.a.createElement(f.c,{to:"/terms_of_service?redirect_to="+encodeURIComponent(this.props.location.pathname)});return this.props.children}onFocusListener(){L.a(!0)}onBlurListener(){L.a(!1)}}j(S,"propTypes",{currentUser:m.a.object,currentChannelId:m.a.string,children:m.a.object,mfaRequired:m.a.bool.isRequired,enableTimezone:m.a.bool.isRequired,actions:m.a.shape({autoUpdateTimezone:m.a.func.isRequired,getChannelURLAction:m.a.func.isRequired}).isRequired,showTermsOfService:m.a.bool.isRequired});const y=(e,t)=>(n,o)=>d.a.push(Object(p.t)(o(),e,t));t.default=Object(o.connect)((function(e,t){const n=Object(a.getLicense)(e),o=Object(a.getConfig)(e),i=Object(c.shouldShowTermsOfService)(e);return{currentUser:Object(c.getCurrentUser)(e),currentChannelId:Object(r.getCurrentChannelId)(e),mfaRequired:Object(u.a)(Object(c.getCurrentUser)(e),n,o,t.match.url),enableTimezone:"true"===o.ExperimentalTimezone,showTermsOfService:i}}),(function(e){return{actions:Object(i.bindActionCreators)({autoUpdateTimezone:s.autoUpdateTimezone,getChannelURLAction:y},e)}}))(S)}}]);
//# sourceMappingURL=2.52b7193b238997bd87fa.js.map