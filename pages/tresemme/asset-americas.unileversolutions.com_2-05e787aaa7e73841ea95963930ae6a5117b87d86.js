/* Version=6.58.2,Timestamp=2022-05-26T20:31:38.780Z */define("d2-form-v2",["captcha","formV2Analytics","formV2PostcodeValidation","prmdata","formV2StaticValidations","formExtendedBackboneValidations","successHandler","errorHandler","submitHandler","formV2ProgressiveSignup","formService","commonService","iea-form-v2"],function(i,r,n,s,a,d,l,m,c,u){"use strict";var f,p,g,h,v,y,C,b,S,w,k,E,x,D,T=null,F=null,M=null,R=null,I=null,L=null,U=null,A=null,P=null,V=null,O=null,H=null;return IEA.module("UI.form-v2",function(e,o,t){_.extend(e,{defaultSettings:{componentWrapper:".component-wrapper",errorMessage:"General Form Submission Error",fileHelpBlock:".file-help-block",formElementError:"form-element-error",formElementsGroupSection:".form-elements-group",formElementWarning:"form-element-warning",formError:"has-error",formErrorClass:".error-msg-text",formErrorMsg:".form-error-msg",formErrorMsgDesc:".js-error-msg-desc",formGroup:".form-group",formInputError:"form-input-error",formInputWarning:"form-input-warning",formMandatoryClass:"c-form-mandatory",helpBlock:".help-block",profileYear:"#Profile-Year",loginPage:".login-page-iframe",rewardComp:".c-rr",checkoutFormV2:".checkout-form-v2",signUpPage:".sign-up-page",registrationPage:".registration-page",profilePage:".profile-page",forgetPasswordPage:".forgot-password-page",resetPasswordPage:".reset-password-page",loginPageWrapper:".login-page",loginRegisterV2Comp:".login-register-v2",smsBrand:"#optIn-smsBrand",smsAll:"#optIn-smsAll",campaignQuestionAndAnswersSection:".c-campaign-question-answer",textareaCharCountWrapper:".js-form-textarea__charcount",ecommerceDeliveryAddress:"delivery-address",isEcommerceUnifiedTemplate:!!$(".ecommerce-page").length,listOfCofFormType:["campaign-submit","campaign-temporary-data-storage","campaign-new-users-only","campaign-participation-check","campaign-restrict-access"],campaignFormTypes:["signup","samples","competition"],pageScrollAnimationSpeed:1e3,otpResendTimer:30,formLoaderHTML:'<div class="o-preloader-container"><div class="o-preloader"></div></div>',blockedFormForLoggedInUser:["uim_signin","uim_registration","uim_forgot_password","uim_forgot_password_confirm","community_login"],formForLoggedInUser:["uim_update_profile","uim_change_password","community_profile"]},events:{"change .c-form-file":"_fileUploadMethod","change input[id*=Registrations-0-MarketingPreferences-SmsOptIn-OptIn]":"_checkOptins","submit form":"_handleFormSubmit",'change input[name*="SurveyResponses"], input[name*="surveyResponseList"], select[name*="SurveyResponses"], select[name*="surveyResponseList"]':"_trackEditSurvey","click .calendar-input":"_calendarClickHandler",'change select[name*="Profile-Year"],select[name*="Profile-Date"],select[name*="Profile-Month"]':"_dateHandler","click .c-btn-nocookie-reload":"_reloadCaptcha","blur select, textarea, input:not([type=submit]):not([type=file])":"onInputBlur","click input[type=file]":"_fileClickHandler","change input[type=file]":"onInputBlur","focus select, textarea, input:not([type=submit])":"resetState","change input[id*=rememberme]":"_rememberMe",'click input:radio[name^="surveyResponseList-"]':"surveyFieldUpdateHandler",'change select[name*="SurveyResponses"], select[name*="surveyResponseList"]':"surveyFieldUpdateHandler","click .c-hide-password,.c-eye-icon":"togglePassword",'focus.typeahead.data-api [data-provide="typeahead"]':"_enableTypeaheadFocus","click .c-edit-link":"_editableView","change input[id*=deliveryAddress-sameasbilling]":"_findDeliveryAddress",'click  button[type="reset"]':"_formReset","click input[id*=js-your-preferences]":"_togglePreferenceContent","click input[id*=userSurveyId-submit]":"surveyFormHandling","click input[id*=js-remember-password]":"_rememberPasswordHandler",'focus input[type="email"]':"onEmailFocus","focus .c-tooltip-info":"popUpTip","focusout .c-tooltip-info":"popUpTip","click .captcha-help-icon .c-tooltip-info":"openCaptchaPopup","blur input[id*=contact-phoneNumbers-0-value]":"_contactChangeHandler","change input[id*=optIn-smsAll]":"_contactChangeHandler","click .c-res":"_closeValidationMessage","click .c-campaign-question-answer_close-btn":"_closeValidationMessage","keyup textarea":"_teaxtareaCharacterCount","click .c-samples--selector-all":"samplesSelectAll","click .c-samples--selector-deselect":"samplesDeselectAll","click .overlay-otp__submit-btn":"otpOverlaySubmitButton","blur .otp-verification-code":"otpFieldValidation","focus .otp-verification-code":"otpFieldValidation","click .otp-enabled":"resendOtpLink","click .overlay-otp__closebtn":"otpOverlayCloseBtn","click .reset-password":"showResetPasswordForm","click .form-v2-aws-logout":"_awsUserSignout","click .o-btn--audio-captcha":"_audioCaptcha"},formSuccessActionTypes:{DISPLAY_MESSAGE:"display message",REDIRECT:"redirect to"},onInit:function(){this.updateSetting({calenderAutoclose:!1}),T=new IEA.formService,M=new n,F=new r,R=new s,I=new a,L=new d,A=new l,P=new m,V=new c,O=new u,H=new IEA.commonService,U=new i,this.triggerMethod("formInit")},enable:function(){this.triggerMethod("beforeEnable");var t=this,e=t.moduleName.hyphenToCamelCase();t.$form=$("form",t.$el),t.settings=t.defaultSettings,t.modelData=t.getModelJSON()[e],t.allElementsConfig=t.modelData.formElementsV2Config,t.formElementGroup=t.modelData.formElementGroups,t.compJson=t.getModelJSON().formV2,t.isLocalEnv=IEA.currentInstance.config.attributes.localEnv,t.compLocale=t.modelData.locale,t.brandName=t.modelData.brandName,t.uniqueIdRelease=t.modelData.uniqueIdRelease,t.formType=t.modelData.formType.toLowerCase(),t.promotigoFormId=t.$form.find("input:hidden[name=promotigoformId]").val(),t.dynamicValidatorFlag=void 0===t.modelData.dynamicConditionValidator,t.tokenCookie=T.getCookie("token"),t.form={isAjax:!(!t.$form.data("ajax")&&!t.modelData.isAjax)&&t.modelData.isAjax,postURL:t.$form.attr("action"),failureMessage:t.$form.data("fail")||t.modelData.failureMessage?t.modelData.failureMessage:"Submission Failed",successMessage:t.$form.data("success")||t.modelData.successMessage?t.modelData.successMessage:"Thank you for your submission",validation:!(!t.$form.data("validation")&&!t.modelData.validation)&&t.modelData.validation,successRedirectURL:!(!t.$form.data("redirect")&&!t.modelData.redirect)&&t.modelData.redirect,errorRedirectURL:!(!t.$form.data("redirect")&&!t.modelData.failureRedirect)&&t.modelData.failureRedirect,formSuccessActionType:t.modelData.onSuccessfulFormSubmission},t.errorCodes={captchaErrorCode:867,captchaInternalErrorCode:40,emailErrorCodeForm:1011,emailErrorCodeRegistration:406,inlineErrorValidationCode:422,productExpired:2001,productOutOfStock:2003,productUnAvailable:2004,quantityNotAvailable:2006,utmErrorCode:400,alreadySignedUpErrorMessage:1010,UserIsAlreadyRegistered:2100,UserInformationIsMissing:2101,MembershipLevelIsMissingOrInvalid:2102,CommunityInformationIsMissing:2103,UserWasNotCreated:2104},t.cofSurveyFormData=[],t.cofSurveyResponseData=[],t.cofAnswers=[],t._isFormExpired(),t._renderModulesJS(),t._formValidator(),(t=_.extend(t,l)).delegateEvents(),this._showHideFormBasedOnUserLoggedInStatus(),t._formDOBOnLoadMethod(),t._populateHiddenFields(),t.setUtmParametersForEpsilon(),t.modelData.formType===t.settings.ecommerceDeliveryAddress&&require(["formV2ecommerce"],function(e){x=new e,(t=_.extend(t,x)).fetchShippingAddress()}),"voice"===t.modelData.formType&&t.modelData.voiceProvider&&require(["alexaPreference"],function(e){E=new e,(t=_.extend(t,E))._handleAlexaPreferences()}),"UGCSignup"===t.$form.find("#formType-"+t.compJson.randomNumber).val()&&t.$form.find('input[type="file"]').attr("data-exclude","true"),this.triggerMethod("enable")},_isFormExpired:function(){var e=this.$form.find(".c-alert--error");this._isCampaignFormType()&&this._isExpiredDate()&&e.length&&e.removeAttr("hidden")},_isCampaignFormType:function(){return _.contains(this.defaultSettings.campaignFormTypes,this.compJson.formType)},_isExpiredDate:function(){var e=new Date;return!!this.compJson.expireDate&&e>new Date(this.compJson.expireDate)},_populateHiddenFields:function(){var e,t,i=this.$form.find('[name="hasTakenSkinTest"]'),r=this.$form.find('[name="skinTestTakeOnDate"]');if(i.length&&r.length)for(e in localStorage)localStorage.hasOwnProperty(e)&&e.match("-surveyResponses")&&(t=JSON.parse(localStorage.getItem(e)),i.val(t.CustomAttributes.hasTakenSkinTest),r.val(t.CustomAttributes.skinTestTakeOnDate))},_showHideFormBasedOnUserLoggedInStatus:function(){("onlyNonLoggedInUsers"===this.modelData.displayFormTo&&void 0!==this.tokenCookie||"onlyLoggedInUsers"===this.modelData.displayFormTo&&void 0===this.tokenCookie)&&this.$form.hide()},_hasBodyClass:function(e){if($("body").is(e))return!0},_renderModulesJS:function(){var t=this;(t=_.extend(t,F)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),t._formOnLoadAnalytics(),t._renderFormHandlers(),t._renderSurveyMethod(),$(t.settings.rewardComp).length&&require(["reward"],function(e){p=new e,(t=_.extend(t,p)).settings=_.extend(t.settings,t.defaultSettings)}),t.$el.find(".c-form-file").length&&require(["fileuploadValidations"],function(e){C=new e,t=_.extend(t,C)}),t.emailVerificationEnabled=t.$form.find(".overlay-otp").attr("data-email-verification"),t.smsVerificationEnabled=t.$form.find(".overlay-otp").attr("data-sms-verification"),"true"!==t.smsVerificationEnabled&&"true"!==t.emailVerificationEnabled&&"uim_forgot_password_confirm"!==t.formType||(require(["otpHandler"],function(e){b=new e,t=_.extend(t,b)}),"uim_registration"!==t.formType&&"uim_forgot_password"!==t.formType&&"uim_forgot_password_confirm"!==t.formType&&"community_register"!==t.formType&&"community_create_password"!==t.formType||require(["amazonCognito"],function(e){t.AmazonCognitoIdentity=e,t=_.extend(t,e)})),"community_create_password"!==t.formType&&"community_register"!==t.formType&&"community_login"!==t.formType&&"community_signup"!==t.formType&&"community_profile"!==t.formType||require(["formV2Community"],function(e){D=new e,(t=_.extend(t,D))._formReturnUrl(),t._prepopulateEmailInShortRegistration(),t._communitySignupAuth()}),t.isPreLoginFormType=-1!==_.indexOf(t.settings.blockedFormForLoggedInUser,t.formType),t.formForLoggedInUser=-1!==_.indexOf(t.settings.formForLoggedInUser,t.formType),(t.isPreLoginFormType||t.formForLoggedInUser)&&require(["amazonCognito"],function(e){t.AmazonCognitoIdentity=e,t=_.extend(t,e),T._isAmazonCognitoUserSignedIn(t)}),t._initCampaignHandler(),t._renderRegiserationMethods(),t._renderDynamicConditionHandler(),t._renderPostCodeValidationMethod(),t._renderEgiftingForm(),t.$form.find(t.settings.captchaText).length&&t._reloadCaptcha(),"v3"===t.$form.find(t.settings.captchaField).attr("data-version")&&t._loadCaptcha(),t.$form.find(t.settings.vaptchaContainer).length&&t._loadVaptcha(),t.formType.startsWith("uim_")||((t=_.extend(t,O)).iterateCookie(),t.cookieData=JSON.parse(H.getLocalStorageItem("sign-up-progressive_"+t.modelData.locale.trim())),t._updateFormData()),t.delegateEvents(),t._setRedirectPath()},_getProfileDetails:function(e,t){var i=this,r=JSON.parse(i._formDatatoSend()),r={brand:r.config.brand,clientId:r.config.clientId,locale:r.config.locale,poolId:r.config.poolId,region:r.config.region,entity:r.entity,username:T.decodeStr(T.getCookie("_ulcogid"))},o={Authorization:"Bearer "+T.getCookie("_ulcogtoken")};i.toggleLoader("show"),r={queryParams:JSON.stringify(r),servletUrl:i.modelData.getProfileEndpoint,isTypePost:!0,header:o,onCompleteCallback:function(e){i._updateProfileFields(JSON.parse(e)),i.triggerMethod("userDataLoad",{data:e,contect:i}),i.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1)},onErrorCallback:function(e){i.triggerMethod("userDataError",{error:e,contect:i}),i.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1);e="<p>"+i.modelData.updateProfileErrorMsg+"</p>";i._renderServerSideErrorMessages(e,i.$form),i.toggleLoader("hide")}},H.getDataAjaxMethod(r)},_updateProfileFields:function(i){this.$form.find("input[type!=hidden]").each(function(){var e,t=$(this).attr("name").split("-");"email"===t[1]&&i[t[0]][t[1]]?($(this).attr("readonly",!0),$(this).val(i[t[0]][t[1]])):"birthday"===t[1]&&i[t[0]][t[1]]?(e=(e=i[t[0]][t[1]]).split("-"),$(this).datepicker("setDate",new Date(e[0],e[1]-1,e[2]))):$(this).val(i[t[0]][t[1]])}),this.$form.find("select:not([hidden])").each(function(){var e=$(this).attr("name").split("-");$(this).val(i[e[0]][e[1]])}),this.toggleLoader("hide")},_renderSurveyMethod:function(){var t=this;t.compJson.getSurveyUrl&&(void 0!==t.tokenCookie||void 0!==T.getCookie("CouponDataId")&&H._checkCookieLocale())&&require(["survey"],function(e){f=new e,t.$el.find(".form-filtered-survey").hide(),(t=_.extend(t,f)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),t.renderFilterSurvey()})},_renderDynamicConditionHandler:function(){var t=this;t.modelData.dynamicConditionValidator&&!t.modelData.isEditMode?require(["formConditionHandler"],function(e){g=new e,(t=_.extend(t,g)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),t._dynamicConditionHandler(t.allElementsConfig)}):((t=_.extend(t,I)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),t.elementsHandlingEnquiryType())},_renderEgiftingForm:function(){var t=this;$(t.settings.checkoutFormV2).length&&require(["formV2Checkout"],function(e){v=new e,(t=_.extend(t,v)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),t.getComponentJson()})},_renderPostCodeValidationMethod:function(){var e=this;0===e.$el.find(".twitter-typeahead").length&&((e=_.extend(e,M)).settings=_.extend(e.settings,e.defaultSettings),e.delegateEvents(),e._renderSuggestions())},_initCampaignHandler:function(){var t=this;require(["formV2campaign"],function(e){S=new e,(t=_.extend(t,S)).settings=_.extend(t.settings,t.defaultSettings),t.initCampaignDone||(t.initCampaign(),t.modelData.formType===t.settings.frmRestrictAccess&&H.dispatchEvent("cof:campaign:restrict:load",{restrictionType:t.modelData.restrictionType,accessDeniedMessage:t.modelData.accessDeniedMessage})),require(["campaignQnaHandler"],function(e){w=new e,(t=_.extend(t,w)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),t._setAnsweredQues()})}),t.$form.has(".c-samples").length&&require(["samplesHandler"],function(e){k=new e,(t=_.extend(t,k)).settings=_.extend(t.settings,t.defaultSettings),t.samplesInventory()})},_renderRegiserationMethods:function(){var t=this;t._hasBodyClass(t.settings.registrationPage)&&t.$form.find("[id*=MobileNumber]").prop("disabled",!0).data("disabled-field",!0),(t._hasBodyClass(t.settings.profilePage)||t._hasBodyClass(t.settings.registrationPage)||t._hasBodyClass(t.settings.forgetPasswordPage)||t._hasBodyClass(t.settings.resetPasswordPage))&&require(["formV2Registration"],function(e){h=new e,(t=_.extend(t,h)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),t.registerNewUser()})},_renderFormHandlers:function(){var e=this;(e=_.extend(e,L,P,A,V)).delegateEvents(),(e=_.extend(e,U)).settings=_.extend(e.settings,e.defaultSettings),e.delegateEvents(),(e=_.extend(e,R)).settings=_.extend(e.settings,e.defaultSettings),e.delegateEvents(),e._pageLoadMethods()},_formValidator:function(){var e=this;e._bindBackboneValidations(),e.validator.addRules(e,{rules:e._createValidationRules()}),e._validatorExtended()},_pwstrengthHandler:function(){var e=this;e.$form.find("input[type=password]").length&&require(["bootstrap","pwstrength"],function(){e.$form.find("input[name*=Password]").each(function(e,t){$(this).pwstrength()})})},_formDOBOnLoadMethod:function(){var t=this,i=this.$el.find(".input-date"),r=t.$el.find(t.settings.profileYear);0===r.length&&(r=t.$el.find("[name='"+t.settings.profileYear.slice(1)+"']")),(i.length||r.length)&&require(["formV2DobValidation"],function(e){y=new e,(t=_.extend(t,y)).settings=_.extend(t.settings,t.defaultSettings),t.delegateEvents(),i.length&&(i.data("date-picker")?(t.setElementActions(),o.on("window:scrolled",function(){i.is(":focus")&&i.blur()}),t.signupDOBValidation(t.allElementsConfig)):t.signupDOBValidation(t.allElementsConfig,"maskInput")),r.length&&t._DOBHandling()})},_rememberMe:function(e){var t=this.$form;$(e.currentTarget).is(":checked")&&this.customEventTracking(t,"rememberme"),T.handleRememberMe(e)},_setRedirectPath:function(){void 0!==this.tokenCookie&&this.modelData.formType&&"login"===this.modelData.formType&&(window.location.href=this.modelData.redirect)},_checkOptins:function(e){e=$(e.currentTarget).is(":checked");$("[id*=MobileNumber]").prop("disabled",!e)},_successHandler:function(e){var t,i;this.triggerMethod("beforeSuccess",e),e&&("UGCSignup"===this.$form.find("#formType-"+this.compJson.randomNumber).val()?this._successMiappiHandler(e):"community_create_password"===this.compJson.formType||"community_register"===this.compJson.formType?(i=(t=this).$form.attr("id"),t.$el.find(".form-error-msg").remove(),t.$form.addClass("js-processing").find("button[type=submit]").prop("disabled",!0),t.toggleLoader("show"),t._analyticEventInfo(ctConstants.forms,this.compJson.formType+" - "+i+" - OTP Verification Successful",ctConstants.engagement),T._amazonCognitoSignin(t)):this._successHandlerMethod(e)),this.triggerMethod("afterSuccess",e)},_successMiappiHandler:function(i){var r,o=this;200!==i.code&&201!==i.code||(r=i,o.$el.isContinue=!1,$(document).ready(function(){var e=new FormData,t=void 0===o.$form.find('[name="optIn-onlineBrand"]').val()?!!o.$form.find('[name="optIn-brand"]').is(":checked"):!!o.$form.find('[name="optIn-onlineBrand"]').is(":checked");e.append("email",o.$form.find('[name="contact-email"]').val()),e.append("caption",o.$form.find("#surveyResponseList-0-questionAnswersList-0-answers-0-answerText-"+o.compJson.randomNumber).val()),e.append("author",o.$form.find('[name="contact-givenName"]').val()),e.append("image",o.$form.find('input[type="file"]')[0].files[0]),e.append("__formexternal",JSON.stringify({first_name:o.$form.find('[name="contact-givenName"]').val(),last_name:o.$form.find('[name="contact-familyName"]').val(),city:o.$form.find('[name="contact-locality"]').val(),country:o.$form.find('[name="contact-country"]').val(),checkbox_pii:t,checkbox_over18:!!o.$form.find('[name="contact-legalAgeConfirmation"]').is(":checked"),checkbox_terms:!!o.$form.find('[name="checkbox_terms"]').is(":checked"),UnileverId:i.responseData.UnileverId})),$.ajax({url:$("#miappi-api-url").val(),data:e,processData:!1,contentType:!1,type:"POST",success:function(e){e&&o._successHandlerMethod(r)},error:function(e){r.code=e.status.toString(),o._successHandlerMethod(r)}})}))},_errorHandler:function(e){this.triggerMethod("beforeError",e),e&&this._errorHandlerMethod(e),this.triggerMethod("afterError",e)},_handleFormSubmit:function(e,t){var i=this,r=IEA.serializeFormObject(i.$form),o=i.$form.find('[name*="email"]'),n=i.modelData.formType;if(e.preventDefault(),i._isFormExpired())$("html, body").animate({scrollTop:i.$el.find(".c-alert--error").offset().top-220},i.defaultSetting.pageScrollAnimationSpeed);else{this.multiValueFields&&this.multiValueFields.length&&(r=i._setFormDataInMultiField(r)),i.model.unset(i.changedSet),i.model.set(r),i.changedSet=i.model.changed,i.validDate=!0,(i._hasBodyClass(i.settings.profilePage)||i._hasBodyClass(i.settings.registrationPage))&&i._smsOptinValidation(),!i._hasBodyClass(i.settings.resetPasswordPage)&&"uim_forgot_password"!==i.compJson.formType||((i=_.extend(i,F)).settings=_.extend(i.settings,i.defaultSettings),i.delegateEvents(),i._resetPasswordTracking()),(e=0===(e=i.$form.find(i.settings.profileYear)).length?i.$form.find("[name='"+i.settings.profileYear.slice(1)+"']"):e).length&&""!==i.$form.find("input[name*=Birthday]").val()&&i._customDateHandler();var r=!!i.$form.hasClass("community-no-validation")||i.model.isValid(!0),e=i._moduleSpecificValidations(),s=T.isUserLoggedIn(),a=i.isPreLoginFormType&&""!==s;if((!i.isvalidationRequired||i.validDate&&i.isvalidationRequired&&r)&&e&&!a)i.isFormValid=!0;else if(i.isFormValid=!1,i._invalidFieldMethod(),a)return r='<div class="form-v2-aws-message"><p class="form-v2-aws-message-text"><a href="'+i.compJson.profilePagePath+'" class="form-v2-aws-message-user">'+s+"</a> "+i.compJson.userLoggedin+'</p> <button class="form-v2-aws-logout">'+i.compJson.logoutLinkText+"</button></div>",i.$form.attr("hidden",!0).parent().append(r),!1;if(i.$errorBlock&&i.$errorBlock.hide(),i.isFormValid)if(i.$form.find(i.settings.campaignQuestionAndAnswersSection).length&&(i._cofSurveyResponseData(),i._cofSurveyFormData()),"voice"===i.modelData.formType&&i.modelData.voiceProvider)i._alexaFormSubmission();else if(i.$form.data("customSubmitHandler"))"function"==typeof i.customSubmitHandler?i.customSubmitHandler():T.registrationHelpers().moveNext();else if(""===i.form.postURL||i.isSubmitted||-1!==_.indexOf(i.settings.listOfCofFormType,n))if(i.form.postURL&&i.settings.isEcommerceUnifiedTemplate&&-1===_.indexOf(i.settings.listOfCofFormType,n)&&i.modelData.formType===i.settings.ecommerceDeliveryAddress)i._formSubmission();else switch(n){case i.settings.frmTypeLocal:i.campaignLocalHandler(i),i._resetCaptcha();break;case i.settings.frmTypeParticipation:case i.settings.frmNewUserOnly:case i.settings.frmRestrictAccess:case i.settings.frmSubmit:i.checkCampaignCookie(o.val())?(i.resetMsgBeforeSubmit(),i.setCofLocalStorage(i),i.setCofCookieParticipation(i),H.dispatchEvent("cof:loader:show",i),i._formSubmission()):i.alreadyParticipatedHandler()}else i._formSubmission()}},_formReset:function(e){var t=this;t._hasBodyClass(t.settings.signUpPage)?T.resetFormData(e,t.clonedObjSignUp,t.$form):t._hasBodyClass(t.settings.profilePage)&&T.resetFormData(e,t.clonedObj,t.$form)},popUpTip:function(e){e.stopPropagation(),$(e.currentTarget.parentElement).hasClass("captcha-help-icon")?$(e.currentTarget).find(".c-tooltip-info__copy").removeClass("show"):$(e.currentTarget).find(".c-tooltip-info__icon").trigger("click")},openCaptchaPopup:function(e){e.preventDefault(),$(e.currentTarget).find(".c-tooltip-info__copy").addClass("show")},_contactChangeHandler:function(e){var e=$(e.target),t=$(this.settings.smsBrand+", "+this.settings.smsAll);""!==e.val()?t.prop("disabled",!1):t.prop({disabled:!0,checked:!1})},cofSurveyData:function(e){var e=JSON.parse(e),t={surveyResponseList:this.cofSurveyFormData};return JSON.stringify($.extend(e,t))},_addMembershipLevel:function(e,t){var e=JSON.parse(e),i=H.getSessionStorageItem("referredById"),r=H.getSessionStorageItem("referredChannel"),o=H.getLocalStorageItem("returnUrl"),n=window.location.search,n=new URLSearchParams(n).get("resourceTitle");return JSON.stringify($.extend(e,{community:{membershipLevel:t,referredById:i,referredChannel:r,resourceUrl:o,resourceTitle:n}}))},_cofSurveyFormData:function(){var i,r=this;_.each(r.allElementsConfig,function(e,t){e.campaignQuestionAndAnswers&&(i=[{surveyId:e.campaignQuestionAndAnswers.randomNumber,questionAnswersList:r.cofSurveyResponseData}])}),r.cofSurveyFormData=i},_cofSurveyResponseData:function(){var r,o,n,s,a,d,l,m,c=this,e=c.$form.find(c.settings.campaignQuestionAndAnswersSection),u=[],f=[],p=[],g=c.$el.parents(".c-campaign-wrapper").attr("data-ccid");c.cofSurveyResponseData=[],e.each(function(e,t){var i=[];o=$(this).find(".js-question"),r=o.data("survey-que-id").toString(),o=o.find(".o-text__heading-2").text(),l=$(this).find(".c-res"),0!==e&&(f.push("|"),u.push("|"),p.push("|")),u.push(r),m="",l.each(function(e,t){s=$(this).data("res-id").toString(),a=$(this).data("survey-res-id").toString(),d=$(this).find(".c-res__heading").text(),n=!!$(this).hasClass("res-active"),m=n&&""!==m?m+","+s:s,i.push({answer:n,id:s,sqaId:a,answerText:d})}),f.push(m),p.push(r+":"+m),c.analyticsQList=u.join(""),c.analyticsAList=f.join(""),c.analyticsQnAList=p.join(""),g&&H.setLocalStorageItem(g+"-qna-track",(H.getLocalStorageItem(g+"-qna-track")||"")+c.analyticsQnAList),c.cofSurveyResponseData.push({id:r,question:o,answers:i})})},_teaxtareaCharacterCount:function(e){var t=this,e=$(e.currentTarget),i=e.val().length,r=e.parent().find(t.settings.textareaCharCountWrapper),o=e.data("char-count-enabled"),n=parseInt(e.data("char-length")),s=e.data("char-length-error-msg");o&&n&&(r.text(n-i),i<=n?(e.removeClass(t.settings.formInputError),e.parent().find(t.settings.helpBlock).html("").removeClass(t.settings.formElementError).addClass("hidden"),r.removeClass("error-cl")):(e.addClass(t.settings.formInputError),e.parent().find(t.settings.helpBlock).html(s).addClass(t.settings.formElementError).removeClass("hidden"),r.addClass("error-cl")))},surveyFieldUpdateHandler:function(e){var e=$(e.currentTarget),t=e.attr("id"),i=t.indexOf("-",23),r=t.substring(0,i)+"-",o=e.parents("label").find(".c-form-radio__label").text(),n=t.split("-").slice(0,-6).join("-")+"-surveyId",i=t.indexOf("-",r.length+1),r=t.substring(0,i+1);$("input[name="+r+"id], input[name="+r+"question], input[name="+r+"answers-0-answer]").removeAttr("data-exclude"),e.removeAttr("data-exclude"),o&&$("input[name="+r+"answers-0-answer]").val(o),$("input[name="+n+"]").removeAttr("data-exclude"),e.hasClass("c-form-dropdown")&&(i=e.children(":selected").text(),r=e.val(),o=t.substring(t.indexOf("-")+1,t.lastIndexOf("-")),$("input[name="+o+"-id]").val(r),$("input[name="+o+"-answerText]").val(i))},setUtmParametersForEpsilon:function(){var e,t,i=H.getQueryStringVal("utm_campaign"),r=H.getQueryStringVal("utm_source");r&&i&&(e=this.$form[0],(t=document.createElement("input")).type="hidden",t.name="utmParameters",t.value=encodeURIComponent("utm_source="+r+"&utm_campaign="+i),e.appendChild(t))},onCognitoUserLogin:function(e){var t=e.modelData.profilePagePath;e.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),-1!==_.indexOf(e.settings.blockedFormForLoggedInUser,e.formType)&&t&&(window.location.href=t),"uim_update_profile"===e.formType&&e._getProfileDetails(T.decodeStr(T.getCookie("_ulcogid")),T.getCookie("_ulcogtoken")),"community_profile"===e.formType&&e._getCommunityProfileDetails(T.decodeStr(T.getCookie("_ulcogid")),T.getCookie("_ulcogtoken"))},onCognitoUserNotLogin:function(e){e.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),"uim_change_password"===e.formType&&e.$form.find("[type=submit]").prop("disabled",!1)},onCognitoUserError:function(e){e.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),"uim_change_password"===e.formType&&e.$form.find("[type=submit]").prop("disabled",!1)},onCognitoUserLoginSuccess:function(e){var t,i=e,r=T._getformReturnUrl(),r=r||i.modelData.redirect;i.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),t=localStorage.getItem("intendedPage"),"community_create_password"===i.formType||"community_register"===i.formType?(i.$form.addClass("js-processing").find("button[type=submit]").prop("disabled",!0),this._updateMembershipLevel(e)):"community_login"===i.formType?(i.$form.addClass("js-processing").find("button[type=submit]").prop("disabled",!0),this._getCommunityUserProfile(e)):t?(localStorage.removeItem("intendedPage"),window.location.href=decodeURIComponent(t)):r&&(window.location.href=r)},onCognitoUserLoginFailure:function(e){var t=e.formContext,e=e.apiError;t.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),t.toggleLoader("hide"),t._renderServerSideErrorMessages(t.modelData.incorrectPassword||e.message,!1)},onCognitoUserSignout:function(){window.location.reload()},onCognitoChangePasswordSuccess:function(e){e._renderSuccessMessage(e.modelData.successMessage),e.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),e.toggleLoader("hide")},onCognitoChangePasswordFailure:function(e){e._renderServerSideErrorMessages(e.modelData.incorrectPassword),e.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),e.toggleLoader("hide")},onCognitoDeleteUserSuccess:function(e){e._renderServerSideErrorMessages(e.form.failureMessage,e.$form),e.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),e.toggleLoader("hide"),T._removeULCognitoUserCookie()},onCognitoDeleteUserFailure:function(e){e._renderServerSideErrorMessages(e.form.failureMessage,e.$form),e.$form.removeClass("js-processing").find("button[type=submit]").prop("disabled",!1),e.toggleLoader("hide"),T._removeULCognitoUserCookie()},_awsUserSignout:function(e){e.preventDefault(),T._amazonCognitoUserSignOut(this)},toggleLoader:function(e){var t=this.$form.find(".o-preloader-container");this.addLoader(this),"show"===e?t.removeClass("hidden"):t.addClass("hidden")},addLoader:function(e){0===e.$form.find(".o-preloader-container").length&&e.$form.append(e.settings.formLoaderHTML)}})})}),define("form-v2",["d2-form-v2"],function(){"use strict";return IEA.module("UI.form-v2",function(e,t,i){_.extend(e,{onEnable:function(){var e,t;$(".phone-number").parents(".component-wrapper").addClass("phone-wrapper"),$(".ext").parents(".component-wrapper").addClass("ext-wrapper"),$("body").hasClass("ie9")&&$(".sec-phone-number").parents(".component-wrapper").addClass("sec-phone-wrapper"),"CA"===$('[name="locale"]').val().split("-").pop()&&(e=this.$form.find('[name*="optIn-"]'),"contactus_us"!==(t=this.$form.find('[name="entity"]').val())&&"signup_us"!==t&&"sampling_us"!==t||e.on("change",function(){e.not(this).prop("checked",!1)}))}})})}),define("iea-form-v2",["validator","datepicker","popup"],function(){"use strict";return IEA.module("UI.form-v2",function(e,i,t){_.extend(e,{defaultSettings:{calenderInput:".input-calendar",calenderTodayBtn:"linked",calenderAutoclose:!0,calenderTodayHighlight:!0,popupClass:"white-popup-block",popupOpenType:"inline",multivalueField:".multivalue-field"},events:{"submit form":"_handleFormSubmit","reset form":"_handleFormReset","click .add-input":"_addMultiValueField","click .remove-input":"_removeInput","click .calendar-input":"_openCalendar"},initialize:function(e){this._super(e),this.validator=i.form.validator,this.formCalendarLoaded=!1,this.changedSet={},this.isvalidationRequired=!1,this.isFormValid=!1,this.isSubmitted=!1,this.multiValueFields={},this.validator.addValidation(this,{model:this.model}),this.triggerMethod("init")},render:function(){return this.$el.html(this.template(this.getModelJSON())),!1===this._isEnabled&&(this.enable(),this._isEnabled=!0),this.triggerMethod("render"),this},enable:function(){this.triggerMethod("beforEnable");var e,t,i=this.moduleName.hyphenToCamelCase(),i=this.getModelJSON()[i],r=i.formElementsConfig,o=0;for(this.$form=$("form",this.$el),this.$formElements=this.$form.find(":input"),this.popup=IEA.popup(),this.form={isAjax:!(!this.$form.data("ajax")&&!i.isAjax)&&i.isAjax,postURL:this.$form.attr("action")||i.servletPath?i.servletPath:"",failureMessage:this.$form.data("fail")||i.failureMessage?i.failureMessage:"Submission Failed",successMessage:this.$form.data("success")||i.successMessage?i.successMessage:"Thank you for your submission",validation:!(!this.$form.data("validation")&&!i.validation)&&i.validation,successRedirectURL:!(!this.$form.data("redirect")&&!i.redirect)&&i.redirect,errorRedirectURL:!(!this.$form.data("redirect")&&!i.failureRedirect)&&i.failureRedirect},this.setElementActions(),this.validator.addRules(this,{rules:this._createValidationRules()}),o=0;o<r.length;o++)(e=r[o].formElement)&&e.multivalue&&(this.multiValueFields[e.name]={name:e.name,rules:this.model.validation[e.name]},t=$("input[name^="+e.name+"]"),this._setUpMultiValueField(t,e.name,e.name+"_1"),delete this.model.validation[e.name]);this.triggerMethod("enable")},setElementActions:function(){var e=this.defaultSettings,t=$(e.calenderInput,this.$el);!1===this.formCalendarLoaded&&(t.datepicker({format:t.data("format"),todayBtn:e.calenderTodayBtn,autoclose:e.calenderAutoclose,todayHighlight:e.calenderTodayHighlight,orientation:i.getValue("isMobileBreakpoint")?"top":"auto"}).on("changeDate",function(){t.datepicker("hide")}),this.formCalendarLoaded=!0,t.on("focus",function(){i.getValue("isDesktopBreakpoint")||t.blur()}))},unsetElementActions:function(){$dateInput.datepicker("remove"),this.formCalendarLoaded=!1},onMatchDesktop:function(){this.setElementActions()},onUnmatchDesktop:function(){this.setElementActions()},show:function(){this._super()},hide:function(e,t,i){this._super(e,t,i)},clean:function(){this._super(),this.unsetElementActions(),this.validator.removeValidation(this,{model:this.model})},_createValidationRules:function(){for(var e,t,i,r=this.moduleName.hyphenToCamelCase(),o=this.getModelJSON()[r].formElementsConfig,n={},s=0,a=0,s=0;s<o.length;s++)if(e=o[s],!_.isFunction(e.formElement)&&(n[e.formElement.name]=[],void 0!==e.formElement.rules&&_.isArray(e.formElement.rules)))for(a=0;a<e.formElement.rules.length;a++)this.isvalidationRequired=!0,t=e.formElement.rules[a],n[e.formElement.name].push({xss:!0}),_.has(t,"pattern")?"creditcard"===t.pattern?n[e.formElement.name].push({creditcard:!0,msg:t.msg}):(i=decodeURIComponent(t.pattern).replace(/%24/g,"$"),n[e.formElement.name].push({pattern:this.validator.patterns[i]||new RegExp(i),msg:t.msg})):n[e.formElement.name].push(t);return n},_handleFormSubmit:function(e){var t,i=IEA.serializeFormObject(this.$form),r=0;for(r in e.preventDefault(),this.model.unset(this.changedSet),this.model.set(i),this.changedSet=this.model.changed,!this.isvalidationRequired||this.isvalidationRequired&&this.model.isValid(!0)?this.isFormValid=!0:this.isFormValid=!1,this.multiValueFields)if(this.multiValueFields.hasOwnProperty(r)){var o,n=this.multiValueFields[r];for(t in i)i.hasOwnProperty(t)&&(o=t.match(n.name))&&0<o.length&&(o=$("input[name="+t+"]")).siblings("input[type=hidden]").val(o.val());i[n]=[]}this.$errorBlock&&this.$errorBlock.hide(),this.isFormValid&&""!==this.form.postURL&&!1===this.isSubmitted&&(this.form.isAjax?((e=$.post(this.form.postURL,this.$form.serialize())).done($.proxy(this._successHandler,this)),e.fail($.proxy(this._errorHandler,this))):this.$form[0].submit(),this.triggerMethod("formSubmit",this),this.isSubmitted=!0)},_handleFormReset:function(){var e=this,t=IEA.serializeFormObject(this.$form);this.model.unset(t),this.isFormValid=!1,this.isSubmitted=!1,this.$formElements.each(function(){e.validator.callbacks.valid(e,$(this).attr("name"))}),$(".form-group .multivalue").each(function(){$(this).find(e.defaultSettings.multivalueField).each(function(e){0===e?$(this).find(".remove-input").removeClass("remove-input").addClass("add-input").find(".glyphicon-minus").removeClass("glyphicon-minus").addClass("glyphicon-plus"):$(this).remove()})}),this.triggerMethod("formReset",this)},_successHandler:function(e){200===e.responseHeaders.status?void 0!==this.form.successRedirectURL&&""!==this.form.successRedirectURL&&!1!==this.form.successRedirectURL?IEA.History.started?Router.navigate(this.form.successRedirectURL,{trigger:!0}):window.location.href=this.form.successRedirectURL:(this.$sucessMsgBlock=$('<div class="form-success-msg"><span class="glyphicon glyphicon-ok"></span><span class="success-msg-text">'+this.form.successMessage+"</span></div>"),this.$form.before(this.$sucessMsgBlock),this.$form.hide()):this._errorHandler(),this.triggerMethod("success",this),this.isSubmitted=!1},_errorHandler:function(){void 0!==this.form.errorRedirectURL&&""!==this.form.errorRedirectURL&&!1!==this.form.errorRedirectURL?IEA.History.started?Router.navigate(this.form.errorRedirectURL,{trigger:!0}):window.location.href=this.form.errorRedirectURL:(this.$errorBlock=$('<div class="form-error-msg text-danger"><span class="glyphicon glyphicon-warning-sign"></span><span class="error-msg-text">'+this.form.failureMessage+"</span></div>"),this.$form.before(this.$errorBlock)),this.triggerMethod("error",this.form.failureMessage),this.isSubmitted=!1},_addMultiValueField:function(e){var t,i,e=$(e.currentTarget),r=e.parents(this.defaultSettings.multivalueField),o=e.parents(".multivalue ").find(this.defaultSettings.multivalueField),e=e.parent().attr("data-input-limit");(e=e||1e5)&&e>o.length?(o=(t=(e=$(r[0]).clone(!0)).find("input[type=text]").attr("name").slice(0,-2))+"_"+(o.length+1),i=e.find("input").val(""),$(r[0]).find(".add-input").removeClass("add-input").addClass("remove-input"),$(r[0]).find(".glyphicon-plus").removeClass("glyphicon-plus").addClass("glyphicon-minus"),$(r[0]).after(e),this._setUpMultiValueField(i,t,o)):alert("Limit reached")},_setUpMultiValueField:function(e,t,i){var r={};e.attr("name",i),e.siblings("input[type=hidden]").attr("name",t),r[i]=this.multiValueFields[t].rules,this.validator.addRules(this,{rules:r})},_removeInput:function(e){$(e.currentTarget).parents(this.defaultSettings.multivalueField).remove()},_openCalendar:function(e){$(e.currentTarget).siblings("input").focus()},_populateElems:function(){var e,t,i=this.form.elements,r={};for(t in i)"object"==typeof i[t]&&-1===["submit","reset"].indexOf(i[t].type)&&(e=$(i[t]).parents(".row:first").find(".error")[0],r[i[t].name]={node:i[t],type:i[t].type,required:i[t].dataset.required||"undefined",constraint:unescape(i[t].dataset.constraint),errorRequired:e.dataset.errorRequired,errorConstraint:e.dataset.errorConstraint,errorNode:e});return r}})})});