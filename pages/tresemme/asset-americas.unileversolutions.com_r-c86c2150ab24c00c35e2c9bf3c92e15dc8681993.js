!function(e,n){"use strict";var t,r;"function"==typeof define&&define.amd?define(["backbone","underscore","jquery"],function(){return n.apply(e,arguments)}):"object"==typeof exports?(t=require("backbone"),r=require("underscore"),t.$=t.$||require("jquery"),module.exports=n.call(e,t,r,t.$)):n.call(e,e.Backbone,e._,e.Backbone.$)}("object"==typeof global?global:this,function(i,c,a){"use strict";var s=this,t=i.View,o=Array.prototype.push,l=Array.prototype.concat,u=Array.prototype.splice,r=String.prototype.trim?c.bind(String.prototype.trim.call,String.prototype.trim):a.trim,f=i.View.extend({_render:function(){var e=this,n=e.__manager__,t=e.beforeRender,r=e.deferred();if(e.hasRendered&&e._removeViews(),n.callback=function(){delete n.isAsync,delete n.callback,e.trigger("beforeRender",e),e._viewRender(n).render().then(function(){r.resolve()})},t){t=t.call(e,e);if(t&&t.then&&(n.isAsync=!0,t.then(function(){n.callback(),r.resolve()},r.resolve)),!1===t)return r.resolve()}return n.isAsync||n.callback(),r.promise()},_applyTemplate:function(e,n,t){c.isString(e)&&(n.noel?(e=a.parseHTML(e,!0),this.$el.slice(1).remove(),this.$el.replaceWith(e),this.setElement(e,!1)):this.html(this.$el,e)),t.resolveWith(this,[this])},_viewRender:function(r){var i,t,a,o=this;function s(e,n){var t;r.callback=function(e){delete r.isAsync,delete r.callback,o._applyTemplate(e,r,a)},f.cache(i,n),n&&(t=o.renderTemplate.call(o,n,e)),r.isAsync||o._applyTemplate(t,r,a)}return{render:function(){var n=o.serialize,e=o.template;return a=o.deferred(),c.isFunction(n)&&(n=n.call(o)),r.callback=function(e){delete r.isAsync,delete r.callback,s(n,e)},"string"==typeof e&&(i=o.prefix+e),(t=f.cache(i))?s(n,t):("string"==typeof e?t=o.fetchTemplate.call(o,o.prefix+e):"function"==typeof e?t=e:null!=e&&(t=o.fetchTemplate.call(o,e)),r.isAsync||s(n,t)),a}}},constructor:function(e){this.manage=!0,c.extend(this,e),i.View.apply(this,arguments)},async:function(){var e=this.__manager__;return e.isAsync=!0,e.callback},promise:function(){return this.__manager__.renderDeferred.promise()},then:function(){return this.promise().then.apply(this,arguments)},renderViews:function(e){var n=this,t=n.__manager__,r=n.deferred(),e=(e=e&&c.isArray(e)?c.chain(e):n.getViews(e)).map(function(e){return e.render().__manager__.renderDeferred}).value();return t.renderDeferred=r.promise(),n.when(e).then(function(){r.resolveWith(n,[n])}),n},insertView:function(e,n){return n?this.setView(e,n,!0):this.setView(e,!0)},insertViews:function(t){return c.isArray(t)?this.setViews({"":t}):(c.each(t,function(e,n){t[n]=c.isArray(e)?e:[e]}),this.setViews(t))},getView:function(e){return this.getViews(e=null==e?arguments[1]:e).first().value()},getViews:function(e){var n;return"string"==typeof e?(e=this.sections[e]||e,n=this.views[e]||[],c.chain([].concat(n))):(n=c.chain(this.views).map(function(e){return c.isArray(e)?e:[e]},this).flatten(),"object"==typeof e?n.where(e):"function"==typeof e?n.filter(e):n)},removeView:function(e){e=this.getViews(e).each(function(e){e.remove()});return e.value(),e},setView:function(e,n,t){var r,i=this;if("string"!=typeof e&&(t=n,n=e,e=""),r=n.__manager__)return r.parent=i,r=r.selector=i.sections[e]||e,t?(i.views[r]=l.call([],i.views[e]||[],n),i.__manager__.insert=!0,n):(i.getView(e)!==n&&i.removeView(e),i.views[r]=n);throw new Error("The argument associated with selector '"+e+"' is defined and a View.  Set `manage` property to true for Backbone.View instances.")},setViews:function(e){return c.each(e,function(e,n){if(c.isArray(e))return c.each(e,function(e){this.insertView(n,e)},this);this.setView(n,e)},this),this},render:function(){var t=this,r=t.__manager__,n=r.parent,i=n&&n.__manager__,a=t.deferred();function o(){function e(){var e=s.console,n=t.afterRender;n&&n.call(t,t),t.trigger("afterRender",t),r.noel&&1<t.$el.length&&c.isFunction(e.warn)&&!t.suppressWarnings&&(e.warn("`el: false` with multiple top level elements is not supported."),c.isFunction(e.trace)&&e.trace())}return c.each(t.views,function(e,n){c.isArray(e)&&t.htmlBatch(t,e,n)}),!n||r.insertedViaFragment||t.contains(n.el,t.el)||n.partial(n.$el,t.$el,i,r),t.delegateEvents(),t.hasRendered=!0,r.renderInProgress=!1,delete r.triggeredByRAF,r.queue&&r.queue.length?r.queue.shift()():delete r.queue,i&&(i.renderInProgress||i.queue)?n.once("afterRender",e):e(),a.resolveWith(t,[t])}return r.renderInProgress=!0,t._registerWithRAF(function(){t._render().done(function(){if(!c.keys(t.views).length)return o();var e=c.map(t.views,function(e){var n=c.isArray(e);return n&&e.length?t.when(c.map(e,function(e){return e.__manager__.insertedViaFragment=!0,e.render().__manager__.renderDeferred})):n?e:e.render().__manager__.renderDeferred});t.when(e).done(o)})},a),r.renderDeferred=a,t},remove:function(){return f._removeView(this,!0),this._remove.apply(this,arguments)},_registerWithRAF:function(e,n){var t=this,r=t.__manager__,i=r.parent&&r.parent.__manager__;if(!1===this.useRAF)r.queue?o.call(r.queue,e):(r.queue=[],e());else{if(r.deferreds=r.deferreds||[],r.deferreds.push(n),n.done(function(){for(var e=0;e<r.deferreds.length;e++)r.deferreds[e].resolveWith(t,[t]);r.deferreds=[]}),this._cancelQueuedRAFRender(),i&&i.triggeredByRAF)return a();r.rafID=t.requestAnimationFrame(a)}function a(){r.rafID=null,r.triggeredByRAF=!0,e()}},_cancelQueuedRAFRender:function(){var e=this.__manager__;null!=e.rafID&&this.cancelAnimationFrame(e.rafID)}},{_cache:{},_removeViews:function(e,n){"boolean"==typeof e&&(n=e,e=this),(e=e||this).getViews().each(function(e){(e.hasRendered||n)&&f._removeView(e,n)}).value()},_removeView:function(e,n){var t,r=e.__manager__,i=r.parent&&r.parent.__manager__,a=("boolean"==typeof e.keep?e:e.options).keep;if((!a&&i&&!0===i.insert||n)&&(f.cleanViews(e),e._removeViews(!0),e.$el.remove(),e._cancelQueuedRAFRender(),r.parent)){if(t=r.parent.views[r.selector],c.isArray(t))return c.each(c.clone(t),function(e,n){e&&e.__manager__===r&&u.call(t,n,1)}),void(c.isEmpty(t)&&r.parent.trigger("empty",r.selector));delete r.parent.views[r.selector],r.parent.trigger("empty",r.selector)}},cache:function(e,n){return e in this._cache&&null==n?this._cache[e]:null!=e&&null!=n?this._cache[e]=n:void 0},cleanViews:function(e){c.each(l.call([],e),function(e){e.trigger("cleanup",e),e.unbind(),e.model instanceof i.Model&&e.model.off(null,null,e),e.collection instanceof i.Collection&&e.collection.off(null,null,e),e.stopListening(),c.isFunction(e.cleanup)&&e.cleanup()})},configure:function(e){c.extend(f.prototype,e),e.manage&&(i.View.prototype.manage=!0),!1===e.el&&(i.View.prototype.el=!1),!0===e.suppressWarnings&&(i.View.prototype.suppressWarnings=!0),!1===e.useRAF&&(i.View.prototype.useRAF=!1),e._&&(c=e._)},setupView:function(e,n){n=c.extend({},n),c.each(l.call([],e),function(t){var r,e;t.__manager__||(e=f.prototype,c.defaults(t,{views:{},sections:{},__manager__:{},_removeViews:f._removeViews,_removeView:f._removeView},f.prototype),t.options=n,c.extend(t,n),t._remove=i.View.prototype.remove,t.render=f.prototype.render,t.remove!==e.remove&&(t._remove=t.remove,t.remove=e.remove),e=n.views||t.views,c.keys(e).length&&(r=e,t.views={},c.each(r,function(e,n){"function"==typeof e&&(r[n]=e.call(t,t))}),t.setViews(r)))})}}),e=(f.VERSION="0.9.7",i.Layout=f,i.View.prototype.constructor=function(e){var n;("el"in(e=e||{})?!1===e.el:!1===this.el)&&(n=!0),(e.manage||this.manage)&&f.setupView(this,e),this.__manager__&&(this.__manager__.noel=n,this.__manager__.suppressWarnings=e.suppressWarnings),t.apply(this,arguments)},i.View=i.View.prototype.constructor,i.View.extend=t.extend,i.View.prototype=t.prototype,{prefix:"",useRAF:!0,deferred:function(){return a.Deferred()},fetchTemplate:function(e){return c.template(a(e).html())},renderTemplate:function(e,n){return r(e.call(this,n))},serialize:function(){return this.model?c.clone(this.model.attributes):{}},partial:function(e,n,t,r){var i;r.selector&&(e=t.noel&&(i=e.filter(r.selector)).length?i:e.find(r.selector)),t.insert?this.insert(e,n):this.html(e,n)},html:function(e,n){e.empty().append(n)},htmlBatch:function(r,e,n){var t=r.__manager__,n={selector:n},e=c.reduce(e,function(e,n){var t=("boolean"==typeof n.keep?n:n.options).keep&&a.contains(r.el,n.el);return n.el&&!t&&e.push(n.el),e},[]);return this.partial(r.$el,a(e),t,n)},insert:function(e,n){e.append(n)},when:function(e){return a.when.apply(null,e)},contains:function(e,n){return a.contains(e,n)},requestAnimationFrame:function(){for(var i=0,e=["ms","moz","webkit","o"],n=s.requestAnimationFrame,t=0;t<e.length&&!s.requestAnimationFrame;++t)n=s[e[t]+"RequestAnimationFrame"];return c.bind(n=n||function(e){var n=(new Date).getTime(),t=Math.max(0,16-(n-i)),r=s.setTimeout(function(){e(n+t)},t);return i=n+t,r},s)}(),cancelAnimationFrame:function(){for(var e=["ms","moz","webkit","o"],n=s.cancelAnimationFrame,t=0;t<e.length&&!s.requestAnimationFrame;++t)n=s[e[t]+"CancelAnimationFrame"]||s[e[t]+"CancelRequestAnimationFrame"];return c.bind(n=n||function(e){clearTimeout(e)},s)}()});return c.extend(f.prototype,e),f});