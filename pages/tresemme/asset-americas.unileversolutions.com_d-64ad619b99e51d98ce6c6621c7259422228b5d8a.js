!function(t){"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):"function"==typeof define&&define.amd&&define(["backbone","underscore"],t)}(function(p,t){return p.Validation=function(d){"use strict";var l,F,c,i={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},o={formatLabel:function(t,e){return n[i.labelFormatter](t,e)},format:function(){var n=Array.prototype.slice.call(arguments);return n.shift().replace(/\{(\d+)\}/g,function(t,e){return void 0!==n[e]?n[e]:t})}},f=function(n,u,i){return u=u||{},i=i||"",d.each(n,function(t,e){n.hasOwnProperty(e)&&(t&&"object"==typeof t&&!(t instanceof Array||t instanceof Date||t instanceof RegExp||t instanceof p.Model||t instanceof p.Collection)?f(t,u,i+e+"."):u[i+e]=t)}),u},t=(l=function(t){return d.reduce(d.keys(d.result(t,"validation")||{}),function(t,e){return t[e]=void 0,t},{})},F=function(u,i,a,r){return d.reduce(function(t,e){t=t.validation&&d.result(t,"validation")[e]||{};return(d.isFunction(t)||d.isString(t))&&(t={fn:t}),d.isArray(t)||(t=[t]),d.reduce(t,function(e,n){return d.each(d.without(d.keys(n),"msg"),function(t){e.push({fn:v[t],val:n[t],msg:n.msg})}),e},[])}(u,i),function(t,e){var n=d.extend({},o,v),n=e.fn.call(n,a,i,e.val,u,r);return!1!==n&&!1!==t&&(n&&!t?d.result(e,"msg")||n:t)},"")},c=function(n,t){var u,i={},a=!0,r=d.clone(t),t=f(t);return d.each(t,function(t,e){(u=F(n,e,t,r))&&(i[e]=u,a=!1)}),{invalidAttrs:i,isValid:a}},{version:"0.9.1",configure:function(t){d.extend(i,t)},bind:function(e,n){var t=(n=d.extend({},i,h,n)).model||e.model,u=n.collection||e.collection;if(void 0===t&&void 0===u)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";t?a(e,t,n):u&&(u.each(function(t){a(e,t,n)}),u.bind("add",s,{view:e,options:n}),u.bind("remove",m))},unbind:function(t,e){var n=(e=d.extend({},e)).model||t.model,e=e.collection||t.collection;n?r(n):e&&(e.each(function(t){r(t)}),e.unbind("add",s),e.unbind("remove",m))},mixin:u(null,i)});function u(o,s){return{preValidate:function(t,e){var n,u=this,i={};return d.isObject(t)?(d.each(t,function(t,e){(n=u.preValidate(e,t))&&(i[e]=n)}),d.isEmpty(i)?void 0:i):F(this,t,e,d.extend({},this.attributes))},isValid:function(t){var n=f(this.attributes);return d.isString(t)?!F(this,t,n[t],d.extend({},this.attributes)):d.isArray(t)?d.reduce(t,function(t,e){return t&&!F(this,e,n[e],d.extend({},this.attributes))},!0,this):(!0===t&&this.validate(),!this.validation||this._isValid)},validate:function(t,e){var n=this,i=!t,a=d.extend({},s,e),e=l(n),u=d.extend({},e,n.attributes,t),r=f(t||u),F=c(n,u);if(n._isValid=F.isValid,d.each(e,function(t,e){F.invalidAttrs.hasOwnProperty(e)||a.valid(o,e,a.selector)}),d.each(e,function(t,e){var n=F.invalidAttrs.hasOwnProperty(e),u=r.hasOwnProperty(e);n&&(u||i)&&a.invalid(o,e,F.invalidAttrs[e],a.selector)}),d.defer(function(){n.trigger("validated",n._isValid,n,F.invalidAttrs),n.trigger("validated:"+(n._isValid?"valid":"invalid"),n,F.invalidAttrs)}),!a.forceUpdate&&0<d.intersection(d.keys(F.invalidAttrs),d.keys(r)).length)return F.invalidAttrs}}}function a(t,e,n){d.extend(e,u(t,n))}function r(t){delete t.validate,delete t.preValidate,delete t.isValid}function s(t){a(this.view,t,this.options)}function m(t){r(t)}var e,h=t.callbacks={valid:function(t,e,n){t.$("["+n+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,n,u){t.$("["+u+'~="'+e+'"]').addClass("invalid").attr("data-error",n)}},D=t.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},b=t.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},n=t.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace(/_/g," ")},label:function(t,e){return e.labels&&e.labels[t]||n.sentenceCase(t,e)}},v=t.validators=(e=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){return null===t?"":t.toString().replace(/^\s+/,"").replace(/\s+$/,"")},{fn:function(t,e,n,u,i){return(n=d.isString(n)?u[n]:n).call(u,t,e,i)},required:function(t,e,n,u,i){i=d.isFunction(n)?n.call(u,t,e,i):n;return!(!i&&!x(t))&&(i&&!x(t)?this.format(b.required,this.formatLabel(e,u)):void 0)},acceptance:function(t,e,n,u){if("true"!==t&&(!d.isBoolean(t)||!1===t))return this.format(b.acceptance,this.formatLabel(e,u))},min:function(t,e,n,u){if(!g(t)||t<n)return this.format(b.min,this.formatLabel(e,u),n)},max:function(t,e,n,u){if(!g(t)||n<t)return this.format(b.max,this.formatLabel(e,u),n)},range:function(t,e,n,u){if(!g(t)||t<n[0]||t>n[1])return this.format(b.range,this.formatLabel(e,u),n[0],n[1])},length:function(t,e,n,u){if(!d.isString(t)||t.length!==n)return this.format(b.length,this.formatLabel(e,u),n)},minLength:function(t,e,n,u){if(!d.isString(t)||t.length<n)return this.format(b.minLength,this.formatLabel(e,u),n)},maxLength:function(t,e,n,u){if(!d.isString(t)||t.length>n)return this.format(b.maxLength,this.formatLabel(e,u),n)},rangeLength:function(t,e,n,u){if(!d.isString(t)||t.length<n[0]||t.length>n[1])return this.format(b.rangeLength,this.formatLabel(e,u),n[0],n[1])},oneOf:function(t,e,n,u){if(!d.include(n,t))return this.format(b.oneOf,this.formatLabel(e,u),n.join(", "))},equalTo:function(t,e,n,u,i){if(t!==i[n])return this.format(b.equalTo,this.formatLabel(e,u),this.formatLabel(n,u))},pattern:function(t,e,n,u){if(!x(t)||!t.toString().match(D[n]||n))return this.format(b[n]||b.inlinePattern,this.formatLabel(e,u),n)}});function g(t){return d.isNumber(t)||d.isString(t)&&t.match(D.number)}function x(t){return!(d.isNull(t)||d.isUndefined(t)||d.isString(t)&&""===e(t)||d.isArray(t)&&d.isEmpty(t))}return d.each(v,function(t,e){v[e]=d.bind(v[e],d.extend({},o,v))}),t}(t),p.Validation});