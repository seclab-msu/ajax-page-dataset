define(["commonService","formService","analytics"],function(){"use strict";var i=null,m=null,o=null;function t(){i=new IEA.commonService,m=new IEA.formService,o=new IEA.Analytics}return _.extend(t.prototype,{_setFormDataInMultiField:function(t){for(var e=0,e=0;e<this.multiValueFields.length;e++){for(var o,i=this.multiValueFields[e],a=0;a<t.length;a++)(o=a.match(i.name))&&0<o.length&&(o=$("input[name="+a+"]")).siblings("input[type=hidden]").val(o.val());t[i]=[]}return t},_invalidFieldMethod:function(){this._scrollToError(),this.$form.find(this.settings.captchaText).length&&this._reloadCaptcha(),this._hasBodyClass(".registration-page")&&m.registrationHelpers().setFormHeight()},_moduleSpecificValidations:function(){var t,e=!0,o=!0,i=!0,a=!0,s=m.validationHelpers(this.settings),r=void 0===this.isValidFileUpload||this.isValidFileUpload,n=!0;return $(this.settings.checkoutFormV2).length?i=this.matchEmailAddress():this.checkoutFormV2Flag=!0,t=s.confirmPassword(),s=s.passwordMismatch(this),this.$form.find(this.settings.formElementsGroupSection).length&&(o=this._formElementsGroupHandler()),this.$form.find(this.settings.captchaText).length&&(e=this._captchaHandler()),this.$form.find(this.settings.campaignQuestionAndAnswersSection).length&&(a=this._campaignQuesAnswerHandler()),this.$form.find(".advance-optins--wrapper").length&&(n="true"===this.$form.find(".advance-optins--wrapper").attr("data-valid")),!!(i&&t&&s&&o&&e&&this.checkoutFormV2Flag&&r&&a&&n)},_formDatatoSend:function(){var t=m.formToJson(this.$form);return $(this.settings.rewardComp).length&&(t=this.addRewardData(t)),this.$form.find(this.settings.campaignQuestionAndAnswersSection).length&&(t=this.cofSurveyData(t)),$(this.settings.signUpPage).length&&(t=m._addUtmParamData(t)),$(this.settings.checkoutFormV2).length&&(this.confirmEmail=this.matchEmailAddress(),t=this.createCheckoutFormJson(t)),this._hasBodyClass(this.settings.loginPage)||(t=m.sendDataToPRM(t)),i.getLocalStorageItem(this.compLocale+"-diagnosticToolSignupSurveyResponses",!0)&&(t=this._prmDataToSend(t)),i.getQueryStringVal("ulidh")&&(t=this._addUlidHashcodeData(t)),this.parentCampaignStoreId&&this.modelData.formType===this.settings.frmSubmit&&i.getLocalStorageItem("utm-"+this.parentCampaignId)&&(t=this._addUtmCampaign(t)),!this.parentCampaignStoreId||this.modelData.formType!==this.settings.frmSubmit&&this.modelData.formType!==this.settings.frmTypeParticipation&&this.modelData.formType!==this.settings.frmNewUserOnly&&this.modelData.formType!==this.settings.frmRestrictAccess||(t=this.getCampaignSubmitData(t)),t="community_signup"!==this.modelData.formType&&"community_register"!==this.modelData.formType?t:this._addMembershipLevel(t,"signup")},_isCampaignSamplesSelected:function(){return!(0<this.$form.find(".samples .c-samples--item-checkbox").length)||(0<this.$form.find(".samples .c-samples--item-checkbox:checked").length?(i.dispatchEvent("cof:checkbox-selected",this.$form),!0):(i.dispatchEvent("cof:no-checkbox-selected",this.$form),i.dispatchEvent("cof:loader:hide",this.$form),!1))},identifyVerificationMethod:function(){var t=this;"true"===t.emailVerificationEnabled?t.smsOrEmailFlag="OTP_EMAIL":"true"===t.smsVerificationEnabled&&(t.smsOrEmailFlag="OTP_SMS")},_formSubmission:function(){var t=this;switch(t.$form.siblings(".form-error-msg").addClass("hidden"),t.formType){case"signup":t.identifyVerificationMethod(),t.smsOrEmailFlag?"block"===t.$form.find(t.otpCommonVariables.overlayOtp).css("display").toLowerCase()?t.otpOverlaySubmitButton():(t.clearOtpTimer(),t.$form.find(t.otpCommonVariables.otpTextBox).val(""),t._generateOtp(),t._updateOverlayFields(t)):t._formSubmissionAjax();break;case"community_signup":t.identifyVerificationMethod(),t.smsOrEmailFlag?"block"===t.$form.find(t.otpCommonVariables.overlayOtp).css("display").toLowerCase()?t.otpOverlaySubmitButton():(t.clearOtpTimer(),t.$form.find(t.otpCommonVariables.otpTextBox).val(""),t._generateOtp(),t._updateOverlayFields(t)):t._communityFormSubmissionAjax();break;case"community_register":t.identifyVerificationMethod(),t.smsOrEmailFlag?"block"===t.$form.find(t.otpCommonVariables.overlayOtp).css("display").toLowerCase()?t.otpOverlaySubmitButton():(t.clearOtpTimer(),t.$form.find(t.otpCommonVariables.otpTextBox).val(""),t.formJSONData=JSON.parse(t._formDatatoSend()),m._generateOTPawsCognito(t)):t._formSubmissionAjax();break;case"uim_registration":t.identifyVerificationMethod(),t.smsOrEmailFlag?"block"===t.$form.find(t.otpCommonVariables.overlayOtp).css("display").toLowerCase()?t.otpOverlaySubmitButton():(t.clearOtpTimer(),t.$form.find(t.otpCommonVariables.otpTextBox).val(""),t._formSubmissionToTS()):t._formSubmissionAjax();break;case"uim_forgot_password":t.toggleLoader("show"),t.updateOverlay=!0,m._awsCognitoForgotPassword(t);break;case"uim_forgot_password_confirm":t.toggleLoader("show"),m._awsCognitoResetPassword(t);break;case"community_create_password":t._communityFormSubmissionAjax();break;case"uim_change_password":var e=JSON.parse(t._formDatatoSend());e.oldPassword===e.newPassword?(e="<p>"+t.modelData.newPwdValidation+"</p>",t._renderServerSideErrorMessages(e,t.$form)):(t.toggleLoader("show"),t.$form.addClass("js-processing").find("button[type=submit]").prop("disabled",!0),m._awsChangePassword(t));break;case"uim_signin":t.$el.find(".form-error-msg").remove(),t.$form.addClass("js-processing").find("button[type=submit]").prop("disabled",!0),t.toggleLoader("show"),m._amazonCognitoSignin(t);break;case"community_login":t.$el.find(".form-error-msg").remove(),t.$form.addClass("js-processing").find("button[type=submit]").prop("disabled",!0),t.toggleLoader("show"),o._communityLogin(this.$el.find(".form")),m._amazonCognitoSignin(t);break;default:t._isCampaignSamplesSelected()&&t._formSubmissionAjax()}},_formSubmissionAjax:function(){var t,e,o=this;o.form.isAjax||0<$(".c-coupons").length?(o.$form.find("button[type=submit]").prop("disabled",!0),t=o._formDatatoSend(),(e=$.ajax({type:o.isLocalEnv?"GET":"POST",url:o.form.postURL,contentType:"application/json",dataType:"json",headers:{locale:o.compLocale,brand:o.brandName},data:t})).done($.proxy(o._successHandler,o)),e.fail($.proxy(o._errorHandler,o)),$(o.settings.signUpPage).length&&!i.getLocalStorageItem(o.compLocale+"-diagnosticToolSignupSurveyResponses",!0)&&i.setLocalStorageItem("signupFormData",t)):o.$form[0].submit(),o.triggerMethod("formSubmit",o)},_communityFormSubmissionAjax:function(){var t,e,o,i,a=this;a.form.isAjax?(a.$form.find("button[type=submit]").prop("disabled",!0),i=a._formDatatoSend(),"community_signup"===a.compJson.formType?(t="POST",o=a.form.postURL):(t="GET",e=(e=JSON.parse(i)).contact?e.contact.email:"",o=document.querySelector(".en-flexible").getAttribute("data-community-profile-basic-url")+"?email="+e,i=null),(e=$.ajax({type:t,url:o,contentType:"application/json",dataType:"json",headers:{locale:a.compLocale,brand:a.brandName,"x-api-key":a.compJson.communityAPIKEY},data:i})).done(function(t){"community_signup"===a.compJson.formType?a._successHandler(t):200===t.code||201===t.code?(a.identifyVerificationMethod(),a.smsOrEmailFlag?"block"===a.$form.find(a.otpCommonVariables.overlayOtp).css("display").toLowerCase()?a.otpOverlaySubmitButton():(a.clearOtpTimer(),a.$form.find(a.otpCommonVariables.otpTextBox).val(""),a.formJSONData=JSON.parse(a._formDatatoSend()),m._generateOTPawsCognito(a)):a._formSubmissionAjax()):a._errorHandler(t)}),e.fail($.proxy(a._errorHandler,a))):a.$form[0].submit(),a.triggerMethod("formSubmit",a)}}),t});