!function(t){function n(t,e){return function(){t.apply(e,arguments)}}function i(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],s(t,n(o,this),n(r,this))}function u(n){var o=this;return null===this._state?void this._deferreds.push(n):void e(function(){var t,e=o._state?n.onFulfilled:n.onRejected;if(null===e)(o._state?n.resolve:n.reject)(o._value);else{try{t=e(o._value)}catch(t){return void n.reject(t)}n.resolve(t)}})}function o(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void s(n(e,t),n(o,this),n(r,this))}this._state=!0,this._value=t,c.call(this)}catch(t){r.call(this,t)}}function r(t){this._state=!1,this._value=t,c.call(this)}function c(){for(var t=0,e=this._deferreds.length;t<e;t++)u.call(this,this._deferreds[t]);this._deferreds=null}function f(t,e,n,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=o}function s(t,e,n){var o=!1;try{t(function(t){o||(o=!0,e(t))},function(t){o||(o=!0,n(t))})}catch(t){if(o)return;o=!0,n(t)}}var e=i.immediateFn||"function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(n,o){var r=this;return new i(function(t,e){u.call(r,new f(n,o,t,e))})},i.all=function(){var c=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new i(function(r,i){if(0===c.length)return r([]);for(var u=c.length,t=0;t<c.length;t++)!function e(n,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var o=t.then;if("function"==typeof o)return o.call(t,function(t){e(n,t)},i)}c[n]=t,0==--u&&r(c)}catch(t){i(t)}}(t,c[t])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(n){return new i(function(t,e){e(n)})},i.race=function(r){return new i(function(t,e){for(var n=0,o=r.length;n<o;n++)r[n].then(t,e)})},"undefined"!=typeof module&&module.exports?module.exports=i:t.Promise||(t.Promise=i)}(this);