define(function(){"use strict";function e(){}return _.extend(e.prototype,{_dynamicConditionHandler:function(i,s,l){var d=this;_.each(i,function(a){var n=a.formElementsGroup||a.formElementV2,r=!!a.formElementsGroup;n&&n.ruleSet&&$.isArray(n.ruleSet)&&_.each(n.ruleSet,function(e){var t=n.groupName||n.id||n.fieldId;d._ruleComparator(e,r?a:i)?(r&&s||!r)&&(s||"radio"!==l)&&d._applyRule(t,e.rule):e&&(s||"radio"!==l)&&d._applyRule(t,d._getOppRule(e.rule))})})},_getOppRule:function(e){return{show:"hide",hide:"show",mandatory:"non-mandatory","non-mandatory":"mandatory"}[e]},_ruleComparator:function(e,t){var a,n=this,r=e&&$.isArray(e.conditions)?e.conditions.length:0,i=!(!e||!e.matchAll),s=[];for($.isArray(t)?s=t:s.push(t),a=0;a<r;a++){var l=e.conditions[a],d=l.elementType,o="checkbox"===d?n.$form.find('[name="'+l.formField+'"]').is(":checked"):("radio"===d?n.$form.find('input[name="'+l.formField+'"]:checked'):$(n.$form.find('[name="'+l.formField+'"]')).parent().children(":first")).val();if(("radio"===d?n.$form.find('input[name="'+l.formField+'"]'):$(n.$form.find('[name="'+l.formField+'"]')).parent().children(":first")).off("change").on("change",function(){n._dynamicConditionHandler(s,!0,d)}),l=n._evaluateRule(l,o,d),e.matchAll){if(!(i=i&&l))break}else i=i||l}return i},_evaluateRule:function(e,t,a){var n,r="date"===a?(t=new Date(t),new Date(e.formElementValue)):"number"===a?parseInt(e.formElementValue,10):"checkbox"===a?"true"===e.formElementValue:e.formElementValue;switch(e.evaluationCondition.trim()){case">=":n=r<=t;break;case"<=":n=t<=r;break;case"!=":n=t!==r;break;case"===":n=r===t;break;case"startsWith":n=!!t.match("^"+r);break;case"endsWith":n=!!t.match(r+"$");break;case"contains":n=-1<t.indexOf(r);break;case">":n=r<t;break;case"<":n=t<r}return n},_applyRule:function(e,t){var a=this,n=a.$el.find("[name="+e+"]"),r=(!n.length||!n.parents(".radio").length)&&a.$el.find("#"+e).length?a.$el.find("#"+e):n;switch(t){case"show":case"hide":r.parents(a.settings.formGroup).hasClass("o-hidden")&&r.parents(a.settings.formGroup).removeClass("o-hidden"),r.hasClass("o-hidden")&&r.removeClass("o-hidden"),r.closest(a.settings.componentWrapper)[t](),"hide"===t?(a._applyRule(e,"non-mandatory"),a.resetHiddenElements(r),r.attr("data-rule-hide",!0)):r.parents(a.settings.formGroup).find(".c-form-mandatory").length&&r.data("rule-hide")&&a._applyRule(e,"mandatory");break;case"mandatory":a.requiredMethod(e,!0),a.validator.addRules(a,{rules:a._createValidationRules()}),a._makeFieldMandatoryByName(e),r.attr("data-rule-hide",!1);break;case"non-mandatory":a.requiredMethod(e,!1),a.validator.addRules(a,{rules:a._createValidationRules()}),a._removeMandatory(e),r.attr("data-rule-hide",!0)}},resetHiddenElements:function(e){e.hasClass("form-elements-group")?(e.find("input[type=checkbox]:checked").length&&e.find("input[type=checkbox]:checked").prop("checked",!1),e.find("input[type=radio]:checked").length&&e.find("input[type=radio]:checked").prop("checked",!1)):e.parent().children(":first").is("select")?(e.parent().children(":first")[0].options[0].selected=!0,e.parent().children(":first").hasClass("c-form-survey-field")&&(e.parent().find("input")[0].value=e[0].name,e[0].value=e[0].name,e.parent().find("input")[1].value=e.parent().children(":first")[0].options[0].value)):e.parent().children(":first").val("")},_makeFieldMandatoryByName:function(e){var t=this.$form.find("label[for='"+e+"']"),t=(t=0===t.length?this.$form.find("[name='"+e+"']").parents(".form-group").find("label"):t).length?t:$("#"+e);t.find("."+this.settings.formMandatoryClass).length?t.find("."+this.settings.formMandatoryClass).show():t.append('<span class="'+this.settings.formMandatoryClass+'">*</span>')},_fileClickHandler:function(e){e=this.$form.find(e.target);e.val(null),e.siblings(this.settings.fileHelpBlock).addClass("hidden"),e.siblings(this.settings.helpBlock).addClass("hidden")},onInputBlur:function(e){var t,a,n,r,i=this,s=this.$form.find(e.target),l=s.closest(i.settings.formGroup),d=l.find(i.settings.helpBlock),o=!1,f=$(e.target).data("date-picker"),m=l.find("[type=file]"),h=l.find(".form-element-valid"),p=s.parent().find(".form-date-range"),u=!!s.attr("data-char-count-enabled")&&s.data("char-count-enabled"),c=u?s.data("char-length"):"",u=!!(u&&c&&s.val().length>c),c=!1,g=this.model.preValidate(e.target.name,e.target.value);if(-1<e.target.name.indexOf("birthday")&&!f&&!g?g=i.signupDOBValidation(i.allElementsConfig,"maskInput"):m.length&&m.val()?g=m.siblings(i.settings.helpBlock+":visible").html():u&&(g=s.data("char-length-error-msg")),g){if(-1<e.target.name.indexOf("birthday")||u)o=!0;else for(t=0;t<i.allElementsConfig.length;t++)if(null!==i.allElementsConfig[t]&&i.allElementsConfig[t].formElementV2&&(i.allElementsConfig[t].formElementV2.fieldId===e.target.name||""===i.allElementsConfig[t].formElementV2.fieldId&&i.allElementsConfig[t].formElementV2.groupName===e.target.name)){for(n=(a=i.allElementsConfig[t].formElementV2.rules)?a.length:0,r=0;r<n;r++)if(-1<a[r].msg.trim().indexOf(g.trim())){o=!0;break}break}o?(d.addClass("form-element-error"),s.parent().find(e.target).addClass(i.settings.formInputError),d.html(g).removeClass("hidden"),h.addClass("hidden"),p.addClass("hidden"),s.parent().find(".input-date").data("datepicker")&&$(".js-datepicker-enabled").length&&(d.removeClass("form-element-error"),s.parent().find(e.target).removeClass(i.settings.formInputError),d.html(g).addClass("hidden"),s.parent().find(e.target).hasClass(i.settings.formInputError)&&d.hasClass("form-element-error")?s.parent().find(e.target).removeClass("form-input-valid"):s.parent().find(e.target).addClass("form-input-valid")),s.parents(".form-group").removeClass("has-error"),s.parents(".form-group").find(".help-block-error").addClass("hidden")):(d.addClass(i.settings.formElementWarning),s.parent().find(e.target).addClass(i.settings.formInputWarning),d.html(g).removeClass("hidden"),h.addClass("hidden"))}else this.model&&this.model.warningMsgConfigured&&this.model.warningMsgConfigured[e.target.name]&&(c=!0),m.length&&(!m.length||m.val())||(c||(l.find(i.settings.helpBlock).html("").addClass("hidden"),d.removeClass(i.settings.formElementWarning)),d.removeClass("form-element-error"),l.find(".captcha").length||""===s.val()?(h.addClass("hidden"),s.removeClass("form-input-valid").removeClass(i.settings.formInputError),s.parents(".form-group").removeClass("has-error")):(c||h.removeClass("hidden"),s.addClass("form-input-valid").removeClass(i.settings.formInputError),p.addClass("hidden")))},togglePassword:function(e){e.preventDefault();var e=$(e.currentTarget).parents(".password"),t=e.find("input"),a=e.find(".c-eye-icon"),e=e.find(".c-hide-password");"password"===t.attr("type")&&""!==t.val()?(t.attr("type","text"),e.hide(),a.css("display","block")):(t.attr("type","password"),a.hide(),e.css("display","block"))},resetState:function(e){var t=this.$form.find(e.target),a=t.parent().find(this.settings.helpBlock),n=t.parent().find("[type=file]"),r=!!t.attr("data-char-count-enabled")&&t.data("char-count-enabled"),i=r?t.data("char-length"):"",r=!!(r&&i&&t.val().length>i);n.length&&(!n.length||n.val())||r||(a.hasClass("form-element-warning")&&(a.html("").addClass("hidden"),a.removeClass("form-element-warning"),t.parent().find(e.target).removeClass("form-input-warning")),a.hasClass("form-element-error")&&(a.html("").addClass("hidden"),a.removeClass("form-element-error"),t.parent().find(e.target).removeClass(this.settings.formInputError)),t.parent().find(".form-element-valid")&&(t.parent().find(".form-element-valid").addClass("hidden"),t.removeClass("form-input-valid")))},inlineErrorValidation:function(e){var t,a,n,r,i,s=this;e.forEach(function(e){for(a=0;a<s.allElementsConfig.length;a++)if(null!==s.allElementsConfig[a]&&void 0!==(t=s.allElementsConfig[a].formElementV2)&&t.fieldId===e.fieldName.replace(".","-")){for(n=t.rules?t.rules.length:0,r=0;r<n;r++){if(i=Object.keys(t.rules[r]),"ValidatonFailure"===e.category&&(0<i.indexOf("pattern")||0<i.indexOf("required"))){s._updateInlineErrorMsg(t.fieldId,t.rules[r].msg);break}if("MissingRequiredProperty"===e.category&&0<i.indexOf("required")){s._updateInlineErrorMsg(t.fieldId,t.rules[r].msg);break}}break}})},_updateInlineErrorMsg:function(e,t){var e=this.$form.find("#"+e),a=e.closest(this.settings.formGroup),e=e.parent().find(this.settings.helpBlock);a.find(this.settings.helpBlock).html(t).removeClass("hidden"),e.addClass("form-element-error")}}),e});