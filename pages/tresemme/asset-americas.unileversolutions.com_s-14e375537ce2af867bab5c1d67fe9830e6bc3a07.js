define(["search","analytics","typeahead","commonService"],function(){"use strict";function e(){this.searchService=new IEA.search,this.analyticsService=new IEA.Analytics,this.commonService=new IEA.commonService}return _.extend(e.prototype,{openModal:function(e,t){e.preventDefault();var a=this,e=$(this.defaultSettings.modalCl);e&&(a.$body.addClass("o-modal-open"),e.show(),this.commonService.animate(e,{opacity:1},1e3,0,function(){a.$el.find(".c-global-search .typeahead").focus()}),t||this.blurBackground(["js-blur-bg"],!0))},closeModal:function(e,t){e.preventDefault();var a=this;$(a.defaultSettings.searchInputField).typeahead("val",""),a.commonService.animate(a.defaultSettings.modalCl,{opacity:0},1e3,0,function(){$(a.defaultSettings.modalCl).hide()}),$("body").removeClass("o-modal-open"),t||a.blurBackground(["js-blur-bg"],!1)},blurBackground:function(e,t){for(var a=0;a<e.length;a++){var n=e[a];$("."+n).toggleClass("u-blur-background",!!t)}},enableSearchMethods:function(){var e=this,t=e.defaultSettings;$(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(e){var t=$(this);if(t.data("typeahead"))return!0;t.typeahead(t.data())}),e.$el.find(t.searchForm).length&&0===e.$el.find(t.searchInputField).parent(".twitter-typeahead").length&&e.renderSuggestions(),$(e.$el.find(e.clearSearch)).on("click",{field:t.searchTextBox,wrapper:t.searchForm},this.searchService.clearSearchVal)},keyboardHandler:function(e){var t=e.keyCode||e.charCode,e=$(e.target),a=e.parents(options.searchForm);if(13===t){if(!e.val().trim().length)return $(this.defaultSettings.searchInputField).focus(),!1;this.updateParams(e.val(),a)}},submitForm:function(e){var t=this,a=$(e.target).closest(t.defaultSettings.searchForm),n=a.find(".c-global-search__textbox"),r=a.data("action");if(""!==a.attr("action"))return!0;e.preventDefault(),0<n.typeahead("val").length&&n.typeahead("val").trim().length?(a.attr("action",r),t.updateParams(n.typeahead("val"),a),t.searchAnalytics()):$(n).focus()},renderSuggestions:function(){var n=this,r=n.defaultSettings,e={autoSuggest:!0,brandName:$("input[name=BrandName]").val(),clearSearch:n.clearSearch,customKeyword:r.defaultSuggestions,dropDownLabel:n.modelData.search.dropDownLabel||null,inputFont:n.inputFont,locale:$("input[name=Locale]").val(),searchInputField:r.searchInputField,searchKeyword:n.searchKeyword,searchWrapper:r.searchWrapper,suggestionsLimit:r.suggestionsLimit,selectCallback:function(e,t,a){n.updateParams(t,a.parents(r.searchForm)),e.searchKeyword=n.searchKeyword}};this.searchService.showSuggestions(e,n)},searchAnalytics:function(){var e,t;digitalData&&ctConstants&&(e={},t=$(".o-global-search"),this.analyticsService.trackComponentInfo(t,digitalData),e.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.siteSearch,eventLabel:this.searchKeyword,eventValue:1},e.category={primaryCategory:ctConstants.engagement},e.subcategory="Interest",digitalData.event.push(e))},updateParams:function(e,t){var a,n=this,r=n.modelData.search.dropDownLabel,i="";-1!==e.indexOf(r.inArticles)||-1!==e.indexOf(r.inProducts)||-1!==e.indexOf(r.inEverything)?(-1!==e.indexOf(r.inArticles)?(i="ContentType:Article",a=e.split(" "+r.inArticles)):-1!==e.indexOf(r.inProducts)?(i="ContentType:Product",a=e.split(" "+r.inProducts)):-1!==e.indexOf(r.inEverything)&&(i="",a=e.split(" "+r.inEverything)),a&&a.constructor===Array&&0<a.length&&(n.searchKeyword=a[0])):(n.searchKeyword=e,i=""),$("input[name=q]").val(n.searchKeyword),$("input[name=fq]").val(i),t.submit()},resizeFont:function(e,t,a){this.searchService.shrinkToFill(e,t,a)}}),e});