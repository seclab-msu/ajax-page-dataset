define(["commonService","search","typeahead"],function(){"use strict";var d=null,o=null;function e(){d=new IEA.commonService,o=new IEA.search}return _.extend(e.prototype,{defaultSettings:{addressLookupInputField:".js-address-lookup",searchInputField:".js-address-search-field.typeahead",autosuggestHint:!1},_enableTypeaheadFocus:function(e){e=$(e.currentTarget);if(e.data("typeahead"))return!0;e.typeahead(e.data())},_renderSuggestions:function(){var s=this,e=s.$el.find(s.settings.addressLookupInputField),a=e.data("suggestions-limit"),t=e.data("autosuggest-min-limit"),n=e.data("autosuggest-disable"),r=e.data("country-list"),e={searchWrapper:e,searchInputField:s.$el.find(s.settings.searchInputField),locale:s.compJson.locale,brandName:s.compJson.brandName,groupCall:!1,typedVal:"",groupQueryParams:"",countryList:r,searchKeyword:s.searchKeyword,suggestionsLimit:a,hint:s.settings.autosuggestHint,autoSuggest:!n,minLengthToTriggerAutoSuggest:t,formAddressEnabled:!0,queryParams:"&Locale="+s.compJson.locale+(r?"&Countries="+r:"")+"&BrandName="+s.compJson.brandName+"&Limit="+a,selectCallback:function(e,a,t){a=JSON.parse(a);s._addressRetrivalHandler(a,t,e)}};o.showSuggestions(e,s)},_addressRetrivalHandler:function(e,a,t){var o=this,s=o.$el.find(o.settings.addressLookupInputField).data("retrival-query"),n=o.$el.find(o.settings.addressLookupInputField).data("group-query"),r={};"Address"===e.Type?(r.queryParams="?Id="+e.Id+"&BrandName="+o.compJson.brandName+"&Locale="+o.compJson.locale,r.servletUrl=s,r.onCompleteCallback=function(e){var t,e=JSON.parse(e),n=o.$form.find('[name*="'+a[0].name+'"]').not(o.settings.searchInputField),r=n.length;e&&e.responseData&&(e=e.responseData,t=a[0].name,$.each(e,function(e,s){var a;Array.isArray(s)?n.each(function(e){var a=$(this),t=s;e<r-1?a.val(s[e]):e===r-1&&(t.splice(0,e),o._populateLastAddressFieldData(t,a))}):(e=e.split("-").pop(),a=t.substring(0,t.lastIndexOf("-")),o.$form.find("[name="+a+"-"+e+"]").val(s))}))},d.getDataAjaxMethod(r)):(t.groupQueryParams="?Id="+e.Id+"&BrandName="+o.compJson.brandName+"&Locale="+o.compJson.locale+(t.countryList?"&Countries="+t.countryList:""),t.servletUrl=n,t.groupCall=!0,a.typeahead("val",t.typedVal+" "))},_populateLastAddressFieldData:function(e,a){e=e.filter(Boolean).join(", ");a.val(e)}}),e});