define(["commonService"],function(){"use strict";IEA.service("animService",function(o,n,t){function e(){return this}var i=1400,a=985,l=!1,c=null,r=null,s=null;return _.extend(e.prototype,{initialize:function(){var n=this;return s=new IEA.commonService,$('[data-anim="scroll"]').click(function(o){o.preventDefault(),n.scrollTo($($(this).attr("href")).offset().top)}),n.mobileCheck(),this},mobileCheck:function(){var o;return s.isMobile()&&$(window).width()<=a||s.isMobileAndTablet()?(i=a,l=!0,s.animate(".o-modal-content",{scrollTop:o=a/3,scrollLeft:o},1e3)):l=!(i=1400),l},blurBackground:function(o,n){for(var t=0;t<o.length;t++){var e=o[t];n?$("."+e).addClass("u-blur-background"):$("."+e).removeClass("u-blur-background")}},initProducts:function(){var t,e,i=$('[data-anim="product"]');0<i.length&&(t=i.first().offset().top,e=$(window).height(),$(document).on("scroll",function(o){var n=$(window).scrollTop();t-e/1.5<n&&i.each(function(o,n){$(n).delay(300*o).queue(function(o){s.animate(this,{scrollTop:-8,opacity:1},800),o()})})}))},initParallax:function(e){var i,o=$('[data-anim="parallax"]');0<o.length&&(i=$(window).height(),o.each(function(){var t=$(this);$(document).scroll(function(){var o=$(window).scrollTop(),n=t.offset().top;n+t.outerHeight()<=o||o+i<=n||(n=Math.round((n-o)*e),t.css("background-position","center "+n+"px"))})}))},initParallaxEffect:function(o,a){function n(){t.each(function(o,n){var t,e,i;n=$(n),t=l.height(),e=l.scrollTop(),((i=n.offset().top)+n.outerHeight()<=e||e+t<=i)&&!a||(t=Number(n.attr("data-anim-speed")),i=Math.round((i-e)*t),n.css({webkitTransform:"translate3d(0, "+i+"px, 0)",MozTransform:"translate3d(0, "+i+"px, 0)",msTransform:"translate3d(0, "+i+"px, 0)",OTransform:"translate3d(0, "+i+"px, 0)",transform:"translate3d(0, "+i+"px, 0)"}))}),"function"==typeof o.parallaxScrollingHandler&&o.parallaxScrollingHandler()}var t=o.$el.find('[data-anim="parallax"]'),l=$(window);0<t.length&&(l.on("scroll",n),n())},initZoom:function(){var n=this,o=$("[data-zoom-image]");null===c?0<o.length&&(c=$(".js-modal"),r=c.find(".js-modal-image"),o.each(function(){n.zoomEvents($(this),n)}),r.mousemove(function(o){n.zoomMove($(this),o.clientY)}),r.on("click",function(){s.animate(c,{opacity:0},1e3,0,function(){c.css("display","none")}),$("body").removeClass("open-zoom-modal").removeAttr("style")})):o.each(function(){$(this).off("click").unbind(),n.zoomEvents($(this),n)})},zoomOpenUrl:function(o,n){var t=this;null===c?(c=$(".js-modal"),r=c.find(".js-modal-image"),n&&"productOverview"===n.componentName&&setTimeout(function(){c.find(".o-modal-content").focus()},500),r.mousemove(function(o){t.zoomMove($(this),o.clientY)}),r.on("click",function(){$("body").removeClass("open-zoom-modal").removeAttr("style"),s.animate(c,{opacity:0},1e3,0,function(){c.css("display","none")}),t.blurBackground(["js-blur-bg"],!1)}),$(document).keyup(function(o){27===o.keyCode&&($(".js-modal-image").trigger("click"),n&&"productOverview"===n.componentName&&$(".js-product-overview__zoom:visible").focus())})):n&&"productOverview"===n.componentName&&setTimeout(function(){c.find(".o-modal-content").focus()},500),t.mobileCheck(),this.zoom(o,window.innerHeight/2),t.blurBackground(["js-blur-bg"],!0),r.parent(".o-modal-content")&&s.animate(r.parent(".o-modal-content"),{scrollTop:0})},zoomEvents:function(n,t){n.on("click",function(o){t.zoom(n.data("zoom-image"),o.clientY)})},zoom:function(o,n,t){null!==c&&(r.css("backgroundImage",'url("'+o+'")'),o=void 0!==t?t:i,s.isMobile()?r.width(a):r.width($(window).width()),r.height(o),$("body").css("overflow","hidden"),c.show(),s.animate(c,{opacity:1},1e3))},zoomMove:function(o,n,t){var t=void 0!==t?t:i,e=$(window).height(),t=t-e,n=(1-n/e)*t-t;s.isMobileAndTablet()||o.css("top",n+"px")},zoomSwap:function(o,n){null===c&&(c=$(".js-modal"),(r=c.find(".js-modal-image")).css("backgroundImage",'url("'+o+'")'),s.animate(r,{opacity:0},500,0,function(){r.css("backgroundImage","url("+o+")"),s.animate(r,{opacity:1},500)}))},openOverlay:function(o,n,t){o=$(o);n=$.extend({onCompleteCallback:function(){}},n),null!==o&&($("body").addClass("o-modal-open"),o.show(),s.animate(o,{opacity:1},1e3,0,function(){n.onCompleteCallback()}),t||this.blurBackground(["js-blur-bg"],!0))},closeOverlay:function(o,n){s.animate(o,{opacity:0},1e3,0,function(){$(o).css("display","none")}),$("body").removeClass("o-modal-open"),n||this.blurBackground(["js-blur-bg"],!1)},scrollTo:function(o){s.animate("html, body",{scrollTop:o},1e3)}}),e})});