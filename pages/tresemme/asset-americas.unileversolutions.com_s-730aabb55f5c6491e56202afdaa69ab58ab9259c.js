define(["analytics","commonService"],function(){"use strict";var c=null,f=null;function t(){var e=this;c=new IEA.Analytics,(f=new IEA.commonService).listenEvent("surveyLoaded",function(t,n){e.surveyId=n.ref})}return _.extend(t.prototype,{_analyticEventInfo:function(t,n,e,a,s,o){var i={},r=this.$form.find(this.settings.campaignQuestionAndAnswersSection).length||f.getLocalStorageItem(this.parentCampaignId+"-qna-track");void 0!==s&&s.length?c.trackComponentInfo(this.$form,digitalData,s):c.trackComponentInfo(this.$form,digitalData),r&&$.extend(digitalData.component[0].attributes,{DTQns:this.qnaAnalyticsData("question"),DTAns:this.qnaAnalyticsData("answer"),DTResult:"",DTMSARes:""}),i.eventInfo={type:o||ctConstants.trackEvent,eventAction:t,eventLabel:n,eventValue:1},i.category={primaryCategory:e},i.subcategory=a||"Lead",digitalData.event.push(i)},_trackProfileEdit:function(t){"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(t=f.trimString(t.$el.parents(".js-profile-tabs-cont").find(".tabbed-content-tabs .tabbed-content__tab--is-active").text()),this._analyticEventInfo(ctConstants.profileEdit,t,ctConstants.custom,"Others"))},onFormSubmitTracking:function(t){var e,n,a,s,o,i=this,r=location.pathname,c=$(".c-form-copy-content__headline").first().text(),r=r.substring(r.lastIndexOf("/")+1,r.lastIndexOf(".")),r=i.modelData&&i.modelData.formType?i.modelData.formType:""===c?r:c,d=[],c=i.$form.find('input[name*="optIn-"], input[name*="-OptIn"]'),u=i.$form.find(i.settings.campaignQuestionAndAnswersSection).length||f.getLocalStorageItem(i.parentCampaignId+"-qna-track");_.each(c,function(t,n){t=$(t);t.is(":checked")&&(e=t.attr("id"),d.push(e))}),"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(r=$(".contact-page").length?(c=(c=0===(c=i.$el.find("#contactUs-inquiryType")).length?i.$el.find('[name="contactUs-inquiryType"]'):c).length?c.val()+" | ":"",o=(o=0===(o=i.$el.find("#contactUs-upcCode")).length?i.$el.find('[name="contactUs-upcCode"]'):o).length&&""!==o.val()?o.val()+" | ":"",a=[],s=i.$form.find('input[type="checkbox"]:checked'),$.each(s,function(){a.push($(this).attr("id"))}),s=ctConstants.contactus,"Contact-Us - "+c+o+a):(s=ctConstants.submission,r+" - "+i.$form.attr("id")),c=ctConstants.engagement,o="Interest",$(i.settings.signUpPage).length&&(s=ctConstants.SignUpSubmit,r="Event Label: Successful Sign Up",o="Lead"),u&&(s=ctConstants.qaSubmit,r="COF-QA-Survey|"+i.parentCampaignId+"|"+f.getLocalStorageItem(i.parentCampaignId+"-qna-track")||"",c=ctConstants.engagement,o="Interest",n=ctConstants.qaSubmit),i.$form.find(".c-samples")&&(n=ctConstants.cOF_RequestSample),i._analyticEventInfo(s,r,c,o,d,n),i.$el.find('[name*="SurveyResponses"], [name*="surveyResponseList"]').length&&i._trackSurveyResponse("Survey Submitted"))},_trackSignInRegistration:function(t){var n,e,a,s,o,i,r;"undefined"==typeof digitalData||"undefined"==typeof ctConstants||$(".form-error-msg").length||(n=this,e=ctConstants.registration,a="Registered - "+t.UnileverId,s=ctConstants.engagement,o="",i=[],r=n.$form.find('input[name*="optIn-"], input[name*="-OptIn"]'),"community_register"!==n.compJson.formType&&"community_create_password"!==n.compJson.formType||(a="Registered - "+t.cmId),_.each(r,function(t,n){t=$(t);t.is(":checked")&&(o=t.attr("id"),i.push(o))}),n._analyticEventInfo(e,a,s,"Lead",i),n._trackSignIn(t,i))},_trackSignIn:function(t,n){var e,a;"undefined"==typeof digitalData||"undefined"==typeof ctConstants||$(".form-error-msg").length||(e=ctConstants.signIns,a=ctConstants.engagement,this._analyticEventInfo(e,"Signup/Registration",a,"Lead",n))},_trackRedeemCoupon:function(t){var n=t.responseData&&null!==t.responseData?t.responseData.results:"";"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(n=n&&""!==n&&n.length?"Valid"+": "+t.responseData.results[0].couponPoints:"Invalid"+": "+t.status,this._analyticEventInfo(ctConstants.RedeemCoupons,n,ctConstants.custom))},_trackFormCheckboxes:function(t){var n,e,a=this,s=[],o=a.$form.find('input[name*="optIn-"], input[name*="-OptIn"]'),i=location.pathname,r=$(".c-form-copy-content__headline").first().text(),i=i.substring(i.lastIndexOf("/")+1,i.lastIndexOf(".")),i=a.modelData&&a.modelData.formType?a.modelData.formType:""===r?i:r,r=t&&t.responseData&&null!==t.responseData&&void 0!==t.responseData.UnileverId?t.responseData.UnileverId:"";_.each(o,function(t,n){t=$(t);t.is(":checked")&&(e=t.attr("id"),s.push(e))}),"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&s.length&&(t=$('input[name*="NewsLetterOptIns-"]').is(":checked")&&""!==r?(i=i+" | "+r,n=ctConstants.suscribeNewsletter,ctConstants.other):(n=ctConstants.Acquisition,i=s.join(" | "),ctConstants.engagement),a._analyticEventInfo(n,i,t,"Lead",s))},_inputErrors:function(t){"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&this._analyticEventInfo(ctConstants.inputerror,t,ctConstants.custom,"Error")},_trackInputErrors:function(){var e,a=[],t="",n=this.$el.find(".has-error .help-block"),s=this.$el.find(".error-msg-text"),o=this.$el.find(".form-element-error"),n=n.length?n:s.length?s:o;0<n.length&&(n.each(function(t,n){(e=$(this).text())&&a.push(e)}),t+=a.join(" | "),this._inputErrors(t))},_trackEditSurvey:function(t){this._trackSurveyResponse("Survey Edited")},_trackSubmitSurvey:function(){var e,a=[],t=this.$el.find('[name*="SurveyResponses"]'),n=this.$el.find('[name*="surveyResponseList"]');$(t+","+n).each(function(){var t,n;$(this).is(":checked")&&(t=$(this).parents(".form-group").find(".c-control-label").text()+" - "+n,n=("checkbox"===$(this).attr("type")?$(this).parents("label").find(".c-form-checkbox__label-copy"):$(this).parents("label").find(".c-form-radio__label")).text(),a.push(t),e=a.join(" | "))}),this._trackSurveyResponse(e)},_trackSurveyResponse:function(t){var n;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(n=(n=$('[id*="SurveyId"], [id*="surveyId"]')).length?n.val():this.surveyId,this._analyticEventInfo(ctConstants.survey,n+" - "+t,ctConstants.engagement,"Interest"))},_formOnLoadAnalytics:function(){var t,n;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(t=this,$(t.settings.signUpPage).length&&(n=ctConstants.SignUpstart),(n="community_register"!==t.compJson.formType&&"community_create_password"!==t.compJson.formType?n:ctConstants.RegistrationStart)&&t._analyticEventInfo(n,window.location.href,ctConstants.engagement,"Lead"),t.$el.find('[name*="SurveyResponses"], [name*="surveyResponseList"]').length&&t._trackSurveyResponse("Survey Launch"))},_resetPasswordTracking:function(){"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&("uim_forgot_password"===this.compJson.formType?this._analyticEventInfo(ctConstants.PasswordReset,window.location.href,ctConstants.engagement,"Interest"):this._analyticEventInfo(ctConstants.PasswordReset,window.location.href,ctConstants.custom,"Interest"))},customEventTracking:function(t,n){"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&this._analyticEventInfo(ctConstants.RememberMe,window.location.href,ctConstants.custom,"Interest")},_trackCampaignSurveyStart:function(){var t;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(t="COF-QA-Survey|"+this.parentCampaignId,this._analyticEventInfo(ctConstants.qaStart,t,ctConstants.engagement,"Interest"))},qnaAnalyticsData:function(t){var e,n=f.getLocalStorageItem(this.parentCampaignId+"-qna-track")||"",a=n.split("|"),s=[],o=[];return""!==n?($.each(a,function(t,n){e=n.split(":"),s.push(e[0]),o.push(e[1])}),("question"===t?s:o).join("|")):"NA"},_trackShippingAddressSubmission:function(t){var a,n,e;"undefined"==typeof digitalData||"undefined"==typeof ctConstants||$(".form-error-msg").length||(a=this,n=ctConstants.trackEvent,e=ctConstants.custom,digitalData.product=[],$.each(t.items,function(t,n){var e={productInfo:{},category:{},attributes:{}};e.productInfo.productID=n.productEan,e.productInfo.productName=n.name,e.productInfo.price=n.total,e.productInfo.brand=a.compJson.brandName,e.productInfo.quantity=n.quantity,e.attributes.productVariants=n.size,digitalData.product.push(e)}),a._analyticEventInfo("Checkout Step 1","Customer Information",e,"Win",[],n))}}),t});