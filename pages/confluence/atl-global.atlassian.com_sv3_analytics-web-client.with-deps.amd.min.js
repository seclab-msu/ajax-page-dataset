(function (define) { define([],(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=r(1);r.d(t,"default",(function(){return n.default})),r.d(t,"STARGATE_PROXY_PATH",(function(){return n.STARGATE_PROXY_PATH}));var i=r(6);r.d(t,"apdexType",(function(){return i.apdexType})),r.d(t,"envType",(function(){return i.envType})),r.d(t,"eventType",(function(){return i.eventType})),r.d(t,"originType",(function(){return i.originType})),r.d(t,"platformType",(function(){return i.platformType})),r.d(t,"tenantType",(function(){return i.tenantType})),r.d(t,"userType",(function(){return i.userType})),r.d(t,"originTracingType",(function(){return i.originTracingType}));var s=r(97);r.d(t,"DwellTimeHelper",(function(){return s.default}));var o=r(99);r.d(t,"DwellTimeHelperWithBrowserInteraction",(function(){return o.default}));var a=r(13);r.d(t,"CompressionRule",(function(){return a.CompressionRule})),r.d(t,"StopLowPriorityEventDelayReason",(function(){return a.StopLowPriorityEventDelayReason}));var c=r(24);r.d(t,"ResilienceMechanism",(function(){return c.ResilienceMechanism}));var u=r(102);r.d(t,"TypeAheadHelper",(function(){return u.default}))},function(e,t,r){"use strict";r.r(t),r.d(t,"STARGATE_PROXY_PATH",(function(){return P})),r.d(t,"default",(function(){return j}));var n=r(2),i=r.n(n),s=r(3),o=r.n(s),a=r(6),c=r(7),u=r(10),l=r(11),d=r(13),h=r(15),f=r(22),m=r(83),p=r(8),g=r(90),b=r(91),y=r(92),v=r(93),E=r(94),I=r(95),O=r(84),T=r(96),w=r(55);function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const P="/gateway/api/gasv3/api/v1";class j{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i()(this,"_useStargate",e=>null==e||e),i()(this,"_selectHost",e=>{let{useStargate:t,env:r,useLegacyUrl:n}=e;return t?n?r===a.envType.PROD?"api-private.atlassian.com/gasv3/api/v1":"api-private.stg.atlassian.com/gasv3/api/v1":window.location.host+P:r===a.envType.PROD?"as.atlassian.com/api/v1":"as.staging.atl-paas.net/api/v1"}),i()(this,"_endsWith",(e,t)=>-1!==e.indexOf(t,e.length-t.length)),i()(this,"_changeInternalUserId",(e,t)=>{this.eventProcessor.getUser().setUserId(e),t&&t!==this.eventProcessor.getUser().getAnonymousId()&&this.eventProcessor.getUser().setAnonymousId(t)}),i()(this,"_createSubproductGetter",e=>Object(u.default)(e,"Cannot get subproduct from the callback. Proceeding without it.")),i()(this,"_createEmbeddedProductGetter",e=>Object(u.default)(e,"Cannot get embeddedProduct from the callback. Proceeding without it.")),i()(this,"_getLastScreenEvent",()=>{try{return JSON.parse(this._safeSessionStorage.getItem("last.screen.event")||"")}catch(e){return this._safeSessionStorage.removeItem("last.screen.event"),null}}),i()(this,"_setLastScreenEvent",e=>{this._safeSessionStorage.setItem("last.screen.event",JSON.stringify({name:e.name,attributes:e.attributes}))}),i()(this,"_shouldEventBeDelayed",e=>{if(!e.tags||-1===e.tags.indexOf("measurement"))return!1;const t=!1!==e.highPriority;return this.eventDelayQueue.isDelayingLowPriorityEvents()&&!t}),i()(this,"_fireEvent",(e,t,r,n)=>{switch(t.eventType){case a.eventType.UI:case a.eventType.OPERATIONAL:case a.eventType.TRACK:return this.eventProcessor.track(e,t,r,n);case a.eventType.SCREEN:return this.eventProcessor.page(e,t,r,n);case a.eventType.IDENTIFY:return this.eventProcessor.identify(e,t,r,n);default:throw new Error("No handler has been defined for events of type "+t.eventType)}}),i()(this,"_fireDelayedEvent",(e,t,r,n)=>{try{this._changeInternalUserId(n.userId,n.anonymousId),t.tags=[...t.tags||[],"sentWithDelay"],this._fireEvent(e,t,r,void 0)}finally{this._changeInternalUserId(this._userInfo.userId,this._userInfo.anonymousId)}}),i()(this,"_delayEvent",(e,t,r,n,i)=>{this.eventDelayQueue.push(e,t,r,n),i&&i()}),i()(this,"_processEvent",(e,t,r,n)=>(this._testingCache.saveEvent(t),this._shouldEventBeDelayed(t)?(this._delayEvent(e,t,r,this._userInfo,n),Promise.resolve()):this._fireEvent(e,t,r,n))),i()(this,"setEmbeddedProduct",e=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(e),this.resetUIViewedTimers()}),i()(this,"clearEmbeddedProduct",()=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(null)}),i()(this,"setSubproduct",e=>{this._productInfo.subproduct=this._createSubproductGetter(e),this.resetUIViewedTimers()}),i()(this,"setOriginTracingHandlers",e=>{const t=this.originTracing.handleOriginParameters(e,this._historyReplaceFn);Object.keys(t).forEach(e=>{void 0!==t[e].taskSessionId&&this.task.createTaskSessionWithProvidedId(e,t[e].taskSessionId)});const r={};return Object.keys(t).forEach(e=>{t[e].originTracingAttributes?r[e]=t[e].originTracingAttributes:console.warn(`Handling method for origin parameter ${e} has not returned any attributes`)}),Object.keys(t).length>0?this.sendOperationalEvent({action:"landed",actionSubject:"origin",source:"webClient",attributes:{originTracesLanded:r}},()=>{}):Promise.resolve()}),i()(this,"setTenantInfo",(e,t)=>{if(!e)throw new Error("Missing tenantIdType");if(e!==a.tenantType.NONE&&!t)throw new Error("Missing tenantId");if(!Object(a.isType)(a.tenantType,e))throw new Error(`Invalid tenantIdType '${e}', must be an tenantType: [${Object(a.objectValues)(a.tenantType)}]`);this._tenantInfo={tenantIdType:e,tenantId:t}}),i()(this,"clearTenantInfo",()=>{this._tenantInfo={}}),i()(this,"setOrgInfo",e=>{if(!e)throw new Error("Missing orgId");this._orgInfo={orgId:e}}),i()(this,"clearOrgInfo",()=>{this._orgInfo={}}),i()(this,"setUserInfo",(e,t)=>{Object(h.validateIdentifyEvent)(e,t),this._changeInternalUserId(t),this._userInfo={userIdType:e,userId:t,anonymousId:this.eventProcessor.getUser().getAnonymousId()}}),i()(this,"clearUserInfo",()=>{this._changeInternalUserId(void 0),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId()}}),i()(this,"getAnonymousId",()=>this._userInfo.anonymousId),i()(this,"setUIViewedAttributes",e=>{if(!e)throw new Error("Missing uiViewedAttributes");if("object"!=typeof e||Array.isArray(e))throw new Error("Invalid uiViewedAttributes type, should be a non array object");this._uiViewedAttributes=S({},e)}),i()(this,"clearUIViewedAttributes",()=>{this._uiViewedAttributes={}}),i()(this,"sendIdentifyEvent",(e,t,r)=>{this.setUserInfo(e,t);const n={userIdType:e,eventType:a.eventType.IDENTIFY};return this._processEvent(t,n,this._context,r)}),i()(this,"sendPageEvent",(e,t)=>this.sendScreenEvent(e,t)),i()(this,"sendScreenEvent",(e,t,r)=>{let n,i,s,o;"object"==typeof e?(n=e.name,i=e.attributes,s=e.containers,o=e.tags):(n=e,i=r),Object(h.validateScreenEvent)(n),Object(h.validateContainers)(s);const a=Object(l.buildScreenEvent)(this._productInfo,this._tenantInfo,this._userInfo,i,e.nonPrivacySafeAttributes,o,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,e,s),c=S({name:n},a);return this._setLastScreenEvent(c),this._processEvent(n,a,this._context,Object(T.default)(t,c))}),i()(this,"sendTrackEvent",(e,t)=>{Object(h.validateTrackEvent)(e);const r=Object(l.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.TRACK,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId);return this._processEvent(Object(l.buildActionName)(e),r,this._context,Object(T.default)(t,r))}),i()(this,"sendUIEvent",(e,t)=>{Object(h.validateUIEvent)(e);const r=Object(l.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.UI,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId);return this._processEvent(Object(l.buildActionName)(e),r,this._context,Object(T.default)(t,r))}),i()(this,"sendOperationalEvent",(e,t)=>{Object(h.validateOperationalEvent)(e);const r=Object(l.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.OPERATIONAL,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId);return this._processEvent(Object(l.buildActionName)(e),r,this._context,Object(T.default)(t,r))}),i()(this,"startUIViewedEvent",e=>{this.stopUIViewedEvent(),this._uiViewedEvent=new I.default(this._productInfo,()=>({embeddedProduct:this._productInfo.embeddedProduct(),subproduct:this._productInfo.subproduct(),tenantIdType:this._tenantInfo.tenantIdType,tenantId:this._tenantInfo.tenantId,userId:this._userInfo.userId,lastScreenEvent:this._getLastScreenEvent(),attributes:this._uiViewedAttributes}),t=>this.sendUIEvent(t,e)),this._uiViewedEvent.start()}),i()(this,"stopUIViewedEvent",()=>{this._uiViewedEvent&&(this._uiViewedEvent.stop(),this._uiViewedEvent=null)}),i()(this,"resetUIViewedTimers",()=>{this._uiViewedEvent&&this._uiViewedEvent.resetTimers()}),i()(this,"startApdexEvent",e=>{this._apdexEvent.start(e)}),i()(this,"getApdexStart",e=>this._apdexEvent.getStart(e)),i()(this,"stopApdexEvent",(e,t)=>{this._apdexEvent.stop(e,t)}),i()(this,"startLowPriorityEventDelay",(e,t)=>{this.eventDelayQueue.startLowPriorityEventDelay(e,t)}),i()(this,"stopLowPriorityEventDelay",()=>{this.eventDelayQueue.stopLowPriorityEventDelay()}),i()(this,"onEvent",(e,t)=>{if(!t)throw new Error("Missing analyticsData");if(!t.eventType)throw new Error("Missing analyticsData.eventType");if(t.eventType===a.eventType.TRACK)return this.sendTrackEvent(t);if(t.eventType===a.eventType.UI)return this.sendUIEvent(t);if(t.eventType===a.eventType.OPERATIONAL)return this.sendOperationalEvent(t);if(t.eventType===a.eventType.SCREEN)return this.sendScreenEvent(t.name,null,t.attributes);if(t.eventType===a.eventType.IDENTIFY)return this.sendIdentifyEvent(t.userIdType,t.userId);throw new Error(`Invalid analyticsData.eventType '${t.eventType}', must be an eventType: [${Object(a.objectValues)(a.eventType)}]`)}),!e)throw new Error("Missing productInfo");if(!e.env)throw new Error("Missing productInfo.env");if(!e.product)throw new Error("Missing productInfo.product");if(!Object(a.isType)(a.envType,e.env))throw new Error(`Invalid productInfo.env '${e.env}', must be an envType: [${Object(a.objectValues)(a.envType)}]`);if(e.origin){if(!Object(a.isType)(a.originType,e.origin))throw new Error(`Invalid productInfo.origin '${e.origin}', must be an originType: [${Object(a.objectValues)(a.originType)}]`)}else e.origin=a.originType.WEB;e.platform?Object(h.validatePlatform)(e):e.platform=e.origin===a.originType.WEB?a.platformType.WEB:a.platformType.DESKTOP,this.logger=t.logger||console,this._productInfo=S(S({},e),{},{subproduct:this._createSubproductGetter(e.subproduct),embeddedProduct:this._createEmbeddedProductGetter(e.embeddedProduct)}),this._tenantInfo={},this._orgInfo={},this._uiViewedAttributes={},this._context=Object(l.buildContext)(this._productInfo),this._safeSessionStorage=new b.default;const r=this._useStargate(t.useStargate),n=t.apiHost||this._selectHost({useStargate:r,env:e.env,useLegacyUrl:t.useLegacyUrl}),s={maxRetryDelay:6e4,minRetryDelay:t.minRetryDelay||1e3,backoffFactor:2,flushWaitMs:t.flushWaitInterval,flushBeforeUnload:t.flushBeforeUnload},_="awc-"+e.env;this.eventProcessor=new f.default({apiHost:n,product:e.product,retryQueuePrefix:_,retryQueueOptions:s,xidPromiseGetter:()=>Object(w.XIDPromise)(t.xidConsent,t.xidPromiseFn),logger:this.logger}),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId()},this._pageVisibility=new p.default,this._tabTracking=new y.default,this._sessionTracking=new g.default({sessionExpiryTime:t.sessionExpiryTime}),this.task=new v.default,this.originTracing=new m.default,this._apdexEvent=new c.default(this.sendOperationalEvent,this._pageVisibility),this._historyReplaceFn="function"==typeof t.historyReplaceFn?t.historyReplaceFn:O.defaultHistoryReplaceFn,this.eventDelayQueue=new d.default(this._fireDelayedEvent,t.delayQueueCompressors||[]),this._testingCache=new E.default,this._pageLoadId=o()()}}},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(4),i=r(5);e.exports=function(e,t,r){var s=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||n)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[s+a]=o[a];return t||i(o)}},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},function(e,t,r){"use strict";let n,i,s,o,a,c,u;r.r(t),r.d(t,"envType",(function(){return n})),r.d(t,"eventType",(function(){return i})),r.d(t,"platformType",(function(){return s})),r.d(t,"originType",(function(){return o})),r.d(t,"tenantType",(function(){return a})),r.d(t,"userType",(function(){return c})),r.d(t,"apdexType",(function(){return u})),r.d(t,"desktopPlatforms",(function(){return l})),r.d(t,"webPlatforms",(function(){return d})),r.d(t,"originTracingType",(function(){return h})),r.d(t,"objectValues",(function(){return f})),r.d(t,"isType",(function(){return m})),function(e){e.LOCAL="local",e.DEV="dev",e.STAGING="staging",e.PROD="prod"}(n||(n={})),function(e){e.TRACK="track",e.UI="ui",e.OPERATIONAL="operational",e.SCREEN="screen",e.IDENTIFY="identify"}(i||(i={})),function(e){e.MAC="mac",e.LINUX="linux",e.WINDOWS="windows",e.DESKTOP="desktop",e.WEB="web",e.MOBILE_WEB="mobileWeb"}(s||(s={})),function(e){e.DESKTOP="desktop",e.WEB="web"}(o||(o={})),function(e){e.CLOUD_ID="cloudId",e.ORG_ID="orgId",e.OPSGENIE_CUSTOMER_ID="opsgenieCustomerId",e.HALP_TEAM_ID="halpTeamId",e.NONE="none"}(a||(a={})),function(e){e.ATLASSIAN_ACCOUNT="atlassianAccount",e.HASHED_EMAIL="hashedEmail",e.TRELLO="trello",e.OPSGENIE="opsgenie",e.HALP="halp"}(c||(c={})),function(e){e.TRANSITION="transition",e.INITIAL_LOAD="initialLoad"}(u||(u={}));const l=Object.freeze([s.DESKTOP,s.MAC,s.LINUX,s.WINDOWS]),d=Object.freeze([s.WEB,s.MOBILE_WEB]);let h;function f(e){return Object.values(e)}function m(e,t){return Object.values(e).indexOf(t)>-1}!function(e){e.ATL_ORIGIN="atlOrigin"}(h||(h={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l}));var n=r(2),i=r.n(n),s=r(6),o=r(8),a=r(9);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class l{constructor(e,t){if(i()(this,"_getEventKey",e=>{let{task:t,taskId:r}=e;return r?`${t}.${r}`:t}),i()(this,"_getEventTimingByName",e=>{const t=this._performance.getEntriesByName(e);return t[t.length-1]}),i()(this,"_getApdexFields",e=>{const t=this._getApdexTimings(e),r=this._calculateApdex({duration:t.duration,threshold:e.threshold});return u(u({},t),{},{apdex:r})}),i()(this,"_getApdexTimings",e=>{const t=this._getEventKey(e),r=t+"-start",n=e.startTime||this._getStartTime(e,r),i=e.stopTime||this._getStopTime();return this._cleanApdexState(t),{startTime:n,stopTime:i,duration:i-n}}),i()(this,"_getStartTime",(e,t)=>{let r;const n=this._performance.getTimeOrigin();if(e.type===s.apdexType.INITIAL_LOAD)r=n;else{r=n+this._getEventTimingByName(t).startTime}return r}),i()(this,"_getStopTime",()=>this._performance.getTimeOrigin()+this._performance.now()),i()(this,"_cleanApdexState",e=>{this._performance.clearMarks(e+"-start"),this._performance.clearMarks(e+"-stop"),this._startedEvents.delete(e)}),i()(this,"_getVisibilityFields",e=>{let t;if(e.type===s.apdexType.INITIAL_LOAD)t=!this._wasPreviouslyHidden;else if(e.type===s.apdexType.TRANSITION){const r=this._getEventKey(e);t=this._isActiveEvents.get(r)}return(e.startTime||e.stopTime)&&(t=!this._pageVisibility.getIsHidden()),{isActiveTab:t}}),i()(this,"_calculateApdex",e=>{let t,{duration:r,threshold:n=this._threshold}=e;return t=r<=n?1:r<=4*n?.5:0,t}),i()(this,"_validateStartEvent",e=>{if(!e)throw new Error('Missing "event" in Apdex start event');if(!e.task)throw new Error('Missing "task" in Apdex start event');if("string"!=typeof e.task)throw new Error('Invalid "task" in Apdex start event');if(e.taskId&&"string"!=typeof e.taskId)throw new Error('Invalid "taskId" in Apdex start event')}),i()(this,"_validateStopEvent",e=>{if(!e)throw new Error('Missing "event" in Apdex stop event');if(!e.task)throw new Error('Missing "task" in Apdex stop event');if("string"!=typeof e.task)throw new Error('Invalid "task" in Apdex stop event');if(e.taskId&&"string"!=typeof e.taskId)throw new Error('Invalid "taskId" in Apdex stop event');if(!e.type)throw new Error('Missing "type" in Apdex stop event');if(e.type&&!Object(s.isType)(s.apdexType,e.type))throw new Error('Invalid "type" in Apdex stop event');if(e.threshold&&"number"!=typeof e.threshold)throw new Error('Invalid "threshold" in Apdex stop event');if(!e.startTime&&e.type===s.apdexType.TRANSITION){const t=this._getEventKey(e);if(!this._startedEvents.has(t))throw new Error(`Apdex event transition "${t}" was not started`)}if(e.startTime&&!("number"==typeof e.startTime&&e.startTime>=0))throw new Error('Invalid "startTime" in Apdex stop event');if(e.stopTime&&"number"!=typeof e.stopTime)throw new Error('Invalid "stopTime" in Apdex stop event');if(e.stopTime<=e.startTime)throw new Error('"stopTime" should be greater than "startTime" in Apdex stop event')}),i()(this,"_shouldSendEvent",e=>!!e&&"number"==typeof e.apdex),i()(this,"_sendEvent",(e,t)=>{this._shouldSendEvent(e)&&this._onEvent({source:"ui",action:"readyForUser",actionSubject:"ui",attributes:u(u({},e.additionalAttributes),{},{task:e.task,taskId:e.taskId,type:e.type,threshold:e.threshold||this._threshold,apdex:e.apdex,startTime:e.startTime,stopTime:e.stopTime,duration:e.duration,isActiveTab:e.isActiveTab})},t)}),!e)throw new Error("Missing onEvent callback");if("function"!=typeof e)throw new Error("Invalid onEvent, must be function");if(!(t instanceof o.default))throw new Error("Invalid pageVisibility, must be PageVisibility class");this._startedEvents=new Map,this._performance=new a.default,this._onEvent=e,this._threshold=1e3,this._wasPreviouslyHidden=t.getIsHidden(),this._isActiveEvents=new Map,this._pageVisibility=t,this._pageVisibility.addCallback("apdexEvent",e=>{this.onVisibilityChange(!e)})}start(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;const t=this._getEventKey(e),r=t+"-start";this._startedEvents.set(t,!0),this._isActiveEvents.set(t,!this._pageVisibility.getIsHidden()),this._performance.clearMarks(r),this._performance.mark(r)}getStart(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;const t=this._getEventKey(e)+"-start";return this._getEventTimingByName(t)}stop(e,t){if(this._validateStopEvent(e),!this._performance.isAvailable())return;const r=this._getApdexFields(e),n=this._getVisibilityFields(e);this._sendEvent(u(u(u({},e),r),n),t)}onVisibilityChange(e){e||(this._wasPreviouslyHidden=!0,this._isActiveEvents.forEach((e,t)=>this._isActiveEvents.set(t,!1)))}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var n=r(2),i=r.n(n);class s{constructor(){i()(this,"_bindEventListeners",()=>{document.addEventListener(this._visibilityChange,this._handleVisibilityChange,!1)}),i()(this,"_handleVisibilityChange",()=>{const e=document[this._hidden];this._isHidden=e,this._callbacks.forEach(t=>t(e))}),this._isHidden=!1,this._callbacks=new Map,this._hidden=void 0,this._visibilityChange=void 0,void 0!==document.hidden?(this._isHidden=document.hidden,this._hidden="hidden",this._visibilityChange="visibilitychange"):void 0!==document.msHidden?(this._isHidden=document.msHidden,this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this._isHidden=document.webkitHidden,this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),void 0!==document.addEventListener&&void 0!==this._hidden&&this._bindEventListeners()}addCallback(e,t){if("string"!=typeof e)throw new Error("Invalid name, must be string");if("function"!=typeof t)throw new Error("Invalid callback, must be function");this._callbacks.set(e,t)}removeCallback(e){this._callbacks.has(e)&&this._callbacks.delete(e)}getIsHidden(){return this._isHidden}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return n}));class n{constructor(){this._performance=window.performance}clearMarks(){this._performance&&this._performance.clearMarks&&this._performance.clearMarks(...arguments)}mark(){this._performance&&this._performance.mark&&this._performance.mark(...arguments)}getEntriesByName(){return this._performance&&this._performance.getEntriesByName?this._performance.getEntriesByName(...arguments):[]}getTimeOrigin(){return this._performance&&(this._performance.timeOrigin||this._performance.timing)?this._performance.timeOrigin||this._performance.timing.navigationStart:0}now(){return this._performance&&this._performance.now?this._performance.now():Date.now?Date.now():+new Date}isAvailable(){return!!(this._performance&&this._performance.clearMarks&&this._performance.mark&&this._performance.getEntriesByName&&this._performance.timing)}}},function(e,t,r){"use strict";r.r(t);t.default=(e,t)=>()=>{if((e=>"function"==typeof e)(e))try{return e()}catch(e){return void console.error(`${t} - ${e.message}`)}return e}},function(e,t,r){"use strict";r.r(t),r.d(t,"filterAndBuildContainers",(function(){return b})),r.d(t,"buildContainersWithName",(function(){return y})),r.d(t,"buildActionFields",(function(){return v})),r.d(t,"buildScreenEvent",(function(){return E})),r.d(t,"buildActionName",(function(){return I})),r.d(t,"buildContext",(function(){return O})),r.d(t,"extractProductOverrides",(function(){return T})),r.d(t,"buildActionEvent",(function(){return w}));var n=r(2),i=r.n(n),s=r(6),o=r(12);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e){return{tenantIdType:e.tenantIdType,tenantId:e.tenantId}}function l(e){return{userIdType:e.userIdType}}function d(e){return{orgId:e.orgId}}function h(e){return e.anonymousId?{anonymousId:e.anonymousId}:{}}function f(e,t){return void 0===t?e:t}function m(e,t){const r=t||{};return{env:f(e.env,r.env),product:f(e.product,r.product),subproduct:f(e.subproduct(),r.subproduct),version:f(e.version,r.version),origin:f(e.origin,r.origin),platform:f(e.platform,r.platform)}}function p(e){return Object(o.isPlainObject)(e)&&Object.keys(e).length>0}function g(e,t){return p(t)?{[e]:t}:void 0}function b(e){const t={};return Object.keys(e).forEach(r=>{const n=e[r];t[r]={id:n.id,type:n.type}}),t}function y(e){if(p(e)){return g("containers",b(e))}}function v(e,t){return c({containerType:e.containerType,containerId:e.containerId,source:e.source,objectType:e.objectType,objectId:e.objectId,actionSubject:e.actionSubject,action:e.action,actionSubjectId:e.actionSubjectId,attributes:e.attributes,nonPrivacySafeAttributes:e.nonPrivacySafeAttributes,tags:e.tags,highPriority:e.highPriority,eventType:t},y(e.containers))}function E(e,t,r,n,i,o,a,f,p,b,v,E,I){const O=m(e),T=u(t),w=l(r),_=d(b),S={title:"",path:"",url:"",referrer:"",search:"",eventType:s.eventType.SCREEN};return c(c(c(c(c(c(c(c(c(c({},O),T),w),_),S),function(e){return g("attributes",e)}(n)),function(e){return g("nonPrivacySafeAttributes",e)}(i)),y(I)),h(E)),{},{tags:o,tabId:a,sessionId:f,taskSessions:p,pageLoadId:v})}function I(e){return`${e.actionSubject} ${e.action}`}function O(e){const t=window.screen||{};return{context:{locale:e.locale,screen:{width:t.width,height:t.height,density:window.devicePixelRatio},library:{name:"analytics.js",version:"4.6.0"}}}}function T(e){const{env:t,product:r,subproduct:n,version:i,origin:s,platform:o}=e;return{env:t,product:r,subproduct:n,version:i,origin:s,platform:o}}function w(e,t,r,n,i,s,o,a,f,p){const g=m(e,T(n)),b=u(t),y=d(f),E=l(r),I=v(n,i);return c(c(c(c(c(c(c({},g),b),y),E),I),h(n)),{},{tabId:s,sessionId:o,taskSessions:a,pageLoadId:p})}},function(e,t,r){"use strict";function n(e){return!0==(null!==(t=e)&&"object"==typeof t&&!1===Array.isArray(t))&&"[object Object]"===Object.prototype.toString.call(e);var t}function i(e){if(!1===n(e))return!1;const t=e.constructor;if("function"!=typeof t)return!1;const r=t.prototype;return!1!==n(r)&&"isPrototypeOf"in r}r.r(t),r.d(t,"isPlainObject",(function(){return i}))},function(e,t,r){"use strict";r.r(t);var n=r(14);r.d(t,"CompressionRule",(function(){return n.CompressionRule}));var i=r(17);r.d(t,"default",(function(){return i.default}));var s=r(21);r.d(t,"StopLowPriorityEventDelayReason",(function(){return s.StopLowPriorityEventDelayReason}))},function(e,t,r){"use strict";r.r(t),r.d(t,"CompressionRule",(function(){return a}));var n=r(2),i=r.n(n),s=r(15),o=r(16);class a{constructor(e,t){if(i()(this,"canCompress",e=>{try{return e&&Object(s.isActionEventType)(e.eventType)&&this.predicate(e)}catch(e){return!1}}),i()(this,"compress",e=>{const[t,r]=Object(o.partition)(e,e=>this.canCompress(e)),n=this.compressFn(t);if(!n)throw new Error("No events were returned from the compression function");return n.forEach(e=>{Object(s.validateActionEventType)(e.eventType),Object(s.validateActionEvent)(e)}),n.concat(r)}),"function"!=typeof e)throw new Error("Invalid predicate, must be a function that accepts an event and returns a boolean");if("function"!=typeof t)throw new Error("Invalid compressFn, must be a function that both accepts and returns an array of events");this.predicate=e,this.compressFn=t}}},function(e,t,r){"use strict";r.r(t),r.d(t,"validateContainersObject",(function(){return o})),r.d(t,"validateContainers",(function(){return a})),r.d(t,"isActionEventType",(function(){return c})),r.d(t,"validateActionEventType",(function(){return u})),r.d(t,"validateActionEvent",(function(){return l})),r.d(t,"validateScreenEvent",(function(){return d})),r.d(t,"validateTrackEvent",(function(){return h})),r.d(t,"validateDwellBaseEvent",(function(){return f})),r.d(t,"validateUIEvent",(function(){return m})),r.d(t,"validateOperationalEvent",(function(){return p})),r.d(t,"validateIdentifyEvent",(function(){return g})),r.d(t,"validatePlatform",(function(){return b}));var n=r(6),i=r(12);const s=Object.freeze([n.eventType.OPERATIONAL,n.eventType.TRACK,n.eventType.UI]);function o(e){if(!Object(i.isPlainObject)(e))throw new Error("properties.containers must be an Object");if(!("id"in e))throw new Error("properties.containers is missing field 'id'");if("string"!=typeof e.id)throw new Error("properties.containers.id must be of type String");if("type"in e&&"string"!=typeof e.type)throw new Error("properties.containers.type must be of type String")}function a(e){if(e){if(e&&e.constructor!==Object)throw new Error("properties.containers must be an Object");Object.values(e).forEach(e=>o(e))}}function c(e){switch(e){case n.eventType.OPERATIONAL:case n.eventType.TRACK:case n.eventType.UI:return!0;default:return!1}}function u(e){if(!c(e))throw new Error(`Invalid action event type: ${e}, must be one of: [${s}]`);return!0}function l(e){if(!e)throw new Error("Missing event");if(!e.source)throw new Error("Missing event.source");if(!e.actionSubject)throw new Error("Missing event.actionSubject");if(!e.action)throw new Error("Missing event.action");a(e.containers)}function d(e){if(!e)throw new Error("Missing name")}function h(e){l(e)}function f(e){if(!e)throw new Error("Missing event");if(!e.source)throw new Error("Missing event.source");if(!e.actionSubject)throw new Error("Missing event.actionSubject")}function m(e){l(e)}function p(e){l(e)}function g(e,t){if(!e)throw new Error("Missing userIdType");if(!t)throw new Error("Missing userId");if(!Object(n.isType)(n.userType,e))throw new Error(`Invalid userIdType '${e}', must be an userType: [${Object(n.objectValues)(n.userType)}]`)}function b(e){if(!Object(n.isType)(n.platformType,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be a platformType: [${Object(n.objectValues)(n.platformType)}]`);if(e.origin===n.originType.DESKTOP&&!Object(n.isType)(n.desktopPlatforms,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be one of [mac, linux, windows]`);if(e.origin===n.originType.WEB&&!Object(n.isType)(n.webPlatforms,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be one of [web, mobileWeb]`)}},function(e,t,r){"use strict";r.r(t),r.d(t,"mapKeys",(function(){return n})),r.d(t,"pick",(function(){return i})),r.d(t,"pickBy",(function(){return o})),r.d(t,"omitBy",(function(){return s})),r.d(t,"omit",(function(){return a})),r.d(t,"equals",(function(){return c})),r.d(t,"partition",(function(){return u}));const n=(e,t)=>Object.keys(e).reduce((r,n)=>(r[t(e[n],n,e)]=e[n],r),{}),i=(e,t)=>t.reduce((t,r)=>(r in e&&(t[r]=e[r]),t),{}),s=(e,t)=>Object.keys(e).filter(r=>!t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),o=(e,t)=>Object.keys(e).filter(r=>t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),a=(e,t)=>Object.keys(e).filter(e=>t.indexOf(e)<0).reduce((t,r)=>(t[r]=e[r],t),{}),c=(e,t)=>{if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return e===t;if(e.prototype!==t.prototype)return!1;const r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(r=>c(e[r],t[r]))},u=(e,t)=>e.reduce((e,r,n,i)=>(e[t(r,n,i)?0:1].push(r),e),[[],[]])},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var n=r(2),i=r.n(n),s=r(18),o=r(19),a=r(21);class c{constructor(e,t){var r=this;i()(this,"push",(e,t,r,n)=>{this.delayQueue.push(e,t,r,n)}),i()(this,"startLowPriorityEventDelay",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DEFAULT_DELAY_TIMEOUT,t=arguments.length>1?arguments[1]:void 0;if(Number.isNaN(e)||e<=0)throw new Error(`Invalid timeout period: ${e}, must be a number greater than 0`);r.delayTimeout&&clearTimeout(r.delayTimeout);const n=e?Math.min(e,s.MAX_DELAY_TIMEOUT):s.MAX_DELAY_TIMEOUT;r.delayCallback=t,r.delayTimeout=setTimeout(()=>r.stopLowPriorityEventDelay(a.StopLowPriorityEventDelayReason.TIMEOUT),n),r.delayQueue.cancelFlush(),r.isDelaying=!0})),i()(this,"stopLowPriorityEventDelay",(function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.StopLowPriorityEventDelayReason.MANUAL;r.delayTimeout&&(clearTimeout(r.delayTimeout),r.delayTimeout=void 0),r.delayQueue.startFlush(),r.isDelaying=!1,null===(e=r.delayCallback)||void 0===e||e.call(r,t),r.delayCallback=void 0})),i()(this,"isDelayingLowPriorityEvents",()=>this.isDelaying),this.isDelaying=!1,this.delayQueue=new o.default(e,t)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"DEFAULT_DELAY_TIMEOUT",(function(){return n})),r.d(t,"MAX_DELAY_TIMEOUT",(function(){return i}));const n=1e4,i=3e4},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var n=r(2),i=r.n(n),s=r(11),o=r(16),a=r(20);class c{constructor(e,t){i()(this,"push",(e,t,r,n)=>{this.eventArgs.push({identifier:e,builtEvent:t,context:r,userInfo:n})}),i()(this,"size",()=>this.eventArgs.length),i()(this,"startFlush",()=>{try{this.eventArgs=this.compressEventArgs(this.eventArgs)}catch(e){console.warn(`Failed to perform compression on the delayed analytics events. Error: ${e.message}. Sending ${this.eventArgs.length} uncompressed events instead`)}this.flushNextBatch()}),i()(this,"cancelFlush",()=>{this.flushBatchTimeout&&(clearTimeout(this.flushBatchTimeout),this.flushBatchTimeout=null)}),i()(this,"flushNextBatch",()=>{this.eventArgs.splice(0,7).forEach(e=>this.processFn(e.identifier,e.builtEvent,e.context,e.userInfo)),this.eventArgs.length>0?this.flushBatchTimeout=setTimeout(()=>this.flushNextBatch(),100):this.flushBatchTimeout=null}),i()(this,"compressEventArgs",e=>{const[t,r]=Object(o.partition)(e,e=>this.compressor.canCompress(e.builtEvent)),n=t.reduce((e,t)=>{const r=e.find(e=>Object(o.equals)(e.userInfo,t.userInfo)&&Object(o.equals)(e.context,t.context));return r?r.eventArgs.push(t):e.push({userInfo:t.userInfo,context:t.context,eventArgs:[t]}),e},[]).reduce((e,t)=>{try{const r=t.eventArgs.map(e=>e.builtEvent),n=this.compressor.compress(r).map(e=>({identifier:Object(s.buildActionName)(e),builtEvent:e,userInfo:t.userInfo,context:t.context}));return e.concat(n)}catch(e){return console.warn(`Failed to compress some analytics events. Error: ${e.message}. Sending ${t.eventArgs.length} uncompressed events instead`),t.eventArgs}},[]);return r.forEach(e=>n.push(e)),n}),this.processFn=e,this.flushBatchTimeout=null,this.eventArgs=[],this.compressor=new a.default(t)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l}));var n=r(2),i=r.n(n),s=r(11),o=r(16),a=r(14);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(i()(this,"canCompress",e=>this.compressionRules.some(t=>t.canCompress(e))),i()(this,"compress",e=>this.createGroups(e).reduce((e,t)=>{const r=this.compressGroup(t);return e.concat(r)},[])),i()(this,"createGroups",e=>e.reduce((e,t)=>{const r=this.compressionRules.find(e=>e.canCompress(t));let n;if(r){const e=Object(s.buildActionFields)(t,t.eventType);n=Object(o.omit)(t,Object.keys(e))}const i=e.find(e=>r===e.compressor&&Object(o.equals)(n,e.contextFields));return i?i.events.push(t):e.push({contextFields:n,compressor:r,events:[t]}),e},[])),i()(this,"compressGroup",e=>{if(!e.compressor)return e.events;try{return e.compressor.compress(e.events).map(t=>u(u({},t),e.contextFields))}catch(t){return console.warn(`Failed to compress some analytics events. Error: ${t.message}. Sending ${e.events.length} uncompressed events instead`),e.events}}),!Array.isArray(e))throw new Error("Event compressors must be constructed with an array of CompressionRules");if(!e.every(e=>e instanceof a.CompressionRule))throw new Error("Event compressors can only be constructed with instances of CompressionRule");this.compressionRules=e}}},function(e,t,r){"use strict";let n;r.r(t),r.d(t,"StopLowPriorityEventDelayReason",(function(){return n})),function(e){e.TIMEOUT="timeout",e.MANUAL="manual"}(n||(n={}))},function(e,t,r){"use strict";r.r(t);var n=r(23);r.d(t,"default",(function(){return n.default}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return b}));var n=r(2),i=r.n(n),s=r(3),o=r.n(s),a=r(24),c=r(48),u=r(55),l=r(61),d=r(62),h=r(60),f=r(64),m=r(80);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class b{constructor(e){i()(this,"sendEvents",async(e,t)=>{const r=this.resilienceQueue.getGlobalRetryCount(),n=this.metrics.getMetricsPayload(),i=g(g({},n),{},{httpRetryCount:r});for(let e in i)0===i[e]&&delete i[e];const s=await this.attachXIDs(e),o=(new Date).toISOString(),a={batch:s.map(e=>(e.msg.sentAt=o,e.msg)),sentAt:o,metadata:i};try{const e=await Object(d.sendEvents)({url:this.gasv3BatchUrl,batch:a,timeout:this.options.requestTimeout});this.metrics.subtractFromMetrics(n),t(null,e)}catch(e){t(e,null)}}),this.user=new f.default,this.options=g(g({},e),{},{requestTimeout:e.requestTimeout||l.DEFAULT_REQUEST_TIMEOUT,retryQueueOptions:e.retryQueueOptions||{},logger:e.logger||console}),this.xidPromiseCallback=e.xidPromiseGetter(),this.gasv3BatchUrl=`https://${e.apiHost}/batch`,this.metrics=Object(c.default)(),this.resilienceQueue=Object(a.default)(e.retryQueuePrefix,e.product,this.options.retryQueueOptions,this.options.logger),this.resilienceQueue.start(this.sendEvents)}getUser(){return this.user}async track(e,t,r,n){const i=g(g({},this.buildBaseEvent(r,h.SegmentEventTypes.TRACK,t)),{},{type:h.SegmentEventTypes.TRACK,properties:Object(m.prepareEventProperties)(t),event:e}),s=g(g({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(s);await this.resilienceQueue.addItem(o),n&&n()}async page(e,t,r,n){const i=g(g({},this.buildBaseEvent(r,h.SegmentEventTypes.PAGE,t)),{},{type:h.SegmentEventTypes.PAGE,properties:Object(m.prepareEventProperties)(t),name:e}),s=g(g({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(s);await this.resilienceQueue.addItem(o),n&&n()}async identify(e,t,r,n){const i=g(g({},this.buildBaseEvent(r,h.SegmentEventTypes.IDENTIFY,t)),{},{type:h.SegmentEventTypes.IDENTIFY,traits:Object(m.prepareEventProperties)(t)}),s=g(g({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(s);await this.resilienceQueue.addItem(o),n&&n()}buildBaseEvent(e,t,r){const n=Object(m.prepareEventProperties)(e);return{context:Object(m.buildContext)(n),timestamp:(new Date).toISOString(),type:t,userId:this.user.getUserId(),anonymousId:r.anonymousId||this.user.getAnonymousId()}}createMessageId(){return"ajs-"+o()()}packageEvent(e){const{apiHost:t}=this.options;return{headers:{"Content-Type":"text/plain"},msg:e,url:`https://${t}/${e.type.charAt(0)}`}}async attachXIDs(e){return this.xidPromiseCallback?Object(u.attachXidToMultipleEvents)(e,this.xidPromiseCallback):Promise.resolve(e)}}},function(e,t,r){"use strict";r.r(t);var n=r(25),i=r(49);r.d(t,"ResilienceMechanism",(function(){return i.ResilienceMechanism})),t.default=(e,t,r,i)=>new n.default(e,t,r||{},i)},function(e,t,r){"use strict";r.r(t),r.d(t,"DEFAULT_POLLING_OPTIONS",(function(){return m})),r.d(t,"default",(function(){return p}));var n=r(2),i=r.n(n),s=r(26),o=r(31),a=r(48),c=r(50),u=r(51),l=r(49);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const f={backoffFactor:0,backoffJitterPercentage:0,flushWaitMs:6e4,minRetryDelay:6e4,maxRetryDelay:6e4},m={backoffFactor:2,backoffJitterPercentage:.2,batchFlushSize:7,flushBeforeUnload:!1,flushWaitMs:500,maxAttempts:10,maxItems:1e3,maxRetryDelay:3e4,minRetryDelay:1e3};class p{constructor(e,t,r,n){this.queuePrefix=e,this.resilience=new o.default(t,{logger:n,maxAttempts:null==r?void 0:r.maxAttempts,maxEventLimit:null==r?void 0:r.maxItems}),this.options=this.buildOptions(r),this.scheduler=new u.default(h(h({},this.options),{},{waitInterval:null!=r&&r.flushBeforeUnload?0:this.options.flushWaitMs}),this.scheduleCallback.bind(this)),this.longPollingScheduler=new u.default(h(h({},f),{},{waitInterval:f.flushWaitMs}),this.scheduleLongCallBack.bind(this)),this.metricsCollector=Object(a.default)(),this.networkStatus=new c.default(e=>{e===l.NetworkStatusEnum.OFFLINE?this.scheduler.stop():this.checkEventCountAndReschedule()})}start(e){this.batchFlushCallback=e,this.longPollingScheduler.schedule()}stop(){this.scheduler.stop(),this.longPollingScheduler.stop()}async addItem(e){const t=JSON.parse(JSON.stringify(e)),{numberOfEvictedItems:r}=await this.resilience.addItem(t,{},o.GuardPolicy.EVICT);this.scheduler.schedule(),this.metricsCollector.addToEventCount(),r>0&&this.metricsCollector.addToItemsDiscardedByOverflowCounter(r)}getGlobalRetryCount(){return this.scheduler.getFailureCount()}async scheduleCallback(e){if(this.networkStatus.getNetworkStatus()!==l.NetworkStatusEnum.OFFLINE)try{e(await this.resilience.processItems(this.flush.bind(this),this.options.batchFlushSize))}catch(t){if(t.name===o.CallbackProcessingErrorName)return void e(u.DoneState.ERROR)}finally{await this.checkEventCountAndReschedule()}else e(u.DoneState.NOOP)}async checkEventCountAndReschedule(){const e=await this.resilience.getItemCount();e>0&&this.scheduler.schedule({immediate:e>=this.options.batchFlushSize})}async scheduleLongCallBack(e){const t=Object(s.purgeOrphanedQueues)(this.queuePrefix);this.metricsCollector.addToPurgedQueuesMetrics(t);const r=await Object(s.reclaimEvents)(this.queuePrefix,async e=>{const t=e.map(e=>({item:e.item,retryAttempts:e.attemptNumber,id:e.id})),{items:r}=await this.resilience.bulkAddItem(t,o.GuardPolicy.IGNORE);return r.length===t.length?{status:"successful"}:{status:"partial",acceptedItemIds:r.map(e=>e.id)}});this.metricsCollector.addToReclaimMetrics(r),await this.checkEventCountAndReschedule(),e(u.DoneState.SUCCESS),this.longPollingScheduler.schedule()}flush(e,t){this.metricsCollector.setResilienceMechanism(this.resilience.storeType());const{batchFlushCallback:r}=this;if(!r)throw new Error("batchFlushCallback has not been set. Call PullBatchableQueue#start first.");return new Promise((n,i)=>{if(e.length<=0)return void n(u.DoneState.NOOP);const s=e.map(e=>{const t=e.item;return e.retryAttempts>0&&t.msg&&(t.msg._metadata||(t.msg._metadata={}),t.msg._metadata.failedAttempts=e.retryAttempts),t});r(s,e=>{e?(t.numberOfDeletedItems>0&&this.metricsCollector.addToItemsDiscardedByRetryCounter(t.numberOfDeletedItems),i(e)):n(u.DoneState.SUCCESS)})})}buildOptions(e){return{backoffFactor:(null==e?void 0:e.backoffFactor)||m.backoffFactor,backoffJitterPercentage:void 0!==(null==e?void 0:e.backoffJitterPercentage)?e.backoffJitterPercentage:m.backoffJitterPercentage,batchFlushSize:(null==e?void 0:e.batchFlushSize)||m.batchFlushSize,flushBeforeUnload:(null==e?void 0:e.flushBeforeUnload)||m.flushBeforeUnload,flushWaitMs:(null==e?void 0:e.flushWaitMs)||m.flushWaitMs,maxItems:(null==e?void 0:e.maxItems)||m.maxItems,maxAttempts:(null==e?void 0:e.maxAttempts)||m.maxAttempts,maxRetryDelay:(null==e?void 0:e.maxRetryDelay)||m.maxRetryDelay,minRetryDelay:(null==e?void 0:e.minRetryDelay)||m.minRetryDelay}}}},function(e,t,r){"use strict";r.r(t);var n=r(27);r.d(t,"reclaimEvents",(function(){return n.default}));var i=r(30);r.d(t,"purgeOrphanedQueues",(function(){return i.default}))},function(e,t,r){"use strict";r.r(t);var n=r(2),i=r.n(n),s=r(3),o=r.n(s),a=r(28),c=r(29);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const d=e=>new Promise(t=>{setTimeout(t,e)}),h=async(e,t)=>{const{queue:r,inProgress:n}=e.storageKeys,i=JSON.parse(localStorage.getItem(r)||"[]"),s=JSON.parse(localStorage.getItem(n)||"{}"),o=[...i,...Object.entries(s).map(e=>{let[t,r]=e;return l(l({},r),{},{attemptNumber:r.attemptNumber+1,id:t})})];if(o.length>0){const i=await t(o);if("successful"===i.status)f(e.storageKeys);else if("partial"===i.status){const e=o.filter(e=>!i.acceptedItemIds.includes(e.id));return localStorage.removeItem(n),localStorage.setItem(r,JSON.stringify(e)),{fullReclaim:!1}}}else f(e.storageKeys);return{fullReclaim:!0}},f=e=>{localStorage.removeItem(e.queue),localStorage.removeItem(e.inProgress),localStorage.removeItem(e.reclaimEnd),localStorage.removeItem(e.reclaimStart),localStorage.removeItem(e.ack)};t.default=async(e,t)=>{if("string"!=typeof e||0===e.length)return{fullReclaims:0,partialReclaims:0,failedReclaims:0};const r=o()(),n=(e=>{try{return Object.keys(localStorage).filter(t=>t.startsWith(e)).map(e=>e.split(".")).filter(t=>{if(3===t.length&&t[0]===e&&t[2]===a.LocalStorageKeySuffix.ACK)try{const e=localStorage.getItem(t.join("."));if(e){const t=parseInt(e);return a.Timers.RECLAIM_TIMEOUT+t<Date.now()}}catch(e){}return!1}).map(e=>e[1])}catch(e){}return[]})(e).map(n=>(async(e,t)=>{const{ack:r,reclaimStart:n,reclaimEnd:i}=e.storageKeys,s=Date.now();if(localStorage.setItem(n,e.reclaimProcessId),localStorage.setItem(r,s.toString()),await d(a.Timers.RECLAIM_WAIT),Date.now()>s+a.Timers.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(n)!==e.reclaimProcessId)throw new Error("Took to long to callback, reclaim abandonded. After reclaimStart.");if(localStorage.setItem(i,e.reclaimProcessId),await d(a.Timers.RECLAIM_WAIT),Date.now()>s+a.Timers.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(n)!==e.reclaimProcessId||localStorage.getItem(i)!==e.reclaimProcessId)throw new Error("Took to long to callback, reclaim abandonded. After reclaimEnd.");return h(e,t)})({queuePrefix:e,reclaimProcessId:r,storageKeys:Object(c.createLocalStorageKeys)(e,n)},t)),i=await Promise.allSettled(n),s=i.filter(e=>"rejected"===e.status),u=i.filter(e=>"fulfilled"===e.status).map(e=>e.value),l=u.filter(e=>e.fullReclaim),f=u.filter(e=>!e.fullReclaim);return{failedReclaims:s.length,partialReclaims:f.length,fullReclaims:l.length}}},function(e,t,r){"use strict";let n,i;r.r(t),r.d(t,"LocalStorageKeySuffix",(function(){return n})),r.d(t,"Timers",(function(){return i})),function(e){e.IN_PROGRESS="inProgress",e.QUEUE="queue",e.RECLAIM_START="reclaimStart",e.RECLAIM_END="reclaimEnd",e.ACK="ack"}(n||(n={})),function(e){e[e.RECLAIM_TIMEOUT=1e4]="RECLAIM_TIMEOUT",e[e.RECLAIM_WAIT=500]="RECLAIM_WAIT",e[e.RECLAIM_WAIT_THRESHOLD=2e3]="RECLAIM_WAIT_THRESHOLD"}(i||(i={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"createLocalStorageKeys",(function(){return i}));var n=r(28);const i=(e,t)=>({[n.LocalStorageKeySuffix.ACK]:`${e}.${t}.${n.LocalStorageKeySuffix.ACK}`,[n.LocalStorageKeySuffix.QUEUE]:`${e}.${t}.${n.LocalStorageKeySuffix.QUEUE}`,[n.LocalStorageKeySuffix.IN_PROGRESS]:`${e}.${t}.${n.LocalStorageKeySuffix.IN_PROGRESS}`,[n.LocalStorageKeySuffix.RECLAIM_START]:`${e}.${t}.${n.LocalStorageKeySuffix.RECLAIM_START}`,[n.LocalStorageKeySuffix.RECLAIM_END]:`${e}.${t}.${n.LocalStorageKeySuffix.RECLAIM_END}`})},function(e,t,r){"use strict";r.r(t);var n=r(28),i=r(29);const s=Object.values(n.LocalStorageKeySuffix);t.default=e=>{if("string"!=typeof e||0===e.length)return 0;try{const t=Object.keys(localStorage).filter(t=>t&&t.startsWith(e+".")||!1).map(e=>e.split(".")).filter(e=>3===e.length&&s.includes(e[2])).reduce((e,t)=>{const[,r,n]=t;return void 0===e[r]&&(e[r]={}),e[r][n]=!0,e},{}),r=Object.keys(t).filter(e=>!0!==t[e][n.LocalStorageKeySuffix.ACK]);return r.forEach(t=>{const{queue:r,inProgress:n,reclaimStart:s,reclaimEnd:o}=Object(i.createLocalStorageKeys)(e,t);localStorage.removeItem(n),localStorage.removeItem(r),localStorage.removeItem(s),localStorage.removeItem(o)}),r.length}catch(e){}return 0}},function(e,t,r){"use strict";r.r(t);var n=r(32),i=r(33);r.d(t,"GuardPolicy",(function(){return i.GuardPolicy})),r.d(t,"StoreType",(function(){return i.StoreType}));var s=r(34);r.d(t,"CallbackProcessingErrorName",(function(){return s.CallbackProcessingErrorName})),t.default=n.default},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var n=r(33),i=r(34),s=r(40),o=r(46),a=r(45);class c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.namespace=e,this.options=Object(a.createOptionsWithDefaults)(t),!e||0===e.length||"string"!=typeof e)throw new Error("Invalid namespace provided");this.resilience=this.getResilienceMechanism(e,t)}getResilienceMechanism(e,t){if(!t.useMemory)try{return new s.default(e,t)}catch(e){var r;if(!(e instanceof i.NoIndexedDbError))null===(r=t.logger)||void 0===r||r.warn("Attempted to create IndexedDbResilience but failed. Using memory instead.")}return new o.default(this.namespace,t)}addItem(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.GuardPolicy.ABANDON;return this.runOrFailOver(()=>this.resilience.addItem(e,t,r))}bulkAddItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.GuardPolicy.ABANDON;return this.runOrFailOver(()=>this.resilience.bulkAddItem(e,t))}getItems(e){return this.runOrFailOver(()=>this.resilience.getItems(e))}deleteItems(e){return this.runOrFailOver(()=>this.resilience.deleteItems(e))}getItemCount(){return this.runOrFailOver(()=>this.resilience.getItemCount())}processItems(e,t){return this.runOrFailOver(()=>this.resilience.processItems(e,t))}storeType(){return this.resilience.storeType()}async runOrFailOver(e){try{return await e()}catch(t){if(Object(i.shouldIgnoreResilienceDbError)(t))throw t;return this.resilience.storeType()===n.StoreType.INDEXEDDB&&await this.failOver(),e()}}async failOver(){const e=this.resilience,t=new o.default(this.namespace,this.options);this.resilience=t;try{const{items:r}=await e.getItems(this.options.maxEventLimit);if(r.length>0){const i=(await t.bulkAddItemWrapperType(r,n.GuardPolicy.IGNORE)).items.map(e=>e.id);await e.deleteItems(i)}}catch(e){this.options.logger.warn("Unexpected error from ResilienceDb, switching to MemoryDb")}}}},function(e,t,r){"use strict";r.r(t),r.d(t,"NAMESPACE_AND_TIME_ADDED_INDEX",(function(){return n})),r.d(t,"RESILIENCE_DB_NAME",(function(){return i})),r.d(t,"RESILIENCE_STORE_NAME",(function(){return s})),r.d(t,"TIME_TO_PROCESS_AFTER_INDEX",(function(){return o})),r.d(t,"TIME_ADDED_INDEX",(function(){return a})),r.d(t,"RETRY_INDEX",(function(){return c})),r.d(t,"INDEXEDDB_TIMEOUT",(function(){return u})),r.d(t,"StoreType",(function(){return l})),r.d(t,"GuardPolicy",(function(){return d}));const n="namespace-timeAdded",i="analytics-web-client",s="analytics-resilience",o="timeToBeProcessedAfter",a="timeAdded",c="retryAttempts",u=15e3;let l,d;!function(e){e.INDEXEDDB="indexeddb",e.MEMORY="memory"}(l||(l={})),function(e){e.IGNORE="ignore",e.ABANDON="abandon",e.EVICT="evict"}(d||(d={}))},function(e,t,r){"use strict";r.r(t);var n=r(35);r.d(t,"AbandonWriteError",(function(){return n.default})),r.d(t,"AbandonWriteErrorName",(function(){return n.AbandonWriteErrorName}));var i=r(36);r.d(t,"CallbackProcessingError",(function(){return i.default})),r.d(t,"CallbackProcessingErrorName",(function(){return i.CallbackProcessingErrorName}));var s=r(37);r.d(t,"InvalidPolicyError",(function(){return s.default})),r.d(t,"InvalidPolicyErrorName",(function(){return s.InvalidPolicyErrorName}));var o=r(38);r.d(t,"NoIndexedDbError",(function(){return o.default})),r.d(t,"NoIndexedDbErrorName",(function(){return o.NoIndexedDbErrorName}));var a=r(39);r.d(t,"shouldIgnoreResilienceDbError",(function(){return a.shouldIgnoreResilienceDbError}))},function(e,t,r){"use strict";r.r(t),r.d(t,"AbandonWriteErrorName",(function(){return n})),r.d(t,"default",(function(){return i}));const n="AbandonWriteError";class i extends Error{constructor(e){super("Event Limit reached. Abandoning write to: "+e),Object.setPrototypeOf(this,i.prototype),this.name=n}}},function(e,t,r){"use strict";r.r(t),r.d(t,"CallbackProcessingErrorName",(function(){return n})),r.d(t,"default",(function(){return i}));const n="CallbackProcessingError";class i extends Error{constructor(e){super("Error thrown while processing events in callback: "+(e&&"object"==typeof e&&"toString"in e&&"function"==typeof e.toString&&e.toString()||"string"==typeof e&&e||"Argument passed to CallbackProcessingError was not an Error or string.")),Object.setPrototypeOf(this,i.prototype),this.name=n}}},function(e,t,r){"use strict";r.r(t),r.d(t,"InvalidPolicyErrorName",(function(){return n})),r.d(t,"default",(function(){return i}));const n="InvalidPolicyError";class i extends Error{constructor(e,t){super(`Method '${t}' cannot be called with policy '${e}'.`),this.name=n}}},function(e,t,r){"use strict";r.r(t),r.d(t,"NoIndexedDbErrorName",(function(){return n})),r.d(t,"default",(function(){return i}));const n="NoIndexedDbError";class i extends Error{constructor(){super("window.indexeddb is undefined."),Object.setPrototypeOf(this,i.prototype),this.name=n}}},function(e,t,r){"use strict";r.r(t),r.d(t,"shouldIgnoreResilienceDbError",(function(){return o}));var n=r(35),i=r(36),s=r(37);const o=e=>{if(e&&"object"==typeof e&&"name"in e){const t=e;return"string"==typeof t.name&&(t.name===n.AbandonWriteErrorName||t.name===i.CallbackProcessingErrorName||t.name===s.InvalidPolicyErrorName)}return!1}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return g}));var n=r(41),i=r.n(n),s=r(2),o=r.n(s),a=r(33),c=r(43),u=r(34),l=r(44),d=r(45);const h=["item"],f=["items"];function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class g{constructor(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o()(this,"startDB",async()=>new Promise(async(e,t)=>{window.setTimeout(()=>{this.logger.warn("IndexedDB timed out."),t(new u.NoIndexedDbError)},a.INDEXEDDB_TIMEOUT);const r=window.indexedDB.open(a.RESILIENCE_DB_NAME,1);r.onupgradeneeded=e=>{if(0!==e.oldVersion)throw new Error("We cannot upgrade the database. Do not do this.");const t=r.result.createObjectStore(a.RESILIENCE_STORE_NAME,{keyPath:"id"});t.createIndex(a.TIME_TO_PROCESS_AFTER_INDEX,a.TIME_TO_PROCESS_AFTER_INDEX,{unique:!1}),t.createIndex(a.RETRY_INDEX,a.RETRY_INDEX,{unique:!1}),t.createIndex(a.TIME_ADDED_INDEX,a.TIME_ADDED_INDEX,{unique:!1}),t.createIndex(a.NAMESPACE_AND_TIME_ADDED_INDEX,["namespace","timeAdded"],{unique:!1})};try{return await Object(d.requestToPromise)(r),e(r.result)}catch(e){this.logger.warn("IndexedDB failed to initialise.",e),t(new u.NoIndexedDbError)}})),o()(this,"addItem",(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.GuardPolicy.ABANDON;const{logger:i,namespace:s}=t,o=Object(d.convertToItemWrapper)(e,s,r),{objectStore:c}=await t.getObjectStoreAndTransaction("readwrite");if(n===a.GuardPolicy.IGNORE)throw new u.InvalidPolicyError(n,"IndexedDbConnector#addItem");try{if(!o.namespace||0===o.namespace.length||"string"!=typeof o.namespace)throw new Error("Namespace not specified");const e=await t.globalEventLimitGuard.insertItems(c,[o],n);if(1===e.items.length)return{item:e.items[0],numberOfEvictedItems:e.numberOfEvictedItems};throw new Error("Incorrect number of items added. Expected: 1, got: "+e.items.length)}catch(e){if(Object(u.shouldIgnoreResilienceDbError)(e))throw e;throw i.log("Failed to add item to table",e),new Error("Request to add item to table failed")}})),o()(this,"bulkAddItem",(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.GuardPolicy.ABANDON;const{logger:n,namespace:s}=t,o=e.map(e=>{let{item:t}=e,r=i()(e,h);return Object(d.convertToItemWrapper)(t,s,r)}),{objectStore:c}=await t.getObjectStoreAndTransaction("readwrite");try{return await t.globalEventLimitGuard.insertItems(c,o,r)}catch(e){if(Object(u.shouldIgnoreResilienceDbError)(e))throw e;throw n.log("Failed to add item to table",e),new Error("Request to add item to table failed")}})),o()(this,"getItems",(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.GET_ITEM_COUNT;const r=e>0?e:c.GET_ITEM_COUNT,{logger:n}=t,i=t.options.maxAttempts,{transaction:s,objectStore:o}=await t.getObjectStoreAndTransaction("readwrite"),u=o.index(a.TIME_TO_PROCESS_AFTER_INDEX),l=IDBKeyRange.upperBound(Date.now()),h=u.openCursor(l),f=await new Promise(async(e,t)=>{const s=[];let o=0;h.onerror=e=>{n.error("Failed to open cursor:",e),t("Failed to open cursor")},h.onsuccess=t=>{const a=t.target.result;if(a){const t=p({},a.value);s.push(t);const u=a.value;if(u.retryAttempts+=1,u.timeToBeProcessedAfter=Date.now()+c.VISIBILITY_TIMEOUT,u.retryAttempts>=i){++o;const e=a.delete();Object(d.monitorErrorsOnRequest)(e,n)}else{const e=a.update(u);Object(d.monitorErrorsOnRequest)(e,n)}s.length<r?a.continue():e({items:s,numberOfDeletedItems:o})}else e({items:s,numberOfDeletedItems:o})}});return await Object(d.commitTransaction)(s,t.logger),f})),o()(this,"deleteItems",async e=>{const{transaction:t,objectStore:r}=await this.getObjectStoreAndTransaction("readwrite");try{const n=e.map(e=>this.deleteItem(r,e));await Object(d.commitTransaction)(t,this.logger),await Promise.all(n)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),o()(this,"getItemCount",async()=>{const{transaction:e,objectStore:t}=await this.getObjectStoreAndTransaction("readonly"),r=t.index(a.TIME_TO_PROCESS_AFTER_INDEX),n=IDBKeyRange.upperBound(Date.now()),i=r.count(n),s=await Object(d.requestToPromise)(i);return await Object(d.commitTransaction)(e,this.logger),s.target.result}),o()(this,"processItems",(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.GET_ITEM_COUNT;const n=await t.getItems(r),{items:s}=n,o=i()(n,f);try{const r=await e(s,o),n=s.map(e=>e.id);return await t.deleteItems(n),r}catch(e){throw new u.CallbackProcessingError(e)}})),o()(this,"deleteItem",async(e,t)=>{const{logger:r}=this;try{await Object(d.requestToPromise)(e.delete(t))}catch(e){throw r.error("Failed to delete item:",t,e),e}}),o()(this,"getObjectStoreAndTransaction",async e=>{const t=(await this.db).transaction(a.RESILIENCE_STORE_NAME,e),r=t.objectStore(a.RESILIENCE_STORE_NAME);return{transaction:t,objectStore:r}}),this.options=Object(d.createOptionsWithDefaults)(r),this.namespace=e,this.logger=this.options.logger,!window.indexedDB)throw new u.NoIndexedDbError;this.db=this.startDB(),this.db.catch(()=>{}),this.globalEventLimitGuard=new l.default(this.options.maxEventLimit,this.namespace,this.logger,this.deleteItem)}storeType(){return a.StoreType.INDEXEDDB}}},function(e,t,r){var n=r(42);e.exports=function(e,t){if(null==e)return{};var r,i,s=n(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(null==e)return{};var r,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(i[r]=e[r]);return i},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.r(t),r.d(t,"GET_ITEM_COUNT",(function(){return n})),r.d(t,"VISIBILITY_TIMEOUT",(function(){return i})),r.d(t,"MAX_ATTEMPTS",(function(){return s})),r.d(t,"EVENT_COUNT_LIMIT",(function(){return o}));const n=7,i=6e4,s=10,o=5e3},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var n=r(2),i=r.n(n),s=r(33),o=r(34),a=r(45);class c{constructor(e,t,r,n){if(i()(this,"deleteOldestNEvents",async(e,t)=>{var r;const n=e.index(s.NAMESPACE_AND_TIME_ADDED_INDEX),i=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),o=n.getAllKeys(i,t),c=await Object(a.requestToPromise)(o),u=null==c||null===(r=c.target)||void 0===r?void 0:r.result;if(u&&Array.isArray(u)&&u.length>0)try{const t=u.map(t=>this.deleteItemHandler(e,t));await Promise.all(t)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),!(e>0))throw Error("Event Limit has to be set higher than 1");this.eventLimit=e,this.namespace=t,this.logger=r,this.deleteItemHandler=n}async insertItems(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.GuardPolicy.ABANDON;const n=[...t];let i=0;switch(r){case s.GuardPolicy.ABANDON:await this.throwIfNotEnoughSpace(e,t.length);break;case s.GuardPolicy.EVICT:i=await this.evictIfNotEnoughSpace(e,t.length);break;case s.GuardPolicy.IGNORE:await this.calculateHowManyEventsWeCanAdd(e,n)}const o=n.map(t=>Object(a.requestToPromise)(e.add(t)));return await Promise.all(o),await Object(a.commitTransaction)(e.transaction,this.logger),{items:n,numberOfEvictedItems:i}}async throwIfNotEnoughSpace(e,t){const r=await this.calculateFreeSpace(e);if(r<t)throw new o.AbandonWriteError(`Not enough space in IndexedDb. Needed ${t} but only had ${r}`)}async evictIfNotEnoughSpace(e,t){const r=await this.calculateFreeSpace(e);if(r<t){const n=t-r;return await this.deleteOldestNEvents(e,n),n}return 0}async calculateHowManyEventsWeCanAdd(e,t){const r=await this.calculateFreeSpace(e);if(r<t.length){const e=t.length-r,n=t.length-e;t.splice(n,e)}}async calculateFreeSpace(e){const t=await this.getCountofEventsInObjectStore(e);return this.eventLimit-t}async getCountofEventsInObjectStore(e){const t=e.index(s.NAMESPACE_AND_TIME_ADDED_INDEX),r=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),n=t.count(r);return(await Object(a.requestToPromise)(n)).target.result}}},function(e,t,r){"use strict";r.r(t),r.d(t,"convertToItemWrapper",(function(){return o})),r.d(t,"createOptionsWithDefaults",(function(){return a})),r.d(t,"requestToPromise",(function(){return c})),r.d(t,"transactionToPromise",(function(){return u})),r.d(t,"commitTransaction",(function(){return l})),r.d(t,"monitorErrorsOnRequest",(function(){return d}));var n=r(3),i=r.n(n),s=r(43);const o=(e,t,r)=>{let{id:n,retryAttempts:s,timeToProcessOffset:o}=r;return{item:e,id:n||i()(),retryAttempts:s||0,timeToBeProcessedAfter:Date.now()+(o||0),namespace:t,timeAdded:Date.now()}},a=e=>({logger:e.logger||console,useMemory:e.useMemory||!1,maxAttempts:e.maxAttempts||s.MAX_ATTEMPTS,maxEventLimit:e.maxEventLimit||s.EVENT_COUNT_LIMIT}),c=e=>new Promise((t,r)=>{e.onsuccess=e=>{t(e)},e.onerror=e=>{r(e)}}),u=e=>new Promise((t,r)=>{e.oncomplete=()=>{t()},e.onerror=e=>{r(e)},e.onabort=e=>{r(e)}}),l=(e,t)=>{try{"function"==typeof e.commit&&e.commit()}catch(e){throw t.error("Failed to force commit transaction:",e),e}return u(e)},d=(e,t)=>{e.onerror=e=>{t.warn("Error thrown from request:",e)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return g}));var n=r(2),i=r.n(n),s=r(41),o=r.n(s),a=r(33),c=r(43),u=r(34),l=r(47),d=r(45);const h=["item"],f=["items"];function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class g{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.namespace=e,this.memoryStore=[],this.options=Object(d.createOptionsWithDefaults)(t),this.globalEventLimitGuard=new l.default(this.options.maxEventLimit,{addItems:this.addItems.bind(this),getItemCount:this.getItemCount.bind(this),evictEventsIfNeeded:this.evictEventsIfNeeded.bind(this)})}async addItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.GuardPolicy.ABANDON;if(r===a.GuardPolicy.IGNORE)throw new u.InvalidPolicyError(r,"IndexedDbConnector#addItem");const n=Object(d.convertToItemWrapper)(e,this.namespace,t),i=await this.globalEventLimitGuard.insertItemsToMemoryStore([n],r);return Promise.resolve({item:i.items[0],numberOfEvictedItems:i.numberOfEvictedItems})}bulkAddItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.GuardPolicy.ABANDON;const r=e.map(e=>{let{item:t}=e,r=o()(e,h);return Object(d.convertToItemWrapper)(t,this.namespace,r)});return this.bulkAddItemWrapperType(r,t)}bulkAddItemWrapperType(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.GuardPolicy.ABANDON;return Promise.resolve(this.globalEventLimitGuard.insertItemsToMemoryStore(e,t))}getItems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.GET_ITEM_COUNT;return Promise.resolve(this.synchronousGetItems(e))}synchronousGetItems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.GET_ITEM_COUNT;const t=e>0?e:c.GET_ITEM_COUNT,r=Date.now(),n=[],i=[];for(let e of this.memoryStore)if(e.timeToBeProcessedAfter<=r&&(n.push(p({},e)),e.timeToBeProcessedAfter+=c.VISIBILITY_TIMEOUT,e.retryAttempts+=1,e.retryAttempts>=this.options.maxAttempts&&i.push(e)),n.length>=t)break;return i.forEach(e=>{const t=this.memoryStore.indexOf(e);this.memoryStore.splice(t,1)}),{items:n,numberOfDeletedItems:i.length}}deleteItems(e){return this.memoryStore=this.memoryStore.filter(t=>!e.includes(t.id)),Promise.resolve(void 0)}getItemCount(){const e=Date.now(),t=this.memoryStore.filter(t=>t.timeToBeProcessedAfter<=e).length;return Promise.resolve(t)}async processItems(e,t){const r=this.synchronousGetItems(t),{items:n}=r,i=o()(r,f),s=n.map(e=>e.id);try{const t=await e(n,i);return await this.deleteItems(s),t}catch(e){throw new u.CallbackProcessingError(e)}}storeType(){return a.StoreType.MEMORY}addItems(e){this.memoryStore.push(...e),this.memoryStore.sort((function(e,t){return e.timeAdded-t.timeAdded}))}evictEventsIfNeeded(e){const t=this.memoryStore.length;if(t>e){const r=t-e;return this.memoryStore.splice(0,r),r}return 0}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));var n=r(2),i=r.n(n),s=r(33),o=r(34);class a{constructor(e,t){if(i()(this,"insertItemsToMemoryStore",(e,t)=>{switch(t){case s.GuardPolicy.ABANDON:return this.handleAbandonIfLimitWillExceedPolicy(e);case s.GuardPolicy.EVICT:return Promise.resolve(this.handleEvictOldestIfLimitExceededPolicy(e));case s.GuardPolicy.IGNORE:return this.handleAddAsManyAsPossible(e)}}),!(e>0))throw Error("Event Limit has to be set higher than 1");this.eventLimit=e,this.memoryItemHandlers=t}async handleAbandonIfLimitWillExceedPolicy(e){if(await this.memoryItemHandlers.getItemCount()+e.length>this.eventLimit)throw new o.AbandonWriteError(s.StoreType.MEMORY);return this.memoryItemHandlers.addItems(e),{items:e,numberOfEvictedItems:0}}handleEvictOldestIfLimitExceededPolicy(e){this.memoryItemHandlers.addItems(e);return{items:e,numberOfEvictedItems:this.memoryItemHandlers.evictEventsIfNeeded(this.eventLimit)}}async handleAddAsManyAsPossible(e){const t=this.eventLimit-await this.memoryItemHandlers.getItemCount(),r=t>e.length?e:e.slice(0,t);return this.memoryItemHandlers.addItems(r),{items:r,numberOfEvictedItems:0}}}},function(e,t,r){"use strict";r.r(t),r.d(t,"MetricsCollector",(function(){return o}));var n=r(2),i=r.n(n),s=r(49);class o{constructor(){i()(this,"itemsDiscardedByRetry",0),i()(this,"eventCount",0),i()(this,"itemsDiscardedByOverflow",0),i()(this,"resilienceMechanism",s.ResilienceMechanism.INDEXEDDB),i()(this,"localstorageNumberOfQueuesPurged",0),i()(this,"localstorageNumberOfFullReclaims",0),i()(this,"localstorageNumberOfPartialReclaims",0),i()(this,"localstorageNumberOfFailedReclaims",0)}addToItemsDiscardedByRetryCounter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.itemsDiscardedByRetry+=e}addToEventCount(){this.eventCount++}addToItemsDiscardedByOverflowCounter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.itemsDiscardedByOverflow+=e}setResilienceMechanism(e){this.resilienceMechanism=e}addToReclaimMetrics(e){this.localstorageNumberOfFullReclaims+=e.fullReclaims,this.localstorageNumberOfPartialReclaims+=e.partialReclaims,this.localstorageNumberOfFailedReclaims+=e.failedReclaims}addToPurgedQueuesMetrics(e){this.localstorageNumberOfQueuesPurged+=e}subtractFromMetrics(e){this.itemsDiscardedByRetry=this.subtractFromCount(this.itemsDiscardedByRetry,e.itemsDiscardedByRetry),this.eventCount=this.subtractFromCount(this.eventCount,e.eventCount),this.itemsDiscardedByOverflow=this.subtractFromCount(this.itemsDiscardedByOverflow,e.itemsDiscardedByOverflow),this.localstorageNumberOfFullReclaims=this.subtractFromCount(this.localstorageNumberOfFullReclaims,e.fullReclaims),this.localstorageNumberOfPartialReclaims=this.subtractFromCount(this.localstorageNumberOfPartialReclaims,e.partialReclaims),this.localstorageNumberOfFailedReclaims=this.subtractFromCount(this.localstorageNumberOfFailedReclaims,e.failedReclaims),this.localstorageNumberOfQueuesPurged=this.subtractFromCount(this.localstorageNumberOfQueuesPurged,e.localstorageQueuesPurged)}subtractFromCount(e,t){return Math.max(e-(t||0),0)}getMetricsPayload(){return{itemsDiscardedByRetry:this.itemsDiscardedByRetry,eventCount:this.eventCount,itemsDiscardedByOverflow:this.itemsDiscardedByOverflow,resilienceMechanism:this.resilienceMechanism,localstorageQueuesPurged:this.localstorageNumberOfQueuesPurged,fullReclaims:this.localstorageNumberOfFullReclaims,partialReclaims:this.localstorageNumberOfPartialReclaims,failedReclaims:this.localstorageNumberOfFailedReclaims}}}let a=null;t.default=()=>(a||(a=new o),a)},function(e,t,r){"use strict";let n,i;r.r(t),r.d(t,"ResilienceMechanism",(function(){return n})),r.d(t,"NetworkStatusEnum",(function(){return i})),function(e){e.INDEXEDDB="indexeddb",e.MEMORY="memory"}(n||(n={})),function(e){e[e.ONLINE=0]="ONLINE",e[e.OFFLINE=1]="OFFLINE"}(i||(i={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var n=r(49);class i{constructor(e){window.addEventListener("offline",()=>e(n.NetworkStatusEnum.OFFLINE)),window.addEventListener("online",()=>e(n.NetworkStatusEnum.ONLINE))}getNetworkStatus(){return window.navigator.onLine?n.NetworkStatusEnum.ONLINE:n.NetworkStatusEnum.OFFLINE}}},function(e,t,r){"use strict";r.r(t);var n=r(52);r.d(t,"default",(function(){return n.default}));var i=r(54);r.d(t,"DoneState",(function(){return i.DoneState}))},function(e,t,r){"use strict";r.r(t),r.d(t,"QueuedScheduleTypes",(function(){return f})),r.d(t,"default",(function(){return m}));var n=r(2),i=r.n(n),s=r(53),o=r(54);const a=1e3,c=3e4,u=2,l=0,d=500,h=5e3;let f;!function(e){e[e.NONE=0]="NONE",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.WAIT=2]="WAIT"}(f||(f={}));class m{constructor(e,t){var r=this;i()(this,"schedule",(function(){let{immediate:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{immediate:!1};r.operationInFlight?e?r.queuedSchedule=f.IMMEDIATE:r.queuedSchedule!==f.IMMEDIATE&&(r.queuedSchedule=f.WAIT):(e||r.options.waitInterval<=0)&&0===r.failureCount?(r.clearTimeout(),r.run()):r.failureCount>0&&null===r.scheduledTimeout?r.scheduledTimeout=window.setTimeout(r.run,r.calculateBackoff()):null===r.scheduledTimeout&&(r.scheduledTimeout=window.setTimeout(r.run,r.options.waitInterval))})),i()(this,"stop",()=>{this.clearTimeout(),this.queuedSchedule=f.NONE}),i()(this,"getFailureCount",()=>this.failureCount),i()(this,"getCallbackStatus",()=>this.callbackTimer.getCallbackStatus()),i()(this,"clearTimeout",()=>{null!==this.scheduledTimeout&&(window.clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null)}),i()(this,"run",()=>{this.operationInFlight=!0,this.clearTimeout();try{this.callbackTimer.executeCallbackWithTimeout(this.callback,this.done,()=>this.done(o.DoneState.ERROR))}catch(e){this.done(e)}}),i()(this,"done",e=>{this.operationInFlight=!1,e===o.DoneState.ERROR||this.callbackTimer.getCallbackStatus()===s.CallbackStatus.TIMED_OUT?(this.failureCount++,this.clearTimeout()):e===o.DoneState.SUCCESS&&(this.failureCount=0),this.processQueuedSchedule()}),i()(this,"processQueuedSchedule",()=>{if(this.queuedSchedule!==f.NONE){const e=this.queuedSchedule===f.IMMEDIATE;this.queuedSchedule=f.NONE,this.schedule({immediate:e})}else this.failureCount>0&&this.schedule()}),i()(this,"calculateBackoff",()=>{const{minRetryDelay:e,maxRetryDelay:t,backoffFactor:r,backoffJitterPercentage:n}=this.options;let i=e*r**this.failureCount;if(n){const e=Math.random(),t=Math.floor(e*n*i);Math.floor(10*e)<5?i-=t:i+=t}return Number(Math.min(i,t).toPrecision(1))}),this.options={minRetryDelay:e.minRetryDelay||a,maxRetryDelay:e.maxRetryDelay||c,backoffFactor:e.backoffFactor||u,backoffJitterPercentage:e.backoffJitterPercentage||l,waitInterval:void 0!==e.waitInterval?e.waitInterval:d,callbackTimeoutPeriod:e.callbackTimeoutPeriod||h},this.scheduledTimeout=null,this.failureCount=0,this.callback=t,this.operationInFlight=!1,this.queuedSchedule=f.NONE,this.callbackTimer=new s.CallbackWithTimeout(this.options.callbackTimeoutPeriod)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"CallbackStatus",(function(){return s})),r.d(t,"CallbackEvent",(function(){return o})),r.d(t,"CallbackWithTimeout",(function(){return a}));var n=r(2),i=r.n(n);let s,o;!function(e){e.IDLE="idle",e.RUNNING="running",e.COMPLETED="completed",e.TIMED_OUT="timedOut"}(s||(s={})),function(e){e.EXECUTE="execute",e.COMPLETE="complete",e.TIMEOUT="timeout"}(o||(o={}));class a{constructor(e){if(i()(this,"timeoutHandle",void 0),i()(this,"callbackStatus",s.IDLE),!(e>0))throw new Error("CallbackWithTimeout requires timeout period higher than 0");this.timeoutPeriod=e}transitionCallbackStatus(e,t){switch(e){case s.IDLE:case s.TIMED_OUT:case s.COMPLETED:t===o.EXECUTE&&(this.callbackStatus=s.RUNNING);break;case s.RUNNING:switch(t){case o.COMPLETE:this.callbackStatus=s.COMPLETED;break;case o.TIMEOUT:this.callbackStatus=s.TIMED_OUT}break;default:this.callbackStatus=e}}executeCallbackWithTimeout(e,t,r){this.transitionCallbackStatus(this.callbackStatus,o.EXECUTE),this.timeoutHandle=window.setTimeout(()=>{this.transitionCallbackStatus(this.callbackStatus,o.TIMEOUT),r()},this.timeoutPeriod),e(e=>{this.cancelTimeout(),this.getCallbackStatus()!==s.TIMED_OUT&&(this.transitionCallbackStatus(this.callbackStatus,o.COMPLETE),t(e))})}getCallbackStatus(){return this.callbackStatus}cancelTimeout(){this.timeoutPeriod>0&&this.timeoutHandle&&(window.clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0)}}},function(e,t,r){"use strict";let n;r.r(t),r.d(t,"DoneState",(function(){return n})),function(e){e[e.NOOP=0]="NOOP",e[e.SUCCESS=1]="SUCCESS",e[e.ERROR=2]="ERROR"}(n||(n={}))},function(e,t,r){"use strict";r.r(t);var n=r(56);r.d(t,"createUnknownXid",(function(){return n.createUnknownXid}));var i=r(57);r.d(t,"XIDItemType",(function(){return i.XIDItemType})),r.d(t,"XIDState",(function(){return i.XIDState}));var s=r(58);r.d(t,"XIDPromise",(function(){return s.XIDPromise}));var o=r(59);r.d(t,"attachXidToSingleEvent",(function(){return o.attachXidToSingleEvent})),r.d(t,"attachXidToMultipleEvents",(function(){return o.attachXidToMultipleEvents}))},function(e,t,r){"use strict";r.r(t),r.d(t,"XID_TIMEOUT",(function(){return i})),r.d(t,"createTimeoutXid",(function(){return s})),r.d(t,"createUnknownXid",(function(){return o}));var n=r(57);const i=5e3,s=()=>[{type:n.XIDItemType.XC,state:"TIMEOUT"},{type:n.XIDItemType.UID,state:"TIMEOUT"}],o=()=>[{type:n.XIDItemType.XC,state:"UNKNOWN"},{type:n.XIDItemType.UID,state:"UNKNOWN"}]},function(e,t,r){"use strict";let n,i;r.r(t),r.d(t,"XIDItemType",(function(){return n})),r.d(t,"XIDState",(function(){return i})),function(e){e.XC="xc",e.UID="uid"}(n||(n={})),function(e){e.NEW="NEW",e.CHANGED="CHANGED",e.EXISTING="EXISTING",e.TIMEOUT="TIMEOUT",e.ERROR="ERROR",e.UNAVAILABLE="UNAVAILABLE",e.MALFORMED="MALFORMED",e.UNKNOWN="UNKNOWN"}(i||(i={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"XIDPromise",(function(){return i}));var n=r(56);const i=(e,t)=>{if(e&&t&&"function"==typeof t){const e=()=>new Promise(e=>{setTimeout(()=>e(()=>Object(n.createTimeoutXid)()),n.XID_TIMEOUT)}),r=()=>t().catch(()=>()=>Object(n.createUnknownXid)());return Promise.race([r(),e()])}}},function(e,t,r){"use strict";r.r(t),r.d(t,"attachXidToSingleEvent",(function(){return c})),r.d(t,"attachXidToMultipleEvents",(function(){return u}));var n=r(2),i=r.n(n),s=r(60);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t){if(!(t&&t instanceof Function))return e;if(e.msg.type===s.SegmentEventTypes.PAGE||e.msg.type===s.SegmentEventTypes.TRACK){const r=t();r&&Array.isArray(r)&&(e.msg.properties=a(a({},e.msg.properties),{},{xid:r}))}else if(e.msg.traits&&e.msg.type===s.SegmentEventTypes.IDENTIFY){const r=t();r&&Array.isArray(r)&&(e.msg.traits=a(a({},e.msg.traits),{},{xid:r}))}return e}async function u(e,t){try{const r=await t;return e.map(e=>c(e,r))}catch(t){return e}}},function(e,t,r){"use strict";let n,i,s;r.r(t),r.d(t,"SegmentEventTypes",(function(){return n})),r.d(t,"CrossDomainIdentifierType",(function(){return i})),r.d(t,"CrossDomainIdentifierState",(function(){return s})),function(e){e.IDENTIFY="identify",e.PAGE="page",e.TRACK="track"}(n||(n={})),function(e){e.XC="xc",e.UID="uid"}(i||(i={})),function(e){e.NEW="NEW",e.CHANGED="CHANGED",e.EXISTING="EXISTING",e.TIMEOUT="TIMEOUT",e.ERROR="ERROR",e.UNAVAILABLE="UNAVAILABLE",e.MALFORMED="MALFORMED",e.UNKNOWN="UNKNOWN"}(s||(s={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"DEFAULT_REQUEST_TIMEOUT",(function(){return n}));const n=1e4},function(e,t,r){"use strict";r.r(t),r.d(t,"sendEvents",(function(){return a}));var n=r(2),i=r.n(n),s=r(63);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}const a=async e=>{var t;const r=null===(t=c(e))||void 0===t?void 0:t.signal,n=u(e.url),s=await fetch(e.url,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(e.batch),signal:r},n));if(429===s.status||s.status>=500&&s.status<600)throw new Error(`HTTP Error ${s.status} (${s.statusText})`);return s},c=e=>{if(e.abortController)return e.abortController;if(e.timeout){const t=new AbortController;return setTimeout(()=>{t.abort()},e.timeout),t}},u=Object(s.default)(e=>new URL(e).origin===location.origin?{}:{mode:"cors",credentials:"include"})},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var n=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function i(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(i=e[r],s=t[r],!(i===s||n(i)&&n(s)))return!1;var i,s;return!0}function s(e,t){void 0===t&&(t=i);var r=null;function n(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(r&&r.lastThis===this&&t(n,r.lastArgs))return r.lastResult;var s=e.apply(this,n);return r={lastResult:s,lastArgs:n,lastThis:this},s}return n.clear=function(){r=null},n}},function(e,t,r){"use strict";r.r(t),r.d(t,"ANONYMOUS_ID_KEY",(function(){return c})),r.d(t,"default",(function(){return u}));var n=r(65),i=r(3),s=r.n(i),o=r(71),a=r(76);const c="ajs_anonymous_id";class u{constructor(){this.store=new a.default({useStoragePrefix:!1}),this.cookie=new o.default}getUserId(){return this.userId||null}setUserId(e){this.userId=e}getAnonymousId(){const e=this.store.getItem(c);if(e){const t=JSON.parse(e);return(!this.lastAnonymousIdCookieUpdate||Object(n.default)(new Date,new Date(this.lastAnonymousIdCookieUpdate))>=7)&&this.setAnonymousId(t),t}{const e=this.cookie.get(c);if(e){const t=JSON.parse(e);return this.store.setItem(c,e),t}}const t=s()();return this.setAnonymousId(t),t}setAnonymousId(e){return this.cookie.set(c,JSON.stringify(e)),this.lastAnonymousIdCookieUpdate=Date.now(),this.store.setItem(c,JSON.stringify(e))}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));var n=r(66),i=r(68),s=r(67);function o(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function a(e,t){Object(s.default)(2,arguments);var r=Object(n.default)(e),a=Object(n.default)(t),c=o(r,a),u=Math.abs(Object(i.default)(r,a));r.setDate(r.getDate()-c*u);var l=Number(o(r,a)===-c),d=c*(u-l);return 0===d?0:d}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var n=r(67);function i(e){Object(n.default)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}},function(e,t,r){"use strict";function n(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}r.r(t),r.d(t,"default",(function(){return n}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o}));var n=r(69),i=r(70),s=r(67);function o(e,t){Object(s.default)(2,arguments);var r=Object(i.default)(e),o=Object(i.default)(t),a=r.getTime()-Object(n.default)(r),c=o.getTime()-Object(n.default)(o);return Math.round((a-c)/864e5)}},function(e,t,r){"use strict";function n(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}r.r(t),r.d(t,"default",(function(){return n}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var n=r(66),i=r(67);function s(e){Object(i.default)(1,arguments);var t=Object(n.default)(e);return t.setHours(0,0,0,0),t}},function(e,t,r){"use strict";r.r(t);var n=r(72);r.d(t,"default",(function(){return n.default}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return h}));var n=r(2),i=r.n(n),s=r(73),o=r.n(s),a=r(74),c=r(75),u=r(79);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class h{constructor(){this.cookieLike=Object(u.canUseCookie)()?o.a:new c.default}set(e,t,r){return this.cookieLike.set(e,t,d(d({},a.COOKIE_OPTIONS),{},{domain:Object(u.getTld)()},r))}get(e){return this.cookieLike.get(e)}remove(e,t){this.cookieLike.remove(e,d({},t))}}},function(e,t,r){var n,i;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(s){if(void 0===(i="function"==typeof(n=s)?n.call(t,r,t,e):n)||(e.exports=i),!0,e.exports=s(),!!0){var o=window.Cookies,a=window.Cookies=s();a.noConflict=function(){return window.Cookies=o,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function i(){}function s(t,r,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},i.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var o=JSON.stringify(r);/^[\{\[]/.test(o)&&(r=o)}catch(e){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in s)s[c]&&(a+="; "+c,!0!==s[c]&&(a+="="+s[c].split(";")[0]));return document.cookie=t+"="+r+a}}function o(e,r){if("undefined"!=typeof document){for(var i={},s=document.cookie?document.cookie.split("; "):[],o=0;o<s.length;o++){var a=s[o].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(a[0]);if(c=(n.read||n)(c,u)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(i[u]=c,e===u)break}catch(e){}}return e?i[e]:i}}return i.set=s,i.get=function(e){return o(e,!1)},i.getJSON=function(e){return o(e,!0)},i.remove=function(t,r){s(t,"",e(r,{expires:-1}))},i.defaults={},i.withConverter=r,i}((function(){}))}))},function(e,t,r){"use strict";r.r(t),r.d(t,"COOKIE_OPTIONS",(function(){return n}));const n={expires:365,secure:"https:"===window.location.protocol,path:"/"}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var n=r(76);class i{constructor(){this.safeStorage=new n.default({useStoragePrefix:!1})}set(e,t){return this.safeStorage.setItem(e,t),t}get(e){return this.safeStorage.getItem(e)||void 0}remove(e){this.safeStorage.removeItem(e)}}},function(e,t,r){"use strict";r.r(t);var n=r(77),i=r(78);t.default=class extends i.default{constructor(e){let t;try{t=window.localStorage||n.default}catch(e){t=n.default}super(t,e)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"InMemoryStore",(function(){return s}));var n=r(2),i=r.n(n);class s{constructor(){i()(this,"_data",{}),i()(this,"length",0),i()(this,"setItem",(e,t)=>(this._data[e]=t,this.length=Object.keys(this._data).length,t)),i()(this,"getItem",e=>e in this._data?this._data[e]:null),i()(this,"removeItem",e=>(e in this._data&&delete this._data[e],this.length=Object.keys(this._data).length,null)),i()(this,"clear",()=>{this._data={},this.length=0}),i()(this,"key",e=>Object.keys(this._data)[e])}}t.default=new s},function(e,t,r){"use strict";r.r(t),r.d(t,"AWC_STORAGE_PREFIX",(function(){return a})),r.d(t,"GLOBAL_IN_MEMORY_NAME",(function(){return c})),r.d(t,"isSupported",(function(){return u})),r.d(t,"isQuotaExceeded",(function(){return l})),r.d(t,"default",(function(){return d}));var n=r(2),i=r.n(n),s=r(6),o=r(77);const a="awc",c="awcInMemoryStorageFallback";function u(e){if(!e)return!1;try{const t="awc.storage.support";e.setItem(t,"test_value");const r=e.getItem(t);return e.removeItem(t),"test_value"===r}catch(e){return!1}}function l(e){let t=!1;if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}class d{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,"getStore",()=>this._store),i()(this,"getItem",e=>this._store.getItem(this.createKey(e))),i()(this,"removeItem",e=>this._store.removeItem(this.createKey(e))),i()(this,"setItem",(e,t)=>{try{this._store.setItem(this.createKey(e),t)}catch(r){l(r)&&(this.swapToInMemory(),this._store.setItem(this.createKey(e),t))}}),i()(this,"swapToInMemory",()=>{if(this._store===o.default)return;const e=Object.keys(this._store||{});let t;u(window[c])?t=window[c]:(t=o.default,window[c]||(window[c]=o.default)),e.forEach(e=>{if(0===e.indexOf(this.getPrefix())){const r=this._store.getItem(e);r&&t.setItem(e,r)}}),this._store=t}),i()(this,"clear",()=>this._store.clear()),i()(this,"key",e=>this._store.key(e)),i()(this,"getPrefix",()=>this._prefix),i()(this,"createKey",e=>this._prefix?`${this.getPrefix()}.${e}`:e),this.options=t;const r=[];(void 0===t.useStoragePrefix||t.useStoragePrefix)&&r.push(a),t.envPrefix&&t.envPrefix!==s.envType.PROD&&r.push(t.envPrefix),this._prefix=r.join("-"),u(e)?this._store=e:this.swapToInMemory()}}},function(e,t,r){"use strict";r.r(t),r.d(t,"canUseCookie",(function(){return o})),r.d(t,"COOKIE_NAME",(function(){return a})),r.d(t,"COOKIE_VALUE",(function(){return c})),r.d(t,"getTld",(function(){return u}));var n=r(73),i=r.n(n),s=r(63);const o=()=>!("file:"===location.protocol||"chrome-extension:"===location.protocol),a="__awc_tld_test__",c="tld_test",u=Object(s.default)(()=>{const{hostname:e}=location,t=e.split(".");for(let e=1;e<=t.length;e++){const r="."+t.slice(-1*e).join(".");if(i.a.set(a,c,{domain:r}),i.a.get(a)===c)return i.a.remove(a,{domain:r}),r}return e})},function(e,t,r){"use strict";r.r(t),r.d(t,"buildContext",(function(){return u})),r.d(t,"prepareEventProperties",(function(){return l})),r.d(t,"nestedRemoveUndefinedValues",(function(){return d}));var n=r(2),i=r.n(n),s=r(81),o=r.n(s);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const u=e=>c(c({},e.context),{},{userAgent:navigator.userAgent}),l=e=>{const t=d(e);return o()(t)},d=e=>{const t={};return Object.keys(e).forEach(r=>{const n=h(e,r);void 0!==n&&(Array.isArray(n)?t[r]=n.map(e=>e):t[r]="object"==typeof n&&null!==n?d(n):n)}),t},h=(e,t)=>e[t]},function(e,t,r){"use strict";var n=r(82);function i(e,t){return void 0===t&&(t=!0),e&&"object"==typeof e?function(e,t){return Object.keys(e).forEach((function(r){e[r]=i(e[r],t)})),e}(e,t):Array.isArray(e)?function(e,t){return e.forEach((function(r,n){e[n]=i(r,t)})),e}(e,t):n.is(e,t)?n.parse(e):e}e.exports=i},function(e,t,r){"use strict";var n=/^(\d{4})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:([ T])(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;t.parse=function(e){var t=[1,5,6,7,11,12],r=n.exec(e),i=0;if(!r)return new Date(e);for(var s,o=0;s=t[o];o++)r[s]=parseInt(r[s],10)||0;r[2]=parseInt(r[2],10)||1,r[3]=parseInt(r[3],10)||1,r[2]--,r[8]=r[8]?(r[8]+"00").substring(0,3):0," "===r[4]?i=(new Date).getTimezoneOffset():"Z"!==r[9]&&r[10]&&(i=60*r[11]+r[12],"+"===r[10]&&(i=0-i));var a=Date.UTC(r[1],r[2],r[3],r[5],r[6]+i,r[7],r[8]);return new Date(a)},t.is=function(e,t){return"string"==typeof e&&((!t||!1!==/^\d{4}-\d{2}-\d{2}/.test(e))&&n.test(e))}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));var n=r(2),i=r.n(n),s=r(6),o=r(84);class a{constructor(){i()(this,"handleOriginParameters",(e,t)=>{const r=Object.keys(e);if(!(r.length>0))throw new Error("Empty parameter mapping provided");const n=r.filter(e=>Object.values(s.originTracingType).indexOf(e)<0);if(n.length>0)throw new Error(`Invalid Origin Tracing Parameter(s) supplied: ${n.join()}!`);const i=Object(o.default)((e,t)=>r.indexOf(t)>=0,t);return Object.keys(i).map(t=>({[t]:e[t](i[t])})).reduce((e,t)=>Object.assign(e,t),{})}),this._originStore={}}}},function(e,t,r){"use strict";r.r(t),r.d(t,"defaultHistoryReplaceFn",(function(){return s}));var n=r(85),i=r(16);const s=e=>window.history.replaceState({},"",e);t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;const r=window.location.href,o=window.location.hash,a=""!==o?r.replace(o,""):r,{url:c,query:u}=Object(n.parseUrl)(a),l=Object(i.pickBy)(u,e);if(Object.keys(l).length>0){const r=Object(i.omitBy)(u,e);if(Object.keys(r).length>0){t(`${c}?${Object(n.stringify)(r)}${o}`)}else t(`${c}${o}`)}return l}},function(e,t,r){"use strict";const n=r(86),i=r(87),s=r(88),o=r(89);function a(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function c(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function u(e,t){return t.decode?i(e):e}function l(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=l(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function h(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function f(e,t){a((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const i="string"==typeof r&&r.includes(e.arrayFormatSeparator),s="string"==typeof r&&!i&&u(r,e).includes(e.arrayFormatSeparator);r=s?u(r,e):r;const o=i||s?r.split(e.arrayFormatSeparator).map(t=>u(t,e)):null===r?r:u(r,e);n[t]=o};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const i of e.split("&")){if(""===i)continue;let[e,o]=s(t.decode?i.replace(/\+/g," "):i,"=");o=void 0===o?null:["comma","separator"].includes(t.arrayFormat)?o:u(o,t),r(u(e,t),o,n)}for(const e of Object.keys(n)){const r=n[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=h(r[e],t);else n[e]=h(r,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce((e,t)=>{const r=n[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(r):e[t]=r,e},Object.create(null))}t.extract=d,t.parse=f,t.stringify=(e,t)=>{if(!e)return"";a((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],n=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const i=r.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[c(t,e),"[",i,"]"].join("")]:[...r,[c(t,e),"[",c(i,e),"]=",c(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[c(t,e),"[]"].join("")]:[...r,[c(t,e),"[]=",c(n,e)].join("")];case"comma":case"separator":return t=>(r,n)=>null==n||0===n.length?r:0===r.length?[[c(t,e),"=",c(n,e)].join("")]:[[r,c(n,e)].join(e.arrayFormatSeparator)];default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,c(t,e)]:[...r,[c(t,e),"=",c(n,e)].join("")]}}(t),i={};for(const t of Object.keys(e))r(t)||(i[t]=e[t]);const s=Object.keys(i);return!1!==t.sort&&s.sort(t.sort),s.map(r=>{const i=e[r];return void 0===i?"":null===i?c(r,t):Array.isArray(i)?i.reduce(n(r),[]).join("&"):c(r,t)+"="+c(i,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,n]=s(e,"#");return Object.assign({url:r.split("?")[0]||"",query:f(d(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:u(n,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0},r);const n=l(e.url).split("?")[0]||"",i=t.extract(e.url),s=t.parse(i,{sort:!1}),o=Object.assign(s,e.query);let a=t.stringify(o,r);a&&(a="?"+a);let u=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(u="#"+c(e.fragmentIdentifier,r)),`${n}${a}${u}`},t.pick=(e,r,n)=>{n=Object.assign({parseFragmentIdentifier:!0},n);const{url:i,query:s,fragmentIdentifier:a}=t.parseUrl(e,n);return t.stringifyUrl({url:i,query:o(s,r),fragmentIdentifier:a},n)},t.exclude=(e,r,n)=>{const i=Array.isArray(r)?e=>!r.includes(e):(e,t)=>!r(e,t);return t.pick(e,i,n)}},function(e,t,r){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())},function(e,t,r){"use strict";var n=new RegExp("%[a-f0-9]{2}","gi"),i=new RegExp("(%[a-f0-9]{2})+","gi");function s(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],s(r),s(n))}function o(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(n),r=1;r<t.length;r++)t=(e=s(t,r).join("")).match(n);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=i.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=o(r[0]);n!==r[0]&&(t[r[0]]=n)}r=i.exec(e)}t["%C2"]="�";for(var s=Object.keys(t),a=0;a<s.length;a++){var c=s[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},function(e,t,r){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}},function(e,t,r){"use strict";e.exports=function(e,t){for(var r={},n=Object.keys(e),i=Array.isArray(t),s=0;s<n.length;s++){var o=n[s],a=e[o];(i?-1!==t.indexOf(o):t(o,a,e))&&(r[o]=a)}return r}},function(e,t,r){"use strict";r.r(t),r.d(t,"DEFAULT_SESSION_EXPIRY_TIME_MS",(function(){return a})),r.d(t,"DEFAULT_EXPIRY_DEBOUNCE",(function(){return c})),r.d(t,"DEFAULT_DEBOUNCE_THRESHOLD_PERCENTAGE",(function(){return u})),r.d(t,"default",(function(){return l}));var n=r(2),i=r.n(n),s=r(76);const o=/^\d+$/,a=18e5,c=5e3,u=.9;class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,"_generateNewSessionId",()=>{const e=Date.now().toString();return this._safeLocalStorage.setItem("session.id",e),e}),i()(this,"_updateSessionExpiry",()=>{const e=Date.now()+this._sessionExpiryTime;return this._safeLocalStorage.setItem("session.expiry",e.toString()),e}),i()(this,"_debouncedUpdateSessionExpiry",e=>{const{_updateSessionExpiry:t}=this;if(e<Date.now()+this._sessionExpiryDebounceThresholdPercentage*this._sessionExpiryTime)return t();this._sessionExpiryDebounceTimer&&clearTimeout(this._sessionExpiryDebounceTimer),this._sessionExpiryDebounceTimer=setTimeout(()=>{t()},this._sessionExpiryDebounce)}),this._sessionExpiryTime=e.sessionExpiryTime||a,this._sessionExpiryDebounce=e.sessionExpiryDebounce||c,this._sessionExpiryDebounceThresholdPercentage=e.sessionExpiryDebounceThresholdPercentage||u,this._safeLocalStorage=new s.default}getCurrentSessionId(){const e=this._safeLocalStorage.getItem("session.id"),t=parseInt(this._safeLocalStorage.getItem("session.expiry")||"0",10)||0;return this._debouncedUpdateSessionExpiry(t),!e||t<=Date.now()||Number.isNaN(t)?this._generateNewSessionId():o.test(e)?e:this._generateNewSessionId()}}},function(e,t,r){"use strict";r.r(t);var n=r(77),i=r(78);t.default=class extends i.default{constructor(e){let t;try{t=window.sessionStorage||n.default}catch(e){t=n.default}super(t,e)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var n=r(2),i=r.n(n),s=r(3),o=r.n(s),a=r(91);class c{constructor(){i()(this,"_generateNewTabId",()=>{const e=o()();return this._safeSessionStorage.setItem("tab.id",e),e}),this._safeSessionStorage=new a.default}getCurrentTabId(){let e=this._safeSessionStorage.getItem("tab.id");return e||(e=this._generateNewTabId()),e}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return p}));var n=r(2),i=r.n(n),s=r(85),o=r(3),a=r.n(o),c=r(6),u=r(16),l=r(91),d=r(84);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const m="taskSessionsInit";class p{constructor(){i()(this,"_taskSessionsNotRecentlyInitialised",e=>null===this._safeSessionStorage.getItem("taskSessions")||null===this._safeSessionStorage.getItem(m)||parseInt(this._safeSessionStorage.getItem(m)||"0",10)<e-3e3),i()(this,"_removeTaskSessionPrefix",(e,t)=>t.split("awc.")[1]),i()(this,"_isTaskSessionQueryParam",(e,t)=>t.startsWith("awc.")),i()(this,"getAllTaskSessions",()=>{try{return JSON.parse(this._safeSessionStorage.getItem("taskSessions")||"")}catch(e){return{}}}),i()(this,"_writeToSessionStorage",e=>{try{this._safeSessionStorage.setItem("taskSessions",JSON.stringify(e))}catch(e){}}),i()(this,"_appendTaskSessions",e=>{const t=this.getAllTaskSessions(),r=null===t?e:Object.assign(t,e);this._writeToSessionStorage(r)}),i()(this,"_safelyRemoveKey",(e,t)=>null===e?{}:(delete e[t],e)),i()(this,"createTaskSession",e=>{const t=a()(),r={};return r[e]=t,this._appendTaskSessions(r),t}),i()(this,"createTaskSessionWithProvidedId",(e,t)=>{if("string"!=typeof t)throw new TypeError("invalid taskSessionId, must be string");const r={};r[e]=t,this._appendTaskSessions(r)}),i()(this,"completeTaskSession",e=>{const t=this.getAllTaskSessions(),r=this._safelyRemoveKey(t,e);this._writeToSessionStorage(r)}),i()(this,"formatTaskSessionQueryString",e=>{let{uri:t,includedTaskSessions:r}=e;const{url:n,query:i}=Object(s.parseUrl)(t),o=this.getAllTaskSessions(),a=r?Object(u.pick)(o,r):Object(u.omit)(o,Object.values(c.originTracingType));if(0===Object.keys(a).length)return t;const l=f(f({},Object(u.mapKeys)(a,(e,t)=>"awc."+t)),i);return`${n}?${Object(s.stringify)(l)}`}),i()(this,"stripQueryParameters",()=>{const e=Object(u.mapKeys)(Object(d.default)(this._isTaskSessionQueryParam),this._removeTaskSessionPrefix);this._appendTaskSessions(e)});const e=Date.now();this._safeSessionStorage=new l.default;try{this._taskSessionsNotRecentlyInitialised(e)&&(this._writeToSessionStorage({}),this._safeSessionStorage.setItem(m,e.toString()))}catch(e){}}}},function(e,t,r){"use strict";r.r(t);var n=r(2),i=r.n(n),s=r(73),o=r.n(s);t.default=class{constructor(){i()(this,"_bind",()=>{window.testAnalytics||(window.testAnalytics={eventCache:[],events:()=>window.testAnalytics.eventCache,clear:()=>{window.testAnalytics.eventCache=[];try{localStorage.removeItem("awc.ui.viewed.last.sent"),localStorage.removeItem("awc-staging.ui.viewed.last.sent"),localStorage.removeItem("awc-dev.ui.viewed.last.sent"),localStorage.removeItem("awc-local.ui.viewed.last.sent")}catch(e){}}})}),i()(this,"_cache",e=>{window.testAnalytics.eventCache.length>=100&&(window.testAnalytics.eventCache=window.testAnalytics.eventCache.slice(1,window.testAnalytics.eventCache.length)),window.testAnalytics.eventCache.push(e)}),i()(this,"_shouldCacheEvent",()=>this._isDebugCookieEnabled),i()(this,"saveEvent",e=>{e&&this._shouldCacheEvent()&&(window.testAnalytics||this._bind(),e.tags instanceof Array?e.tags.push("synthetic"):e.tags=["synthetic"],this._cache(e))}),this._isDebugCookieEnabled=(()=>{try{return JSON.parse(o.a.get("atlassian_analytics_debug")||"false")}catch(e){o.a.remove("atlassian_analytics_debug")}return!1})(),this._isDebugCookieEnabled&&this._bind()}}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return h}));var n=r(41),i=r.n(n),s=r(2),o=r.n(s),a=r(6),c=r(76);const u=["embeddedProduct"];function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class h{constructor(e,t,r){var n=this;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(o()(this,"start",()=>{this._startInterval(),this._bindEventListeners()}),o()(this,"stop",()=>{this._stopInterval(),this._unbindEventListeners()}),o()(this,"resetTimers",()=>{this._intervalId&&(this.stop(),this.start())}),o()(this,"_bindEventListeners",()=>{window.addEventListener("focus",this._focusListener),window.addEventListener("blur",this._blurListener)}),o()(this,"_unbindEventListeners",()=>{window.removeEventListener("focus",this._focusListener),window.removeEventListener("blur",this._blurListener)}),o()(this,"_startInterval",()=>{clearInterval(this._intervalId),this._intervalId=setInterval(this._handleInterval,this._delay)}),o()(this,"_stopInterval",()=>{this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}),o()(this,"_getProductKey",(e,t)=>{let r=e;return t&&(r+="-"+t),r}),o()(this,"_getLastSentTimestamp",(e,t,r)=>(((this._parseLocalStorageData()||{})[r]||{})[t]||{})[e]||null),o()(this,"_parseLocalStorageData",()=>{const e=this._safeLocalStorage.getItem(this._storageKey);try{return JSON.parse(e||"")}catch(e){return this._safeLocalStorage.removeItem(this._storageKey),null}}),o()(this,"_setLastSentTimestamp",(e,t,r)=>{const n=this._parseLocalStorageData()||{},i=n[r]||{},s=i[t]||{};s[e]=Date.now(),i[t]=s,n[r]=i,this._safeLocalStorage.setItem(this._storageKey,JSON.stringify(n))}),o()(this,"_shouldSendEvent",(e,t,r,n)=>{if(!document.hasFocus())return!1;if(t!==a.tenantType.NONE&&!r||!n)return!1;return Date.now()-this._getLastSentTimestamp(e,r,n)>this._throttle}),o()(this,"_handleInterval",()=>{const e=this._getContext(),{embeddedProduct:t}=e,r=i()(e,u);this._sendEvent(this._product,r),t&&this._sendEvent(t,r,!0)}),o()(this,"_sendEvent",(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{subproduct:i,tenantIdType:s,tenantId:o,userId:a,lastScreenEvent:c,attributes:u}=t,l=n._getProductKey(e,i);if(n._shouldSendEvent(l,s,o,a)){n._setLastSentTimestamp(l,o,a);const t=n._createEvent(e,i,r,c,u);n._onEvent(t)}})),o()(this,"_createEvent",(e,t,r,n,i)=>{const s={product:e,source:"ui",action:"viewed",actionSubject:"ui",attributes:i};return r&&(s.subproduct=null,s.version=null,s.attributes=d(d({},s.attributes),{},{embeddedInEnv:this._productInfo.env,embeddedInProduct:this._productInfo.product,embeddedInSubproduct:t,embeddedInVersion:this._productInfo.version,embeddedInOrigin:this._productInfo.origin,embeddedInPlatform:this._productInfo.platform})),n&&(s.attributes=d(d({},s.attributes),{},{lastScreenEvent:{name:n.name,attributes:n.attributes}})),s}),!e)throw new Error("Missing productInfo");if(!e.product)throw new Error("Missing productInfo.product");if(!t)throw new Error("Missing getContext callback");if("function"!=typeof t)throw new Error("Invalid getContext, must be function");if(!r)throw new Error("Missing onEvent callback");if("function"!=typeof r)throw new Error("Invalid onEvent, must be function");this._productInfo=e,this._product=e.product,this._getContext=t,this._onEvent=r,this._delay=s.delay||2e3,this._throttle=s.throttle||36e5,this._storageKey=s.storageKey||"ui.viewed.last.sent",this._safeLocalStorage=new c.default({envPrefix:this._productInfo.env}),this._focusListener=()=>{this._startInterval()},this._blurListener=()=>{this._stopInterval()}}}},function(e,t,r){"use strict";function n(e,t){return e&&"function"==typeof e?()=>{e(t)}:null}r.r(t),r.d(t,"default",(function(){return n}))},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return d}));var n=r(2),i=r.n(n),s=r(98),o=r.n(s),a=r(15);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const l={initialPollInterval:5,pollBackoffRate:2,idleTimeout:30};class d{constructor(e,t,r,n){if(i()(this,"start",()=>{if(o.a.active)throw new Error("DwellTimeHelper should only be initialised once per page load.");this._initDwellTimeCounterAndPolling(),window.addEventListener("beforeunload",()=>{this.stop()})}),i()(this,"stop",()=>{o.a.active&&this._sendDwellEvent(this._eventData,this._searchSessionId,!0),o.a.stopAllTimers(),o.a.resetAllRecordedPageTimes(),o.a.timeElapsedCallbacks=[]}),i()(this,"newPage",(e,t)=>{Object(a.validateDwellBaseEvent)(e),this.stop(),this._eventData=e,this._searchSessionId=t,this._initDwellTimeCounterAndPolling()}),i()(this,"_initDwellTimeCounterAndPolling",()=>{o.a.initialize({idleTimeoutInSeconds:this._timing.idleTimeout}),this._pollDwellTime(this._timing.initialPollInterval,this._searchSessionId,this._eventData)}),i()(this,"_pollDwellTime",(e,t,r)=>{o.a.callAfterTimeElapsedInSeconds(e,()=>{this._sendDwellEvent(r,t,!1),this._pollDwellTime(e*this._timing.pollBackoffRate,t,r)})}),i()(this,"_sendDwellEvent",(e,t,r)=>{const n={dwellTime:o.a.getTimeOnCurrentPageInMilliseconds(),searchReferrer:t,finalDwellEvent:r};this._trackCallback({action:"dwelled",actionSubject:e.actionSubject,actionSubjectId:e.actionSubjectId,source:e.source,containerType:e.containerType,containerId:e.containerId,containers:e.containers,objectType:e.objectType,objectId:e.objectId,attributes:u(u({},n),e.attributes),tags:e.tags})}),!e)throw new Error("trackCallback is required for DwellTimeHelper");Object(a.validateDwellBaseEvent)(t),this._trackCallback=e,this._eventData=t,this._searchSessionId=r,this._timing=u(u({},l),n)}}},function(e,t,r){var n;(function(){!function(r,i){if(e.exports)return e.exports=i();void 0===(n=function(){return r.TimeMe=i()}.apply(t,[]))||(e.exports=n)}(this,(function(){var e={startStopTimes:{},idleTimeoutMs:3e4,currentIdleTimeMs:0,checkStateRateMs:250,active:!1,idle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],trackTimeOnElement:function(t){var r=document.getElementById(t);r&&(r.addEventListener("mouseover",(function(){e.startTimer(t)})),r.addEventListener("mousemove",(function(){e.startTimer(t)})),r.addEventListener("mouseleave",(function(){e.stopTimer(t)})),r.addEventListener("keypress",(function(){e.startTimer(t)})),r.addEventListener("focus",(function(){e.startTimer(t)})))},getTimeOnElementInSeconds:function(t){var r=e.getTimeOnPageInSeconds(t);return r||0},startTimer:function(t,r){if(t||(t=e.currentPageName),void 0===e.startStopTimes[t])e.startStopTimes[t]=[];else{var n=e.startStopTimes[t],i=n[n.length-1];if(void 0!==i&&void 0===i.stopTime)return}e.startStopTimes[t].push({startTime:r||new Date,stopTime:void 0}),e.active=!0,e.idle=!1},stopAllTimers:function(){for(var t=Object.keys(e.startStopTimes),r=0;r<t.length;r++)e.stopTimer(t[r])},stopTimer:function(t,r){t||(t=e.currentPageName);var n=e.startStopTimes[t];void 0!==n&&0!==n.length&&(void 0===n[n.length-1].stopTime&&(n[n.length-1].stopTime=r||new Date),e.active=!1)},getTimeOnCurrentPageInSeconds:function(){return e.getTimeOnPageInSeconds(e.currentPageName)},getTimeOnPageInSeconds:function(t){var r=e.getTimeOnPageInMilliseconds(t);return void 0===r?void 0:r/1e3},getTimeOnCurrentPageInMilliseconds:function(){return e.getTimeOnPageInMilliseconds(e.currentPageName)},getTimeOnPageInMilliseconds:function(t){var r=e.startStopTimes[t];if(void 0!==r){for(var n=0,i=0;i<r.length;i++){var s=r[i].startTime,o=r[i].stopTime;void 0===o&&(o=new Date),n+=o-s}return Number(n)}},getTimeOnAllPagesInSeconds:function(){for(var t=[],r=Object.keys(e.startStopTimes),n=0;n<r.length;n++){var i=r[n],s=e.getTimeOnPageInSeconds(i);t.push({pageName:i,timeOnPage:s})}return t},setIdleDurationInSeconds:function(t){var r=parseFloat(t);if(!1!==isNaN(r))throw{name:"InvalidDurationException",message:"An invalid duration time ("+t+") was provided."};return e.idleTimeoutMs=1e3*t,this},setCurrentPageName:function(t){return e.currentPageName=t,this},resetRecordedPageTime:function(t){delete e.startStopTimes[t]},resetAllRecordedPageTimes:function(){for(var t=Object.keys(e.startStopTimes),r=0;r<t.length;r++)e.resetRecordedPageTime(t[r])},resetIdleCountdown:function(){e.idle&&e.triggerUserHasReturned(),e.idle=!1,e.currentIdleTimeMs=0},callWhenUserLeaves:function(e,t){this.userLeftCallbacks.push({callback:e,numberOfTimesToInvoke:t})},callWhenUserReturns:function(e,t){this.userReturnCallbacks.push({callback:e,numberOfTimesToInvoke:t})},triggerUserHasReturned:function(){if(!e.active)for(var t=0;t<this.userReturnCallbacks.length;t++){var r=this.userReturnCallbacks[t],n=r.numberOfTimesToInvoke;(isNaN(n)||void 0===n||n>0)&&(r.numberOfTimesToInvoke-=1,r.callback())}e.startTimer()},triggerUserHasLeftPage:function(){if(e.active)for(var t=0;t<this.userLeftCallbacks.length;t++){var r=this.userLeftCallbacks[t],n=r.numberOfTimesToInvoke;(isNaN(n)||void 0===n||n>0)&&(r.numberOfTimesToInvoke-=1,r.callback())}e.stopAllTimers()},callAfterTimeElapsedInSeconds:function(t,r){e.timeElapsedCallbacks.push({timeInSeconds:t,callback:r,pending:!0})},checkState:function(){for(var t=0;t<e.timeElapsedCallbacks.length;t++)e.timeElapsedCallbacks[t].pending&&e.getTimeOnCurrentPageInSeconds()>e.timeElapsedCallbacks[t].timeInSeconds&&(e.timeElapsedCallbacks[t].callback(),e.timeElapsedCallbacks[t].pending=!1);!1===e.idle&&e.currentIdleTimeMs>e.idleTimeoutMs?(e.idle=!0,e.triggerUserHasLeftPage()):e.currentIdleTimeMs+=e.checkStateRateMs},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents:function(){void 0!==document.hidden?(e.hiddenPropName="hidden",e.visibilityChangeEventName="visibilitychange"):void 0!==document.mozHidden?(e.hiddenPropName="mozHidden",e.visibilityChangeEventName="mozvisibilitychange"):void 0!==document.msHidden?(e.hiddenPropName="msHidden",e.visibilityChangeEventName="msvisibilitychange"):void 0!==document.webkitHidden&&(e.hiddenPropName="webkitHidden",e.visibilityChangeEventName="webkitvisibilitychange"),document.addEventListener(e.visibilityChangeEventName,(function(){document[e.hiddenPropName]?e.triggerUserHasLeftPage():e.triggerUserHasReturned()}),!1),window.addEventListener("blur",(function(){e.triggerUserHasLeftPage()})),window.addEventListener("focus",(function(){e.triggerUserHasReturned()})),document.addEventListener("mousemove",(function(){e.resetIdleCountdown()})),document.addEventListener("keyup",(function(){e.resetIdleCountdown()})),document.addEventListener("touchstart",(function(){e.resetIdleCountdown()})),window.addEventListener("scroll",(function(){e.resetIdleCountdown()})),setInterval((function(){e.checkState()}),e.checkStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket:function(t){if(window.WebSocket&&t){var r=t.websocketHost;try{e.websocket=new WebSocket(r),window.onbeforeunload=function(r){e.sendCurrentTime(t.appId)},e.websocket.onopen=function(){e.sendInitWsRequest(t.appId)},e.websocket.onerror=function(e){console&&console.log("Error occurred in websocket connection: "+e)},e.websocket.onmessage=function(e){console&&console.log(e.data)}}catch(e){console&&console.error("Failed to connect to websocket host.  Error:"+e)}}return this},websocketSend:function(t){e.websocket.send(JSON.stringify(t))},sendCurrentTime:function(t){var r={type:"INSERT_TIME",appId:t,timeOnPageMs:e.getTimeOnCurrentPageInMilliseconds(),pageName:e.currentPageName};e.websocketSend(r)},sendInitWsRequest:function(t){var r={type:"INIT",appId:t};e.websocketSend(r)},initialize:function(t){var r=e.idleTimeoutMs||30,n=e.currentPageName||"default-page-name",i=void 0,s=void 0;t&&(r=t.idleTimeoutInSeconds||r,n=t.currentPageName||n,i=t.websocketOptions,s=t.initialStartTime),e.setIdleDurationInSeconds(r).setCurrentPageName(n).setUpWebsocket(i).listenForVisibilityEvents(),e.startTimer(void 0,s)}};return e}))}).call(this)},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l}));var n=r(2),i=r.n(n),s=r(100),o=r(15);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const u={initialPollInterval:5e3,idleTimeout:3e4,multiplierCallback:e=>e+e};class l{constructor(e,t,r,n){if(i()(this,"start",()=>{this.browserInteractionTime.startTimer(),this.browserInteractionTime.addTimeIntervalEllapsedCallback({callback:e=>this._sendDwellEvent(this._eventData,this._searchSessionId,e,!1),timeInMilliseconds:this._timing.initialPollInterval,multiplier:this._timing.multiplierCallback}),window.addEventListener("beforeunload",this._onBeforeUnload)}),i()(this,"stop",()=>{this.browserInteractionTime.isRunning()&&this._sendDwellEvent(this._eventData,this._searchSessionId,this.browserInteractionTime.getTimeInMilliseconds(),!0),this.browserInteractionTime.stopTimer()}),i()(this,"newPage",(e,t)=>{Object(o.validateDwellBaseEvent)(e),this.stop(),this.browserInteractionTime.reset(),this.setEventData(e),this.setSearchSessionId(t),this.start()}),i()(this,"setEventData",e=>{this._eventData=e}),i()(this,"getEventData",()=>this._eventData),i()(this,"setSearchSessionId",e=>{this._searchSessionId=e}),i()(this,"getSearchSessionId",()=>this._searchSessionId),i()(this,"destroy",()=>{this.browserInteractionTime.destroy(),window.removeEventListener("beforeunload",this._onBeforeUnload)}),i()(this,"_onBeforeUnload",()=>{this.stop(),this.destroy()}),i()(this,"_sendDwellEvent",(e,t,r,n)=>{const i={dwellTime:r,searchReferrer:t,finalDwellEvent:n};this._trackCallback({action:"dwelled",actionSubject:e.actionSubject,actionSubjectId:e.actionSubjectId,source:e.source,containerType:e.containerType,containerId:e.containerId,objectType:e.objectType,objectId:e.objectId,attributes:c(c({},i),e.attributes),tags:e.tags})}),!e)throw new Error("trackCallback is required for DwellTimeHelper");Object(o.validateDwellBaseEvent)(t),this._trackCallback=e,this._eventData=t,this._searchSessionId=r,this._timing=c(c({},u),n),this.browserInteractionTime=new s.default({idleTimeoutMs:this._timing.idleTimeout,checkCallbacksIntervalMs:500})}}},function(e,t,r){"use strict";r.r(t),function(e){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var n=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},s="object"==typeof i&&i&&i.Object===Object&&i,o="object"==typeof self&&self&&self.Object===Object&&self,a=s||o||Function("return this")(),c=function(){return a.Date.now()},u=a.Symbol,l=Object.prototype,d=l.hasOwnProperty,h=l.toString,f=u?u.toStringTag:void 0;var m=function(e){var t=d.call(e,f),r=e[f];try{e[f]=void 0;var n=!0}catch(e){}var i=h.call(e);return n&&(t?e[f]=r:delete e[f]),i},p=Object.prototype.toString;var g=function(e){return p.call(e)},b=u?u.toStringTag:void 0;var y=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":b&&b in Object(e)?m(e):g(e)};var v=function(e){return null!=e&&"object"==typeof e};var E=function(e){return"symbol"==typeof e||v(e)&&"[object Symbol]"==y(e)},I=/^\s+|\s+$/g,O=/^[-+]0x[0-9a-f]+$/i,T=/^0b[01]+$/i,w=/^0o[0-7]+$/i,_=parseInt;var S=function(e){if("number"==typeof e)return e;if(E(e))return NaN;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(I,"");var r=T.test(e);return r||w.test(e)?_(e.slice(2),r?2:8):O.test(e)?NaN:+e},P=Math.max,j=Math.min;var k=function(e,t,r){var i,s,o,a,u,l,d=0,h=!1,f=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var r=i,n=s;return i=s=void 0,d=t,a=e.apply(n,r)}function g(e){return d=e,u=setTimeout(y,t),h?p(e):a}function b(e){var r=e-l;return void 0===l||r>=t||r<0||f&&e-d>=o}function y(){var e=c();if(b(e))return v(e);u=setTimeout(y,function(e){var r=t-(e-l);return f?j(r,o-(e-d)):r}(e))}function v(e){return u=void 0,m&&i?p(e):(i=s=void 0,a)}function E(){var e=c(),r=b(e);if(i=arguments,s=this,l=e,r){if(void 0===u)return g(l);if(f)return u=setTimeout(y,t),p(l)}return void 0===u&&(u=setTimeout(y,t)),a}return t=S(t)||0,n(r)&&(h=!!r.leading,o=(f="maxWait"in r)?P(S(r.maxWait)||0,t):o,m="trailing"in r?!!r.trailing:m),E.cancel=function(){void 0!==u&&clearTimeout(u),d=0,i=l=s=u=void 0},E.flush=function(){return void 0===u?a:v(c())},E};var D=function(e,t,r){var i=!0,s=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return n(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),k(e,t,{leading:i,maxWait:t,trailing:s})},A=["scroll","resize"],C=["wheel","keydown","keyup","mousedown","mousemove","touchstart","touchmove","click","contextmenu"],N=function(){function e(e){var t=e.timeIntervalEllapsedCallbacks,n=void 0===t?[]:t,i=e.absoluteTimeEllapsedCallbacks,s=void 0===i?[]:i,o=e.checkCallbacksIntervalMs,a=void 0===o?100:o,c=e.browserTabInactiveCallbacks,u=void 0===c?[]:c,l=e.idleCallbacks,d=void 0===l?[]:l,h=e.stopTimerOnTabchange,f=void 0===h||h,m=e.activeCallbacks,p=void 0===m?[]:m,g=e.browserTabActiveCallbacks,b=void 0===g?[]:g,y=e.idleTimeoutMs,v=void 0===y?3e3:y,E=this;this.onBrowserTabInactive=function(){E.isRunning()&&E.stopTimerOnTabchange&&E.stopTimer(),E.browserTabInactiveCallbacks.forEach((function(e){return e(E.getTimeInMilliseconds())}))},this.onBrowserTabActive=function(){E.isRunning()||E.startTimer(),E.browserTabActiveCallbacks.forEach((function(e){return e(E.getTimeInMilliseconds())}))},this.onBrowserActiveChange=function(){"visible"===document.visibilityState?E.onBrowserTabActive():E.onBrowserTabInactive()},this.onTimePassed=function(){E.absoluteTimeEllapsedCallbacks.forEach((function(e,t){var r=e.callback,n=e.pending,i=e.timeInMilliseconds;n&&i<=E.getTimeInMilliseconds()&&(r(E.getTimeInMilliseconds()),E.absoluteTimeEllapsedCallbacks[t].pending=!1)})),E.timeIntervalEllapsedCallbacks.forEach((function(e,t){var r=e.callback,n=e.timeInMilliseconds,i=e.multiplier;n<=E.getTimeInMilliseconds()&&(r(E.getTimeInMilliseconds()),E.timeIntervalEllapsedCallbacks[t].timeInMilliseconds=i(n))})),E.currentIdleTimeMs>=E.idleTimeoutMs&&E.isRunning()?(E.idle=!0,E.stopTimer(),E.idleCallbacks.forEach((function(e){return e(E.getTimeInMilliseconds())}))):E.currentIdleTimeMs+=E.checkCallbacksIntervalMs},this.resetIdleTime=function(){E.idle&&E.startTimer(),E.activeCallbacks.forEach((function(e){return e(E.getTimeInMilliseconds())})),E.idle=!1,E.currentIdleTimeMs=0},this.registerEventListeners=function(){var e={passive:!0},t=r({},e,{capture:!0});document.addEventListener("visibilitychange",E.onBrowserActiveChange);var n=D(E.resetIdleTime,2e3,{leading:!0,trailing:!1});A.forEach((function(e){window.addEventListener(e,n,t)})),C.forEach((function(t){return document.addEventListener(t,n,e)}))},this.unregisterEventListeners=function(){document.removeEventListener("visibilitychange",E.onBrowserActiveChange),A.forEach((function(e){return window.removeEventListener(e,E.resetIdleTime)})),C.forEach((function(e){return document.removeEventListener(e,E.resetIdleTime)}))},this.checkCallbacksOnInterval=function(){E.checkCallbackIntervalId=window.setInterval((function(){E.onTimePassed()}),E.checkCallbacksIntervalMs)},this.startTimer=function(){E.checkCallbackIntervalId||E.checkCallbacksOnInterval();var e=E.times[E.times.length-1];e&&null===e.stop||(E.times.push({start:performance.now(),stop:null}),E.running=!0)},this.stopTimer=function(){E.times.length&&(E.times[E.times.length-1].stop=performance.now(),E.running=!1)},this.addTimeIntervalEllapsedCallback=function(e){E.timeIntervalEllapsedCallbacks.push(e)},this.addAbsoluteTimeEllapsedCallback=function(e){E.absoluteTimeEllapsedCallbacks.push(e)},this.addBrowserTabInactiveCallback=function(e){E.browserTabInactiveCallbacks.push(e)},this.addBrowserTabActiveCallback=function(e){E.browserTabActiveCallbacks.push(e)},this.addIdleCallback=function(e){E.idleCallbacks.push(e)},this.addActiveCallback=function(e){E.activeCallbacks.push(e)},this.getTimeInMilliseconds=function(){return E.times.reduce((function(e,t){return t.stop?e+=t.stop-t.start:e+=performance.now()-t.start,e}),0)},this.isRunning=function(){return E.running},this.isIdle=function(){return E.idle},this.reset=function(){E.times=[]},this.destroy=function(){E.unregisterEventListeners(),E.checkCallbackIntervalId&&window.clearInterval(E.checkCallbackIntervalId)},this.running=!1,this.times=[],this.idle=!1,this.currentIdleTimeMs=0,this.marks={},this.measures={},this.stopTimerOnTabchange=f,this.browserTabActiveCallbacks=b,this.browserTabInactiveCallbacks=u,this.checkCallbacksIntervalMs=a,this.idleTimeoutMs=v,this.timeIntervalEllapsedCallbacks=n,this.absoluteTimeEllapsedCallbacks=s,this.idleCallbacks=d,this.activeCallbacks=p,this.registerEventListeners()}return e.prototype.mark=function(e){this.marks[e]||(this.marks[e]=[]),this.marks[e].push({time:this.getTimeInMilliseconds()})},e.prototype.getMarks=function(e){if(!(this.marks[e].length<1))return this.marks[e]},e.prototype.measure=function(e,t,r){var n=this.marks[t],i=n[n.length-1],s=this.marks[r],o=s[s.length-1];this.measures[e]||(this.measures[e]=[]),this.measures[e].push({name:e,startTime:i.time,duration:o.time-i.time})},e.prototype.getMeasures=function(e){if(this.measures[e]||!(this.measures[e].length<1))return this.measures[e]},e}();t.default=N}.call(this,r(101))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var n=r(2),i=r.n(n);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){const n=o({action:e},r);return n.attributes=o(o({},t),n.attributes),n}class c{constructor(e,t){this._onEvent=e,this._baseEvent=t,this._searchStartedTime=null,this._lastQueryResultsTime=null,this._queryLength=null,this._baseEvent=o({},t)}search(e){if(!e&&""!==e)throw new Error("Missing query param");this._searchStartedTime=Date.now(),this._queryLength=(e||"").length}searched(e){if(!e)throw new Error("Missing results param");if(null===this._queryLength)throw new Error("search() must be called before searched().");const t=Date.now()-this._searchStartedTime;this._lastQueryResultsTime=Date.now(),this._lastResults=e;const r=a("searched",{responseTimeMs:t,queryLength:this._queryLength,results:e},this._baseEvent);this._onEvent(r)}selected(e){if(!e&&0!==e)throw new Error("Missing selectionIndex param");if(!this._lastQueryResultsTime)throw new Error("searched() must be called before selected().");const t=Date.now(),r=t-this._lastQueryResultsTime,n=t-this._searchStartedTime,i=this._lastResults[e],s=a("selected",{queryLength:this._queryLength,selectionIndex:e,selectionTimeMs:r,searchTimeMs:n,selectedResultValue:i},this._baseEvent);this._onEvent(s)}}}])}));}(globalRequire.define));