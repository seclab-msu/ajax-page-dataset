/**
 * @version $Id: jquery.djmegamenu.js 72 2017-08-04 10:30:52Z szymon $
 * @package DJ-MegaMenu
 * @copyright Copyright (C) 2017 DJ-Extensions.com, All rights reserved.
 * @license DJ-Extensions.com Proprietary Use License
 * @author url: http://dj-extensions.com
 * @author email contact@dj-extensions.com
 * @developer Szymon Woronowski - szymon.woronowski@design-joomla.eu
 */
!function(t){var s=function(t,s){this.options={openDelay:250,closeDelay:500,animIn:"fadeIn",animOut:"fadeOut",animSpeed:"normal",duration:450,wrap:null,direction:"ltr",event:"mouseenter",touch:"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,offset:0,wcag:1},this.init(t,s)};s.prototype.init=function(s,o){var n=this;if(jQuery.extend(n.options,o),s.length){switch(n.options.menu=s,n.options.blurTimer=null,n.options.animSpeed){case"fast":n.options.duration=250;break;case"slow":n.options.duration=650}s.addClass(n.options.animSpeed);var i=s.find("li.dj-up");n.kids=[],n.options.wrap=t("#"+n.options.wrap),n.options.wrap.length||(n.options.wrap=s),n.options.touch&&s.on("touchstart",function(t){t.stopPropagation()}),i.each(function(s){var o=t(this);n.kids[s]=new e(o,0,n,n.options)}),1==n.options.fixed&&t(window).one("load",n.makeSticky.bind(n,s)),1==n.options.wcag&&(n.focusable=s.find("a[href], [tabindex]"),s.on("keydown",function(t){n.focusNearest(t)}))}},s.prototype.focusNearest=function(s){var e=this,o=s.which,n=e.options.menu.find(":focus"),i=n.offset(),a={x:1024,y:1024},u=null;if(i){var r=function(t){if(!t.is(":hidden")&&t!=n){var s=t.offset(),e={x:Math.abs(s.left-i.left),y:Math.abs(s.top-i.top)};37==o&&s.left<i.left||39==o&&s.left>i.left?(e.y<a.y||e.y==a.y&&e.x<a.x)&&(a=e,u=t):(38==o&&s.top<i.top||40==o&&s.top>i.top&&e.x<t.width())&&e.x+e.y<a.x+a.y&&(a=e,u=t)}};e.focusable.each(function(){r(t(this))}),u&&(s.preventDefault(),s.stopPropagation(),u.focus())}},s.prototype.makeSticky=function(s){var e=this;e.sticky=!1;var o=t("#"+s.attr("id")+"sticky"),n=s.offset().top-parseInt(e.options.offset),i=s.clone();i.attr("id",s.attr("id")+"placeholder"),i.css({display:"none",opacity:0}),i.find(".dj-subwrap").remove(),i.insertBefore(o);var a="rtl"==e.options.direction?"right":"left";t(window).scroll(e.scroll.bind(e,o,s,i,n,a,!1)),t(window).resize(e.scroll.bind(e,o,s,i,n,a,!0))},s.prototype.scroll=function(s,e,o,n,i,a){var u=this;if(t(window).scrollTop()>n){if(!u.sticky&&!a||u.sticky&&a){a||(s.css({position:"fixed",top:parseInt(u.options.offset),left:0,width:"100%"}),s.addClass("dj-megamenu-fixed"),s.find(".dj-stickylogo").css("display",""),e.css("background","transparent"),o.css("display",""),u.sticky=!0);var r=o.offset(),l="left"==i?r.left:t(window).width()-r.left-e.outerWidth();e.css(i,l),e.css("max-width",o.outerWidth()+1);var c=t(window).height()-parseInt(u.options.offset)-e.height();e.find(".dj-up > .dj-subwrap").css({"max-height":c,"overflow-y":"auto"})}}else u.sticky&&(s.find(".dj-stickylogo").css("display","none"),s.css({position:"",top:"",left:"",width:"",background:""}),s.removeClass("dj-megamenu-fixed"),e.css("background",""),o.css("display","none"),e.css(i,""),e.css("max-width",""),u.sticky=!1,e.find(".dj-up > .dj-subwrap").css({"max-height":"","overflow-y":""}))};var e=function(t,s,e,o){this.options={},this.init(t,s,e,o)};e.prototype.init=function(s,e,o,n){var i=this;jQuery.extend(i.options,n),i.menu=s,i.level=e,i.parent=o,i.timer=null,i.blurTimer=null,i.sub=i.menu.find("> .dj-subwrap").first(),i.menu.find(".dj-submenu > li, .dj-subtree > li").length||(i.sub.remove(),i.menu.removeClass("parent"),i.menu.find("span.dj-drop").removeClass("dj-drop"),i.menu.find("i.arrow").remove());var a="mouseenter";if(i.options.touch||"click_all"==i.options.event?(a="click_all"==i.options.event?"click":a,(u=i.menu.find("> a").first()).length&&(i.menu.hasClass("separator")&&u.css("cursor","pointer"),u.on("touchend click",function(t){i.sub.length&&!i.menu.hasClass("hover")&&(t.preventDefault(),"touchend"==t.type&&i.menu.trigger("click"))}))):"click"==i.options.event&&i.menu.hasClass("separator")&&((u=i.menu.find("> a").first()).length&&u.css("cursor","pointer"),a="click"),i.options.touch&&(i.menu.on("click",i.showSub.bind(i)),t(document).on("touchstart",function(){i.menu.hasClass("hover")&&i.menu.trigger("mouseleave")})),i.menu.on(a,i.showSub.bind(i)),i.menu.on("mouseleave",i.hideSub.bind(i)),1==i.options.wcag){var u=i.menu.find("> a").first();u.on("focus",i.showSub.bind(i)),u.on("blur",function(){i.blurTimer=setTimeout(function(){if(!i.options.menu.find(":focus").length){for(var t=i;t.level>0;)t.hideSub(),t=t.parent;t.hideSub()}},1e3)}),u.on("keydown",function(t){i.focusNearest(t)}),i.options.menu.on("click",function(){clearTimeout(i.blurTimer)})}i.sub.length&&(i.kids=[],i.initKids())},e.prototype.focusNearest=function(s){var e=this,o=s.which,n=e.menu.offset(),i={x:1024,y:1024},a=null,u=function(t){if(t.menu&&t.menu.find("> a").length){var s=t.menu.offset(),e={x:Math.abs(s.top-n.top),y:Math.abs(s.left-n.left)};37==o&&s.left<n.left||39==o&&s.left>n.left?(e.x<i.x||e.x==i.x&&e.y<i.y)&&(i=e,a=t):(38==o&&s.top<n.top||40==o&&s.top>n.top)&&(e.y<i.y||e.y==i.y&&e.x<i.x)&&(i=e,a=t)}};t.each(e.parent.kids,function(t,s){u(s)}),a||(u(e.parent),e.sub.length&&t.each(e.kids,function(t,s){u(s)})),a&&(s.preventDefault(),s.stopPropagation(),a.menu.find("> a").first().focus())},e.prototype.showSub=function(){var s=this;clearTimeout(s.timer),s.menu.hasClass("hover")&&!s.sub.hasClass(s.options.animOut)||(s.sub.length&&s.sub.css("display","none"),s.timer=setTimeout(function(){clearTimeout(s.animTimer),s.menu.addClass("hover"),s.hideOther(),s.sub.length&&(s.sub.css("display",""),s.sub.removeClass(s.options.animOut),s.checkDir(),s.sub.addClass(s.options.animIn),t(window).trigger("resize"))},s.options.openDelay))},e.prototype.hideSub=function(){var t=this;clearTimeout(t.timer),t.sub.length?t.timer=setTimeout(function(){t.menu.is(":hover")||(t.sub.removeClass(t.options.animIn),t.sub.addClass(t.options.animOut),t.animTimer=setTimeout(function(){t.menu.removeClass("hover")},t.options.duration))},t.options.closeDelay):t.menu.removeClass("hover")},e.prototype.checkDir=function(){var t=this;if(!t.menu.hasClass("fullsub")){t.sub.css("left",""),t.sub.css("right",""),t.sub.css("margin-left",""),t.sub.css("margin-right","");var s=t.sub.offset(),e=t.options.wrap.offset();if("ltr"==t.options.direction)((o=s.left+t.sub.outerWidth()-t.options.wrap.outerWidth()-e.left)>0||t.sub.hasClass("open-left"))&&(t.level?(t.sub.css("right",t.menu.outerWidth()),t.sub.css("left","auto")):t.sub.hasClass("open-left")?(t.sub.css("right",t.sub.css("left")),t.sub.css("left","auto")):t.sub.css("margin-left",-o));else if("rtl"==t.options.direction){var o=s.left-e.left;(o<0||t.sub.hasClass("open-right"))&&(t.level?(t.sub.css("left",t.menu.outerWidth()),t.sub.css("right","auto")):t.sub.hasClass("open-right")?(t.sub.css("left",t.sub.css("right")),t.sub.css("right","auto")):t.sub.css("margin-right",o))}}},e.prototype.initKids=function(){var s=this;s.sub.find("> .dj-subwrap-in > .dj-subcol > ul.dj-submenu > li").each(function(o){var n=t(this);s.kids[o]=new e(n,s.level+1,s,s.options)})},e.prototype.hideOther=function(){var s=this;t.each(s.parent.kids,function(t,e){e.menu.hasClass("hover")&&e!=s&&(e.sub.length?(e.hideOtherSub(),e.sub.removeClass(e.options.animIn),e.sub.addClass(e.options.animOut),e.animTimer=setTimeout(function(){e.menu.removeClass("hover")},s.options.duration)):e.menu.removeClass("hover"))})},e.prototype.hideOtherSub=function(){var s=this;t.each(s.kids,function(t,s){s.sub.length&&(s.hideOtherSub(),s.sub.removeClass(s.options.animIn),s.sub.removeClass(s.options.animOut)),s.menu.removeClass("hover")})},t(document).ready(function(){t(".dj-megamenu[data-options]").each(function(){var e=t(this);e.find(".dj-hideitem").remove(),e.data();var o=e.data("options");e.removeAttr("data-options"),e.find(".modules-wrap ul.nav li.current").each(function(){t(this).parents("ul.dj-submenu > li, li.dj-up").each(function(){t(this).addClass("active"),t(this).find("> a").addClass("active")})}),new s(e,o)})})}(jQuery);