!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var n=function(t){return t&&t.Math==Math&&t},r=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),i=function(t){try{return!!t()}catch(t){return!0}},o=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),a={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,c={f:s&&!a.call({1:2},1)?function(t){var e=s(this,t);return!!e&&e.enumerable}:a},u=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},l={}.toString,h=function(t){return l.call(t).slice(8,-1)},f="".split,p=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==h(t)?f.call(t,""):Object(t)}:Object,d=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},g=function(t){return p(d(t))},v=function(t){return"object"==typeof t?null!==t:"function"==typeof t},m=function(t,e){if(!v(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!v(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},y={}.hasOwnProperty,b=function(t,e){return y.call(t,e)},w=r.document,k=v(w)&&v(w.createElement),_=function(t){return k?w.createElement(t):{}},S=!o&&!i((function(){return 7!=Object.defineProperty(_("div"),"a",{get:function(){return 7}}).a})),x=Object.getOwnPropertyDescriptor,T={f:o?x:function(t,e){if(t=g(t),e=m(e,!0),S)try{return x(t,e)}catch(t){}if(b(t,e))return u(!c.f.call(t,e),t[e])}},E=/#|\.prototype\./,A=function(t,e){var n=C[O(t)];return n==P||n!=j&&("function"==typeof e?i(e):!!e)},O=A.normalize=function(t){return String(t).replace(E,".").toLowerCase()},C=A.data={},j=A.NATIVE="N",P=A.POLYFILL="P",L=A,I={},B=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},D=function(t,e,n){if(B(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},R=function(t){if(!v(t))throw TypeError(String(t)+" is not an object");return t},M=Object.defineProperty,z={f:o?M:function(t,e,n){if(R(t),e=m(e,!0),R(n),S)try{return M(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},N=o?function(t,e,n){return z.f(t,e,u(1,n))}:function(t,e,n){return t[e]=n,t},F=T.f,U=function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e},q=function(t,e){var n,i,o,a,s,c,u,l,h=t.target,f=t.global,p=t.stat,d=t.proto,g=f?r:p?r[h]:(r[h]||{}).prototype,v=f?I:I[h]||(I[h]={}),m=v.prototype;for(o in e)n=!L(f?o:h+(p?".":"#")+o,t.forced)&&g&&b(g,o),s=v[o],n&&(c=t.noTargetGet?(l=F(g,o))&&l.value:g[o]),a=n&&c?c:e[o],n&&typeof s==typeof a||(u=t.bind&&n?D(a,r):t.wrap&&n?U(a):d&&"function"==typeof a?D(Function.call,a):a,(t.sham||a&&a.sham||s&&s.sham)&&N(u,"sham",!0),v[o]=u,d&&(b(I,i=h+"Prototype")||N(I,i,{}),I[i][o]=a,t.real&&m&&!m[o]&&N(m,o,a)))};q({target:"Object",stat:!0,forced:!o,sham:!o},{defineProperty:z.f});var W=e((function(t){var e=I.Object,n=t.exports=function(t,n,r){return e.defineProperty(t,n,r)};e.defineProperty.sham&&(n.sham=!0)})),H=W,G=[].slice,V={},K=function(t,e,n){if(!(e in V)){for(var r=[],i=0;i<e;i++)r[i]="a["+i+"]";V[e]=Function("C,a","return new C("+r.join(",")+")")}return V[e](t,n)},Q=Function.bind||function(t){var e=B(this),n=G.call(arguments,1),r=function(){var i=n.concat(G.call(arguments));return this instanceof r?K(e,i.length,i):e.apply(t,i)};return v(e.prototype)&&(r.prototype=e.prototype),r};q({target:"Function",proto:!0},{bind:Q});var $=function(t){return I[t+"Prototype"]},J=$("Function").bind,Y=Function.prototype,X=function(t){var e=t.bind;return t===Y||t instanceof Function&&e===Y.bind?J:e},Z=X,tt=Math.ceil,et=Math.floor,nt=function(t){return isNaN(t=+t)?0:(t>0?et:tt)(t)},rt=Math.min,it=function(t){return t>0?rt(nt(t),9007199254740991):0},ot=Math.max,at=Math.min,st=function(t,e){var n=nt(t);return n<0?ot(n+e,0):at(n,e)},ct=function(t){return function(e,n,r){var i,o=g(e),a=it(o.length),s=st(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}},ut={includes:ct(!0),indexOf:ct(!1)},lt=Object.defineProperty,ht={},ft=function(t){throw t},pt=function(t,e){if(b(ht,t))return ht[t];e||(e={});var n=[][t],r=!!b(e,"ACCESSORS")&&e.ACCESSORS,a=b(e,0)?e[0]:ft,s=b(e,1)?e[1]:void 0;return ht[t]=!!n&&!i((function(){if(r&&!o)return!0;var t={length:-1};r?lt(t,1,{enumerable:!0,get:ft}):t[1]=1,n.call(t,a,s)}))},dt=ut.includes,gt=pt("indexOf",{ACCESSORS:!0,1:0});q({target:"Array",proto:!0,forced:!gt},{includes:function(t){return dt(this,t,arguments.length>1?arguments[1]:void 0)}});var vt=$("Array").includes,mt=r["__core-js_shared__"]||function(t,e){try{N(r,t,e)}catch(n){r[t]=e}return e}("__core-js_shared__",{}),yt=e((function(t){(t.exports=function(t,e){return mt[t]||(mt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.4",mode:"pure",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),bt=0,wt=Math.random(),kt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++bt+wt).toString(36)},_t=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())})),St=_t&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,xt=yt("wks"),Tt=r.Symbol,Et=St?Tt:Tt&&Tt.withoutSetter||kt,At=function(t){return b(xt,t)||(_t&&b(Tt,t)?xt[t]=Tt[t]:xt[t]=Et("Symbol."+t)),xt[t]},Ot=At("match"),Ct=function(t){if(function(t){var e;return v(t)&&(void 0!==(e=t[Ot])?!!e:"RegExp"==h(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t},jt=At("match"),Pt=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[jt]=!1,"/./"[t](e)}catch(t){}}return!1};q({target:"String",proto:!0,forced:!Pt("includes")},{includes:function(t){return!!~String(d(this)).indexOf(Ct(t),arguments.length>1?arguments[1]:void 0)}});var Lt=$("String").includes,It=Array.prototype,Bt=String.prototype,Dt=function(t){var e=t.includes;return t===It||t instanceof Array&&e===It.includes?vt:"string"==typeof t||t===Bt||t instanceof String&&e===Bt.includes?Lt:e},Rt={},Mt=Function.toString;"function"!=typeof mt.inspectSource&&(mt.inspectSource=function(t){return Mt.call(t)});var zt,Nt,Ft,Ut=mt.inspectSource,qt=r.WeakMap,Wt="function"==typeof qt&&/native code/.test(Ut(qt)),Ht=yt("keys"),Gt=function(t){return Ht[t]||(Ht[t]=kt(t))},Vt={},Kt=r.WeakMap;if(Wt){var Qt=new Kt,$t=Qt.get,Jt=Qt.has,Yt=Qt.set;zt=function(t,e){return Yt.call(Qt,t,e),e},Nt=function(t){return $t.call(Qt,t)||{}},Ft=function(t){return Jt.call(Qt,t)}}else{var Xt=Gt("state");Vt[Xt]=!0,zt=function(t,e){return N(t,Xt,e),e},Nt=function(t){return b(t,Xt)?t[Xt]:{}},Ft=function(t){return b(t,Xt)}}var Zt,te,ee,ne={set:zt,get:Nt,has:Ft,enforce:function(t){return Ft(t)?Nt(t):zt(t,{})},getterFor:function(t){return function(e){var n;if(!v(e)||(n=Nt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},re=function(t){return Object(d(t))},ie=!i((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),oe=Gt("IE_PROTO"),ae=Object.prototype,se=ie?Object.getPrototypeOf:function(t){return t=re(t),b(t,oe)?t[oe]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ae:null},ce=(At("iterator"),!1);[].keys&&("next"in(ee=[].keys())?(te=se(se(ee)))!==Object.prototype&&(Zt=te):ce=!0),null==Zt&&(Zt={});var ue,le={IteratorPrototype:Zt,BUGGY_SAFARI_ITERATORS:ce},he=ut.indexOf,fe=function(t,e){var n,r=g(t),i=0,o=[];for(n in r)!b(Vt,n)&&b(r,n)&&o.push(n);for(;e.length>i;)b(r,n=e[i++])&&(~he(o,n)||o.push(n));return o},pe=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],de=Object.keys||function(t){return fe(t,pe)},ge=o?Object.defineProperties:function(t,e){R(t);for(var n,r=de(e),i=r.length,o=0;i>o;)z.f(t,n=r[o++],e[n]);return t},ve=function(t){return"function"==typeof t?t:void 0},me=function(t,e){return arguments.length<2?ve(I[t])||ve(r[t]):I[t]&&I[t][e]||r[t]&&r[t][e]},ye=me("document","documentElement"),be=Gt("IE_PROTO"),we=function(){},ke=function(t){return"<script>"+t+"<\/script>"},_e=function(){try{ue=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;_e=ue?function(t){t.write(ke("")),t.close();var e=t.parentWindow.Object;return t=null,e}(ue):((e=_("iframe")).style.display="none",ye.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(ke("document.F=Object")),t.close(),t.F);for(var n=pe.length;n--;)delete _e.prototype[pe[n]];return _e()};Vt[be]=!0;var Se=Object.create||function(t,e){var n;return null!==t?(we.prototype=R(t),n=new we,we.prototype=null,n[be]=t):n=_e(),void 0===e?n:ge(n,e)},xe={};xe[At("toStringTag")]="z";var Te="[object z]"===String(xe),Ee=At("toStringTag"),Ae="Arguments"==h(function(){return arguments}()),Oe=Te?h:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ee))?n:Ae?h(e):"Object"==(r=h(e))&&"function"==typeof e.callee?"Arguments":r},Ce=Te?{}.toString:function(){return"[object "+Oe(this)+"]"},je=z.f,Pe=At("toStringTag"),Le=function(t,e,n,r){if(t){var i=n?t:t.prototype;b(i,Pe)||je(i,Pe,{configurable:!0,value:e}),r&&!Te&&N(i,"toString",Ce)}},Ie=le.IteratorPrototype,Be=function(){return this},De=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return R(n),function(t){if(!v(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),Re=function(t,e,n,r){r&&r.enumerable?t[e]=n:N(t,e,n)},Me=le.IteratorPrototype,ze=le.BUGGY_SAFARI_ITERATORS,Ne=At("iterator"),Fe=function(){return this},Ue=function(t,e,n,r,i,o,a){!function(t,e,n){var r=e+" Iterator";t.prototype=Se(Ie,{next:u(1,n)}),Le(t,r,!1,!0),Rt[r]=Be}(n,e,r);var s,c,l,h=function(t){if(t===i&&v)return v;if(!ze&&t in d)return d[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},f=e+" Iterator",p=!1,d=t.prototype,g=d[Ne]||d["@@iterator"]||i&&d[i],v=!ze&&g||h(i),m="Array"==e&&d.entries||g;if(m&&(s=se(m.call(new t)),Me!==Object.prototype&&s.next&&(Le(s,f,!0,!0),Rt[f]=Fe)),"values"==i&&g&&"values"!==g.name&&(p=!0,v=function(){return g.call(this)}),a&&d[Ne]!==v&&N(d,Ne,v),Rt[e]=v,i)if(c={values:h("values"),keys:o?v:h("keys"),entries:h("entries")},a)for(l in c)(ze||p||!(l in d))&&Re(d,l,c[l]);else q({target:e,proto:!0,forced:ze||p},c);return c},qe=ne.set,We=ne.getterFor("Array Iterator");Ue(Array,"Array",(function(t,e){qe(this,{type:"Array Iterator",target:g(t),index:0,kind:e})}),(function(){var t=We(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");Rt.Arguments=Rt.Array;var He=At("toStringTag");for(var Ge in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Ve=r[Ge],Ke=Ve&&Ve.prototype;Ke&&Oe(Ke)!==He&&N(Ke,He,Ge),Rt[Ge]=Rt.Array}var Qe=Array.isArray||function(t){return"Array"==h(t)},$e=At("species"),Je=function(t,e){var n;return Qe(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Qe(n.prototype)?v(n)&&null===(n=n[$e])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Ye=[].push,Xe=function(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,a=5==t||o;return function(s,c,u,l){for(var h,f,d=re(s),g=p(d),v=D(c,u,3),m=it(g.length),y=0,b=l||Je,w=e?b(s,m):n?b(s,0):void 0;m>y;y++)if((a||y in g)&&(f=v(h=g[y],y,d),t))if(e)w[y]=f;else if(f)switch(t){case 3:return!0;case 5:return h;case 6:return y;case 2:Ye.call(w,h)}else if(i)return!1;return o?-1:r||i?i:w}},Ze={forEach:Xe(0),map:Xe(1),filter:Xe(2),some:Xe(3),every:Xe(4),find:Xe(5),findIndex:Xe(6)},tn=function(t,e){var n=[][t];return!!n&&i((function(){n.call(null,e||function(){throw 1},1)}))},en=Ze.forEach,nn=tn("forEach"),rn=pt("forEach"),on=nn&&rn?[].forEach:function(t){return en(this,t,arguments.length>1?arguments[1]:void 0)};q({target:"Array",proto:!0,forced:[].forEach!=on},{forEach:on});var an=$("Array").forEach,sn=Array.prototype,cn={DOMTokenList:!0,NodeList:!0},un=function(t){var e=t.forEach;return t===sn||t instanceof Array&&e===sn.forEach||cn.hasOwnProperty(Oe(t))?an:e},ln=un,hn="production",fn="true"===String(!0),pn="MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEApOsQPnGejMMA3SWpmByzZaXlSla2IK2NLV11r4/Qd8MgjvT63cNkM/j3w2E/fCJ1C+cdDPTCZcXgUVFdSXvVAEmNscx/3SZBCvAfXVYUj3fkk00XPO425cSQ6368/fEoa8ocqFtHwSlHyaWZBerp6tfawkhvzJSk8sSfQB0slMyy/IsPQU/jwE9sCKjvPO3QcSTvslTyKSIVeVrxOMULA7HT2u9XaVzGd45l8KxdLfTd7o1XHBw2meA566tQ65Po/wy/3ycM7b8LXG6e+I7xCrHudTlLRVISkSx4Uh4XLJF47EwRIVCvtosY7AENjzLV56D9INCeVBv8GraYPtXJQ3iF65v4bPq8kjm+RNUWxzzLYpJ/tt5Utx5ZVogtN18iObVmw+sR+yY3rJOohUyPwSEhNRfQ9qGEJAImUuqOU6HSUHDD2QDfonsHKPwfEN1l5q3oyMIe73yjtulTUkk0MVPvV0F/v7kwLGZDyoskZ6aDuhSDJf/UTxCjzpbtuYX6VUQyid0X3Dr7fswvFn9ucZydNTW1ZOC/nszmu7Rl+Fk+OsEcTLM0CfZP+1n+bd17+UtIAl4rChmJGhEyz4c4/TFuACcaz8vlIeNZ+9MbXZ1VbI9kOB6roQzGQ2qpirKk1dtrV1Lb/6ODixSGtJ0ShcH7y0icxR8HK71j+oT4mN0CAwEAAQ==\n",dn=["runtime","polyfills","vendor","main"];function gn(t,e,n){var r;t._&&ln(r=t._).call(r,(function(t){var r=t[0],i=t[1];if(Dt(r).call(r,".")){var o=r.split("."),a=o[0],s=o[1];if(!(a in e))return n.error("Failed to replay function call ".concat(r)),void n.error("".concat(a," does not exist on the object"));try{e[a][s].apply(e[a],i)}catch(t){n.error("Failed to replay function call ".concat(r),t)}}else try{e[r].apply(e,i)}catch(t){n.error("Failed to replay function call ".concat(r),t)}}))}function vn(t,e,n){ln(t).call(t,(function(t){var r;e[t]=Z(r=n[t]).call(r,n)}))}var mn=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},yn=W;function bn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),yn(t,r.key,r)}}var wn=function(t,e,n){return e&&bn(t.prototype,e),n&&bn(t,n),t};function kn(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function _n(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var c=a[t?s:++i];if(!1===n(o[c],c,o))break}return e}}var Sn=_n();var xn="object"==typeof global&&global&&global.Object===Object&&global,Tn="object"==typeof self&&self&&self.Object===Object&&self,En=xn||Tn||Function("return this")(),An=En.Symbol,On=Object.prototype,Cn=On.hasOwnProperty,jn=On.toString,Pn=An?An.toStringTag:void 0;var Ln=Object.prototype.toString;var In=An?An.toStringTag:void 0;function Bn(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":In&&In in Object(t)?function(t){var e=Cn.call(t,Pn),n=t[Pn];try{t[Pn]=void 0;var r=!0}catch(t){}var i=jn.call(t);return r&&(e?t[Pn]=n:delete t[Pn]),i}(t):function(t){return Ln.call(t)}(t)}function Dn(t){return null!=t&&"object"==typeof t}function Rn(t){return Dn(t)&&"[object Arguments]"==Bn(t)}var Mn=Object.prototype,zn=Mn.hasOwnProperty,Nn=Mn.propertyIsEnumerable,Fn=Rn(function(){return arguments}())?Rn:function(t){return Dn(t)&&zn.call(t,"callee")&&!Nn.call(t,"callee")},Un=Array.isArray;var qn="object"==typeof exports&&exports&&!exports.nodeType&&exports,Wn=qn&&"object"==typeof module&&module&&!module.nodeType&&module,Hn=Wn&&Wn.exports===qn?En.Buffer:void 0,Gn=(Hn?Hn.isBuffer:void 0)||function(){return!1},Vn=/^(?:0|[1-9]\d*)$/;function Kn(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Vn.test(t))&&t>-1&&t%1==0&&t<e}function Qn(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var $n={};function Jn(t){return function(e){return t(e)}}$n["[object Float32Array]"]=$n["[object Float64Array]"]=$n["[object Int8Array]"]=$n["[object Int16Array]"]=$n["[object Int32Array]"]=$n["[object Uint8Array]"]=$n["[object Uint8ClampedArray]"]=$n["[object Uint16Array]"]=$n["[object Uint32Array]"]=!0,$n["[object Arguments]"]=$n["[object Array]"]=$n["[object ArrayBuffer]"]=$n["[object Boolean]"]=$n["[object DataView]"]=$n["[object Date]"]=$n["[object Error]"]=$n["[object Function]"]=$n["[object Map]"]=$n["[object Number]"]=$n["[object Object]"]=$n["[object RegExp]"]=$n["[object Set]"]=$n["[object String]"]=$n["[object WeakMap]"]=!1;var Yn="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xn=Yn&&"object"==typeof module&&module&&!module.nodeType&&module,Zn=Xn&&Xn.exports===Yn&&xn.process,tr=function(){try{var t=Xn&&Xn.require&&Xn.require("util").types;return t||Zn&&Zn.binding&&Zn.binding("util")}catch(t){}}(),er=tr&&tr.isTypedArray,nr=er?Jn(er):function(t){return Dn(t)&&Qn(t.length)&&!!$n[Bn(t)]},rr=Object.prototype.hasOwnProperty;function ir(t,e){var n=Un(t),r=!n&&Fn(t),i=!n&&!r&&Gn(t),o=!n&&!r&&!i&&nr(t),a=n||r||i||o,s=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=s.length;for(var u in t)!e&&!rr.call(t,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Kn(u,c))||s.push(u);return s}var or=Object.prototype;function ar(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||or)}function sr(t,e){return function(n){return t(e(n))}}var cr=sr(Object.keys,Object),ur=Object.prototype.hasOwnProperty;function lr(t){if(!ar(t))return cr(t);var e=[];for(var n in Object(t))ur.call(t,n)&&"constructor"!=n&&e.push(n);return e}function hr(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function fr(t){if(!hr(t))return!1;var e=Bn(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function pr(t){return null!=t&&Qn(t.length)&&!fr(t)}function dr(t){return pr(t)?ir(t):lr(t)}function gr(t,e){return t&&Sn(t,e,dr)}function vr(t,e){return function(n,r){if(null==n)return n;if(!pr(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Object(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}var mr=vr(gr);function yr(t){return t}function br(t){return"function"==typeof t?t:yr}function wr(t,e){return(Un(t)?kn:mr)(t,br(e))}var kr,_r,Sr=function(t,e,n){var r=m(e);r in t?z.f(t,r,u(0,n)):t[r]=n},xr=me("navigator","userAgent")||"",Tr=r.process,Er=Tr&&Tr.versions,Ar=Er&&Er.v8;Ar?_r=(kr=Ar.split("."))[0]+kr[1]:xr&&(!(kr=xr.match(/Edge\/(\d+)/))||kr[1]>=74)&&(kr=xr.match(/Chrome\/(\d+)/))&&(_r=kr[1]);var Or=_r&&+_r,Cr=At("species"),jr=function(t){return Or>=51||!i((function(){var e=[];return(e.constructor={})[Cr]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Pr=At("isConcatSpreadable"),Lr=Or>=51||!i((function(){var t=[];return t[Pr]=!1,t.concat()[0]!==t})),Ir=jr("concat"),Br=function(t){if(!v(t))return!1;var e=t[Pr];return void 0!==e?!!e:Qe(t)};q({target:"Array",proto:!0,forced:!Lr||!Ir},{concat:function(t){var e,n,r,i,o,a=re(this),s=Je(a,0),c=0;for(e=-1,r=arguments.length;e<r;e++)if(Br(o=-1===e?a:arguments[e])){if(c+(i=it(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,c++)n in o&&Sr(s,c,o[n])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Sr(s,c++,o)}return s.length=c,s}});var Dr=$("Array").concat,Rr=Array.prototype,Mr=function(t){var e=t.concat;return t===Rr||t instanceof Array&&e===Rr.concat?Dr:e};function zr(t,e){return t===e||t!=t&&e!=e}function Nr(t,e){for(var n=t.length;n--;)if(zr(t[n][0],e))return n;return-1}var Fr=Array.prototype.splice;function Ur(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ur.prototype.clear=function(){this.__data__=[],this.size=0},Ur.prototype.delete=function(t){var e=this.__data__,n=Nr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Fr.call(e,n,1),--this.size,!0)},Ur.prototype.get=function(t){var e=this.__data__,n=Nr(e,t);return n<0?void 0:e[n][1]},Ur.prototype.has=function(t){return Nr(this.__data__,t)>-1},Ur.prototype.set=function(t,e){var n=this.__data__,r=Nr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var qr=En["__core-js_shared__"],Wr=function(){var t=/[^.]+$/.exec(qr&&qr.keys&&qr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Hr=Function.prototype.toString;function Gr(t){if(null!=t){try{return Hr.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var Vr=/^\[object .+?Constructor\]$/,Kr=Function.prototype,Qr=Object.prototype,$r=Kr.toString,Jr=Qr.hasOwnProperty,Yr=RegExp("^"+$r.call(Jr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Xr(t){return!(!hr(t)||(e=t,Wr&&Wr in e))&&(fr(t)?Yr:Vr).test(Gr(t));var e}function Zr(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Xr(n)?n:void 0}var ti=Zr(En,"Map"),ei=Zr(Object,"create");var ni=Object.prototype.hasOwnProperty;var ri=Object.prototype.hasOwnProperty;function ii(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function oi(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function ai(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ii.prototype.clear=function(){this.__data__=ei?ei(null):{},this.size=0},ii.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ii.prototype.get=function(t){var e=this.__data__;if(ei){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ni.call(e,t)?e[t]:void 0},ii.prototype.has=function(t){var e=this.__data__;return ei?void 0!==e[t]:ri.call(e,t)},ii.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ei&&void 0===e?"__lodash_hash_undefined__":e,this},ai.prototype.clear=function(){this.size=0,this.__data__={hash:new ii,map:new(ti||Ur),string:new ii}},ai.prototype.delete=function(t){var e=oi(this,t).delete(t);return this.size-=e?1:0,e},ai.prototype.get=function(t){return oi(this,t).get(t)},ai.prototype.has=function(t){return oi(this,t).has(t)},ai.prototype.set=function(t,e){var n=oi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function si(t){var e=this.__data__=new Ur(t);this.size=e.size}si.prototype.clear=function(){this.__data__=new Ur,this.size=0},si.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},si.prototype.get=function(t){return this.__data__.get(t)},si.prototype.has=function(t){return this.__data__.has(t)},si.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Ur){var r=n.__data__;if(!ti||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new ai(r)}return n.set(t,e),this.size=n.size,this};function ci(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new ai;++e<n;)this.add(t[e])}function ui(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function li(t,e){return t.has(e)}ci.prototype.add=ci.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},ci.prototype.has=function(t){return this.__data__.has(t)};function hi(t,e,n,r,i,o){var a=1&n,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;var u=o.get(t);if(u&&o.get(e))return u==e;var l=-1,h=!0,f=2&n?new ci:void 0;for(o.set(t,e),o.set(e,t);++l<s;){var p=t[l],d=e[l];if(r)var g=a?r(d,p,l,e,t,o):r(p,d,l,t,e,o);if(void 0!==g){if(g)continue;h=!1;break}if(f){if(!ui(e,(function(t,e){if(!li(f,e)&&(p===t||i(p,t,n,r,o)))return f.push(e)}))){h=!1;break}}else if(p!==d&&!i(p,d,n,r,o)){h=!1;break}}return o.delete(t),o.delete(e),h}var fi=En.Uint8Array;function pi(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function di(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var gi=An?An.prototype:void 0,vi=gi?gi.valueOf:void 0;function mi(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function yi(t,e,n){var r=e(t);return Un(t)?r:mi(r,n(t))}function bi(){return[]}var wi=Object.prototype.propertyIsEnumerable,ki=Object.getOwnPropertySymbols,_i=ki?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}(ki(t),(function(e){return wi.call(t,e)})))}:bi;function Si(t){return yi(t,dr,_i)}var xi=Object.prototype.hasOwnProperty;var Ti=Zr(En,"DataView"),Ei=Zr(En,"Promise"),Ai=Zr(En,"Set"),Oi=Zr(En,"WeakMap"),Ci=Gr(Ti),ji=Gr(ti),Pi=Gr(Ei),Li=Gr(Ai),Ii=Gr(Oi),Bi=Bn;(Ti&&"[object DataView]"!=Bi(new Ti(new ArrayBuffer(1)))||ti&&"[object Map]"!=Bi(new ti)||Ei&&"[object Promise]"!=Bi(Ei.resolve())||Ai&&"[object Set]"!=Bi(new Ai)||Oi&&"[object WeakMap]"!=Bi(new Oi))&&(Bi=function(t){var e=Bn(t),n="[object Object]"==e?t.constructor:void 0,r=n?Gr(n):"";if(r)switch(r){case Ci:return"[object DataView]";case ji:return"[object Map]";case Pi:return"[object Promise]";case Li:return"[object Set]";case Ii:return"[object WeakMap]"}return e});var Di=Bi,Ri=Object.prototype.hasOwnProperty;function Mi(t,e,n,r,i,o){var a=Un(t),s=Un(e),c=a?"[object Array]":Di(t),u=s?"[object Array]":Di(e),l="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),h="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f=c==u;if(f&&Gn(t)){if(!Gn(e))return!1;a=!0,l=!1}if(f&&!l)return o||(o=new si),a||nr(t)?hi(t,e,n,r,i,o):function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new fi(t),new fi(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return zr(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=pi;case"[object Set]":var c=1&r;if(s||(s=di),t.size!=e.size&&!c)return!1;var u=a.get(t);if(u)return u==e;r|=2,a.set(t,e);var l=hi(s(t),s(e),r,i,o,a);return a.delete(t),l;case"[object Symbol]":if(vi)return vi.call(t)==vi.call(e)}return!1}(t,e,c,n,r,i,o);if(!(1&n)){var p=l&&Ri.call(t,"__wrapped__"),d=h&&Ri.call(e,"__wrapped__");if(p||d){var g=p?t.value():t,v=d?e.value():e;return o||(o=new si),i(g,v,n,r,o)}}return!!f&&(o||(o=new si),function(t,e,n,r,i,o){var a=1&n,s=Si(t),c=s.length;if(c!=Si(e).length&&!a)return!1;for(var u=c;u--;){var l=s[u];if(!(a?l in e:xi.call(e,l)))return!1}var h=o.get(t);if(h&&o.get(e))return h==e;var f=!0;o.set(t,e),o.set(e,t);for(var p=a;++u<c;){var d=t[l=s[u]],g=e[l];if(r)var v=a?r(g,d,l,e,t,o):r(d,g,l,t,e,o);if(!(void 0===v?d===g||i(d,g,n,r,o):v)){f=!1;break}p||(p="constructor"==l)}if(f&&!p){var m=t.constructor,y=e.constructor;m==y||!("constructor"in t)||!("constructor"in e)||"function"==typeof m&&m instanceof m&&"function"==typeof y&&y instanceof y||(f=!1)}return o.delete(t),o.delete(e),f}(t,e,n,r,i,o))}function zi(t,e,n,r,i){return t===e||(null==t||null==e||!Dn(t)&&!Dn(e)?t!=t&&e!=e:Mi(t,e,n,r,zi,i))}function Ni(t){return t==t&&!hr(t)}function Fi(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}function Ui(t){var e=function(t){for(var e=dr(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ni(i)]}return e}(t);return 1==e.length&&e[0][2]?Fi(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,r){var i=n.length,o=i,a=!r;if(null==t)return!o;for(t=Object(t);i--;){var s=n[i];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<o;){var c=(s=n[i])[0],u=t[c],l=s[1];if(a&&s[2]){if(void 0===u&&!(c in t))return!1}else{var h=new si;if(r)var f=r(u,l,c,t,e,h);if(!(void 0===f?zi(l,u,3,r,h):f))return!1}}return!0}(n,t,e)}}function qi(t){return"symbol"==typeof t||Dn(t)&&"[object Symbol]"==Bn(t)}var Wi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hi=/^\w*$/;function Gi(t,e){if(Un(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!qi(t))||(Hi.test(t)||!Wi.test(t)||null!=e&&t in Object(e))}function Vi(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Vi.Cache||ai),n}Vi.Cache=ai;var Ki=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qi=/\\(\\)?/g,$i=function(t){var e=Vi(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ki,(function(t,n,r,i){e.push(r?i.replace(Qi,"$1"):n||t)})),e}));function Ji(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Yi=An?An.prototype:void 0,Xi=Yi?Yi.toString:void 0;function Zi(t){if("string"==typeof t)return t;if(Un(t))return Ji(t,Zi)+"";if(qi(t))return Xi?Xi.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function to(t){return null==t?"":Zi(t)}function eo(t,e){return Un(t)?t:Gi(t,e)?[t]:$i(to(t))}function no(t){if("string"==typeof t||qi(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function ro(t,e){for(var n=0,r=(e=eo(e,t)).length;null!=t&&n<r;)t=t[no(e[n++])];return n&&n==r?t:void 0}function io(t,e){return null!=t&&e in Object(t)}function oo(t,e){return null!=t&&function(t,e,n){for(var r=-1,i=(e=eo(e,t)).length,o=!1;++r<i;){var a=no(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&Qn(i)&&Kn(a,i)&&(Un(t)||Fn(t))}(t,e,io)}function ao(t,e){return Gi(t)&&Ni(e)?Fi(no(t),e):function(n){var r=function(t,e,n){var r=null==t?void 0:ro(t,e);return void 0===r?n:r}(n,t);return void 0===r&&r===e?oo(n,t):zi(e,r,3)}}function so(t){return Gi(t)?(e=no(t),function(t){return null==t?void 0:t[e]}):function(t){return function(e){return ro(e,t)}}(t);var e}function co(t){return"function"==typeof t?t:null==t?yr:"object"==typeof t?Un(t)?ao(t[0],t[1]):Ui(t):so(t)}function uo(t,e){return function(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}(t,co(e),gr)}var lo=function(){try{var t=Zr(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function ho(t,e,n){"__proto__"==e&&lo?lo(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function fo(t,e){var n={};return e=co(e),gr(t,(function(t,r,i){ho(n,r,e(t,r,i))})),n}var po=function(){function t(e){mn(this,t),this.cookies=e}return wn(t,[{key:"getAbTest",value:function(t,e){var n,r=Mr(n="".concat("__exponea_ab_")).call(n,t,"__"),i=this.cookies.getCookie(r);return i||(i=this._selectAbTestVariant(e)),this.cookies.setCookie(r,i,"ab_test"),i}},{key:"_selectAbTestVariant",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random(),n=0,r=fo(t,(function(t){return n+=t})),i=e*n;return uo(r,(function(t){return i<t}))}}]),t}(),go=jr("splice"),vo=pt("splice",{ACCESSORS:!0,0:0,1:2}),mo=Math.max,yo=Math.min;q({target:"Array",proto:!0,forced:!go||!vo},{splice:function(t,e){var n,r,i,o,a,s,c=re(this),u=it(c.length),l=st(t,u),h=arguments.length;if(0===h?n=r=0:1===h?(n=0,r=u-l):(n=h-2,r=yo(mo(nt(e),0),u-l)),u+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=Je(c,r),o=0;o<r;o++)(a=l+o)in c&&Sr(i,o,c[a]);if(i.length=r,n<r){for(o=l;o<u-r;o++)s=o+n,(a=o+r)in c?c[s]=c[a]:delete c[s];for(o=u;o>u-r+n;o--)delete c[o-1]}else if(n>r)for(o=u-r;o>l;o--)s=o+n-1,(a=o+r-1)in c?c[s]=c[a]:delete c[s];for(o=0;o<n;o++)c[o+l]=arguments[o+2];return c.length=u-r+n,i}});var bo=$("Array").splice,wo=Array.prototype,ko=function(t){var e=t.splice;return t===wo||t instanceof Array&&e===wo.splice?bo:e},_o=[],So=_o.sort,xo=i((function(){_o.sort(void 0)})),To=i((function(){_o.sort(null)})),Eo=tn("sort");q({target:"Array",proto:!0,forced:xo||!To||!Eo},{sort:function(t){return void 0===t?So.call(re(this)):So.call(re(this),B(t))}});var Ao=$("Array").sort,Oo=Array.prototype,Co=function(t){var e=t.sort;return t===Oo||t instanceof Array&&e===Oo.sort?Ao:e},jo=Ze.filter,Po=jr("filter"),Lo=pt("filter");q({target:"Array",proto:!0,forced:!Po||!Lo},{filter:function(t){return jo(this,t,arguments.length>1?arguments[1]:void 0)}});var Io=$("Array").filter,Bo=Array.prototype,Do=function(t){var e=t.filter;return t===Bo||t instanceof Array&&e===Bo.filter?Io:e},Ro=Ze.find,Mo=!0,zo=pt("find");"find"in[]&&Array(1).find((function(){Mo=!1})),q({target:"Array",proto:!0,forced:Mo||!zo},{find:function(t){return Ro(this,t,arguments.length>1?arguments[1]:void 0)}});var No=$("Array").find,Fo=Array.prototype,Uo=function(t){var e=t.find;return t===Fo||t instanceof Array&&e===Fo.find?No:e},qo=ut.indexOf,Wo=[].indexOf,Ho=!!Wo&&1/[1].indexOf(1,-0)<0,Go=tn("indexOf"),Vo=pt("indexOf",{ACCESSORS:!0,1:0});q({target:"Array",proto:!0,forced:Ho||!Go||!Vo},{indexOf:function(t){return Ho?Wo.apply(this,arguments)||0:qo(this,t,arguments.length>1?arguments[1]:void 0)}});var Ko=$("Array").indexOf,Qo=Array.prototype,$o=function(t){var e=t.indexOf;return t===Qo||t instanceof Array&&e===Qo.indexOf?Ko:e},Jo=$o,Yo=jr("slice"),Xo=pt("slice",{ACCESSORS:!0,0:0,1:2}),Zo=At("species"),ta=[].slice,ea=Math.max;q({target:"Array",proto:!0,forced:!Yo||!Xo},{slice:function(t,e){var n,r,i,o=g(this),a=it(o.length),s=st(t,a),c=st(void 0===e?a:e,a);if(Qe(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!Qe(n.prototype)?v(n)&&null===(n=n[Zo])&&(n=void 0):n=void 0,n===Array||void 0===n))return ta.call(o,s,c);for(r=new(void 0===n?Array:n)(ea(c-s,0)),i=0;s<c;s++,i++)s in o&&Sr(r,i,o[s]);return r.length=i,r}});var na=$("Array").slice,ra=Array.prototype,ia=function(t){var e=t.slice;return t===ra||t instanceof Array&&e===ra.slice?na:e},oa=ia,aa={f:At},sa=z.f,ca=function(t){var e=I.Symbol||(I.Symbol={});b(e,t)||sa(e,t,{value:aa.f(t)})};ca("iterator");var ua=function(t){return function(e,n){var r,i,o=String(d(e)),a=nt(n),s=o.length;return a<0||a>=s?t?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}},la={codeAt:ua(!1),charAt:ua(!0)}.charAt,ha=ne.set,fa=ne.getterFor("String Iterator");Ue(String,"String",(function(t){ha(this,{type:"String Iterator",string:String(t),index:0})}),(function(){var t,e=fa(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=la(n,r),e.index+=t.length,{value:t,done:!1})}));var pa=aa.f("iterator"),da=pe.concat("length","prototype"),ga={f:Object.getOwnPropertyNames||function(t){return fe(t,da)}},va=ga.f,ma={}.toString,ya="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ba={f:function(t){return ya&&"[object Window]"==ma.call(t)?function(t){try{return va(t)}catch(t){return ya.slice()}}(t):va(g(t))}},wa={f:Object.getOwnPropertySymbols},ka=Ze.forEach,_a=Gt("hidden"),Sa=At("toPrimitive"),xa=ne.set,Ta=ne.getterFor("Symbol"),Ea=Object.prototype,Aa=r.Symbol,Oa=me("JSON","stringify"),Ca=T.f,ja=z.f,Pa=ba.f,La=c.f,Ia=yt("symbols"),Ba=yt("op-symbols"),Da=yt("string-to-symbol-registry"),Ra=yt("symbol-to-string-registry"),Ma=yt("wks"),za=r.QObject,Na=!za||!za.prototype||!za.prototype.findChild,Fa=o&&i((function(){return 7!=Se(ja({},"a",{get:function(){return ja(this,"a",{value:7}).a}})).a}))?function(t,e,n){var r=Ca(Ea,e);r&&delete Ea[e],ja(t,e,n),r&&t!==Ea&&ja(Ea,e,r)}:ja,Ua=function(t,e){var n=Ia[t]=Se(Aa.prototype);return xa(n,{type:"Symbol",tag:t,description:e}),o||(n.description=e),n},qa=St?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Aa},Wa=function(t,e,n){t===Ea&&Wa(Ba,e,n),R(t);var r=m(e,!0);return R(n),b(Ia,r)?(n.enumerable?(b(t,_a)&&t[_a][r]&&(t[_a][r]=!1),n=Se(n,{enumerable:u(0,!1)})):(b(t,_a)||ja(t,_a,u(1,{})),t[_a][r]=!0),Fa(t,r,n)):ja(t,r,n)},Ha=function(t,e){R(t);var n=g(e),r=de(n).concat(Qa(n));return ka(r,(function(e){o&&!Ga.call(n,e)||Wa(t,e,n[e])})),t},Ga=function(t){var e=m(t,!0),n=La.call(this,e);return!(this===Ea&&b(Ia,e)&&!b(Ba,e))&&(!(n||!b(this,e)||!b(Ia,e)||b(this,_a)&&this[_a][e])||n)},Va=function(t,e){var n=g(t),r=m(e,!0);if(n!==Ea||!b(Ia,r)||b(Ba,r)){var i=Ca(n,r);return!i||!b(Ia,r)||b(n,_a)&&n[_a][r]||(i.enumerable=!0),i}},Ka=function(t){var e=Pa(g(t)),n=[];return ka(e,(function(t){b(Ia,t)||b(Vt,t)||n.push(t)})),n},Qa=function(t){var e=t===Ea,n=Pa(e?Ba:g(t)),r=[];return ka(n,(function(t){!b(Ia,t)||e&&!b(Ea,t)||r.push(Ia[t])})),r};if(_t||(Re((Aa=function(){if(this instanceof Aa)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=kt(t),n=function(t){this===Ea&&n.call(Ba,t),b(this,_a)&&b(this[_a],e)&&(this[_a][e]=!1),Fa(this,e,u(1,t))};return o&&Na&&Fa(Ea,e,{configurable:!0,set:n}),Ua(e,t)}).prototype,"toString",(function(){return Ta(this).tag})),Re(Aa,"withoutSetter",(function(t){return Ua(kt(t),t)})),c.f=Ga,z.f=Wa,T.f=Va,ga.f=ba.f=Ka,wa.f=Qa,aa.f=function(t){return Ua(At(t),t)},o&&ja(Aa.prototype,"description",{configurable:!0,get:function(){return Ta(this).description}})),q({global:!0,wrap:!0,forced:!_t,sham:!_t},{Symbol:Aa}),ka(de(Ma),(function(t){ca(t)})),q({target:"Symbol",stat:!0,forced:!_t},{for:function(t){var e=String(t);if(b(Da,e))return Da[e];var n=Aa(e);return Da[e]=n,Ra[n]=e,n},keyFor:function(t){if(!qa(t))throw TypeError(t+" is not a symbol");if(b(Ra,t))return Ra[t]},useSetter:function(){Na=!0},useSimple:function(){Na=!1}}),q({target:"Object",stat:!0,forced:!_t,sham:!o},{create:function(t,e){return void 0===e?Se(t):Ha(Se(t),e)},defineProperty:Wa,defineProperties:Ha,getOwnPropertyDescriptor:Va}),q({target:"Object",stat:!0,forced:!_t},{getOwnPropertyNames:Ka,getOwnPropertySymbols:Qa}),q({target:"Object",stat:!0,forced:i((function(){wa.f(1)}))},{getOwnPropertySymbols:function(t){return wa.f(re(t))}}),Oa){var $a=!_t||i((function(){var t=Aa();return"[null]"!=Oa([t])||"{}"!=Oa({a:t})||"{}"!=Oa(Object(t))}));q({target:"JSON",stat:!0,forced:$a},{stringify:function(t,e,n){for(var r,i=[t],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=e,(v(e)||void 0!==t)&&!qa(t))return Qe(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!qa(e))return e}),i[1]=e,Oa.apply(null,i)}})}Aa.prototype[Sa]||N(Aa.prototype,Sa,Aa.prototype.valueOf),Le(Aa,"Symbol"),Vt[_a]=!0,ca("asyncIterator"),ca("hasInstance"),ca("isConcatSpreadable"),ca("match"),ca("matchAll"),ca("replace"),ca("search"),ca("species"),ca("split"),ca("toPrimitive"),ca("toStringTag"),ca("unscopables"),Le(Math,"Math",!0),Le(r.JSON,"JSON",!0);var Ja=I.Symbol;ca("asyncDispose"),ca("dispose"),ca("observable"),ca("patternMatch"),ca("replaceAll");var Ya=Ja,Xa=e((function(t){function e(n){return t.exports=e="function"==typeof Ya&&"symbol"==typeof pa?function(t){return typeof t}:function(t){return t&&"function"==typeof Ya&&t.constructor===Ya&&t!==Ya.prototype?"symbol":typeof t},e(n)}t.exports=e})),Za=function(t){var e,n,r,i,o,a,s,c,u,l,h,f,p,d,g,v,m,y,b,w,k="sizzle"+-new Date,_=t.document,S=0,x=0,T=rt(),E=rt(),A=rt(),O=function(t,e){return t===e&&(f=!0),0},C={}.hasOwnProperty,j=[],P=j.pop,L=j.push,I=j.push,B=oa(j),D=Jo(j)||function(t){for(var e=0,n=this.length;e<n;e++)if(this[e]===t)return e;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",z="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+M+"*("+z+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+z+"))|)"+M+"*\\]",F=":("+z+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",U=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),q=new RegExp("^"+M+"*,"+M+"*"),W=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),H=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),G=new RegExp(F),V=new RegExp("^"+z+"$"),K={ID:new RegExp("^#("+z+")"),CLASS:new RegExp("^\\.("+z+")"),TAG:new RegExp("^("+z+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,$=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,Z=/'|\\/g,tt=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),et=function(t,e,n){var r="0x"+e-65536;return r!=r||n?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{I.apply(j=B.call(_.childNodes),_.childNodes),j[_.childNodes.length].nodeType}catch(t){I={apply:j.length?function(t,e){L.apply(t,B.call(e))}:function(t,e){for(var n=t.length,r=0;t[n++]=e[r++];);t.length=n-1}}}function nt(t,e,n,i){var o,a,c,l,h,f,g,y,b,S;if((e?e.ownerDocument||e:_)!==d&&p(e),n=n||[],!t||"string"!=typeof t)return n;if(1!==(l=(e=e||d).nodeType)&&9!==l)return[];if(v&&!i){if(o=Y.exec(t))if(c=o[1]){if(9===l){if(!(a=e.getElementById(c))||!a.parentNode)return n;if(a.id===c)return n.push(a),n}else if(e.ownerDocument&&(a=e.ownerDocument.getElementById(c))&&w(e,a)&&a.id===c)return n.push(a),n}else{if(o[2])return I.apply(n,e.getElementsByTagName(t)),n;if((c=o[3])&&r.getElementsByClassName)return I.apply(n,e.getElementsByClassName(c)),n}if(r.qsa&&(!m||!m.test(t))){if(y=g=k,b=e,S=9===l&&t,1===l&&"object"!==e.nodeName.toLowerCase()){for(f=s(t),(g=e.getAttribute("id"))?y=g.replace(Z,"\\$&"):e.setAttribute("id",y),y="[id='"+y+"'] ",h=f.length;h--;)f[h]=y+pt(f[h]);b=X.test(t)&&ht(e.parentNode)||e,S=f.join(",")}if(S)try{return I.apply(n,b.querySelectorAll(S)),n}catch(t){}finally{g||e.removeAttribute("id")}}}return u(t.replace(U,"$1"),e,n,i)}function rt(){var t=[];return function e(n,r){return t.push(n+" ")>i.cacheLength&&delete e[t.shift()],e[n+" "]=r}}function it(t){return t[k]=!0,t}function ot(t){var e=d.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function at(t,e){for(var n=t.split("|"),r=t.length;r--;)i.attrHandle[n[r]]=e}function st(t,e){var n=e&&t,r=n&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||1<<31)-(~t.sourceIndex||1<<31);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function ct(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ut(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function lt(t){return it((function(e){return e=+e,it((function(n,r){for(var i,o=t([],n.length,e),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))}))}))}function ht(t){return t&&"undefined"!==Xa(t.getElementsByTagName)&&t}for(n in r=nt.support={},a=nt.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},p=nt.setDocument=function(t){var e,n=t?t.ownerDocument||t:_,o=n.defaultView;return n!==d&&9===n.nodeType&&n.documentElement?(d=n,g=n.documentElement,v=!a(n),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",(function(){p()}),!1):o.attachEvent&&o.attachEvent("onunload",(function(){p()}))),r.attributes=ot((function(t){return t.className="i",!t.getAttribute("className")})),r.getElementsByTagName=ot((function(t){return t.appendChild(n.createComment("")),!t.getElementsByTagName("*").length})),r.getElementsByClassName=J.test(n.getElementsByClassName),r.getById=ot((function(t){return g.appendChild(t).id=k,!n.getElementsByName||!n.getElementsByName(k).length})),r.getById?(Uo(i).ID=function(t,e){if("undefined"!==Xa(e.getElementById)&&v){var n=e.getElementById(t);return n&&n.parentNode?[n]:[]}},Do(i).ID=function(t){var e=t.replace(tt,et);return function(t){return t.getAttribute("id")===e}}):(delete Uo(i).ID,Do(i).ID=function(t){var e=t.replace(tt,et);return function(t){var n="undefined"!==Xa(t.getAttributeNode)&&t.getAttributeNode("id");return n&&n.value===e}}),Uo(i).TAG=r.getElementsByTagName?function(t,e){if("undefined"!==Xa(e.getElementsByTagName))return e.getElementsByTagName(t)}:function(t,e){var n,r=[],i=0,o=e.getElementsByTagName(t);if("*"===t){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},Uo(i).CLASS=r.getElementsByClassName&&function(t,e){if(v)return e.getElementsByClassName(t)},y=[],m=[],(r.qsa=J.test(n.querySelectorAll))&&(ot((function(t){t.innerHTML="<select msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+M+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||m.push("\\["+M+"*(?:value|"+R+")"),t.querySelectorAll(":checked").length||m.push(":checked")})),ot((function(t){var e=n.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&m.push("name"+M+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),m.push(",.*:")}))),(r.matchesSelector=J.test(b=g.matches||g.webkitMatchesSelector||g.mozMatchesSelector||g.oMatchesSelector||g.msMatchesSelector))&&ot((function(t){r.disconnectedMatch=b.call(t,"div"),b.call(t,"[s!='']:x"),y.push("!=",F)})),m=m.length&&new RegExp(m.join("|")),y=y.length&&new RegExp(y.join("|")),e=J.test(g.compareDocumentPosition),w=e||J.test(g.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},O=e?function(t,e){if(t===e)return f=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!r.sortDetached&&e.compareDocumentPosition(t)===i?t===n||t.ownerDocument===_&&w(_,t)?-1:e===n||e.ownerDocument===_&&w(_,e)?1:h?D.call(h,t)-D.call(h,e):0:4&i?-1:1)}:function(t,e){if(t===e)return f=!0,0;var r,i=0,o=t.parentNode,a=e.parentNode,s=[t],c=[e];if(!o||!a)return t===n?-1:e===n?1:o?-1:a?1:h?D.call(h,t)-D.call(h,e):0;if(o===a)return st(t,e);for(r=t;r=r.parentNode;)s.unshift(r);for(r=e;r=r.parentNode;)c.unshift(r);for(;s[i]===c[i];)i++;return i?st(s[i],c[i]):s[i]===_?-1:c[i]===_?1:0},n):d},nt.matches=function(t,e){return nt(t,null,null,e)},nt.matchesSelector=function(t,e){if((t.ownerDocument||t)!==d&&p(t),e=e.replace(H,"='$1']"),r.matchesSelector&&v&&(!y||!y.test(e))&&(!m||!m.test(e)))try{var n=b.call(t,e);if(n||r.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return nt(e,d,null,[t]).length>0},nt.contains=function(t,e){return(t.ownerDocument||t)!==d&&p(t),w(t,e)},nt.attr=function(t,e){(t.ownerDocument||t)!==d&&p(t);var n=i.attrHandle[e.toLowerCase()],o=n&&C.call(i.attrHandle,e.toLowerCase())?n(t,e,!v):void 0;return void 0!==o?o:r.attributes||!v?t.getAttribute(e):(o=t.getAttributeNode(e))&&o.specified?o.value:null},nt.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},nt.uniqueSort=function(t){var e,n=[],i=0,o=0;if(f=!r.detectDuplicates,h=!r.sortStable&&oa(t).call(t,0),Co(t).call(t,O),f){for(;e=t[o++];)e===t[o]&&(i=n.push(o));for(;i--;)ko(t).call(t,n[i],1)}return h=null,t},o=nt.getText=function(t){var e,n="",r=0,i=t.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=o(t)}else if(3===i||4===i)return t.nodeValue}else for(;e=t[r++];)n+=o(e);return n},(i=nt.selectors={cacheLength:50,createPseudo:it,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(tt,et),t[3]=(t[3]||t[4]||t[5]||"").replace(tt,et),"~="===t[2]&&(t[3]=" "+t[3]+" "),oa(t).call(t,0,4)},CHILD:function(t){var e;return t[1]=t[1].toLowerCase(),"nth"===oa(e=t[1]).call(e,0,3)?(t[3]||nt.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&nt.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];if(K.CHILD.test(t[0]))return null;if(t[3])t[2]=t[4]||t[5]||"";else if(n&&G.test(n)&&(e=s(n,!0))&&(e=Jo(n).call(n,")",n.length-e)-n.length)){var r;t[0]=oa(r=t[0]).call(r,0,e),t[2]=oa(n).call(n,0,e)}return oa(t).call(t,0,3)}},filter:{TAG:function(t){var e=t.replace(tt,et).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=T[t+" "];return e||(e=new RegExp("(^|"+M+")"+t+"("+M+"|$)"))&&T(t,(function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!==Xa(t.getAttribute)&&t.getAttribute("class")||"")}))},ATTR:function(t,e,n){return function(r){var i,o=nt.attr(r,t);return null==o?"!="===e:!e||(o+="","="===e?o===n:"!="===e?o!==n:"^="===e?n&&0===Jo(o).call(o,n):"*="===e?n&&Jo(o).call(o,n)>-1:"$="===e?n&&oa(o).call(o,-n.length)===n:"~="===e?Jo(i=" "+o+" ").call(i,n)>-1:"|="===e&&(o===n||oa(o).call(o,0,n.length+1)===n+"-"))}},CHILD:function(t,e,n,r,i){var o="nth"!==oa(t).call(t,0,3),a="last"!==oa(t).call(t,-4),s="of-type"===e;return 1===r&&0===i?function(t){return!!t.parentNode}:function(e,n,c){var u,l,h,f,p,d,g=o!==a?"nextSibling":"previousSibling",v=e.parentNode,m=s&&e.nodeName.toLowerCase(),y=!c&&!s;if(v){if(o){for(;g;){for(h=e;h=h[g];)if(s?h.nodeName.toLowerCase()===m:1===h.nodeType)return!1;d=g="only"===t&&!d&&"nextSibling"}return!0}if(d=[a?v.firstChild:v.lastChild],a&&y){for(p=(u=(l=v[k]||(v[k]={}))[t]||[])[0]===S&&u[1],f=u[0]===S&&u[2],h=p&&v.childNodes[p];h=++p&&h&&h[g]||(f=p=0)||d.pop();)if(1===h.nodeType&&++f&&h===e){l[t]=[S,p,f];break}}else if(y&&(u=(e[k]||(e[k]={}))[t])&&u[0]===S)f=u[1];else for(;(h=++p&&h&&h[g]||(f=p=0)||d.pop())&&((s?h.nodeName.toLowerCase()!==m:1!==h.nodeType)||!++f||(y&&((h[k]||(h[k]={}))[t]=[S,f]),h!==e)););return(f-=i)===r||f%r==0&&f/r>=0}}},PSEUDO:function(t,e){var n,r=i.pseudos[t]||i.setFilters[t.toLowerCase()]||nt.error("unsupported pseudo: "+t);return r[k]?r(e):r.length>1?(n=[t,t,"",e],i.setFilters.hasOwnProperty(t.toLowerCase())?it((function(t,n){for(var i,o=r(t,e),a=o.length;a--;)t[i=D.call(t,o[a])]=!(n[i]=o[a])})):function(t){return r(t,0,n)}):r}},pseudos:{not:it((function(t){var e=[],n=[],r=c(t.replace(U,"$1"));return r[k]?it((function(t,e,n,i){for(var o,a=r(t,null,i,[]),s=t.length;s--;)(o=a[s])&&(t[s]=!(e[s]=o))})):function(t,i,o){return e[0]=t,r(e,null,o,n),!n.pop()}})),has:it((function(t){return function(e){return nt(t,e).length>0}})),contains:it((function(t){return t=t.replace(tt,et),function(e){var n;return Jo(n=e.textContent||e.innerText||o(e)).call(n,t)>-1}})),lang:it((function(t){return V.test(t||"")||nt.error("unsupported lang: "+t),t=t.replace(tt,et).toLowerCase(),function(e){var n;do{if(n=v?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(n=n.toLowerCase())===t||0===Jo(n).call(n,t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var n=t.location&&t.location.hash;return n&&oa(n).call(n,1)===e.id},root:function(t){return t===g},focus:function(t){return t===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!i.pseudos.empty(t)},header:function(t){return $.test(t.nodeName)},input:function(t){return Q.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:lt((function(){return[0]})),last:lt((function(t,e){return[e-1]})),eq:lt((function(t,e,n){return[n<0?n+e:n]})),even:lt((function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t})),odd:lt((function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t})),lt:lt((function(t,e,n){for(var r=n<0?n+e:n;--r>=0;)t.push(r);return t})),gt:lt((function(t,e,n){for(var r=n<0?n+e:n;++r<e;)t.push(r);return t}))}}).pseudos.nth=i.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=ct(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ut(n);function ft(){}function pt(t){for(var e=0,n=t.length,r="";e<n;e++)r+=t[e].value;return r}function dt(t,e,n){var r=e.dir,i=n&&"parentNode"===r,o=x++;return e.first?function(e,n,o){for(;e=e[r];)if(1===e.nodeType||i)return t(e,n,o)}:function(e,n,a){var s,c,u=[S,o];if(a){for(;e=e[r];)if((1===e.nodeType||i)&&t(e,n,a))return!0}else for(;e=e[r];)if(1===e.nodeType||i){if((s=(c=e[k]||(e[k]={}))[r])&&s[0]===S&&s[1]===o)return u[2]=s[2];if(c[r]=u,u[2]=t(e,n,a))return!0}}}function gt(t){return t.length>1?function(e,n,r){for(var i=t.length;i--;)if(!t[i](e,n,r))return!1;return!0}:t[0]}function vt(t,e,n,r,i){for(var o,a=[],s=0,c=t.length,u=null!=e;s<c;s++)(o=t[s])&&(n&&!n(o,r,i)||(a.push(o),u&&e.push(s)));return a}function mt(t,e,n,r,i,o){return r&&!r[k]&&(r=mt(r)),i&&!i[k]&&(i=mt(i,o)),it((function(o,a,s,c){var u,l,h,f=[],p=[],d=a.length,g=o||function(t,e,n){for(var r=0,i=e.length;r<i;r++)nt(t,e[r],n);return n}(e||"*",s.nodeType?[s]:s,[]),v=!t||!o&&e?g:vt(g,f,t,s,c),m=n?i||(o?t:d||r)?[]:a:v;if(n&&n(v,m,s,c),r)for(u=vt(m,p),r(u,[],s,c),l=u.length;l--;)(h=u[l])&&(m[p[l]]=!(v[p[l]]=h));if(o){if(i||t){if(i){for(u=[],l=m.length;l--;)(h=m[l])&&u.push(v[l]=h);i(null,m=[],u,c)}for(l=m.length;l--;)(h=m[l])&&(u=i?D.call(o,h):f[l])>-1&&(o[u]=!(a[u]=h))}}else m=vt(m===a?ko(m).call(m,d,m.length):m),i?i(null,a,m,c):I.apply(a,m)}))}function yt(t){for(var e,n,r,o=t.length,a=i.relative[t[0].type],s=a||i.relative[" "],c=a?1:0,u=dt((function(t){return t===e}),s,!0),h=dt((function(t){return D.call(e,t)>-1}),s,!0),f=[function(t,n,r){return!a&&(r||n!==l)||((e=n).nodeType?u(t,n,r):h(t,n,r))}];c<o;c++)if(n=i.relative[t[c].type])f=[dt(gt(f),n)];else{if((n=Do(i)[t[c].type].apply(null,t[c].matches))[k]){var p;for(r=++c;r<o&&!i.relative[t[r].type];r++);return mt(c>1&&gt(f),c>1&&pt(Mr(p=oa(t).call(t,0,c-1)).call(p,{value:" "===t[c-2].type?"*":""})).replace(U,"$1"),n,c<r&&yt(oa(t).call(t,c,r)),r<o&&yt(t=oa(t).call(t,r)),r<o&&pt(t))}f.push(n)}return gt(f)}return ft.prototype=i.filters=i.pseudos,i.setFilters=new ft,s=nt.tokenize=function(t,e){var n,r,o,a,s,c,u,l,h=E[t+" "];if(h)return e?0:oa(h).call(h,0);for(c=t,u=[],l=i.preFilter;c;){for(s in r&&!(o=q.exec(c))||(o&&(c=oa(c).call(c,o[0].length)||c),u.push(a=[])),r=!1,(o=W.exec(c))&&(r=o.shift(),a.push({value:r,type:o[0].replace(U," ")}),c=oa(c).call(c,r.length)),Do(i))!(o=K[s].exec(c))||l[s]&&!(o=l[s](o))||(r=o.shift(),a.push({value:r,type:s,matches:o}),c=oa(c).call(c,r.length));if(!r)break}return e?c.length:c?nt.error(t):oa(n=E(t,u)).call(n,0)},c=nt.compile=function(t,e){var n,r=[],o=[],a=A[t+" "];if(!a){for(e||(e=s(t)),n=e.length;n--;)(a=yt(e[n]))[k]?r.push(a):o.push(a);(a=A(t,function(t,e){var n=e.length>0,r=t.length>0,o=function(o,a,s,c,u){var h,f,p,g=0,v="0",m=o&&[],y=[],b=l,w=o||r&&Uo(i).TAG("*",u),k=S+=null==b?1:Math.random()||.1,_=w.length;for(u&&(l=a!==d&&a);v!==_&&null!=(h=w[v]);v++){if(r&&h){for(f=0;p=t[f++];)if(p(h,a,s)){c.push(h);break}u&&(S=k)}n&&((h=!p&&h)&&g--,o&&m.push(h))}if(g+=v,n&&v!==g){for(f=0;p=e[f++];)p(m,y,a,s);if(o){if(g>0)for(;v--;)m[v]||y[v]||(y[v]=P.call(c));y=vt(y)}I.apply(c,y),u&&!o&&y.length>0&&g+e.length>1&&nt.uniqueSort(c)}return u&&(S=k,l=b),m};return n?it(o):o}(o,r))).selector=t}return a},u=nt.select=function(t,e,n,o){var a,u,l,h,f,p="function"==typeof t&&t,d=!o&&s(t=p.selector||t);if(n=n||[],1===d.length){var g;if((u=d[0]=oa(g=d[0]).call(g,0)).length>2&&"ID"===(l=u[0]).type&&r.getById&&9===e.nodeType&&v&&i.relative[u[1].type]){if(!(e=(Uo(i).ID(l.matches[0].replace(tt,et),e)||[])[0]))return n;p&&(e=e.parentNode),t=oa(t).call(t,u.shift().value.length)}for(a=K.needsContext.test(t)?0:u.length;a--&&(l=u[a],!i.relative[h=l.type]);)if((f=Uo(i)[h])&&(o=f(l.matches[0].replace(tt,et),X.test(u[0].type)&&ht(e.parentNode)||e))){if(ko(u).call(u,a,1),!(t=o.length&&pt(u)))return I.apply(n,o),n;break}}return(p||c(t,d))(o,e,!v,n,X.test(t)&&ht(e.parentNode)||e),n},r.sortStable=Co(e=k.split("")).call(e,O).join("")===k,r.detectDuplicates=!!f,p(),r.sortDetached=ot((function(t){return 1&t.compareDocumentPosition(d.createElement("div"))})),ot((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||at("type|href|height|width",(function(t,e,n){if(!n)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),r.attributes&&ot((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||at("value",(function(t,e,n){if(!n&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),ot((function(t){return null==t.getAttribute("disabled")}))||at(R,(function(t,e,n){var r;if(!n)return!0===t[e]?e.toLowerCase():(r=t.getAttributeNode(e))&&r.specified?r.value:null})),nt}(window),ts=function(){function t(e,n){mn(this,t),this.tracing=e,this.documentContentLoaded=n}return wn(t,[{key:"materializeValue",value:function(t,e){if("constant"===t.type)return t.value;try{var n,r;if("target"===(r="string"==typeof t.selector?{selector:t.selector,type:"css"}:t.selector).type){if(null==e)return null;n=[e]}else if("target_css"===r.type){if(null==e)return null;n=Za(r.selector,e)}else n=Za(r.selector);if(0===n.length)return null;var i=this._fetchRawValueFromElementList(t,n);return this._applyValueConverter(i,t.converter)}catch(t){if(!(t instanceof Error))throw t}return null}},{key:"materializeProperties",value:function(t,e,n){var r=this;this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((function(){var i={};ln(t).call(t,(function(t){var n=t.key,o=t.value;i[n]=r.materializeValue(o,e)})),n(i)}))}},{key:"materializeIds",value:function(t,e,n){var r=this;this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((function(){if("anonymous"===t.type)n({});else if("registered"===t.type){var i=r.materializeValue(t.id,e);n(null===i?{}:{registered:i})}}))}},{key:"_fetchRawValueFromElementList",value:function(t,e){var n=e[0];return n instanceof Element?"from_html"===t.type?n.innerHTML:"value"===t.attribute&&n instanceof HTMLInputElement?""!==n.value?n.value:null:n.getAttribute(t.attribute):null}},{key:"_applyValueConverter",value:function(t,e){return t&&e&&"replace"===e.type?t.replace(new RegExp(e.regex,"gm"),e.replace):t}}]),t}(),es=me("JSON","stringify"),ns=/[\uD800-\uDFFF]/g,rs=/^[\uD800-\uDBFF]$/,is=/^[\uDC00-\uDFFF]$/,os=function(t,e,n){var r=n.charAt(e-1),i=n.charAt(e+1);return rs.test(t)&&!is.test(i)||is.test(t)&&!rs.test(r)?"\\u"+t.charCodeAt(0).toString(16):t},as=i((function(){return'"\\udf06\\ud834"'!==es("\udf06\ud834")||'"\\udead"'!==es("\udead")}));es&&q({target:"JSON",stat:!0,forced:as},{stringify:function(t,e,n){var r=es.apply(null,arguments);return"string"==typeof r?r.replace(ns,os):r}}),I.JSON||(I.JSON={stringify:JSON.stringify});var ss=function(t,e,n){return I.JSON.stringify.apply(null,arguments)};q({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}});var cs=I.Date.now,us=e((function(t){var e=function(t){var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new S(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return T()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(t,n,a),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};d[i]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(x([])));v&&v!==e&&n.call(v,i)&&(d=v);var m=p.prototype=h.prototype=Object.create(d);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function x(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=m.constructor=p,p.constructor=f,f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},y(b.prototype),b.prototype[o]=function(){return this},t.AsyncIterator=b,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new b(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(m),s(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=x,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),_(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;_(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:x(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}})),ls=$("Array").keys,hs=Array.prototype,fs={DOMTokenList:!0,NodeList:!0},ps=function(t){var e=t.keys;return t===hs||t instanceof Array&&e===hs.keys||fs.hasOwnProperty(Oe(t))?ls:e};q({target:"Array",stat:!0},{isArray:Qe});var ds=I.Array.isArray,gs=ds;var vs=function(t){if(gs(t))return t},ms=At("iterator"),ys=function(t){if(null!=t)return t[ms]||t["@@iterator"]||Rt[Oe(t)]},bs=function(t){var e=ys(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return R(e.call(t))},ws=bs,ks=At("iterator"),_s=function(t){var e=Object(t);return void 0!==e[ks]||"@@iterator"in e||Rt.hasOwnProperty(Oe(e))};var Ss=function(t,e){if(void 0!==Ya&&_s(Object(t))){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=ws(t);!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}},xs=function(t,e,n,r){try{return r?e(R(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&R(i.call(t)),e}},Ts=At("iterator"),Es=Array.prototype,As=function(t){return void 0!==t&&(Rt.Array===t||Es[Ts]===t)},Os=At("iterator"),Cs=!1;try{var js=0,Ps={next:function(){return{done:!!js++}},return:function(){Cs=!0}};Ps[Os]=function(){return this},Array.from(Ps,(function(){throw 2}))}catch(t){}var Ls=function(t,e){if(!e&&!Cs)return!1;var n=!1;try{var r={};r[Os]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},Is=!Ls((function(t){Array.from(t)}));q({target:"Array",stat:!0,forced:Is},{from:function(t){var e,n,r,i,o,a,s=re(t),c="function"==typeof this?this:Array,u=arguments.length,l=u>1?arguments[1]:void 0,h=void 0!==l,f=ys(s),p=0;if(h&&(l=D(l,u>2?arguments[2]:void 0,2)),null==f||c==Array&&As(f))for(n=new c(e=it(s.length));e>p;p++)a=h?l(s[p],p):s[p],Sr(n,p,a);else for(o=(i=f.call(s)).next,n=new c;!(r=o.call(i)).done;p++)a=h?xs(i,l,[r.value,p],!0):r.value,Sr(n,p,a);return n.length=p,n}});var Bs=I.Array.from,Ds=Bs,Rs=ia;var Ms=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r};var zs=function(t,e){var n;if(t){if("string"==typeof t)return Ms(t,e);var r=Rs(n=Object.prototype.toString.call(t)).call(n,8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Ds(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ms(t,e):void 0}};var Ns=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var Fs,Us=function(t,e){return vs(t)||Ss(t,e)||zs(t,e)||Ns()},qs="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Ws="["+qs+"]",Hs=RegExp("^"+Ws+Ws+"*"),Gs=RegExp(Ws+Ws+"*$"),Vs=function(t){return function(e){var n=String(d(e));return 1&t&&(n=n.replace(Hs,"")),2&t&&(n=n.replace(Gs,"")),n}},Ks={start:Vs(1),end:Vs(2),trim:Vs(3)},Qs=Ks.trim;q({target:"String",proto:!0,forced:(Fs="trim",i((function(){return!!qs[Fs]()||"âÂá "!="âÂá "[Fs]()||qs[Fs].name!==Fs})))},{trim:function(){return Qs(this)}});var $s,Js,Ys,Xs=$("String").trim,Zs=String.prototype,tc=function(t){var e=t.trim;return"string"==typeof t||t===Zs||t instanceof String&&e===Zs.trim?Xs:e},ec=r.Promise,nc=function(t,e,n){for(var r in e)n&&n.unsafe&&t[r]?t[r]=e[r]:Re(t,r,e[r],n);return t},rc=At("species"),ic=function(t){var e=me(t),n=z.f;o&&e&&!e[rc]&&n(e,rc,{configurable:!0,get:function(){return this}})},oc=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t},ac=e((function(t){var e=function(t,e){this.stopped=t,this.result=e};(t.exports=function(t,n,r,i,o){var a,s,c,u,l,h,f,p=D(n,r,i?2:1);if(o)a=t;else{if("function"!=typeof(s=ys(t)))throw TypeError("Target is not iterable");if(As(s)){for(c=0,u=it(t.length);u>c;c++)if((l=i?p(R(f=t[c])[0],f[1]):p(t[c]))&&l instanceof e)return l;return new e(!1)}a=s.call(t)}for(h=a.next;!(f=h.call(a)).done;)if("object"==typeof(l=xs(a,p,f.value,i))&&l&&l instanceof e)return l;return new e(!1)}).stop=function(t){return new e(!0,t)}})),sc=At("species"),cc=function(t,e){var n,r=R(t).constructor;return void 0===r||null==(n=R(r)[sc])?e:B(n)},uc=/(iphone|ipod|ipad).*applewebkit/i.test(xr),lc=r.location,hc=r.setImmediate,fc=r.clearImmediate,pc=r.process,dc=r.MessageChannel,gc=r.Dispatch,vc=0,mc={},yc=function(t){if(mc.hasOwnProperty(t)){var e=mc[t];delete mc[t],e()}},bc=function(t){return function(){yc(t)}},wc=function(t){yc(t.data)},kc=function(t){r.postMessage(t+"",lc.protocol+"//"+lc.host)};hc&&fc||(hc=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return mc[++vc]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},$s(vc),vc},fc=function(t){delete mc[t]},"process"==h(pc)?$s=function(t){pc.nextTick(bc(t))}:gc&&gc.now?$s=function(t){gc.now(bc(t))}:dc&&!uc?(Ys=(Js=new dc).port2,Js.port1.onmessage=wc,$s=D(Ys.postMessage,Ys,1)):!r.addEventListener||"function"!=typeof postMessage||r.importScripts||i(kc)||"file:"===lc.protocol?$s="onreadystatechange"in _("script")?function(t){ye.appendChild(_("script")).onreadystatechange=function(){ye.removeChild(this),yc(t)}}:function(t){setTimeout(bc(t),0)}:($s=kc,r.addEventListener("message",wc,!1)));var _c,Sc,xc,Tc,Ec,Ac,Oc,Cc,jc={set:hc,clear:fc},Pc=T.f,Lc=jc.set,Ic=r.MutationObserver||r.WebKitMutationObserver,Bc=r.process,Dc=r.Promise,Rc="process"==h(Bc),Mc=Pc(r,"queueMicrotask"),zc=Mc&&Mc.value;zc||(_c=function(){var t,e;for(Rc&&(t=Bc.domain)&&t.exit();Sc;){e=Sc.fn,Sc=Sc.next;try{e()}catch(t){throw Sc?Tc():xc=void 0,t}}xc=void 0,t&&t.enter()},Rc?Tc=function(){Bc.nextTick(_c)}:Ic&&!uc?(Ec=!0,Ac=document.createTextNode(""),new Ic(_c).observe(Ac,{characterData:!0}),Tc=function(){Ac.data=Ec=!Ec}):Dc&&Dc.resolve?(Oc=Dc.resolve(void 0),Cc=Oc.then,Tc=function(){Cc.call(Oc,_c)}):Tc=function(){Lc.call(r,_c)});var Nc,Fc,Uc,qc=zc||function(t){var e={fn:t,next:void 0};xc&&(xc.next=e),Sc||(Sc=e,Tc()),xc=e},Wc=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=B(e),this.reject=B(n)},Hc={f:function(t){return new Wc(t)}},Gc=function(t,e){if(R(t),v(e)&&e.constructor===t)return e;var n=Hc.f(t);return(0,n.resolve)(e),n.promise},Vc=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Kc=jc.set,Qc=At("species"),$c="Promise",Jc=ne.get,Yc=ne.set,Xc=ne.getterFor($c),Zc=ec,tu=r.TypeError,eu=r.document,nu=r.process,ru=(me("fetch"),Hc.f),iu=ru,ou="process"==h(nu),au=!!(eu&&eu.createEvent&&r.dispatchEvent),su=L($c,(function(){if(!(Ut(Zc)!==String(Zc))){if(66===Or)return!0;if(!ou&&"function"!=typeof PromiseRejectionEvent)return!0}if(!Zc.prototype.finally)return!0;if(Or>=51&&/native code/.test(Zc))return!1;var t=Zc.resolve(1),e=function(t){t((function(){}),(function(){}))};return(t.constructor={})[Qc]=e,!(t.then((function(){}))instanceof e)})),cu=su||!Ls((function(t){Zc.all(t).catch((function(){}))})),uu=function(t){var e;return!(!v(t)||"function"!=typeof(e=t.then))&&e},lu=function(t,e,n){if(!e.notified){e.notified=!0;var r=e.reactions;qc((function(){for(var i=e.value,o=1==e.state,a=0;r.length>a;){var s,c,u,l=r[a++],h=o?l.ok:l.fail,f=l.resolve,p=l.reject,d=l.domain;try{h?(o||(2===e.rejection&&du(t,e),e.rejection=1),!0===h?s=i:(d&&d.enter(),s=h(i),d&&(d.exit(),u=!0)),s===l.promise?p(tu("Promise-chain cycle")):(c=uu(s))?c.call(s,f,p):f(s)):p(i)}catch(t){d&&!u&&d.exit(),p(t)}}e.reactions=[],e.notified=!1,n&&!e.rejection&&fu(t,e)}))}},hu=function(t,e,n){var i,o;au?((i=eu.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),r.dispatchEvent(i)):i={promise:e,reason:n},(o=r["on"+t])?o(i):"unhandledrejection"===t&&function(t,e){var n=r.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)},fu=function(t,e){Kc.call(r,(function(){var n,r=e.value;if(pu(e)&&(n=Vc((function(){ou?nu.emit("unhandledRejection",r,t):hu("unhandledrejection",t,r)})),e.rejection=ou||pu(e)?2:1,n.error))throw n.value}))},pu=function(t){return 1!==t.rejection&&!t.parent},du=function(t,e){Kc.call(r,(function(){ou?nu.emit("rejectionHandled",t):hu("rejectionhandled",t,e.value)}))},gu=function(t,e,n,r){return function(i){t(e,n,i,r)}},vu=function(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,lu(t,e,!0))},mu=function(t,e,n,r){if(!e.done){e.done=!0,r&&(e=r);try{if(t===n)throw tu("Promise can't be resolved itself");var i=uu(n);i?qc((function(){var r={done:!1};try{i.call(n,gu(mu,t,r,e),gu(vu,t,r,e))}catch(n){vu(t,r,n,e)}})):(e.value=n,e.state=1,lu(t,e,!1))}catch(n){vu(t,{done:!1},n,e)}}};su&&(Zc=function(t){oc(this,Zc,$c),B(t),Nc.call(this);var e=Jc(this);try{t(gu(mu,this,e),gu(vu,this,e))}catch(t){vu(this,e,t)}},(Nc=function(t){Yc(this,{type:$c,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=nc(Zc.prototype,{then:function(t,e){var n=Xc(this),r=ru(cc(this,Zc));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=ou?nu.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&lu(this,n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),Fc=function(){var t=new Nc,e=Jc(t);this.promise=t,this.resolve=gu(mu,t,e),this.reject=gu(vu,t,e)},Hc.f=ru=function(t){return t===Zc||t===Uc?new Fc(t):iu(t)}),q({global:!0,wrap:!0,forced:su},{Promise:Zc}),Le(Zc,$c,!1,!0),ic($c),Uc=me($c),q({target:$c,stat:!0,forced:su},{reject:function(t){var e=ru(this);return e.reject.call(void 0,t),e.promise}}),q({target:$c,stat:!0,forced:!0},{resolve:function(t){return Gc(this===Uc?Zc:this,t)}}),q({target:$c,stat:!0,forced:cu},{all:function(t){var e=this,n=ru(e),r=n.resolve,i=n.reject,o=Vc((function(){var n=B(e.resolve),o=[],a=0,s=1;ac(t,(function(t){var c=a++,u=!1;o.push(void 0),s++,n.call(e,t).then((function(t){u||(u=!0,o[c]=t,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(t){var e=this,n=ru(e),r=n.reject,i=Vc((function(){var i=B(e.resolve);ac(t,(function(t){i.call(e,t).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}}),q({target:"Promise",stat:!0},{allSettled:function(t){var e=this,n=Hc.f(e),r=n.resolve,i=n.reject,o=Vc((function(){var n=B(e.resolve),i=[],o=0,a=1;ac(t,(function(t){var s=o++,c=!1;i.push(void 0),a++,n.call(e,t).then((function(t){c||(c=!0,i[s]={status:"fulfilled",value:t},--a||r(i))}),(function(t){c||(c=!0,i[s]={status:"rejected",reason:t},--a||r(i))}))})),--a||r(i)}));return o.error&&i(o.value),n.promise}});var yu=!!ec&&i((function(){ec.prototype.finally.call({then:function(){}},(function(){}))}));q({target:"Promise",proto:!0,real:!0,forced:yu},{finally:function(t){var e=cc(this,me("Promise")),n="function"==typeof t;return this.then(n?function(n){return Gc(e,t()).then((function(){return n}))}:t,n?function(n){return Gc(e,t()).then((function(){throw n}))}:t)}});var bu=I.Promise,wu=ne.set,ku=ne.getterFor("AggregateError"),_u=function(t,e){var n=this;if(!(n instanceof _u))return new _u(t,e);De&&(n=De(new Error(e),se(n)));var r=[];return ac(t,r.push,r),o?wu(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==e&&N(n,"message",String(e)),n};_u.prototype=Se(Error.prototype,{constructor:u(5,_u),message:u(5,""),name:u(5,"AggregateError")}),o&&z.f(_u.prototype,"errors",{get:function(){return ku(this).errors},configurable:!0}),q({global:!0},{AggregateError:_u}),q({target:"Promise",stat:!0},{try:function(t){var e=Hc.f(this),n=Vc(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});q({target:"Promise",stat:!0},{any:function(t){var e=this,n=Hc.f(e),r=n.resolve,i=n.reject,o=Vc((function(){var n=B(e.resolve),o=[],a=0,s=1,c=!1;ac(t,(function(t){var u=a++,l=!1;o.push(void 0),s++,n.call(e,t).then((function(t){l||c||(c=!0,r(t))}),(function(t){l||c||(l=!0,o[u]=t,--s||i(new(me("AggregateError"))(o,"No one promise resolved")))}))})),--s||i(new(me("AggregateError"))(o,"No one promise resolved"))}));return o.error&&i(o.value),n.promise}});var Su=bu;function xu(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Su.resolve(c).then(r,i)}var Tu=function(t){return function(){var e=this,n=arguments;return new Su((function(r,i){var o=t.apply(e,n);function a(t){xu(o,r,i,a,s,"next",t)}function s(t){xu(o,r,i,a,s,"throw",t)}a(void 0)}))}},Eu=bu,Au=Object.prototype.hasOwnProperty;function Ou(t,e,n){var r=t[e];Au.call(t,e)&&zr(r,n)&&(void 0!==n||e in t)||ho(t,e,n)}function Cu(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=r?r(n[s],t[s],s,n,t):void 0;void 0===c&&(c=t[s]),i?ho(n,s,c):Ou(n,s,c)}return n}var ju=Object.prototype.hasOwnProperty;function Pu(t){if(!hr(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=ar(t),n=[];for(var r in t)("constructor"!=r||!e&&ju.call(t,r))&&n.push(r);return n}function Lu(t){return pr(t)?ir(t,!0):Pu(t)}var Iu="object"==typeof exports&&exports&&!exports.nodeType&&exports,Bu=Iu&&"object"==typeof module&&module&&!module.nodeType&&module,Du=Bu&&Bu.exports===Iu?En.Buffer:void 0,Ru=Du?Du.allocUnsafe:void 0;function Mu(t,e){if(e)return t.slice();var n=t.length,r=Ru?Ru(n):new t.constructor(n);return t.copy(r),r}function zu(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Nu=sr(Object.getPrototypeOf,Object),Fu=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)mi(e,_i(t)),t=Nu(t);return e}:bi;function Uu(t){return yi(t,Lu,Fu)}var qu=Object.prototype.hasOwnProperty;function Wu(t){var e=new t.constructor(t.byteLength);return new fi(e).set(new fi(t)),e}var Hu=/\w*$/;var Gu=An?An.prototype:void 0,Vu=Gu?Gu.valueOf:void 0;function Ku(t,e){var n=e?Wu(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Qu(t,e,n){var r,i,o=t.constructor;switch(e){case"[object ArrayBuffer]":return Wu(t);case"[object Boolean]":case"[object Date]":return new o(+t);case"[object DataView]":return function(t,e){var n=e?Wu(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ku(t,n);case"[object Map]":return new o;case"[object Number]":case"[object String]":return new o(t);case"[object RegExp]":return(i=new(r=t).constructor(r.source,Hu.exec(r))).lastIndex=r.lastIndex,i;case"[object Set]":return new o;case"[object Symbol]":return function(t){return Vu?Object(Vu.call(t)):{}}(t)}}var $u=Object.create,Ju=function(){function t(){}return function(e){if(!hr(e))return{};if($u)return $u(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function Yu(t){return"function"!=typeof t.constructor||ar(t)?{}:Ju(Nu(t))}var Xu=tr&&tr.isMap,Zu=Xu?Jn(Xu):function(t){return Dn(t)&&"[object Map]"==Di(t)};var tl=tr&&tr.isSet,el=tl?Jn(tl):function(t){return Dn(t)&&"[object Set]"==Di(t)},nl={};function rl(t,e,n,r,i,o){var a,s=1&e,c=2&e,u=4&e;if(n&&(a=i?n(t,r,i,o):n(t)),void 0!==a)return a;if(!hr(t))return t;var l=Un(t);if(l){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&qu.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!s)return zu(t,a)}else{var h=Di(t),f="[object Function]"==h||"[object GeneratorFunction]"==h;if(Gn(t))return Mu(t,s);if("[object Object]"==h||"[object Arguments]"==h||f&&!i){if(a=c||f?{}:Yu(t),!s)return c?function(t,e){return Cu(t,Fu(t),e)}(t,function(t,e){return t&&Cu(e,Lu(e),t)}(a,t)):function(t,e){return Cu(t,_i(t),e)}(t,function(t,e){return t&&Cu(e,dr(e),t)}(a,t))}else{if(!nl[h])return i?t:{};a=Qu(t,h,s)}}o||(o=new si);var p=o.get(t);if(p)return p;o.set(t,a),el(t)?t.forEach((function(r){a.add(rl(r,e,n,r,t,o))})):Zu(t)&&t.forEach((function(r,i){a.set(i,rl(r,e,n,i,t,o))}));var d=u?c?Uu:Si:c?keysIn:dr,g=l?void 0:d(t);return kn(g||t,(function(r,i){g&&(r=t[i=r]),Ou(a,i,rl(r,e,n,i,t,o))})),a}nl["[object Arguments]"]=nl["[object Array]"]=nl["[object ArrayBuffer]"]=nl["[object DataView]"]=nl["[object Boolean]"]=nl["[object Date]"]=nl["[object Float32Array]"]=nl["[object Float64Array]"]=nl["[object Int8Array]"]=nl["[object Int16Array]"]=nl["[object Int32Array]"]=nl["[object Map]"]=nl["[object Number]"]=nl["[object Object]"]=nl["[object RegExp]"]=nl["[object Set]"]=nl["[object String]"]=nl["[object Symbol]"]=nl["[object Uint8Array]"]=nl["[object Uint8ClampedArray]"]=nl["[object Uint16Array]"]=nl["[object Uint32Array]"]=!0,nl["[object Error]"]=nl["[object Function]"]=nl["[object WeakMap]"]=!1;function il(t){return rl(t,5)}var ol=i((function(){de(1)}));q({target:"Object",stat:!0,forced:ol},{keys:function(t){return de(re(t))}});var al,sl,cl=I.Object.keys,ul=cl;function ll(t){var e;ln(e=ul(t)).call(e,(function(e){switch(Xa(t[e])){case"object":t[e]&&ll(t[e]);break;case"function":t[e]=String(t[e])}}))}(sl=al||(al={})).str2ab8=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0,i=t.length;r<i;r++)n[r]=t.charCodeAt(r);return e},sl.str2ab16=function(t){for(var e=new ArrayBuffer(2*t.length),n=new Uint16Array(e),r=0,i=t.length;r<i;r++)n[r]=t.charCodeAt(r);return e};var hl,fl,pl,dl,gl,vl=Bs;function ml(t){var e;return oa(e="0"+t.toString(16)).call(e,-2)}function yl(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;if(t%2)throw new Error("The length of the random string should be an even number!");var n=e.crypto||e.msCrypto;if(n&&n.getRandomValues&&vl){var r=new Uint8Array(t/2);return n.getRandomValues(r),vl(r,ml).join("")}for(var i="",o=0;o<t/2;o++)i+=ml(Math.round(256*Math.random()));return i}function bl(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!n)return"Other";var i=!!t.opr&&!!t.opr.addons||!!t.opera||/ OPR\//.test(n),o=!!e.documentMode,a=!o&&!!t.StyleMedia;
// @cc_on!@
if(i)return/Mini/.test(n)?"Opera Mini":"Opera";if(a)return"Microsoft Edge";var s=/SAMSUNG|SGH-[I|N|T]|GT-[I|P|N]|SM-[N|P|T|Z|G]|SHV-E|SCH-[I|J|R|S]|SPH-L/i;return s.test(n)?"Samsung Browser":/Chrome/.test(n)?"Chrome":/Apple/.test(r)?/Mobile/.test(n)?"Mobile Safari":"Safari":/Android/.test(n)?"Android Mobile":/Konqueror/.test(n)?"Konqueror":/Firefox/.test(n)?"Firefox":/MSIE/.test(n)||/Trident/.test(n)?"Internet Explorer":/Gecko/.test(n)?"Mozilla":"Other"}function wl(t){if(!t)return"Other";var e={iPhone:"iPhone",iPad:"iPad",iPod:"iPod","Windows Phone":"Windows Phone",Android:"Android",BlackBerry:"(BlackBerry|BB10|PlayBook)"};for(var n in e){if(e.hasOwnProperty(n))if(new RegExp(e[n],"i").test(t))return n}return"Other"}function kl(t,e){return{os:(n=t.navigator.userAgent,n?/Windows/i.test(n)?/Phone/.test(n)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(n)?"iOS":/Android/.test(n)?"Android":/Mac/i.test(n)?"Mac OS X":/Linux/.test(n)?"Linux":"Other":"Other"),browser:bl(t,e,t.navigator.userAgent,t.navigator.vendor),device:wl(t.navigator.userAgent)};var n}function _l(t){return hr(t)&&fr(t.remove)}fl=hl||(hl={}),pl=function(){function t(e,n){var r=this;mn(this,t),this.window=e,this.debug=n,this.isInitialized=new Eu((function(t){r.resolveInitialization=t}))}var e,n,r;return wn(t,[{key:"initialize",value:(r=Tu(us.mark((function t(){var e,n,r,i,o=this;return us.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.window.crypto&&this.window.crypto.subtle){t.next=4;break}return this.debug.log("Crypto API is not available in this browser, browser extension communication is disabled"),this.resolveInitialization(!1),t.abrupt("return");case 4:return e=al.str2ab8(this.window.atob(tc(pn).call(pn))),n=this.window.crypto.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["wrapKey"]),r=this.window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),i=Eu.all([n,r]).then((function(t){var e=Us(t,2),n=e[0],r=e[1];return o.window.crypto.subtle.wrapKey("raw",r,n,{name:"RSA-OAEP"})})),this.keys=Eu.all([r,i]).then((function(t){var e=Us(t,2);return{aes:e[0],aesEncrypted:e[1]}})),n.catch((function(t){o.debug.error("Failed to import the encryption key used in BrowserExtension.Handler:",t)})),r.catch((function(t){o.debug.error("Failed to generate the encryption key used in BrowserExtension.Handler:",t)})),i.catch((function(t){o.debug.error("Failed to wrap the encryption key used in BrowserExtension.Handler:",t)})),t.next=14,ps(this).then((function(){return o.resolveInitialization(!0)}),(function(t){throw o.resolveInitialization(!1),t}));case 14:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"sendPayload",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"success"},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cs(),i=yl(32,this.window),o=this.sendMessage({type:"payload",id:i,timestamp:r,state:n,payload:t});return function(t){Tu(us.mark((function n(){return us.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o;case 2:return n.next=4,e.updateState(i,t);case 4:case"end":return n.stop()}}),n)})))()}}},{key:"updateState",value:(n=Tu(us.mark((function t(e,n){return us.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendMessage({type:"stateupdate",target:e,state:n});case 2:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"sendMessage",value:(e=Tu(us.mark((function t(e){var n,r,i,o,a,s,c;return us.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.isInitialized;case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:if(ps(this)){t.next=6;break}throw new Error("BrowserExtension.Handler's keys must be assigned when initialization is resolved!");case 6:return ll(n=il(e)),r=al.str2ab16(ss(n)),i=this.window.crypto.getRandomValues(new Uint8Array(16)).buffer,t.prev=10,t.next=13,ps(this);case 13:s=t.sent,o=s.aes,a=s.aesEncrypted,t.next=21;break;case 18:return t.prev=18,t.t0=t.catch(10),t.abrupt("return");case 21:return t.prev=21,t.next=24,this.window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,r);case 24:c=t.sent,t.next=31;break;case 27:return t.prev=27,t.t1=t.catch(21),this.debug.error("Failed to encrypt the data before sending it to the extension:",t.t1),t.abrupt("return");case 31:try{this.window.postMessage({data:c,key:a,iv:i,version:"webxp-js-client-message:v2"},"*")}catch(t){this.debug.error("Failed to send the encrypted data:",t)}case 32:case"end":return t.stop()}}),t,this,[[10,18],[21,27]])}))),function(t){return e.apply(this,arguments)})}]),t}(),fl.Handler=pl,function(t){t.Ids="system/ids",t.Time="system/time",t.Tracking="system/tracking",t.Clicks="campaigns/clicks",t.Customers="crm/customers",t.Events="crm/events",t.PushNotificationsVapidKey="system/push-notifications-vapid-key"}(dl||(dl={})),function(t){t.BannersShow="campaigns/banners/show",t.ExperimentsShow="campaigns/experiments/show",t.HtmlGet="campaigns/html/get",t.ManagedTagsShow="managed-tags/show",t.Recommendation="optimization/recommend/user",t.WebOptimization="webxp/projects/<project_id>/bundle"}(gl||(gl={}));var Sl=new RegExp("[?&]+".concat("xnpe_cmp","=([^&]*)"),"gi"),xl=function(){function t(e,n,r,i,o,a,s,c){mn(this,t),this.location=e,this.queue=n,this.config=r,this.timestamp=i,this.time=o,this.debug=a,this.window=s,this.document=c}return wn(t,[{key:"parseUrlAndTrackCampaignClick",value:function(){var t=this.getCampaignClickTokenFromUrl();t&&this.trackClickEventWithToken(t)}},{key:"getCampaignClickTokenFromUrl",value:function(){if(this.debug.log("Getting campaign click token from the URL"),this.location.search){var t=this.location.search.match(Sl);if(t)return t[0].split("=")[1]}return null}},{key:"trackClickEventWithToken",value:function(t){var e=this,n=this.timestamp.getTimestamp();this.debug.log("Tracking campaign click with token",t),this.queue.enqueue({name:dl.Clicks,prepareData:function(t){return{data:{company_id:e.config.getToken(),age:t-n,url:e.location.href,timestamp:e.time.isTimeInitialized()?e.timestamp.getTimestampWithOffset():void 0,properties:kl(e.window,e.document)}}}})}}]),t}(),Tl=!i((function(){return Object.isExtensible(Object.preventExtensions({}))})),El=e((function(t){var e=z.f,n=kt("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(t){e(t,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!v(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!b(t,n)){if(!i(t))return"F";if(!e)return"E";o(t)}return t[n].objectID},getWeakData:function(t,e){if(!b(t,n)){if(!i(t))return!0;if(!e)return!1;o(t)}return t[n].weakData},onFreeze:function(t){return Tl&&a.REQUIRED&&i(t)&&!b(t,n)&&o(t),t}};Vt[n]=!0})),Al=El.onFreeze,Ol=Object.freeze,Cl=i((function(){Ol(1)}));q({target:"Object",stat:!0,forced:Cl,sham:!Tl},{freeze:function(t){return Ol&&v(t)?Ol(Al(t)):t}});var jl=I.Object.freeze;function Pl(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var Ll=Math.max;var Il=lo?function(t,e){return lo(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:yr,Bl=Date.now;var Dl,Rl,Ml,zl=(Dl=Il,Rl=0,Ml=0,function(){var t=Bl(),e=16-(t-Ml);if(Ml=t,e>0){if(++Rl>=800)return arguments[0]}else Rl=0;return Dl.apply(void 0,arguments)});function Nl(t,e){return zl(function(t,e,n){return e=Ll(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=Ll(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),Pl(t,this,s)}}(t,e,yr),t+"")}function Fl(t,e,n){if(!hr(n))return!1;var r=typeof e;return!!("number"==r?pr(n)&&Kn(e,n.length):"string"==r&&e in n)&&zr(n[e],t)}var Ul=Object.prototype,ql=Ul.hasOwnProperty,Wl=Nl((function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&Fl(e[0],e[1],i)&&(r=1);++n<r;)for(var o=e[n],a=Lu(o),s=-1,c=a.length;++s<c;){var u=a[s],l=t[u];(void 0===l||zr(l,Ul[u])&&!ql.call(t,u))&&(t[u]=o[u])}return t}));function Hl(t,e,n){(void 0!==n&&!zr(t[e],n)||void 0===n&&!(e in t))&&ho(t,e,n)}var Gl=Function.prototype,Vl=Object.prototype,Kl=Gl.toString,Ql=Vl.hasOwnProperty,$l=Kl.call(Object);function Jl(t){if(!Dn(t)||"[object Object]"!=Bn(t))return!1;var e=Nu(t);if(null===e)return!0;var n=Ql.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Kl.call(n)==$l}function Yl(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function Xl(t,e,n,r,i,o,a){var s=Yl(t,n),c=Yl(e,n),u=a.get(c);if(u)Hl(t,n,u);else{var l,h=o?o(s,c,n+"",t,e,a):void 0,f=void 0===h;if(f){var p=Un(c),d=!p&&Gn(c),g=!p&&!d&&nr(c);h=c,p||d||g?Un(s)?h=s:Dn(l=s)&&pr(l)?h=zu(s):d?(f=!1,h=Mu(c,!0)):g?(f=!1,h=Ku(c,!0)):h=[]:Jl(c)||Fn(c)?(h=s,Fn(s)?h=function(t){return Cu(t,Lu(t))}(s):hr(s)&&!fr(s)||(h=Yu(c))):f=!1}f&&(a.set(c,h),i(h,c,r,o,a),a.delete(c)),Hl(t,n,h)}}function Zl(t,e,n,r,i){t!==e&&Sn(e,(function(o,a){if(i||(i=new si),hr(o))Xl(t,e,a,n,Zl,r,i);else{var s=r?r(Yl(t,a),o,a+"",t,e,i):void 0;void 0===s&&(s=o),Hl(t,a,s)}}),Lu)}function th(t,e,n,r,i,o){return hr(t)&&hr(e)&&(o.set(e,t),Zl(t,e,void 0,th,o),o.delete(e)),t}var eh,nh=(eh=function(t,e,n,r){Zl(t,e,n,r)},Nl((function(t,e){var n=-1,r=e.length,i=r>1?e[r-1]:void 0,o=r>2?e[2]:void 0;for(i=eh.length>3&&"function"==typeof i?(r--,i):void 0,o&&Fl(e[0],e[1],o)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var a=e[n];a&&eh(t,a,n,i)}return t}))),rh=Nl((function(t){return t.push(void 0,th),Pl(nh,void 0,t)})),ih=/^\s+|\s+$/g,oh=/^[-+]0x[0-9a-f]+$/i,ah=/^0b[01]+$/i,sh=/^0o[0-7]+$/i,ch=parseInt;function uh(t){if("number"==typeof t)return t;if(qi(t))return NaN;if(hr(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=hr(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(ih,"");var n=ah.test(t);return n||sh.test(t)?ch(t.slice(2),n?2:8):oh.test(t)?NaN:+t}function lh(t){var e=function(t){return t?(t=uh(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}(t),n=e%1;return e==e?n?e-n:e:0}function hh(t){return t!=t}function fh(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}function ph(t){return rl(t,4)}var dh=function(){return En.Date.now()},gh=Math.max,vh=Math.min;function mh(t,e,n){var r,i,o,a,s,c,u=0,l=!1,h=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=r,o=i;return r=i=void 0,u=e,a=t.apply(o,n)}function d(t){return u=t,s=setTimeout(v,e),l?p(t):a}function g(t){var n=t-c;return void 0===c||n>=e||n<0||h&&t-u>=o}function v(){var t=dh();if(g(t))return m(t);s=setTimeout(v,function(t){var n=e-(t-c);return h?vh(n,o-(t-u)):n}(t))}function m(t){return s=void 0,f&&r?p(t):(r=i=void 0,a)}function y(){var t=dh(),n=g(t);if(r=arguments,i=this,c=t,n){if(void 0===s)return d(c);if(h)return clearTimeout(s),s=setTimeout(v,e),p(c)}return void 0===s&&(s=setTimeout(v,e)),a}return e=uh(e)||0,hr(n)&&(l=!!n.leading,o=(h="maxWait"in n)?gh(uh(n.maxWait)||0,e):o,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=c=i=s=void 0},y.flush=function(){return void 0===s?a:m(dh())},y}function yh(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}var bh=_n(!0);var wh=vr((function(t,e){return t&&bh(t,e,dr)}),!0);function kh(t,e){return t&&gr(t,br(e))}function _h(t){return"string"==typeof t||!Un(t)&&Dn(t)&&"[object String]"==Bn(t)}function Sh(t){return null==t?[]:function(t,e){return Ji(e,(function(e){return t[e]}))}(t,dr(t))}var xh=Math.max;function Th(t,e,n,r){t=pr(t)?t:Sh(t),n=n&&!r?lh(n):0;var i=t.length;return n<0&&(n=xh(i+n,0)),_h(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&function(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):function(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}(t,hh,n)}(t,e,n)>-1}var Eh=tr&&tr.isDate,Ah=Eh?Jn(Eh):function(t){return Dn(t)&&"[object Date]"==Bn(t)},Oh=Object.prototype.hasOwnProperty;function Ch(t,e){var n;return mr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function jh(t,e){return t&&t.length?function(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?fh(t,r?0:o,r?o+1:i):fh(t,r?o+1:0,r?i:o)}(t,co(e)):[]}var Ph=jl({hide_class:"xnpe_async_hide",timeout:4e3,mode:"async"}),Lh=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};mn(this,t),this.options=t.DEFAULT_OPTIONS,this.database=e,this.logger=n,this.extendOptions(r)}return wn(t,[{key:"getOptions",value:function(){return this.options}},{key:"getToken",value:function(){if("string"!=typeof this.options.token)throw new Error("The token in config object is not set!");return this.options.token}},{key:"getNewExperimentsOptions",value:function(){var t=this.getOptions().new_experiments;return!!t&&(!0===t?Ph:Wl(t,Ph))}},{key:"getActivityHandlerOptions",value:function(){var t=this.getOptions().ping.activity;return"object"===Xa(t)?t:{click:!0,key:!0,scroll:!0,move:!0}}},{key:"extendOptions",value:function(t){void 0!==t.track_hash_changes&&this.logger.warn("Configuration option track_hash_changes is deprecated, use the spa_reloading.on_hash_change option instead"),this.options=rh({},t,this.options)}},{key:"setNewCustomerIds",value:function(t){this.options.customer=t}},{key:"isSpaReloadingEnabled",value:function(t){return!0===this.getOptions().spa_reloading||!1!==this.getOptions().spa_reloading[t]}},{key:"storeInIndexedDB",value:function(){if(!this.database.isSupported())return Eu.reject(new Error("Database is not supported!"));var t=il(this.getOptions());return ll(t),this.database.setItem("config",t)}}]),t}();Lh.DEFAULT_OPTIONS=jl({target:"//api.exponea.com",token:null,utm_always:!1,customer:{},ping:{enabled:!0,interval:120,activity:!1,properties:{}},lazy_merge:!1,track:{auto:!0,visits:!1,visits_query_params:["pers_position","pers_content"],activity:!1,unloads:!1,exits:!0,default_properties:{},google_analytics:!0},modify:{enabled:!0,overlay:!1,delay:500},cookies:{cross_subdomain:!0,retrieve_callback:null,expires:{tracking:94608e3,ab_test:94608e3,time:3600}},track_hash_changes:!0,transfer_identity:!0,error_reporting:"errors_only",debug:!1,utm_params:["utm_source","utm_medium","utm_campaign","utm_term","utm_content","gclid","campaign_id"],dependencies:{},webOptimization:!0,push:{safari:{websitePushID:null}},spa_reloading:!0,feature_flags:null,service_worker_path:"/service-worker.js"});var Ih=function(){function t(e,n){mn(this,t),this.config=e,this.http=n}return wn(t,[{key:"rewardBandit",value:function(t,e,n,r){var i,o=this.config.getOptions().target;this.http.post(Mr(i="".concat(o,"/")).call(i,"webxp/bandits/reward"),{reward_token:t,value:e},{credentials:"omit",responseType:"text"}).then((function(t){return t.body})).then(n,r)}}]),t}(),Bh=function(t){return function(e,n,r,i){B(n);var o=re(e),a=p(o),s=it(o.length),c=t?s-1:0,u=t?-1:1;if(r<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,t?c<0:s<=c)throw TypeError("Reduce of empty array with no initial value")}for(;t?c>=0:s>c;c+=u)c in a&&(i=n(i,a[c],c,o));return i}},Dh={left:Bh(!1),right:Bh(!0)}.left,Rh=tn("reduce"),Mh=pt("reduce",{1:0});q({target:"Array",proto:!0,forced:!Rh||!Mh},{reduce:function(t){return Dh(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var zh=$("Array").reduce,Nh=Array.prototype,Fh=function(t){var e=t.reduce;return t===Nh||t instanceof Array&&e===Nh.reduce?zh:e},Uh=Fh,qh=Ks.trim,Wh=r.parseFloat,Hh=1/Wh(qs+"-0")!=-1/0?function(t){var e=qh(String(t)),n=Wh(e);return 0===n&&"-"==e.charAt(0)?-0:n}:Wh;q({global:!0,forced:parseFloat!=Hh},{parseFloat:Hh});var Gh=I.parseFloat,Vh="".endsWith,Kh=Math.min,Qh=Pt("endsWith");q({target:"String",proto:!0,forced:!Qh},{endsWith:function(t){var e=String(d(this));Ct(t);var n=arguments.length>1?arguments[1]:void 0,r=it(e.length),i=void 0===n?r:Kh(it(n),r),o=String(t);return Vh?Vh.call(e,o,i):e.slice(i-o.length,i)===o}});var $h=$("String").endsWith,Jh=String.prototype,Yh=function(t){var e=t.endsWith;return"string"==typeof t||t===Jh||t instanceof String&&e===Jh.endsWith?$h:e},Xh="".startsWith,Zh=Math.min,tf=Pt("startsWith");q({target:"String",proto:!0,forced:!tf},{startsWith:function(t){var e=String(d(this));Ct(t);var n=it(Zh(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return Xh?Xh.call(e,r,n):e.slice(n,n+r.length)===r}});var ef=$("String").startsWith,nf=String.prototype,rf=function(t){var e=t.startsWith;return"string"==typeof t||t===nf||t instanceof String&&e===nf.startsWith?ef:e},of=Ze.map,af=jr("map"),sf=pt("map");q({target:"Array",proto:!0,forced:!af||!sf},{map:function(t){return of(this,t,arguments.length>1?arguments[1]:void 0)}});var cf,uf,lf,hf,ff,pf,df,gf,vf,mf,yf,bf=$("Array").map,wf=Array.prototype,kf=function(t){var e=t.map;return t===wf||t instanceof Array&&e===wf.map?bf:e};function _f(t){return function(n,r){try{var i,o=r.attribute.property,a=r.constraint.type,s=r.constraint.operator,c=r.constraint.operands;if(Jo(i=cf.whitelist).call(i,s)>-1)return function(t,e,n,r){var i=t[n];switch(r){case cf.isSet:return null!=i;case cf.isNotSet:return null==i;case cf.hasValue:var o;return Sf(e)?(null===(o=i)||void 0===o?void 0:o.length)>0:i+""!="";case cf.hasNoValue:var a;return Sf(e)?0===(null===(a=i)||void 0===a?void 0:a.length):i+""==""}return!1}(n,a,o,s);if(function(t){return"string"===t}(a))return function(t,n,r,i){var o;if(-1===Jo(o=uf.whitelist).call(o,r))return e(r,"string"),!1;var a,s=t[n]+"";switch(r){case uf.equals:return s===i[0].value;case uf.doesNotEqual:return s!==i[0].value;case uf.isIn:return a=kf(i).call(i,(function(t){return t.value})),Jo(a).call(a,s)>-1;case uf.isNotIn:return a=kf(i).call(i,(function(t){return t.value})),-1===Jo(a).call(a,s);case uf.contains:return Jo(s).call(s,i[0].value)>-1;case uf.doesNotContain:return-1===Jo(s).call(s,i[0].value);case rf(uf):return rf(s).call(s,i[0].value);case Yh(uf):return Yh(s).call(s,i[0].value)}return!1}(n,o,s,c);if(function(t){return"number"===t}(a))return function(t,n,r,i){var o;if(-1===Jo(o=lf.whitelist).call(o,r))return e(r,"number"),!1;var a=Gh(t[n]+""),s=Gh(i[0].value);switch(r){case lf.equalTo:return a===s;case lf.inBetween:return s<=a&&a<=Gh(i[1].value);case lf.lessThan:return a<s;case lf.greaterThan:return a>s}return!1}(n,o,s,c);if(function(t){return"boolean"===t}(a))return function(t,n,r,i){var o;if(-1===Jo(o=vf.whitelist).call(o,r))return e(r,"boolean"),!1;var a=t[n]+"",s=i.value+"";switch(r){case vf.is:return a===s}return!1}(n,o,s,r.constraint);(function(t){return"date"===t})(a)&&t.error("Contextual bandits: Date type is not supported."),Sf(a)&&t.error("Contextual bandits: List type is not supported.")}catch(e){t.debug("Event filter error:",e)}return!1};function e(e,n){t.error("Contextual Bandits: operation "+e+" not suported for type "+n+".")}}function Sf(t){return"list"===t}!function(t){var e=t.isSet="is set",n=t.isNotSet="is not set",r=t.hasValue="has value",i=t.hasNoValue="has no value";t.whitelist=[e,n,r,i]}(cf||(cf={})),function(t){var e=t.equals="equals",n=t.doesNotEqual="does not equal",r=t.isIn="in",i=t.isNotIn="not in",o=t.contains="contains",a=t.doesNotContain="does not contain",s=t.startsWith="starts with",c=t.endsWith="ends with";t.whitelist=[e,n,r,i,o,a,s,c]}(uf||(uf={})),hf=lf||(lf={}),ff=hf.equalTo="equal to",pf=hf.inBetween="in between",df=hf.lessThan="less than",gf=hf.greaterThan="greater than",hf.whitelist=[ff,pf,df,gf],mf=vf||(vf={}),yf=mf.is="is",mf.whitelist=[yf];var xf=function(){function t(e,n){mn(this,t),this.optimizationTargets=[],this.contextualBandit=e,this.debug=n,this.eventFilterMatcher=_f(this.debug)}return wn(t,[{key:"put",value:function(t,e,n,r){if(""===t)throw new Error("Event type can't be an empty string");if(""===n)throw new Error("Reward token can't be an empty string");this.optimizationTargets.push({eventType:t,eventFilters:e,rewardToken:n,rewardWeight:r})}},{key:"reward",value:function(t,e){var n,r=this,i=Uh(n=this.optimizationTargets).call(n,function(t,e,n){return function(r,i){var o;return i.eventType!==n?(r.remainingTargets.push(i),r):Uh(o=i.eventFilters).call(o,(function(n,r){return n&&e(t,r)}),!0)?(r.matchingTargets.push(i),r):(r.remainingTargets.push(i),r)}}(t,this.eventFilterMatcher,e),{matchingTargets:[],remainingTargets:[]}),o=i.matchingTargets,a=i.remainingTargets;ln(o).call(o,(function(t){r.contextualBandit.rewardBandit(t.rewardToken,t.rewardWeight)})),this.optimizationTargets=a}}]),t}();var Tf,Ef=function(t,e,n){return e in t?yn(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};function Af(t){if("number"!=typeof t)return t;var e=new Date;return new Date(e.getTime()+1e3*t)}!function(t){t[t.defer=0]="defer",t[t.immediate=1]="immediate"}(Tf||(Tf={}));var Of=function(){function t(e,n,r,i,o,a){mn(this,t),this.config=e,this.debug=n,this.logger=r,this.queue=i,this.location=o,this.document=a}return wn(t,[{key:"getCookie",value:function(t){for(var e=this.document.cookie?this.document.cookie.split("; "):[],n=0,r=e.length;n<r;n++){var i=e[n].split("="),o=i.shift();if(o){var a=decodeURIComponent(o),s=i.join("=");if(t===a)return this.parseCookieValue(s)}}}},{key:"setCookie",value:function(t,e,n){var r=this.config.getOptions().cookies.expires[n];r=Af(r);var i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.location.hostname;if(!t)return"";if(_h(t))return t;var n=e.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),r=n?n[0]:"";return r||""}(this.config.getOptions().cookies.cross_subdomain);this.document.cookie=[encodeURIComponent(t),"=",encodeURIComponent(e),"; expires="+r.toUTCString(),"; path=/",i?"; domain="+i:"","https:"===this.location.protocol?"; secure; samesite=none":"; samesite=lax"].join("")}},{key:"sendCustomerCookieToServer",value:function(t){var e=this;this.queue.enqueue({name:dl.Ids,isBlocking:!0,prepareData:function(){return Cf(e.config,{cookie:t})},processResponse:function(t){e.debug.log("received customer ids response",t);var n=t.data,r=n.cookie;e.debug.log("cookie received from server is "+r),e.setTrackingCookie(r),e.config.extendOptions({customer:n})}},{process:Tf.immediate})}},{key:"setTrackingCookie",value:function(t){this.setCookie("__exponea_etc__",t,"tracking")}},{key:"setFreshTrackingCookie",value:function(){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}));return this.setTrackingCookie(t),t}},{key:"sanitizeCookieOptions",value:function(){var t=this.config.getOptions().cookies.expires;function e(t,e,n,r,i){if(!("number"==typeof e&&e>0||Ah(e)&&e>new Date)){if("number"==typeof e)r.warn("When specifying the number of seconds for cookies.expires.".concat(t,", you have to use a positive number. ")+"You passed in '".concat(e,"'. ")+"The SDK will use the default value of ".concat(n,". Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options"));else if(Ah(e))r.warn("When specifying a Date for cookies.expires.".concat(t,", you have to use a date in the future. ")+"You passed in '".concat(e,"'. ")+"The SDK will use the default value of ".concat(n,". Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options"));else{var o;r.warn(Mr(o="You can only use a number or a Date object for cookies.expires.".concat(t,", not '")).call(o,Xa(e),"'. ")+"The SDK will use the default value of ".concat(n,". Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options"))}i.extendOptions({cookies:{expires:Ef({},t,n)}})}}hr(t)&&!Ah(t)||(t={tracking:t,ab_test:t,time:t},this.config.extendOptions({cookies:{expires:t}})),e("tracking",t.tracking,94608e3,this.logger,this.config),e("ab_test",t.ab_test,94608e3,this.logger,this.config),e("time",t.time,3600,this.logger,this.config)}},{key:"parseCookieValue",value:function(t){0===Jo(t).call(t,'"')&&(t=oa(t).call(t,1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(/\+/g," "))}catch(e){return this.debug.error("error while parsing cookie value, ignoring",e),t}}}]),t}();function Cf(t,e){var n=t.getOptions().cookies.expires,r=ph(t.getOptions().customer);return delete r.cookie,{data:{project_id:t.getToken(),cookie:e.cookie,tifc:e.tifc,customer:r,expires:Math.floor(Af(n.tracking).getTime()/1e3)}}}q({target:"Object",stat:!0,forced:!o,sham:!o},{defineProperties:ge});var jf=e((function(t){var e=I.Object,n=t.exports=function(t,n){return e.defineProperties(t,n)};e.defineProperties.sham&&(n.sham=!0)})),Pf=me("Reflect","ownKeys")||function(t){var e=ga.f(R(t)),n=wa.f;return n?e.concat(n(t)):e};q({target:"Object",stat:!0,sham:!o},{getOwnPropertyDescriptors:function(t){for(var e,n,r=g(t),i=T.f,o=Pf(r),a={},s=0;o.length>s;)void 0!==(n=i(r,e=o[s++]))&&Sr(a,e,n);return a}});var Lf=I.Object.getOwnPropertyDescriptors,If=T.f,Bf=i((function(){If(1)}));q({target:"Object",stat:!0,forced:!o||Bf,sham:!o},{getOwnPropertyDescriptor:function(t,e){return If(g(t),e)}});var Df=e((function(t){var e=I.Object,n=t.exports=function(t,n){return e.getOwnPropertyDescriptor(t,n)};e.getOwnPropertyDescriptor.sham&&(n.sham=!0)})),Rf=I.Object.getOwnPropertySymbols,Mf=Object.assign,zf=Object.defineProperty,Nf=!Mf||i((function(){if(o&&1!==Mf({b:1},Mf(zf({},"a",{enumerable:!0,get:function(){zf(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=Mf({},t)[n]||"abcdefghijklmnopqrst"!=de(Mf({},e)).join("")}))?function(t,e){for(var n=re(t),r=arguments.length,i=1,a=wa.f,s=c.f;r>i;)for(var u,l=p(arguments[i++]),h=a?de(l).concat(a(l)):de(l),f=h.length,d=0;f>d;)u=h[d++],o&&!s.call(l,u)||(n[u]=l[u]);return n}:Mf;q({target:"Object",stat:!0,forced:Object.assign!==Nf},{assign:Nf});var Ff=I.Object.assign,Uf=[].reverse,qf=[1,2];q({target:"Array",proto:!0,forced:String(qf)===String(qf.reverse())},{reverse:function(){return Qe(this)&&(this.length=this.length),Uf.call(this)}});var Wf=$("Array").reverse,Hf=Array.prototype,Gf=function(t){var e=t.reverse;return t===Hf||t instanceof Array&&e===Hf.reverse?Wf:e},Vf=Fh,Kf=cl,Qf=un;var $f=function(t,e,n,r,i){var o,a,s,c={};return Qf(o=Kf(r)).call(o,(function(t){c[t]=r[t]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Vf(a=Gf(s=Rs(n).call(n)).call(s)).call(a,(function(n,r){return r(t,e,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(yn(t,e,c),c=null),c},Jf=[].slice,Yf=/MSIE .\./.test(xr),Xf=function(t){return function(e,n){var r=arguments.length>2,i=r?Jf.call(arguments,2):void 0;return t(r?function(){("function"==typeof e?e:Function(e)).apply(this,i)}:e,n)}};q({global:!0,bind:!0,forced:Yf},{setTimeout:Xf(r.setTimeout),setInterval:Xf(r.setInterval)});var Zf=I.setTimeout;function tp(t){Zf(t)}var ep=function(t){if(gs(t))return Ms(t)};var np=function(t){if(void 0!==Ya&&_s(Object(t)))return Ds(t)};var rp=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var ip=function(t){return ep(t)||np(t)||zs(t)||rp()};function op(t,e,n){var r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.start();try{r=n(),e.end()}catch(n){if(e.setError(n),e.end(),!i)throw n;t.error(n)}return r}var ap,sp,cp,up,lp,hp=function t(){mn(this,t)},fp=new hp;function pp(t){return function(e,n,r){var i=r.value;return r.value=function(){var e,n,r,o=fp;"string"==typeof t||"object"===Xa(t)&&t instanceof hp?o=t:void 0!==t&&(t.operation&&(o=t.operation),t.onRoot&&(r=this.tracing._trace));var a=this.tracing.registerNewSpan(o,r),s=a.isChildOfTrace();return op(this.tracing.debug,a,(e=Z(i)).call.apply(e,Mr(n=[i,this]).call(n,ip(vl(arguments)))),s)},r}}function dp(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function gp(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=dp(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=dp(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}sp=ap||(ap={}),function(t){t[t.Waiting=0]="Waiting",t[t.Running=1]="Running",t[t.EndedSync=2]="EndedSync",t[t.EndedAsync=3]="EndedAsync"}(cp||(cp={})),sp.State=cp;var vp=jl({immediate:!1}),mp=(up=pp("EventTracker.track"),$f((lp=function(){function t(e,n,r,i,o,a,s,c,u,l,h,f,p){mn(this,t),this._defaultEventProperties={},this.eventTrackingListeners=[],this.tracing=e,this.config=n,this.contextualBanditEventFilter=r,this.time=i,this.timestamp=o,this.queue=a,this.debug=s,this.document=c,this.location=u,this.initializeState=l,this.window=h,this.url=f,this.browserExtension=p}return wn(t,[{key:"track",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r=Wl(r,vp);var i=gp(gp(gp({location:this.location.href},kl(this.window,this.document)),this._defaultEventProperties),n),o=this.timestamp.getTimestamp(),a=this.browserExtension.sendPayload({type:"event",eventType:t,eventProperties:i},{type:"pending"});this.tracing.tracePromise(this.initializeState.whenInitialized()).then((function(){e.contextualBanditEventFilter.reward(i,t),e.queue.enqueue({name:dl.Events,prepareData:function(n){var r=e.config.getOptions().customer;e.debug.log("Tracking event: "+t,i);var a={customer_ids:r,company_id:e.config.getToken(),type:t,age:n-o,properties:i};e.time.isTimeInitialized()&&(a.timestamp=e.timestamp.getTimestampWithOffset());try{e.triggerEventTrackingListeners(t,i)}catch(t){e.debug.error("Error triggering event tracking listeners",t)}return{data:a}},processResponse:function(t,e,n){tp((function(){var i,o;return null===(i=(o=r).successCallback)||void 0===i?void 0:i.call(o,t,e,n)})),a({type:"success"})},processError:function(t){tp((function(){var e,n;return null===(e=(n=r).errorCallback)||void 0===e?void 0:e.call(n,t)})),a({type:"error",error:String(t)})}},{process:r.immediate?Tf.immediate:Tf.defer})}))}},{key:"addUtmParamsToDefaultEventPropertiesIfEnabled",value:function(){var t=this.config.getOptions();if(t.utm_always){var e=t.utm_params?this.url.getParams(t.utm_params):{};this._addDefaultEventProperties(e)}}},{key:"addTrackDefaultPropertiesToDefaultEventPropertiesIfEnabled",value:function(){var t=this.config.getOptions();t.track&&t.track.default_properties&&this._addDefaultEventProperties(t.track.default_properties)}},{key:"_addDefaultEventProperties",value:function(t){Ff(this._defaultEventProperties,t)}},{key:"registerEventTrackingListener",value:function(t){this.eventTrackingListeners.push(t)}},{key:"trackPageVisitEventIfEnabled",value:function(){var t=this,e=this.config.getOptions().track;e&&e.visits&&(this.trackPageVisitEvent(),this.config.isSpaReloadingEnabled("visits")&&this.url.onChange("trackPageVisitOnUrlChange",(function(){t.trackPageVisitEvent()})))}},{key:"trackPageVisitEvent",value:function(){this.track("page_visit",gp({referrer:this.document.referrer,location:this.location.href,path:this.location.pathname},this.url.getParams(this.config.getOptions().track.visits_query_params)))}},{key:"triggerEventTrackingListeners",value:function(t,e){for(var n=0;n<this.eventTrackingListeners.length;n++)try{this.eventTrackingListeners[n](t,e)}catch(t){this.debug.error("Error when processing event listener ".concat(this.eventTrackingListeners[n].name||n),t)}}}]),t}()).prototype,"track",[up],Df(lp.prototype,"track"),lp.prototype),lp);function yp(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(r>10)throw new Error("Maximum number of retries reached while waiting for window.ga to appear "+"(already waited for ".concat(500*r,"ms). ")+"window.gtag is available but it does not appear to load window.ga anymore!");if(e.ga)return t.log("window.ga is available after ".concat(r," retries")),void e.ga(n);if(e.gtag)return t.log("window.gtag is available, trying ".concat(r," retry")),void e.setTimeout(Z(yp).call(yp,void 0,t,e,n,r+1),500);throw new Error("No window.ga nor window.gtag is available in waitForGoogleAnalyticsSdkToLoad!")}function bp(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function wp(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=bp(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=bp(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var kp=function(){function t(e,n,r,i,o,a,s,c){mn(this,t),this.tracing=e,this.config=n,this.queue=r,this.debug=i,this.initializeState=o,this.window=a,this.cookies=s,this.browserExtension=c}return wn(t,[{key:"requestCustomerIdsFromServer",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.queue.enqueue({name:dl.Ids,isBlocking:!0,prepareData:function(){return Cf(e.config,t)},processResponse:function(t){e.debug.log("received customer ids response",t);var r=t.data,i=r.cookie;e.debug.log("cookie received from server is "+i),e.cookies.setTrackingCookie(i),e.config.extendOptions({customer:r}),n(r)}},{first:!0})}},{key:"filterEmptyCustomerIds",value:function(t){var e={};for(var n in t)!t.hasOwnProperty(n)||null!==t[n]&&void 0!==t[n]&&""!==t[n]?e[n]=t[n]:this.debug.log("Removed empty customer id: "+n,t[n]);return e}},{key:"identifyCustomerWithGoogleAnalyticsId",value:function(){var t=this,e=this.config.getOptions();e.customer&&e.customer.google_analytics||e.track.google_analytics&&(!function(t){return"ga"in t||"gtag"in t}(this.window)?this.debug.warn("Missing Google Analytics SDK (window.ga and window.gtag are not defined). Either integrate Google Analytics with your website or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"):!function(t){return"ga"in t&&"function"!=typeof t.ga}(this.window)?yp(this.debug,this.window,(function(){if(!t.window.ga||!t.window.ga.getAll)throw new Error("window.ga is missing the getAll function");var n=t.window.ga.getAll();if(n){var r=function(t){var e,n=Uo(t).call(t,(function(t){var e;return null===(e=t.get)||void 0===e?void 0:e.call(t,"clientId")}));return null==n||null===(e=n.get)||void 0===e?void 0:e.call(n,"clientId")}(n);r&&(t.config.extendOptions({customer:wp(wp({},e.customer),{},{google_analytics:r})}),t.updateCustomer({}))}})):this.debug.warn("Incorrect Google Analytics SDK detected (window.ga is "+Xa(this.window.ga)+"). Are you using an old Google Analytics SDK? This is not supported in the SDK so Google Analytics integration will not work. Either upgrade the Google Analytics SDK or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"))}},{key:"updateCustomer",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.tracing.tracePromise(this.initializeState.whenInitialized()).then((function(){e.queue.enqueue({name:dl.Customers,prepareData:function(){var n=Ff({},t);return{data:{ids:e.config.getOptions().customer,company_id:e.config.getToken(),properties:n}}},processResponse:n,processError:r},{process:i?Tf.immediate:Tf.defer})}))}},{key:"identifyCustomer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];"string"!=typeof t&&"number"!=typeof t||(t={registered:t});var o=this.config.getOptions().customer,a=this.filterEmptyCustomerIds(t);a.cookie=o.cookie,o.google_analytics&&(a.google_analytics=o.google_analytics),this.debug.log("Identifying customer: ",a),this.browserExtension.sendPayload({type:"ids",ids:a}),this.config.extendOptions({customer:a}),this.updateCustomer(e,n,r,i)}}]),t}();function _p(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function Sp(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=_p(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=_p(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var xp=function(){function t(e,n){mn(this,t),this.window=e,this.logger=n,this.database.catch((function(){}))}return wn(t,[{key:"database",get:function(){var t=this;return this.isSupported()?(this.dbRequest||(this.dbRequest=function(t,e,n){var r=t.open("exponea",1);return r.onblocked=function(){e.warn("A new version of this page is ready. Please close all other tabs with this site open to update.")},r.onupgradeneeded=function(t){!function(t,e){var n=t.result;e.oldVersion<1&&n.createObjectStore("settings",{keyPath:"key"})}(r,t)},new Eu((function(t,e){r.onsuccess=function(){var e=r.result;e.onversionchange=function(){e.close()},e.onclose=function(){n()},t(e)},r.onerror=function(){e(r.error)}}))}(this.window.indexedDB,this.logger,(function(){return t.dbRequest=void 0}))),this.dbRequest):Eu.reject("IndexedDB is not supported, some features may be broken")}}]),wn(t,[{key:"setItem",value:function(t,e){return this.database.then((function(n){var r=Sp(Sp({},e),{},{key:t}),i=n.transaction("settings","readwrite").objectStore("settings").put(r);return new Eu((function(t,e){i.onsuccess=function(){return t()},i.onerror=function(){return e(i.error)}}))}))}},{key:"getItem",value:function(t){return this.database.then((function(e){var n=e.transaction("settings").objectStore("settings").get(t);return new Eu((function(t,e){n.onsuccess=function(){return t(n.result)},n.onerror=function(){e(n.error)}}))}))}},{key:"isSupported",value:function(){return void 0!==this.window.indexedDB}}]),t}();var Tp=function(){function t(e,n,r,i){mn(this,t),this.config=e,this.location=n,this.logger=r,this.storageUtils=i}return wn(t,[{key:"error",value:function(t){if("string"==typeof t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.print.apply(this,Mr(e=["error",t]).call(e,r))}else this.print("error",t)}},{key:"log",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.print.apply(this,Mr(e=["log",t]).call(e,r))}},{key:"warn",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.print.apply(this,Mr(e=["warn",t]).call(e,r))}},{key:"debug",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.print.apply(this,Mr(e=["debug",t]).call(e,r))}},{key:"canPrintMessages",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fn;return"production"!==e&&n||this.config.getOptions().debug||Dt(t=this.location.search).call(t,"".concat("exponea","_debug=true"))||!!this.storageUtils.readBooleanFromStorage("localStorage","".concat("exponea","_debug"))}},{key:"print",value:function(t){var e;if(this.canPrintMessages()){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.logger)[t].apply(e,ip(Do(r).call(r,(function(t){return void 0!==t}))))}}}]),t}(),Ep=ds,Ap=ys,Op=Ja;function Cp(t,e){var n;if(void 0===Op||null==Ap(t)){if(Ep(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return jp(t,e);var r=oa(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return vl(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jp(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=ws(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function jp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Pp=function(){function t(e,n){mn(this,t),this.DEFAULT_DEPENDENCIES={exp:"https://exp-framework.exponea.com/exp.js"},this.loadedDependencies={},this.config=e,this.tracing=n}return wn(t,[{key:"loadDependency",value:function(t){var e;e="[object Array]"===Object.prototype.toString.call(t)?t:[t];try{var n=this.getDependencyUrls(e);return this.getDependencyLoadingChain(n)}catch(t){return this.tracing.tracePromise(Eu.reject(t))}}},{key:"getDependencyUrls",value:function(t){var e,n=[],r=Cp(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=this.DEFAULT_DEPENDENCIES[i];if(this.options.dependencies&&this.options.dependencies[i]&&(o=this.options.dependencies[i]),!o)throw new Error("unknown dependency named '".concat(i,"'"));n.push(o)}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"getDependencyLoadingChain",value:function(t){var e,n=this,r=this.tracing.tracePromise(Eu.resolve()),i=Cp(t);try{var o=function(){var t=e.value;r=r.then((function(){return n.loadDependencyFromUrl(t)}))};for(i.s();!(e=i.n()).done;)o()}catch(t){i.e(t)}finally{i.f()}return r}},{key:"isDependencyPresent",value:function(t){return this.loadedDependencies[t]}},{key:"markDependencyAsPresent",value:function(t){this.loadedDependencies[t]=!0}},{key:"loadDependencyFromUrl",value:function(t){if(this.isDependencyPresent(t))return this.tracing.tracePromise(Eu.resolve());this.markDependencyAsPresent(t);var e=new Eu((function(e,n){var r=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.src=t;var o=!1;i.onload=i.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,e(),i.onload=i.onreadystatechange=null,r&&i.parentNode&&r.removeChild(i))},i.onerror=function(e){var r,i="message"in e?": ".concat(e.message):"";n(new Error(Mr(r="Loading of dependency '".concat(t,"' failed")).call(r,i)))},i.onabort=function(){n(new Error("Loading of dependency '".concat(t,"' was aborted")))},r.insertBefore(i,r.firstChild)}));return this.tracing.tracePromise(e)}},{key:"options",get:function(){return this.config.getOptions()}}]),t}();var Lp,Ip=function(){function t(e,n){mn(this,t),this.window=e,this.document=n}return wn(t,[{key:"whenLoaded",value:function(){var t=this;return this.loadedPromise||(this.loadedPromise=new Eu((function(e){return function(t,e,n){var r=!1,i=!0,o=e.documentElement,a="addEventListener"in e?"addEventListener":"attachEvent",s="removeEventListener"in e?"removeEventListener":"detachEvent",c="addEventListener"in e?"":"on";if("complete"===e.readyState)n.call(t,"lazy");else{if(e.createEventObject&&o.doScroll){try{i=!t.frameElement}catch(t){}i&&function e(){try{o.doScroll("left")}catch(t){return void Zf(e,50)}r=!0,n.call(t,"poll")}()}e[a](c+"DOMContentLoaded",u,!1),e[a](c+"readystatechange",u,!1),t[a](c+"load",u,!1)}function u(i){var o;if("readystatechange"!==i.type||"complete"===e.readyState){var a="load"===i.type?t:e;Z(o=a[s]).call(o,a)(c+i.type,u,!1),r||(r=!0,n.call(t,i.type))}}}(t.window,t.document,e)}))),this.loadedPromise}}]),t}();function Bp(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}!function(t){var e=["id","name","price","brand","category","variant","list","position"],n=["product_id","name","price","brand","category","variant","list","position"],r=["currencyCode"],i=["currency_code"],o=["id","name","brand","category","variant","price","quantity","coupon","position"],a=["product_id","name","brand","category","variant","price","quantity","coupon","position"],s=["id","affiliation","revenue","tax","shipping","coupon","list","step","option"],c=["transaction_id","affiliation","revenue","tax","shipping","coupon","list","step","option"],u=["id","name","creative","position"],l=["promo_id","name","creative","position"],h=function(){function t(e,n){mn(this,t),this.debug=e,this.eventTracker=n}return wn(t,[{key:"trackEnhancedEcommerce",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Jl(t)?("impressions"!==e&&"all"!==e||this.trackProductImpressions(t),"click"!==e&&"all"!==e||this.trackProductAction(t,"click","product_click"),"detail"!==e&&"all"!==e||this.trackProductAction(t,"detail","product_detail"),"add"!==e&&"all"!==e||this.trackProductAction(t,"add","product_add_to_cart"),"remove"!==e&&"all"!==e||this.trackProductAction(t,"remove","product_remove_from_cart"),"promoView"!==e&&"all"!==e||this.trackPromotionAction(t,"promoView","promo_impression"),"promoClick"!==e&&"all"!==e||this.trackPromotionAction(t,"promoClick","promo_click"),"checkout"!==e&&"all"!==e||this.trackCheckout(t),"checkout_option"!==e&&"all"!==e||this.trackCheckoutOption(t),"purchase"!==e&&"all"!==e||this.trackPurchase(t),"refund"!==e&&"all"!==e||this.trackRefund(t)):this.debug.error("Ecommerce parameter is not a plain object")}},{key:"trackProductImpressions",value:function(t){var r,i=this;t.impressions?ln(r=t.impressions).call(r,(function(r){var o={};p(o,t),f(o,r,e,n),i.trackEnhancedEcommerceEvent("product_impression",o)})):this.debug.warn("There are no impressions in the ecommerce object")}},{key:"trackProductAction",value:function(t,e,n){var r,i,s=this,c=t[e];if(c)if(c.products){var u=null!==(r=c.actionField)&&void 0!==r?r:{};ln(i=c.products).call(i,(function(e){var r={};p(r,t),d(r,u),f(r,e,o,a),s.trackEnhancedEcommerceEvent(n,r)}))}else this.debug.debug("".concat(e," in the ecommerce object does not have any products"));else this.debug.debug("".concat(e," not found in the ecommerce object"))}},{key:"trackPromotionAction",value:function(t,e,n){var r,i=this,o=t[e];o?o.promotions?ln(r=o.promotions).call(r,(function(e){var r={};p(r,t),f(r,e,u,l),i.trackEnhancedEcommerceEvent(n,r)})):this.debug.debug("".concat(e," in the ecommerce object does not have any promotions")):this.debug.debug("".concat(e," not found in the ecommerce object"))}},{key:"trackCheckout",value:function(t){var e;if(t.checkout){this.trackProductAction(t,"checkout","product_checkout");var n=null!==(e=t.checkout.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),this.trackEnhancedEcommerceEvent("checkout",r)}else this.debug.debug("There is no checkout in the ecommerce object")}},{key:"trackCheckoutOption",value:function(t){var e;if(t.checkout_option){var n=null!==(e=t.checkout_option.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),this.trackEnhancedEcommerceEvent("checkout_option",r)}else this.debug.debug("There is no checkout option in the ecommerce object")}},{key:"trackPurchase",value:function(t){var e;if(t.purchase){this.trackProductAction(t,"purchase","product_purchase");var n=null!==(e=t.purchase.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),this.trackEnhancedEcommerceEvent("transaction",r)}else this.debug.debug("There is no purchase in the ecommerce object")}},{key:"trackRefund",value:function(t){var e;if(t.refund){var n=null!==(e=t.refund.actionField)&&void 0!==e?e:{},r={};p(r,t),d(r,n),t.refund.products?(r.refund_type="partial",this.trackProductAction(t,"refund","product_refund")):r.refund_type="full",this.trackEnhancedEcommerceEvent("refund",r)}else this.debug.debug("There is no refund in the ecommerce object")}},{key:"trackEnhancedEcommerceEvent",value:function(t,e){this.eventTracker.track(t,function(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=Bp(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=Bp(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}({tracked_via:"eecommerce"},e))}}]),t}();function f(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;ln(n).call(n,(function(n,i){var o=r[i];e.hasOwnProperty(n)&&e[n]&&(t[o]=e[n])}))}function p(t,e){f(t,e,r,i)}function d(t,e){f(t,e,s,c)}t.Tracker=h}(Lp||(Lp={}));var Dp=function(){function t(){mn(this,t)}return wn(t,null,[{key:"matches",value:function(t,e){return!e.enabled||!(e.from_date&&e.from_date>t)&&!(e.to_date&&e.to_date<t)}}]),t}(),Rp=Np,Mp=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,zp=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i;function Np(t,e){return e||null===t||"object"!=typeof t||(e=t),t||"undefined"==typeof navigator||(t=navigator.userAgent),t&&t.headers&&"string"==typeof t.headers["user-agent"]&&(t=t.headers["user-agent"]),"string"==typeof t&&(e||(e={}),e.tablet?zp.test(t):Mp.test(t))}Np.isMobile=Rp;var Fp,Up,qp=function(){function t(){mn(this,t)}return wn(t,null,[{key:"matches",value:function(t,e){return!t||("mobile"===t.type?Rp(e):"desktop"!==t.type||!Rp(e))}}]),t}(),Wp=function(){function t(){mn(this,t)}return wn(t,null,[{key:"matches",value:function(t,e,n,r,i,o){if(!r||!n.isStorageAvailable("localStorage"))return!0;var a=o+i,s=e.getStoredTimestamp(a+"_last_show"),c=e.getStoredTimestamp(a+"_last_interaction"),u=t.getLastSessionStart();switch(r){case"only_once":return!s;case"until_visitor_interacts":return!c;case"once_per_visit":return!s||!u||s<u}return!0}}]),t}();function Hp(t,e,n){var r,i;return Mr(r=Mr(i="".concat(t)).call(i,n?" "+n:""," was filtered out by ")).call(r,e," filter")}function Gp(t,e){return function(n,r){return function(t,e,n,r){return function(i){var o=r(i);return o||e.log(Hp(t,n,"_id"in i?i._id:void 0),i),o}}(t,e,n,r)}}function Vp(){var t,e=!1;return{initialize:function(){},track:function(){},trackLink:function(){},identify:function(){},update:function(){},anonymize:function(){},loadDependency:Z(t=window.exponea.loadDependency).call(t,window.exponea),notifications:{isAvailable:function(t){return null==t||t(!0),!0},isSubscribed:function(t){return t(e,!1),e},subscribe:function(t){Zf((function(){e=!0,t(Up.Subscribed)}),500)},unsubscribe:function(t){Zf((function(){e=!1,t(Up.Unsubscribed)}),500)}}}}function Kp(t,e){var n;if(void 0===Op||null==Ap(t)){if(Ep(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return Qp(t,e);var r=oa(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return vl(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qp(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=ws(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Qp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t){t.WebLayer="Weblayer",t.Experiment="Experiment",t.ManagedTag="Managed tag"}(Fp||(Fp={})),function(t){t.Error="error",t.PermissionDenied="permission-denied",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.Default="default",t.Unsupported="unsupported"}(Up||(Up={}));var $p,Jp,Yp,Xp,Zp=function(){function t(){mn(this,t)}return wn(t,null,[{key:"matches",value:function(t,e){if("page"in e)return this.matchesURLFilter(t,e.page);if(e.exclude_pages){var n,r=Kp(e.exclude_pages);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(this.matchesURLFilter(t,i))return!1}}catch(t){r.e(t)}finally{r.f()}}if(e.include_pages){var o,a=Kp(e.include_pages);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(this.matchesURLFilter(t,s))return!0}}catch(t){a.e(t)}finally{a.f()}}return!1}},{key:"parseURL",value:function(t){var e,n,r,i,o,a,s,c={source:t},u=/^(.{1,5}?):\/\//;(e=u.exec(t))&&(c.protocol=e[1],t=t.replace(u,"")),r="//",n=to(n=t),i=null==i?0:(o=lh(i),a=0,s=n.length,o==o&&(void 0!==s&&(o=o<=s?o:s),void 0!==a&&(o=o>=a?o:a)),o),r=Zi(r),n.slice(i,i+r.length)==r&&(t=t.substr(2));var l=/(.*?)(\/|$)/;if(e=l.exec(t)){var h=e[1].split(":");""!==h[0]&&(c.host=h[0]),h.length>1&&(c.port=h[1]),t=t.replace(l,"/")}var f=/(.*?)(\?|$|#)/;(e=f.exec(t))&&(c.path=e[1],t=t.replace(f,e[2]));var p=/^\?(.*?)($|#)/;(e=p.exec(t))&&(c.query=e[1],t=t.replace(p,e[2]));if((e=/^#(.*)/.exec(t))&&(c.hash=e[1]),c.withoutHost=c.path,c.query&&(c.withoutHost+="?".concat(c.query)),c.hash&&(c.withoutHost+="#".concat(c.hash)),c.host){var d,g,v=c.port?":".concat(c.port):"";c.withoutProtocol=Mr(d=Mr(g="//".concat(c.host)).call(g,v)).call(d,c.withoutHost)}return c}},{key:"escapeRegex",value:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"wildcardToRegex",value:function(t){var e=("^"+this.escapeRegex(t)+"$").replace(new RegExp("\\\\\\*","g"),".*");return new RegExp(e)}},{key:"matchesExactURL",value:function(t,e){var n=this.parseURL(t),r=this.parseURL(e);return!(r.host||!r.withoutHost||!n.withoutHost||!n.withoutHost.match(this.wildcardToRegex(r.withoutHost)))||(!(r.protocol||!r.withoutProtocol||!n.withoutProtocol||!n.withoutProtocol.match(this.wildcardToRegex(r.withoutProtocol)))||!!n.source.match(this.wildcardToRegex(r.source)))}},{key:"matchesContainsURL",value:function(t,e){return Th(t,e)}},{key:"matchesRegexURL",value:function(t,e){try{var n=new RegExp(e);if(t.match(n))return!0;var r=this.parseURL(t);return!(!r.withoutProtocol||!r.withoutProtocol.match(n))||!(!r.withoutHost||!r.withoutHost.match(n))}catch(t){if(t instanceof Error)return!1;throw t}}},{key:"matchesURLFilter",value:function(t,e){return"any"===e.type||("exact"===e.type?this.matchesExactURL(t,e.url):"contains"===e.type?this.matchesContainsURL(t,e.url):"regex"===e.type&&this.matchesRegexURL(t,e.regex))}}]),t}();function td(t,e){var n;if(void 0===Op||null==Ap(t)){if(Ep(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return ed(t,e);var r=oa(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return vl(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ed(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=ws(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ed(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var nd=($p=pp("applyExperimentModificationsAndTrackEvent"),Jp=pp("revertExistingExperiments"),Yp=pp("applyExperiment"),$f((Xp=function(){function t(e,n,r,i,o,a,s,c,u,l,h,f,p,d){mn(this,t),this.applyingExperimentsInProgress=!1,this.experimentRevertFunctions=[],this.tracing=e,this.config=n,this.queue=r,this.timestamp=i,this.ping=o,this.modifications=a,this.experimentsEditor=s,this.tracker=c,this.location=u,this.debug=l,this.documentContentLoaded=h,this.storageUtils=f,this.newExperiments=p,this.url=d}return wn(t,[{key:"applyExperimentModificationsAndTrackEvent",value:function(t){var e,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{e=this.modifications.applyModifications(t)}catch(t){return this.debug.error("Error applying experiment",t),function(){}}return this.experimentRevertFunctions.push(e),n&&this.tracker.track("experiment",{action:"show",experiment_id:t.params.experiment_id,experiment_name:t.params.experiment_name,variant_id:t.params.variant_id,variant_name:t.params.variant_name,location:window.location.href,path:window.location.pathname}),e}},{key:"revertExistingExperiments",value:function(){var t,e=td(this.experimentRevertFunctions);try{for(e.s();!(t=e.n()).done;){var n=t.value;try{n()}catch(t){this.debug.error("Error from revert experiment script",t)}}}catch(t){e.e(t)}finally{e.f()}this.experimentRevertFunctions=[]}},{key:"applyExperiment",value:function(t){if(this.filterByCustomCondition(t)){this.debug.log("Applying experiment ".concat(t.params.experiment_id,"..."),t);var e=this.applyExperimentModificationsAndTrackEvent(t,!0);this.experimentRevertFunctions.push(e)}else this.debug.log(Hp(Fp.Experiment,t.params.experiment_id,"custom condition"))}},{key:"processDefinition",value:function(t){var e=this;this.newExperiments.areAlreadyApplied()?this.debug.log("Not applying experiments with the SDK because new_experiments are enabled."):(this.debug.log("Processing experiments...",t),this.filterAndApplyExperiments(t),this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeFilterAndApplyExperiments",(function(){return e.filterAndApplyExperiments(t)})))}},{key:"filterAndApplyExperiments",value:function(t){if(!this.applyingExperimentsInProgress){this.revertExistingExperiments();var e=this.filterExperimentsForCustomer(t);0!==e.length&&(this.applyingExperimentsInProgress=!0,this.queryAndApplyExperimentsModifications(e))}}},{key:"filterExperimentsForCustomer",value:function(t){var e,n,r,i=this,o=Gp(Fp.Experiment,this.debug);return Do(e=Do(n=Do(r=Do(t).call(t,o("page",(function(t){return Zp.matches(i.location.href,t.trigger)})))).call(r,o("date",(function(t){return Dp.matches(i.timestamp.getTimestamp(),t.date_filter)})))).call(n,o("device",(function(t){return qp.matches(t.device_target)})))).call(e,o("frequency",(function(t){return Wp.matches(i.ping,i.timestamp,i.storageUtils,t.frequency,t._id,"__exponea_experiment_event__")})))}},{key:"queryAndApplyExperimentsModifications",value:function(t){var e=this,n=kf(t).call(t,(function(t){return t._id})),r=ph(this.config.getOptions().customer);this.queue.enqueue({name:gl.ExperimentsShow,noBulk:!0,prepareData:function(){return e.debug.debug("Get filtered experiments by IDs",n),r&&r.cookie||(r=ph(e.config.getOptions().customer)),{data:{company_id:e.config.getToken(),customer_ids:r,personalisation_ids:n}}},processResponse:function(t){e.applyExperimentsModifications(t.data)},processError:function(){e.applyingExperimentsInProgress=!1}})}},{key:"applyExperimentsModifications",value:function(t){var e=this;this.debug.log("Applying experiments..."),this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((function(){ln(t).call(t,(function(t){e.applyExperiment(t)})),e.applyingExperimentsInProgress=!1}))}},{key:"filterByCustomCondition",value:function(t){if(!t.custom_condition||this.experimentsEditor.isEditorRunning())return!0;try{return!!this.setupCustomConditionScriptFunction(t.params,t.custom_condition)()}catch(e){return this.debug.error("Custom condition for experiment ".concat(t.params.experiment_id," threw an error"),e),!1}}},{key:"setupCustomConditionScriptFunction",value:function(t,e){var n,r={};r.inPreview=this.experimentsEditor.isEditorRunning(),r.sdk=r.inPreview?Vp():window.exponea,r.data=r.params=t;var i=e;i.length>0&&Jo(i).call(i,"\n")<0&&Jo(i).call(i,";")<0&&Jo(i).call(i,"return")<0&&(i="return "+i);var o=Z(n=new Function(i)).call(n,r);return o.context=r,o}}]),t}()).prototype,"applyExperimentModificationsAndTrackEvent",[$p],Df(Xp.prototype,"applyExperimentModificationsAndTrackEvent"),Xp.prototype),$f(Xp.prototype,"revertExistingExperiments",[Jp],Df(Xp.prototype,"revertExistingExperiments"),Xp.prototype),$f(Xp.prototype,"applyExperiment",[Yp],Df(Xp.prototype,"applyExperiment"),Xp.prototype),Xp),rd=function(){function t(e,n,r,i,o,a,s,c){mn(this,t),this.urlParamsMatch=null,this.urlParamsMatchBase64=null,this.http=e,this.config=n,this.location=r,this.document=i,this.history=o,this.window=a,this.debug=s,this.storageUtils=c}return wn(t,[{key:"matchUrlWithParams",value:function(){this.urlParamsMatch=this.location.href.match("(#|\\?)?exponea-editor-params=((%7B|{).*(%7D|}))"),this.urlParamsMatchBase64=this.location.href.match("(?:#|\\?)?exponea-editor-params=([a-zA-Z0-9-_=]+)")}},{key:"areEditorParamsInURL",value:function(){return!!this.urlParamsMatch||!!this.urlParamsMatchBase64}},{key:"placeParamsFromURLToStorage",value:function(){var t="";if(this.urlParamsMatch&&(t=decodeURIComponent(this.urlParamsMatch[2])),this.urlParamsMatchBase64){var e=this.urlParamsMatchBase64[1].replace(/-/g,"+").replace(/_/g,"/");t=atob(e)}t&&(this.storageUtils.writeToStorage("sessionStorage","exponea-editor-params",t)||this.debug.warn("The editor is not supported in this browser"))}},{key:"removeParamsFromURL",value:function(){var t="";this.urlParamsMatch&&(t=this.urlParamsMatch[0]),this.urlParamsMatchBase64&&(t=this.urlParamsMatchBase64[0]),t&&(this.history&&this.history.replaceState?this.history.replaceState(null,this.document.title,this.location.href.replace(t,"")):this.location.href=this.location.href.replace(t,""))}},{key:"shouldStartEditor",value:function(){return!!this.storageUtils.readStringFromStorage("sessionStorage","exponea-editor-params")}},{key:"bootstrapEditor",value:function(){var t,e=this;return this.isEditorRunning()?(this.debug.log("The editor is already running"),Eu.resolve()):Jo(t=this.location.host).call(t,"localhost")>=0?(this.debug.log("Auto-launching of the editor is disabled in development environments"),Eu.resolve()):this._waitForPageToLoad().then((function(){e._insertEditorLoadingElement();var t=e._insertEditorIframe();return e.http.get(e.config.getOptions().target+"/editor/index.html?timestamp="+(new Date).getTime(),{responseType:"text"}).then((function(t){return t.body})).then((function(n){if(t){var r,i=n.replace(/base\shref=".*"/,Mr(r='base href="'.concat(e.config.getOptions().target)).call(r,"/editor/",'"'));t.srcdoc=i}else e.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((function(){return e.http.get(e.config.getOptions().target+"/editor/version.txt?timestamp="+(new Date).getTime(),{responseType:"text"}).then((function(n){var r,i=tc(r=n.body).call(r);e.debug.log("Fetching editor version ".concat(i));var o=kf(dn).call(dn,(function(t){var n=e.config.getOptions().target+"/editor/"+i+"/".concat(t,".js");return'<script type="text/javascript" src="'.concat(n,'"><\/script>')})).join();t?t.srcdoc='<html><head><title>Exponea Web Optimization Editor</title><meta charset="utf-8"></head><body>'.concat(o,"</body></html>"):e.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((function(t){return e.debug.error("Failed to fetch the editor version",t)}))}))}))}},{key:"_waitForPageToLoad",value:function(){var t=this;return new Eu((function(e){t.document.body?e():t.window.addEventListener("load",(function(){return e()}))}))}},{key:"isEditorRunning",value:function(){return!!this.document.getElementById("exponea-experiments-editor")}},{key:"_insertEditorLoadingElement",value:function(){var t=this;this.debug.log("Inserting experiments editor loading element");var e=this.document.createElement("style");e.textContent=".exponea-loading-backdrop{margin:0;padding:0;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(87,91,154,.5);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:2147483642}.exponea-loading-icon{width:50px;height:50px;border:4px solid #ffd500;border-right-color:transparent;border-radius:50%;-webkit-animation:rotate .8s infinite linear;animation:rotate .8s infinite linear}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}";var n=this.document.createElement("div");n.innerHTML='<div class="exponea-loading-backdrop"><div class="exponea-loading-icon"></div></div>',this.document.head.appendChild(e),wr(n.childNodes,(function(e){return t.document.body.appendChild(e)}))}},{key:"_insertEditorIframe",value:function(){var t=this.document.createElement("div"),e=this.document.createElement("iframe");return t.id="exponea-experiments-editor",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.border="none",t.style.width="auto",t.style.height="auto",t.style.margin="0",t.style.padding="0",t.style.backgroundColor="transparent",t.style.zIndex="2147483647",e.src="about:blank",e.frameBorder="0",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="transparent",e.style.margin="0",e.style.padding="0",e.style.display="block",e.style.visibility="visible",this.document.body.appendChild(t),t.appendChild(e),e}}]),t}();function id(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function od(t,e){var n;if(void 0===Op||null==Ap(t)){if(Ep(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return ad(t,e);var r=oa(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return vl(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ad(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=ws(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ad(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var sd=function(){function t(e,n,r,i){mn(this,t),this.eventTracker=e,this.experimentsEditor=n,this.document=r,this.debug=i}return wn(t,[{key:"applyModifications",value:function(t){var e=[];t.modifications=t.modifications||[];var n,r=od(t.modifications);try{for(r.s();!(n=r.n()).done;){var i=n.value;switch(i.type){case"add":this._applyAddModification(i,e);break;case"remove":this._applyRemoveModification(i,e);break;case"change":this._applyChangeModification(i,e);break;case"run":this._applyRunModification(i,t.params,e);break;case"track":this._applyTrackModification(i,e);break;case"banner":this._applyBannerModification(i,t.params,e)}}}catch(t){r.e(t)}finally{r.f()}return function(){return function(t,e){return(Un(t)?yh:wh)(t,br(e))}(e,(function(t){return t()}))}}},{key:"_applyAddModification",value:function(t,e){var n=this,r=this.document.createElement("div");t.parametrized_parts?r.innerHTML=t.parametrized_parts.html:r.innerHTML=t.html;var i,o=oa([]).call(r.childNodes);try{i=this.document.querySelector(t.place_to.element)}catch(e){return void this.debug.warn("Invalid selector, ignoring the add modification",t.place_to.element)}if(i)switch(t.place_to.placement){case"before":wr(o,(function(r){var o;i.parentElement?(i.parentElement.insertBefore(r,i),e.push(Z(o=n._revertInsertElement).call(o,n,r))):n.debug.warn("Attempting to insert HTML before an element without a parent",t.place_to.element)}));break;case"after":wr(o,(function(r){var o;i.parentElement?(i.parentElement.insertBefore(r,i.nextSibling),e.push(Z(o=n._revertInsertElement).call(o,n,r))):n.debug.warn("Attempting to insert HTML after an element without a parent",t.place_to.element)}));break;case"prepend_child":wr(o,(function(t){var r;i.insertBefore(t,i.firstChild),e.push(Z(r=n._revertInsertElement).call(r,n,t))}));break;case"append_child":wr(o,(function(t){var r;i.appendChild(t),e.push(Z(r=n._revertInsertElement).call(r,n,t))}))}else this.debug.warn("No element matched the selector, ignoring the add modification",t.place_to.element)}},{key:"_applyRemoveModification",value:function(t,e){var n=this,r=[];try{var i=this.document.querySelectorAll(t.element);r=oa([]).call(i)}catch(e){return void this.debug.warn("Invalid selector, ignoring the remove modification",t.element)}0!==r.length?wr(r,(function(r){var i,o;switch(t.method){case"visibility":e.push(Z(i=n._revertHideElement).call(i,n,r)),r.style.visibility="hidden";break;case"display":e.push(Z(o=n._revertHideElement).call(o,n,r)),r.style.display="none";break;case"remove":var a;if(r.parentElement)e.push(Z(a=n._revertRemoveElement).call(a,n,r,r.parentElement,r.nextElementSibling)),r.parentElement.removeChild(r);else n.debug.warn("Attempting to remove an element without a parent",t.element)}})):this.debug.warn("The selector matched no elements, ignoring the remove modification",t.element)}},{key:"_applyChangeModification",value:function(t,e){var n=this,r=[];try{var i=this.document.querySelectorAll(t.element);r=oa([]).call(i)}catch(e){return void this.debug.warn("Invalid selector, ignoring the change modification",t.element)}if(0!==r.length){var o=[];if(t.place_to){try{var a=this.document.querySelectorAll(t.place_to.element);o=oa([]).call(a)}catch(e){return void this.debug.warn("Invalid container selector, ignoring the change modification",t.place_to.element)}if(0===o.length)return void this.debug.warn("The container selector matched no elements, ignoring the change modification",t.place_to.element);if(o.length!==r.length)return void this.debug.warn("The container selector matched a different number of elements then the source selector")}wr(r,(function(r,i){if(t.html){var a=n.document.createElement("div");a.innerHTML=t.html;var s,c=oa([]).call(a.childNodes),u=r.parentElement,l=r.nextElementSibling;if(u)wr(c,(function(t){var i;u.insertBefore(t,r),e.push(Z(i=n._revertInsertElement).call(i,n,t))})),u.removeChild(r),e.push(Z(s=n._revertRemoveElement).call(s,n,r,u,l));else n.debug.warn("Cannot replace an element's HTML without a parent",t.element)}if(t.text){var h,f=r.innerHTML;r.innerText=t.text,e.push(Z(h=n._revertTextChange).call(h,n,r,f))}if(t.place_to){var p,d=o[i];if(!r.parentElement)return void n.debug.warn("Attempting to move an element without a parent",t.element);switch(e.push(Z(p=n._revertRemoveElement).call(p,n,r,r.parentElement,r.nextElementSibling)),t.place_to.placement){case"before":d.parentElement?d.parentElement.insertBefore(r,d):n.debug.warn("Attempting to insert an element before a container without a parent",t.place_to.element);break;case"after":d.parentElement?d.parentElement.insertBefore(r,d.nextSibling):n.debug.warn("Attempting to insert an element after a container without a parent",t.place_to.element);break;case"prepend_child":d.insertBefore(r,d.firstChild);break;case"append_child":d.appendChild(r)}}t.attributes&&kh(t.attributes,(function(t,i){var o,a=r.getAttribute(i);a&&!r.getAttribute("data-original-".concat(i))&&r.setAttribute("data-original-".concat(i),a),r.setAttribute(i,t),e.push(Z(o=n._revertAttributeChange).call(o,n,r,i))})),t.style&&kh(t.style,(function(t,i){var o;r.style.setProperty(i,t,"important"),e.push(Z(o=n._revertStyleChange).call(o,n,r,i))}))}))}else this.debug.warn("The selector matched no elements, ignoring the change modification",t.element)}},{key:"_applyTrackModification",value:function(t,e){var n=this,r=[];try{var i=this.document.querySelectorAll(t.element);r=oa([]).call(i)}catch(e){return void this.debug.warn("Invalid selector, ignoring the change modification",t.element)}0!==r.length?ln(r).call(r,(function(r){var i,o=n._buildTrackClickEventListener(n.eventTracker,t);r.addEventListener("click",o),e.push(Z(i=n._revertClickEventTracking).call(i,n,r,o))})):this.debug.warn("The selector matched no elements, ignoring the change modification",t.element)}},{key:"_applyRunModification",value:function(t,e,n){var r=this;function i(){var e=null;try{var n=r.document.querySelectorAll(t.element);e=oa([]).call(n)}catch(e){r.debug.log("Invalid selector but still applying run modification",t.element)}if(e&&0===e.length){if("once_per_element"===t.execute)return void r.debug.log("The selector of run modification matched no elements",t.element);r.debug.log("The selector matched no elements but still applying run modification",t.element)}try{"once_per_element"===t.execute?e&&ln(e).call(e,(function(t){return o([t])})):o(e)}catch(t){r.debug.error("The run modification script threw an error",t)}}function o(i){var o=cd(r._setupModificationScriptFunction(t,e,i),e.experiment_id,r.debug);if(fr(o))n.push(o);else if(_l(o)){var a;n.push(Z(a=o.remove).call(a,o))}}t.execute&&"document_ready"!==t.execute||"complete"===document.readyState?i():document.addEventListener("DOMContentLoaded",i)}},{key:"_applyBannerModification",value:function(t,e,n){var r=null;try{var i=this.document.querySelectorAll(t.element);r=oa([]).call(i)}catch(e){this.debug.warn("Invalid selector but still applying banner modification",t.element)}r&&0===r.length&&this.debug.warn("The selector matched no elements but still applying banner modification",t.element);try{var o=this._setupModificationScriptFunction(t,e,r);t.parametrized_parts?(o.context.html=t.parametrized_parts.html,o.context.style=t.parametrized_parts.style):(o.context.html=t.html,o.context.style=t.style);var a=cd(o,e.experiment_id,this.debug);if(fr(a))n.push(a);else if(_l(a)){var s;n.push(Z(s=a.remove).call(s,a))}}catch(t){this.debug.error("The banner modification script threw an error",t)}}},{key:"_buildTrackClickEventListener",value:function(t,e){return function(){t.track(e.event_type,function(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=id(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=id(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}({},e.event_properties))}}},{key:"_revertInsertElement",value:function(t){t.parentElement?t.parentElement.removeChild(t):this.debug.warn("Cannot remove an inserted element without a parent")}},{key:"_revertHideElement",value:function(t){t.style.removeProperty("visibility"),t.style.removeProperty("display")}},{key:"_revertRemoveElement",value:function(t,e,n){e?e.insertBefore(t,n):this.debug.warn("Cannot re-insert a removed element without a parent")}},{key:"_revertClickEventTracking",value:function(t,e){t.removeEventListener("click",e)}},{key:"_revertAttributeChange",value:function(t,e){var n=t.getAttribute("data-original-".concat(e));n&&(t.setAttribute(e,n),t.removeAttribute("data-original-".concat(e)))}},{key:"_revertStyleChange",value:function(t,e){t.style.removeProperty(e)}},{key:"_revertTextChange",value:function(t,e){t.innerHTML=e}},{key:"_setupModificationScriptFunction",value:function(t,e,n){var r={};r.inPreview=this.experimentsEditor.isEditorRunning(),r.sdk=r.inPreview?Vp():window.exponea,r.data=r.params=e,n&&n.length>0?(r.element=n[0],r.elements=n):(r.element=null,r.elements=[]),r.selector=t.element;var i,o="parametrized_parts"in t?t.parametrized_parts.script:t.script;try{var a;(i=Z(a=new Function(o)).call(a,r)).context=r}catch(t){throw this.debug.error("Syntax error in the experiment javascript code.\n            \nThis is not an SDK error but rather an error in the experiment ".concat(e.experiment_id," \njavascript code. Check the experiment code for syntax errors, such errors are \nusually highlighted in the UI. The first line of the stack trace below should \ngive you a clue.\n\n"),t),t}return i}}]),t}();function cd(t,e,n){try{return t()}catch(t){throw n.error("Error when executing a modification javascript code.\n            \nThis is not an SDK error but rather an error in the experiment ".concat(e," \njavascript code. Check the web layer javascript code for errors. This is not \na syntax error and may be hard to spot, but the first line of the stack trace \nbelow should give you a clue.\n\n"),t),t}}var ud,ld=function(){var t=R(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},hd=function(t){return ld.call(t)},fd=RegExp.prototype,pd=function(t){return(t===fd||t instanceof RegExp)&&!("flags"in t)?hd(t):t.flags};!function(t){t.sdk854_implement_trace_sampling="sdk854_implement_trace_sampling"}(ud||(ud={}));var dd=jl(Ef({},ud.sdk854_implement_trace_sampling,!1));function gd(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function vd(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=gd(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=gd(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var md=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:dd,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"eyJleHA3MjhfcmVtb3ZlX3dlYnhwX2NvbmZpZ19mcm9tX2FzeW5jX2FwaSI6IHRydWV9Cg==";mn(this,t),this.debug=e,this.window=n;try{this.flagConfig=jl(vd(vd({},r),yd(i,r,this.debug,this.window)))}catch(t){this.debug.error("Failed to parse feature flags",t),this.flagConfig=jl(r)}this.debug.debug("Initialized feature flags",pd(this))}return wn(t,[{key:"flags",get:function(){return this.flagConfig}}]),wn(t,[{key:"setFlags",value:function(t){this.flagConfig=jl(vd(vd({},this.flagConfig),t)),this.debug.debug("Overwritten feature flags",pd(this))}}]),t}();function yd(t,e,n,r){var i=t.match(/^%%%%.+%%%%$/)?"e30=":t,o=JSON.parse(r.atob(i)),a={};return kh(o,(function(t,r){var i,o;r in e?"boolean"==typeof t?a[r]=t:n.error(Mr(i=Mr(o="Incorrect value '".concat(t,"' for feature flag '")).call(o,r,"', expected a boolean but received '")).call(i,Xa(t),"'")):n.error("Feature '".concat(r,"' is not a feature flag supported by this SDK version"))})),a}var bd,wd=function(){function t(e,n,r,i){mn(this,t),this.config=e,this.debug=n,this.documentContentLoaded=r,this.queue=i}return wn(t,[{key:"getHtml",value:function(t,e){var n=this;this.queue.enqueue({name:gl.HtmlGet,noBulk:!0,prepareData:function(){return n.debug.log("Get html: ",t),{data:{company_id:n.config.getToken(),customer_ids:n.config.getOptions().customer,html_campaign_name:t}}},processResponse:function(t){tp((function(){e(t.data)}))}})}},{key:"showHtml",value:function(t,e){var n=this;this.getHtml(e,(function(e){""!==e&&n.documentContentLoaded.whenLoaded().then((function(){for(var n=Za(t),r=0;r<n.length;r++)n[r].innerHTML=e}),(function(t){n.debug.error("Failed to show HTML",t)}))}))}}]),t}(),kd=e((function(e,n){!function(t){e.exports=function(e){var n=e&&e.Promise||t.Promise,r=e&&e.XMLHttpRequest||t.XMLHttpRequest,i=t;return function(){var t=Object.create(i,{fetch:{value:void 0,writable:!0}});return function(t){if(!t.fetch){var e="URLSearchParams"in t,i="Symbol"in t&&"iterator"in Symbol,o="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),a="FormData"in t,s="ArrayBuffer"in t;if(s)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=function(t){return t&&DataView.prototype.isPrototypeOf(t)},l=ArrayBuffer.isView||function(t){return t&&c.indexOf(Object.prototype.toString.call(t))>-1};v.prototype.append=function(t,e){t=p(t),e=d(e);var n=this.map[t];this.map[t]=n?n+","+e:e},v.prototype.delete=function(t){delete this.map[p(t)]},v.prototype.get=function(t){return t=p(t),this.has(t)?this.map[t]:null},v.prototype.has=function(t){return this.map.hasOwnProperty(p(t))},v.prototype.set=function(t,e){this.map[p(t)]=d(e)},v.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},v.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),g(t)},v.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),g(t)},v.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),g(t)},i&&(v.prototype[Symbol.iterator]=v.prototype.entries);var h=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},k.call(_.prototype),k.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},x.error=function(){var t=new x(null,{status:0,statusText:""});return t.type="error",t};var f=[301,302,303,307,308];x.redirect=function(t,e){if(-1===f.indexOf(e))throw new RangeError("Invalid status code");return new x(null,{status:e,headers:{location:t}})},t.Headers=v,t.Request=_,t.Response=x,t.fetch=function(t,e){return new n((function(n,i){var a=new _(t,e),s=new r;s.onload=function(){var t,e,r={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new v,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}})),e)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;n(new x(i,r))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(a.method,a.url,!0),"include"===a.credentials?s.withCredentials=!0:"omit"===a.credentials&&(s.withCredentials=!1),"responseType"in s&&o&&(s.responseType="blob"),a.headers.forEach((function(t,e){s.setRequestHeader(e,t)})),s.send(void 0===a._bodyInit?null:a._bodyInit)}))},t.fetch.polyfill=!0}function p(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function d(t){return"string"!=typeof t&&(t=String(t)),t}function g(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return i&&(e[Symbol.iterator]=function(){return e}),e}function v(t){this.map={},t instanceof v?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function m(t){if(t.bodyUsed)return n.reject(new TypeError("Already read"));t.bodyUsed=!0}function y(t){return new n((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function b(t){var e=new FileReader,n=y(e);return e.readAsArrayBuffer(t),n}function w(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function k(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(o&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(a&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(s&&o&&u(t))this._bodyArrayBuffer=w(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!s||!ArrayBuffer.prototype.isPrototypeOf(t)&&!l(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=w(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var t=m(this);if(t)return t;if(this._bodyBlob)return n.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return n.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return n.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?m(this)||n.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var t=m(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=y(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return n.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return n.resolve(this._bodyText)},a&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}function _(t,e){var n,r,i=(e=e||{}).body;if(t instanceof _){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new v(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new v(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),h.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function S(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}})),e}function x(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new v(e.headers),this.url=e.url||"",this._initBody(t)}}(void 0!==t?t:this),{fetch:t.fetch,Headers:t.Headers,Request:t.Request,Response:t.Response}}()}}("undefined"!=typeof self?self:t)}));!function(t){t[t.Fetch=0]="Fetch"}(bd||(bd={}));var _d=me("Reflect","construct"),Sd=i((function(){function t(){}return!(_d((function(){}),[],t)instanceof t)})),xd=!i((function(){_d((function(){}))})),Td=Sd||xd;q({target:"Reflect",stat:!0,forced:Td,sham:Td},{construct:function(t,e){B(t),R(e);var n=arguments.length<3?t:B(arguments[2]);if(xd&&!Sd)return _d(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var r=[null];return r.push.apply(r,e),new(Q.apply(t,r))}var i=n.prototype,o=Se(v(i)?i:Object.prototype),a=Function.apply.call(t,o,e);return v(a)?a:o}});var Ed=I.Reflect.construct,Ad=Ed;q({target:"Object",stat:!0,sham:!o},{create:Se});var Od=I.Object,Cd=function(t,e){return Od.create(t,e)};q({target:"Object",stat:!0},{setPrototypeOf:De});var jd=I.Object.setPrototypeOf,Pd=e((function(t){function e(n,r){return t.exports=e=jd||function(t,e){return t.__proto__=e,t},e(n,r)}t.exports=e}));var Ld=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Cd(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pd(t,e)};var Id=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var Bd=function(t,e){return!e||"object"!==Xa(e)&&"function"!=typeof e?Id(t):e},Dd=i((function(){se(1)}));q({target:"Object",stat:!0,forced:Dd,sham:!ie},{getPrototypeOf:function(t){return se(re(t))}});var Rd=I.Object.getPrototypeOf,Md=e((function(t){function e(n){return t.exports=e=jd?Rd:function(t){return t.__proto__||Rd(t)},e(n)}t.exports=e})),zd=z.f,Nd=Ze.forEach,Fd=ne.set,Ud=ne.getterFor,qd=function(t,e,n){var a,s=-1!==t.indexOf("Map"),c=-1!==t.indexOf("Weak"),u=s?"set":"add",l=r[t],h=l&&l.prototype,f={};if(o&&"function"==typeof l&&(c||h.forEach&&!i((function(){(new l).entries().next()})))){a=e((function(e,n){Fd(oc(e,a,t),{type:t,collection:new l}),null!=n&&ac(n,e[u],e,s)}));var p=Ud(t);Nd(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var e="add"==t||"set"==t;!(t in h)||c&&"clear"==t||N(a.prototype,t,(function(n,r){var i=p(this).collection;if(!e&&c&&!v(n))return"get"==t&&void 0;var o=i[t](0===n?0:n,r);return e?this:o}))})),c||zd(a.prototype,"size",{configurable:!0,get:function(){return p(this).collection.size}})}else a=n.getConstructor(e,t,s,u),El.REQUIRED=!0;return Le(a,t,!1,!0),f[t]=a,q({global:!0,forced:!0},f),c||n.setStrong(a,t,s),a},Wd=z.f,Hd=El.fastKey,Gd=ne.set,Vd=ne.getterFor,Kd={getConstructor:function(t,e,n,r){var i=t((function(t,a){oc(t,i,e),Gd(t,{type:e,index:Se(null),first:void 0,last:void 0,size:0}),o||(t.size=0),null!=a&&ac(a,t[r],t,n)})),a=Vd(e),s=function(t,e,n){var r,i,s=a(t),u=c(t,e);return u?u.value=n:(s.last=u={index:i=Hd(e,!0),key:e,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=u),r&&(r.next=u),o?s.size++:t.size++,"F"!==i&&(s.index[i]=u)),t},c=function(t,e){var n,r=a(t),i=Hd(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return nc(i.prototype,{clear:function(){for(var t=a(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,o?t.size=0:this.size=0},delete:function(t){var e=a(this),n=c(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),o?e.size--:this.size--}return!!n},forEach:function(t){for(var e,n=a(this),r=D(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!c(this,t)}}),nc(i.prototype,n?{get:function(t){var e=c(this,t);return e&&e.value},set:function(t,e){return s(this,0===t?0:t,e)}}:{add:function(t){return s(this,t=0===t?0:t,t)}}),o&&Wd(i.prototype,"size",{get:function(){return a(this).size}}),i},setStrong:function(t,e,n){var r=e+" Iterator",i=Vd(e),o=Vd(r);Ue(t,e,(function(t,e){Gd(this,{type:r,target:t,state:i(t),kind:e,last:void 0})}),(function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),ic(e)}},Qd=(qd("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Kd),I.Map);q({target:"Map",stat:!0},{from:function(t){var e,n,r,i,o=arguments.length,a=o>1?arguments[1]:void 0;return B(this),(e=void 0!==a)&&B(a),null==t?new this:(n=[],e?(r=0,i=D(a,o>2?arguments[2]:void 0,2),ac(t,(function(t){n.push(i(t,r++))}))):ac(t,n.push,n),new this(n))}});q({target:"Map",stat:!0},{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}});var $d=function(){for(var t,e=R(this),n=B(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r};q({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){return $d.apply(this,arguments)}});var Jd=bs;q({target:"Map",proto:!0,real:!0,forced:!0},{every:function(t){var e=R(this),n=Jd(e),r=D(t,arguments.length>1?arguments[1]:void 0,3);return!ac(n,(function(t,n){if(!r(n,t,e))return ac.stop()}),void 0,!0,!0).stopped}}),q({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(t){var e=R(this),n=Jd(e),r=D(t,arguments.length>1?arguments[1]:void 0,3),i=new(cc(e,me("Map"))),o=B(i.set);return ac(n,(function(t,n){r(n,t,e)&&o.call(i,t,n)}),void 0,!0,!0),i}}),q({target:"Map",proto:!0,real:!0,forced:!0},{find:function(t){var e=R(this),n=Jd(e),r=D(t,arguments.length>1?arguments[1]:void 0,3);return ac(n,(function(t,n){if(r(n,t,e))return ac.stop(n)}),void 0,!0,!0).result}}),q({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(t){var e=R(this),n=Jd(e),r=D(t,arguments.length>1?arguments[1]:void 0,3);return ac(n,(function(t,n){if(r(n,t,e))return ac.stop(t)}),void 0,!0,!0).result}}),q({target:"Map",stat:!0},{groupBy:function(t,e){var n=new this;B(e);var r=B(n.has),i=B(n.get),o=B(n.set);return ac(t,(function(t){var a=e(t);r.call(n,a)?i.call(n,a).push(t):o.call(n,a,[t])})),n}});q({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(t){return ac(Jd(R(this)),(function(e,n){if((r=n)===(i=t)||r!=r&&i!=i)return ac.stop();var r,i}),void 0,!0,!0).stopped}}),q({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;B(e);var r=B(n.set);return ac(t,(function(t){r.call(n,e(t),t)})),n}}),q({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(t){return ac(Jd(R(this)),(function(e,n){if(n===t)return ac.stop(e)}),void 0,!0,!0).result}}),q({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(t){var e=R(this),n=Jd(e),r=D(t,arguments.length>1?arguments[1]:void 0,3),i=new(cc(e,me("Map"))),o=B(i.set);return ac(n,(function(t,n){o.call(i,r(n,t,e),n)}),void 0,!0,!0),i}}),q({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(t){var e=R(this),n=Jd(e),r=D(t,arguments.length>1?arguments[1]:void 0,3),i=new(cc(e,me("Map"))),o=B(i.set);return ac(n,(function(t,n){o.call(i,t,r(n,t,e))}),void 0,!0,!0),i}}),q({target:"Map",proto:!0,real:!0,forced:!0},{merge:function(t){for(var e=R(this),n=B(e.set),r=0;r<arguments.length;)ac(arguments[r++],n,e,!0);return e}}),q({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(t){var e=R(this),n=Jd(e),r=arguments.length<2,i=r?void 0:arguments[1];if(B(t),ac(n,(function(n,o){r?(r=!1,i=o):i=t(i,o,n,e)}),void 0,!0,!0),r)throw TypeError("Reduce of empty map with no initial value");return i}}),q({target:"Map",proto:!0,real:!0,forced:!0},{some:function(t){var e=R(this),n=Jd(e),r=D(t,arguments.length>1?arguments[1]:void 0,3);return ac(n,(function(t,n){if(r(n,t,e))return ac.stop()}),void 0,!0,!0).stopped}}),q({target:"Map",proto:!0,real:!0,forced:!0},{update:function(t,e){var n=R(this),r=arguments.length;B(e);var i=n.has(t);if(!i&&r<3)throw TypeError("Updating absent value");var o=i?n.get(t):B(r>2?arguments[2]:void 0)(t,n);return n.set(t,e(o,t,n)),n}});var Yd=function(t,e){var n,r=R(this),i=arguments.length>2?arguments[2]:void 0;if("function"!=typeof e&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(t)?(n=r.get(t),"function"==typeof e&&(n=e(n),r.set(t,n))):"function"==typeof i&&(n=i(),r.set(t,n)),n};q({target:"Map",proto:!0,real:!0,forced:!0},{upsert:Yd}),q({target:"Map",proto:!0,real:!0,forced:!0},{updateOrInsert:Yd});var Xd=Qd,Zd=$o;var tg=function(t){var e;return-1!==Zd(e=Function.toString.call(t)).call(e,"[native code]")},eg=X,ng=Ed;var rg=function(){if("undefined"==typeof Reflect||!ng)return!1;if(ng.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(ng(Date,[],(function(){}))),!0}catch(t){return!1}},ig=e((function(t){function e(n,r,i){return rg()?t.exports=e=ng:t.exports=e=function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(eg(Function).apply(t,r));return n&&Pd(i,n.prototype),i},e.apply(null,arguments)}t.exports=e})),og=e((function(t){function e(n){var r="function"==typeof Xd?new Xd:void 0;return t.exports=e=function(t){if(null===t||!tg(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return ig(t,arguments,Md(this).constructor)}return e.prototype=Cd(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Pd(e,t)},e(n)}t.exports=e}));function ag(t){var e=function(){if("undefined"==typeof Reflect||!Ad)return!1;if(Ad.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Ad(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Md(t);if(e){var i=Md(this).constructor;n=Ad(r,arguments,i)}else n=r.apply(this,arguments);return Bd(this,n)}}var sg=function(t){Ld(n,t);var e=ag(n);function n(t){var r;return mn(this,n),(r=e.call(this)).response=t,r}return n}(og(Error));function cg(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function ug(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=cg(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=cg(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var lg=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kd;if(mn(this,t),this.type=bd.Fetch,this.window=n,this.window.fetch)this.fetch=function(t,n){return e.window.fetch(t,n)};else{var i=r({Promise:Eu,XMLHttpRequest:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){return new XMLHttpRequest}))});this.fetch=function(t,e){return i.fetch(t,e)}}}return wn(t,[{key:"post",value:function(t,e,n){return this.fetch(t,ug(ug({},n),{},{headers:ug({Accept:"application/json"},n.headers||{}),method:"POST",body:ss(e),credentials:n.credentials?n.credentials:"include"})).then(hg).then(fg)}},{key:"get",value:function(t,e){return this.fetch(t,{headers:ug({Accept:"application/json"},e.headers||{}),method:"GET"}).then(hg).then(fg)}}],[{key:"isSupported",value:function(){return!!XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}}]),t}();function hg(t){return{json:function(){return e().then((function(t){try{return JSON.parse(t)}catch(e){return t}}))},text:e,status:t.status};function e(){return t.text()}}function fg(t){if(t.status>=200&&t.status<300)return t;throw new sg(t)}function pg(t){var e=function(){if("undefined"==typeof Reflect||!Ad)return!1;if(Ad.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Ad(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Md(t);if(e){var i=Md(this).constructor;n=Ad(r,arguments,i)}else n=r.apply(this,arguments);return Bd(this,n)}}var dg=function(t){Ld(n,t);var e=pg(n);function n(t){var r;return mn(this,n),(r=e.call(this,t.message)).name="HttpNetworkError",r}return n}(og(Error));function gg(t){var e=function(){if("undefined"==typeof Reflect||!Ad)return!1;if(Ad.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Ad(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Md(t);if(e){var i=Md(this).constructor;n=Ad(r,arguments,i)}else n=r.apply(this,arguments);return Bd(this,n)}}var vg=function(t){Ld(n,t);var e=gg(n);function n(t){var r;return mn(this,n),(r=e.call(this,function(t){var e=t.body;if("string"==typeof e)return e;return ss(e)}(t))).name="HttpServerError",r.response=t,r}return n}(og(Error));var mg,yg={responseType:"json"},bg=function(){function t(e){mn(this,t),lg.isSupported()&&(this.transport=new lg(e))}return wn(t,[{key:"hasTransport",value:function(){return void 0!==this.transport}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yg;if(e=Wl({},e,yg),void 0===this.transport)throw new Error("Can't do a get request since no http transport is available!");return this.transport.get(t,e).catch(kg(e)).then(wg(e))}},{key:"post",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yg;if(n=Wl({},n,yg),void 0===this.transport)throw new Error("Can't do a post request since no http transport is available!");return this.transport.post(t,e,n).catch(kg(n)).then(wg(n))}}]),t}();function wg(t){return function(e){return function(t,e){if("text"===t)return e.text();return e.json()}(t.responseType,e).then((function(t){return{body:t,status:e.status}}))}}function kg(t){return function(e){return e instanceof sg?function(t,e){return wg(e)(t.response).then((function(t){return Eu.reject(new vg(t))}))}(e,t):e instanceof TypeError?Eu.reject(new dg(e)):Eu.reject(e)}}function _g(t){return new Eu((function(e,n){t.execute({name:gl.WebOptimization,noBulk:!0,httpMethod:mg.get,processResponse:function(t){e(t)},processError:function(t){n(t)}})}))}function Sg(t,e){var n=t.getOptions();return!1!==n.webOptimization&&!(n.webOptimization&&!1===n.webOptimization[e])}function xg(t){var e=t.exponea;return e?e.snippetVersion?e.snippetVersion:e.start?"v2.0.0":"v1.0.0":"v0.0.0-unknown"}function Tg(t){var e=function(){if("undefined"==typeof Reflect||!Ad)return!1;if(Ad.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Ad(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Md(t);if(e){var i=Md(this).constructor;n=Ad(r,arguments,i)}else n=r.apply(this,arguments);return Bd(this,n)}}!function(t){t[t.post=0]="post",t[t.get=1]="get"}(mg||(mg={}));var Eg=function(t){Ld(n,t);var e=Tg(n);function n(t){return mn(this,n),e.call(this,t)}return n}(og(Error));function Ag(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function Og(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=Ag(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=Ag(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var Cg,jg=function(){function t(e,n,r,i,o,a,s,c,u,l,h,f,p,d,g,v,m,y,b,w,k,_,S,x,T,E,A,O){var C=arguments.length>28&&void 0!==arguments[28]?arguments[28]:_g;mn(this,t),this.tracing=e,this.debug=n,this.config=r,this.time=i,this.cookies=o,this.ping=a,this.customer=s,this.userActivityTracking=c,this.experimentsEditor=u,this.experiments=l,this.webLayers=h,this.managedTags=f,this.campaignClicks=p,this.eventTracker=d,this.queryTracking=g,this.window=v,this.unloader=m,this.initializeState=y,this.queue=b,this.pushWebApi=w,this.pushSafariApi=k,this.transferIdentity=_,this.http=S,this.logger=x,this.performanceTracker=T,this.newExperiments=E,this.featureFlags=A,this.browserExtension=O,this.getDefinitions=C}return wn(t,[{key:"initialize",value:function(t){if(this.http.hasTransport())if(this.initializeState.isInitializing())this.debug.log("The SDK is already being initialized");else if(this.initializeState.isInitialized())this.debug.log("The SDK is already initialized");else{this.debug.log("Starting to initialize the SDK"),this.debug.log("Checking the cookie first"),this.debug.log("attempting to get cookie from browser");var e=this.cookies.getCookie("__exponea_etc__"),n=this.window.webxpClient;if(n&&n.skipExperiments){if(!e&&(this.debug.log("The SDK does not have a cookie yet, communicating with webxp client to get one"),t&&!n.init)){var r;if("boolean"==typeof t)throw new Eg("Invalid type of argument 0 - initialize, expected object but got boolean");return this.storedOptions=t,this.window.setTimeout(Z(r=this.initialize).call(r,this,!1),500),void this.debug.log("Initialization was postponed until the modifications script loads")}if(!t){if(!this.storedOptions)return;t=this.storedOptions}if(!e){if("boolean"==typeof t)throw new Eg("Invalid type of argument 0 - initialize, expected object but got boolean");if(n.config&&n.config.cookie){var i=this.config.getOptions().cookies.cross_subdomain;t&&t.cookies&&void 0!==t.cookies.cross_subdomain&&(i=t.cookies.cross_subdomain),this.config.extendOptions({cookies:{cross_subdomain:i}}),e=n.config.cookie,this.cookies.setTrackingCookie(e)}}}if("boolean"==typeof t)throw new Eg("Invalid type of argument 0 - initialize, expected object but got boolean");if(this.debug.log('Webxp client communication handled, continuing with initialization - SDK is marked as "initializing" now'),!_h(t.token))throw new Eg("Invalid type of project token, expected string but got ".concat(Xa(t.token)));if(""===t.token)throw new Eg("Invalid value of project token, the token cannot be an empty string");this.tracedInitialize(t,e)}else this.logger.warn("".concat("exponea"," sdk won't be initialized because no supported HTTP transport method was found in this browser!"))}},{key:"tracedInitialize",value:function(t,e){var n=this,r=this.tracing.registerNewSpan("initialize");try{r.start(),this.initializeState.markInitializing(),this.browserExtension.initialize(),this.browserExtension.sendPayload({type:"versions",sdkVersion:"v2.20.0",snippetVersion:xg(this.window)}),this.browserExtension.sendPayload({type:"config",config:t}),this.preProcessCustomerIds(t),this.config.extendOptions(t),this.cookies.sanitizeCookieOptions(),pd(this.featureFlags).sdk854_implement_trace_sampling&&void 0===t.error_reporting&&this.config.extendOptions({error_reporting:!0});var i=this.config.getOptions();if(i.feature_flags&&this.featureFlags.setFlags(i.feature_flags),this.experimentsEditor.matchUrlWithParams(),this.experimentsEditor.areEditorParamsInURL()&&(this.experimentsEditor.placeParamsFromURLToStorage(),this.experimentsEditor.removeParamsFromURL()),this.experimentsEditor.shouldStartEditor())return void this.experimentsEditor.bootstrapEditor();this.time.queryTime(),this.pushWebApi.initialize(),e&&(this.config.extendOptions({customer:Og(Og({},i.customer),{},{cookie:e})}),this.debug.log("cookie retrieved from browser: "+e),tp((function(){fr(i.cookies.retrieve_callback)&&(i.cookies.retrieve_callback(e),i.cookies.retrieve_callback=null)})));var o=i.transfer_identity?this.transferIdentity.getTransferIdentityFirstClickToken():void 0;this.customer.requestCustomerIdsFromServer({cookie:e,tifc:o},(function(t){n.browserExtension.sendPayload({type:"ids",ids:t}),e||tp((function(){fr(i.cookies.retrieve_callback)&&(i.cookies.retrieve_callback(t.cookie),i.cookies.retrieve_callback=null)}))})),i.transfer_identity&&(this.debug.log("transferring identity from URL"),this.config.extendOptions({customer:Og(Og({},i.customer),this.transferIdentity.getCustomerIdentityFromUrl())})),this.eventTracker.addUtmParamsToDefaultEventPropertiesIfEnabled(),this.eventTracker.addTrackDefaultPropertiesToDefaultEventPropertiesIfEnabled(),i.track&&i.track.google_analytics&&this.customer.identifyCustomerWithGoogleAnalyticsId(),this.userActivityTracking.trackExitsWithDataAttribute(),this.campaignClicks.parseUrlAndTrackCampaignClick(),i.ping&&(i.ping.enabled||i.lazy_merge)||this.customer.identifyCustomer(i.customer),this.ping.restartPinging(),this.userActivityTracking.startActivityTracking(),this.eventTracker.trackPageVisitEventIfEnabled(),this.queryTracking.initialize(),this.tracing.tracePromise(this.getDefinitions(this.queue)).then((function(t){!function(t,e,n,r,i){Sg(t,"experiments")&&e.processDefinition(i.experiments),Sg(t,"webLayers")&&n.processDefinition(i.webLayers),Sg(t,"tagManager")&&r.processDefinition(i.constantManagedTags)}(n.config,n.experiments,n.webLayers,n.managedTags,t)})),Sg(this.config,"experiments")&&this.newExperiments.initialize(),Sg(this.config,"tagManager")&&this.managedTags.queryNonConstantManagedTagsAndShowOnUrlChange(),this.unloader.initialize(),this.pushSafariApi.handleDeniedSubscription(),this.performanceTracker.trackPerformanceMetricsWhenAvailable(),this.debug.log('The SDK initialization is finished, SDK is marked as "initialized" now'),this.initializeState.markInitialized(),r.end()}catch(t){if(this.queue.clear(),this.initializeState.markFailedInitialization(),t instanceof Eg)throw r.destroy(),t;r.setError(t),r.end(),this.debug.error(t)}}},{key:"preProcessCustomerIds",value:function(t){"number"!=typeof t.customer&&"string"!=typeof t.customer||(t.customer={registered:t.customer}),t.customer&&("cookie"in t.customer&&delete t.customer.cookie,t.customer=this.customer.filterEmptyCustomerIds(t.customer),this.config.extendOptions(t))}}]),t}(),Pg=function(){function t(){var e=this;mn(this,t),this.initializing=!1,this.initialized=!1,this.initializedPromiseResolve=function(){},this.initializedPromiseReject=function(){},this.initializedPromise=new Eu((function(t,n){e.initializedPromiseResolve=t,e.initializedPromiseReject=n}))}return wn(t,[{key:"markInitializing",value:function(){this.initializing=!0,this.initialized=!1}},{key:"markInitialized",value:function(){this.initializing=!1,this.initialized=!0,this.initializedPromiseResolve()}},{key:"markFailedInitialization",value:function(){this.initializing=!1,this.initialized=!1,this.initializedPromiseReject()}},{key:"isInitializing",value:function(){return this.initializing}},{key:"isInitialized",value:function(){return this.initialized}},{key:"whenInitialized",value:function(){return this.initializedPromise}}]),t}(),Lg="sendBeacon"in navigator;!function(t){t[t.Ready=0]="Ready",t[t.Sending=1]="Sending",t[t.Sent=2]="Sent"}(Cg||(Cg={}));var Ig,Bg,Dg,Rg=function(){function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Lg;mn(this,t),this.EVENT_TRIGGERED_DEADLINE=300,this.phase=Cg.Ready,this.lockedUntil=0,this.timeoutID=void 0,this.tracing=e,this.debug=n,this.eventTracker=r,this.eventTypeAndPropertiesGetter=i,this.isSendBeaconSupported=o}return wn(t,[{key:"trackClick",value:function(t){var e=t.target,n=this.eventTypeAndPropertiesGetter(e);this.isSendBeaconSupported?this._trackClickWithBeacon(n):(this.phase===Cg.Ready&&(t.preventDefault(),t.stopImmediatePropagation()),this._trackClickWithoutBeacon(e,n))}},{key:"_trackClickWithBeacon",value:function(t){var e=t.type,n=t.properties;this.eventTracker.track(e,n)}},{key:"_trackClickWithoutBeacon",value:function(t,e){var n=this,r=e.type,i=e.properties;if(this.phase===Cg.Ready){var o=this.tracing.trace((function(){t.click()}));if((new Date).getTime()<this.lockedUntil)return void this.debug.log("Ignoring apparent duplicate click");this.phase=Cg.Sending,this.timeoutID=Zf((function(){n.debug.log("Click timed out"),n.phase===Cg.Sending&&o()}),this.EVENT_TRIGGERED_DEADLINE),this.eventTracker.track(r,i,{successCallback:function(){n.debug.log("Click tracked successfully"),clearTimeout(n.timeoutID),delete n.timeoutID,n.phase=Cg.Sent,o()},errorCallback:function(){n.debug.error("Cannot connect to server."),clearTimeout(n.timeoutID),delete n.timeoutID,n.phase=Cg.Sent,o()}})}else this.phase===Cg.Sending?(clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=Cg.Ready,this.lockedUntil=(new Date).getTime()+500):this.phase===Cg.Sent&&(this.phase=Cg.Ready,this.lockedUntil=(new Date).getTime()+500)}}]),t}(),Mg=function(){function t(e,n,r,i){mn(this,t),this.tracing=e,this.eventTracker=n,this.debug=r,this.documentContentLoaded=i}return wn(t,[{key:"trackLink",value:function(t,e,n){var r=new Rg(this.tracing,this.debug,this.eventTracker,(function(t){return fr(e)?e(t):{type:e,properties:n||{}}}));_h(t)?this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((function(){for(var e=Za(t),n=0;n<e.length;n++)e[n].onclick=function(t){return r.trackClick(t)}})):t.onclick=function(t){return r.trackClick(t)}}}]),t}();function zg(t,e,n){return"attachEvent"in t&&"function"==typeof t?t.attachEvent("on"+e,n):t.addEventListener(e,n,!1)}var Ng,Fg,Ug,qg,Wg,Hg=(Ig=pp("LiveEventHandler.initialize"),Bg=pp({operation:"LiveEventHandler._handleLiveEventListeners",onRoot:!0}),$f((Dg=function(){function t(e,n){mn(this,t),this._liveEventListeners={click:[],submit:[]},this.tracing=e,this.document=n}return wn(t,[{key:"initialize",value:function(){this._registerLiveEventListener("submit"),this._registerLiveEventListener("click")}},{key:"_handleLiveEventListeners",value:function(t,e){ln(t).call(t,(function(t){try{Za.matchesSelector(e.target,t.selector)&&t.callback(e)}catch(t){if(!(t instanceof Error))throw t}}))}},{key:"addLiveEventListener",value:function(t,e,n){this._liveEventListeners[t].push({selector:e,callback:n})}},{key:"clearLiveEventListeners",value:function(){this._liveEventListeners={click:[],submit:[]}}},{key:"_registerLiveEventListener",value:function(t){var e=this;zg(this.document,t,(function(n){return e._handleLiveEventListeners(e._liveEventListeners[t],n)}))}}]),t}()).prototype,"initialize",[Ig],Df(Dg.prototype,"initialize"),Dg.prototype),$f(Dg.prototype,"_handleLiveEventListeners",[Bg],Df(Dg.prototype,"_handleLiveEventListeners"),Dg.prototype),Dg),Gg=function(){function t(e,n){mn(this,t),this.console=e,this.logPrefix=n}return wn(t,[{key:"getMessagePrefix",value:function(){var t,e=(new Date).toUTCString();return Mr(t="".concat(this.logPrefix," [")).call(t,e,"]")}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.print("error",e)}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.print("log",e)}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.print("warn",e)}},{key:"debug",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.print("debug",e)}},{key:"print",value:function(t,e){var n;if(this.isConsoleSupported(t)&&0!==e.length){var r;if("string"==typeof e[0])e[0]=Mr(r="".concat(this.getMessagePrefix()," ")).call(r,e[0]);else e.unshift(this.getMessagePrefix());(n=this.console)[t].apply(n,ip(e))}}},{key:"isConsoleSupported",value:function(t){return void 0!==this.console&&"function"==typeof this.console[t]}}]),t}(),Vg=e((function(t,e){
/**
	 * @file postscribe
	 * @description Asynchronously write javascript, even with document.write.
	 * @version v2.0.8
	 * @see {@link https://krux.github.io/postscribe}
	 * @license MIT
	 * @author Derek Brans
	 * @copyright 2016 Krux Digital, Inc
	 */
var n;n=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r};t.exports=o.default},function(t,e,n){e.__esModule=!0;var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.default=g;var i,o=n(2),a=(i=o)&&i.__esModule?i:{default:i},s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(4));function c(){}var u={afterAsync:c,afterDequeue:c,afterStreamStart:c,afterWrite:c,autoFix:!0,beforeEnqueue:c,beforeWriteToken:function(t){return t},beforeWrite:function(t){return t},done:c,error:function(t){throw new Error(t.msg)},releaseAsync:!1},l=0,h=[],f=null;function p(){var t=h.shift();if(t){var e=s.last(t);e.afterDequeue(),t.stream=d.apply(void 0,t),e.afterStreamStart()}}function d(t,e,n){(f=new a.default(t,n)).id=l++,f.name=n.name||f.id,g.streams[f.name]=f;var i=t.ownerDocument,o={close:i.close,open:i.open,write:i.write,writeln:i.writeln};function s(t){t=n.beforeWrite(t),f.write(t),n.afterWrite(t)}r(i,{close:c,open:c,write:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return s(e.join(""))},writeln:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return s(e.join("")+"\n")}});var u=f.win.onerror||c;return f.win.onerror=function(t,e,r){n.error({msg:t+" - "+e+": "+r}),u.apply(f.win,[t,e,r])},f.write(e,(function(){r(i,o),f.win.onerror=u,n.done(),f=null,p()})),f}function g(t,e,n){if(s.isFunction(n))n={done:n};else if("clear"===n)return h=[],f=null,void(l=0);n=s.defaults(n,u);var r=[t=/^#/.test(t)?window.document.getElementById(t.substr(1)):t.jquery?t[0]:t,e,n];return t.postscribe={cancel:function(){r.stream?r.stream.abort():r[1]=c}},n.beforeEnqueue(r),h.push(r),f||p(),t.postscribe}r(g,{streams:{},queue:h,WriteStream:a.default})},function(t,e,n){e.__esModule=!0;var r,i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o=n(3),a=(r=o)&&r.__esModule?r:{default:r},s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(4));function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){var n="data-ps-"+e,r=t.getAttribute(n);return s.existy(r)?String(r):r}function l(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r="data-ps-"+e;s.existy(n)&&""!==n?t.setAttribute(r,n):t.removeAttribute(r)}var h=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,t),this.root=e,this.options=n,this.doc=e.ownerDocument,this.win=this.doc.defaultView||this.doc.parentWindow,this.parser=new a.default("",{autoFix:n.autoFix}),this.actuals=[e],this.proxyHistory="",this.proxyRoot=this.doc.createElement(e.nodeName),this.scriptStack=[],this.writeQueue=[],l(this.proxyRoot,"proxyof",0)}return t.prototype.write=function(){var t;for((t=this.writeQueue).push.apply(t,arguments);!this.deferredRemote&&this.writeQueue.length;){var e=this.writeQueue.shift();s.isFunction(e)?this._callFunction(e):this._writeImpl(e)}},t.prototype._callFunction=function(t){var e={type:"function",value:t.name||t.toString()};this._onScriptStart(e),t.call(this.win,this.doc),this._onScriptDone(e)},t.prototype._writeImpl=function(t){this.parser.append(t);for(var e=void 0,n=void 0,r=void 0,i=[];(e=this.parser.readToken())&&!(n=s.isScript(e))&&!(r=s.isStyle(e));)(e=this.options.beforeWriteToken(e))&&i.push(e);i.length>0&&this._writeStaticTokens(i),n&&this._handleScriptToken(e),r&&this._handleStyleToken(e)},t.prototype._writeStaticTokens=function(t){var e=this._buildChunk(t);return e.actual?(e.html=this.proxyHistory+e.actual,this.proxyHistory+=e.proxy,this.proxyRoot.innerHTML=e.html,this._walkChunk(),e):null},t.prototype._buildChunk=function(t){for(var e=this.actuals.length,n=[],r=[],i=[],o=t.length,a=0;a<o;a++){var s=t[a],c=s.toString();if(n.push(c),s.attrs){if(!/^noscript$/i.test(s.tagName)){var u=e++;r.push(c.replace(/(\/?>)/," data-ps-id="+u+" $1")),"ps-script"!==s.attrs.id&&"ps-style"!==s.attrs.id&&i.push("atomicTag"===s.type?"":"<"+s.tagName+" data-ps-proxyof="+u+(s.unary?" />":">"))}}else r.push(c),i.push("endTag"===s.type?c:"")}return{tokens:t,raw:n.join(""),actual:r.join(""),proxy:i.join("")}},t.prototype._walkChunk=function(){for(var t=void 0,e=[this.proxyRoot];s.existy(t=e.shift());){var n=1===t.nodeType;if(!n||!u(t,"proxyof")){n&&(this.actuals[u(t,"id")]=t,l(t,"id"));var r=t.parentNode&&u(t.parentNode,"proxyof");r&&this.actuals[r].appendChild(t)}e.unshift.apply(e,s.toArray(t.childNodes))}},t.prototype._handleScriptToken=function(t){var e=this,n=this.parser.clear();n&&this.writeQueue.unshift(n),t.src=t.attrs.src||t.attrs.SRC,(t=this.options.beforeWriteToken(t))&&(t.src&&this.scriptStack.length?this.deferredRemote=t:this._onScriptStart(t),this._writeScriptToken(t,(function(){e._onScriptDone(t)})))},t.prototype._handleStyleToken=function(t){var e=this.parser.clear();e&&this.writeQueue.unshift(e),t.type=t.attrs.type||t.attrs.TYPE||"text/css",(t=this.options.beforeWriteToken(t))&&this._writeStyleToken(t),e&&this.write()},t.prototype._writeStyleToken=function(t){var e=this._buildStyle(t);this._insertCursor(e,"ps-style"),t.content&&(e.styleSheet&&!e.sheet?e.styleSheet.cssText=t.content:e.appendChild(this.doc.createTextNode(t.content)))},t.prototype._buildStyle=function(t){var e=this.doc.createElement(t.tagName);return e.setAttribute("type",t.type),s.eachKey(t.attrs,(function(t,n){e.setAttribute(t,n)})),e},t.prototype._insertCursor=function(t,e){this._writeImpl('<span id="'+e+'"/>');var n=this.doc.getElementById(e);n&&n.parentNode.replaceChild(t,n)},t.prototype._onScriptStart=function(t){t.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(t)},t.prototype._onScriptDone=function(t){t===this.scriptStack[0]?(this.scriptStack.shift(),this.write.apply(this,t.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this._onScriptStart(this.deferredRemote),this.deferredRemote=null)):this.options.error({msg:"Bad script nesting or script finished twice"})},t.prototype._writeScriptToken=function(t,e){var n=this._buildScript(t),r=this._shouldRelease(n),i=this.options.afterAsync;t.src&&(n.src=t.src,this._scriptLoadHandler(n,r?i:function(){e(),i()}));try{this._insertCursor(n,"ps-script"),n.src&&!r||e()}catch(t){this.options.error(t),e()}},t.prototype._buildScript=function(t){var e=this.doc.createElement(t.tagName);return s.eachKey(t.attrs,(function(t,n){e.setAttribute(t,n)})),t.content&&(e.text=t.content),e},t.prototype._scriptLoadHandler=function(t,e){function n(){t=t.onload=t.onreadystatechange=t.onerror=null}var r=this.options.error;function o(){n(),null!=e&&e(),e=null}function a(t){n(),r(t),null!=e&&e(),e=null}function s(t,e){var n=t["on"+e];null!=n&&(t["_on"+e]=n)}s(t,"load"),s(t,"error"),i(t,{onload:function(){if(t._onload)try{t._onload.apply(this,Array.prototype.slice.call(arguments,0))}catch(e){a({msg:"onload handler failed "+e+" @ "+t.src})}o()},onerror:function(){if(t._onerror)try{t._onerror.apply(this,Array.prototype.slice.call(arguments,0))}catch(e){return void a({msg:"onerror handler failed "+e+" @ "+t.src})}a({msg:"remote script failed "+t.src})},onreadystatechange:function(){/^(loaded|complete)$/.test(t.readyState)&&o()}})},t.prototype._shouldRelease=function(t){return!/^script$/i.test(t.nodeName)||!!(this.options.releaseAsync&&t.src&&t.hasAttribute("async"))},t}();e.default=h},function(t,e,n){
/**
		 * @file prescribe
		 * @description Tiny, forgiving HTML parser
		 * @version vundefined
		 * @see {@link https://github.com/krux/prescribe/}
		 * @license MIT
		 * @author Derek Brans
		 * @copyright 2016 Krux Digital, Inc
		 */
var r;r=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){var r,i=n(1),o=(r=i)&&r.__esModule?r:{default:r};t.exports=o.default},function(t,e,n){e.__esModule=!0;var r,i=u(n(2)),o=u(n(3)),a=n(6),s=(r=a)&&r.__esModule?r:{default:r},c=n(5);function u(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var h={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},f=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(this,t),this.stream=n;var o=!1,a={};for(var c in i)i.hasOwnProperty(c)&&(r.autoFix&&(a[c+"Fix"]=!0),o=o||a[c+"Fix"]);o?(this._readToken=(0,s.default)(this,a,(function(){return e._readTokenImpl()})),this._peekToken=(0,s.default)(this,a,(function(){return e._peekTokenImpl()}))):(this._readToken=this._readTokenImpl,this._peekToken=this._peekTokenImpl)}return t.prototype.append=function(t){this.stream+=t},t.prototype.prepend=function(t){this.stream=t+this.stream},t.prototype._readTokenImpl=function(){var t=this._peekTokenImpl();if(t)return this.stream=this.stream.slice(t.length),t},t.prototype._peekTokenImpl=function(){for(var t in h)if(h.hasOwnProperty(t)&&h[t].test(this.stream)){var e=o[t](this.stream);if(e)return"startTag"===e.type&&/script|style/i.test(e.tagName)?null:(e.text=this.stream.substr(0,e.length),e)}},t.prototype.peekToken=function(){return this._peekToken()},t.prototype.readToken=function(){return this._readToken()},t.prototype.readTokens=function(t){for(var e=void 0;e=this.readToken();)if(t[e.type]&&!1===t[e.type](e))return},t.prototype.clear=function(){var t=this.stream;return this.stream="",t},t.prototype.rest=function(){return this.stream},t}();for(var p in e.default=f,f.tokenToString=function(t){return t.toString()},f.escapeAttributes=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=(0,c.escapeQuotes)(t[n],null));return e},f.supports=i,i)i.hasOwnProperty(p)&&(f.browserHasFlaw=f.browserHasFlaw||!i[p]&&p)},function(t,e){e.__esModule=!0;var n=!1,r=!1,i=window.document.createElement("div");try{var o="<P><I></P></I>";i.innerHTML=o,e.tagSoup=n=i.innerHTML!==o}catch(t){e.tagSoup=n=!1}try{i.innerHTML="<P><i><P></P></i></P>",e.selfClose=r=2===i.childNodes.length}catch(t){e.selfClose=r=!1}i=null,e.tagSoup=n,e.selfClose=r},function(t,e,n){e.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.comment=function(t){var e=t.indexOf("--\x3e");if(e>=0)return new i.CommentToken(t.substr(4,e-1),e+3)},e.chars=function(t){var e=t.indexOf("<");return new i.CharsToken(e>=0?e:t.length)},e.startTag=a,e.atomicTag=function(t){var e=a(t);if(e){var n=t.slice(e.length);if(n.match(new RegExp("</\\s*"+e.tagName+"\\s*>","i"))){var r=n.match(new RegExp("([\\s\\S]*?)</\\s*"+e.tagName+"\\s*>","i"));if(r)return new i.AtomicTagToken(e.tagName,r[0].length+e.length,e.attrs,e.booleanAttrs,r[1])}}},e.endTag=function(t){var e=t.match(o.endTag);if(e)return new i.EndTagToken(e[1],e[0].length)};var i=n(4),o={startTag:/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,endTag:/^<\/([\-A-Za-z0-9_]+)[^>]*>/,attr:/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,fillAttr:/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i};function a(t){var e,n,a;if(-1!==t.indexOf(">")){var s=t.match(o.startTag);if(s){var c=(e={},n={},a=s[2],s[2].replace(o.attr,(function(t,r){arguments[2]||arguments[3]||arguments[4]||arguments[5]?arguments[5]?(e[arguments[5]]="",n[arguments[5]]=!0):e[r]=arguments[2]||arguments[3]||arguments[4]||o.fillAttr.test(r)&&r||"":e[r]="",a=a.replace(t,"")})),{v:new i.StartTagToken(s[1],s[0].length,e,n,!!s[3],a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))});if("object"===(void 0===c?"undefined":r(c)))return c.v}}}},function(t,e,n){e.__esModule=!0,e.EndTagToken=e.AtomicTagToken=e.StartTagToken=e.TagToken=e.CharsToken=e.CommentToken=e.Token=void 0;var r=n(5);function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.Token=function t(e,n){i(this,t),this.type=e,this.length=n,this.text=""},e.CommentToken=function(){function t(e,n){i(this,t),this.type="comment",this.length=n||(e?e.length:0),this.text="",this.content=e}return t.prototype.toString=function(){return"\x3c!--"+this.content},t}(),e.CharsToken=function(){function t(e){i(this,t),this.type="chars",this.length=e,this.text=""}return t.prototype.toString=function(){return this.text},t}();var o=e.TagToken=function(){function t(e,n,r,o,a){i(this,t),this.type=e,this.length=r,this.text="",this.tagName=n,this.attrs=o,this.booleanAttrs=a,this.unary=!1,this.html5Unary=!1}return t.formatTag=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n="<"+t.tagName;for(var i in t.attrs)if(t.attrs.hasOwnProperty(i)){n+=" "+i;var o=t.attrs[i];void 0!==t.booleanAttrs&&void 0!==t.booleanAttrs[i]||(n+='="'+(0,r.escapeQuotes)(o)+'"')}return t.rest&&(n+=" "+t.rest),t.unary&&!t.html5Unary?n+="/>":n+=">",null!=e&&(n+=e+"</"+t.tagName+">"),n},t}();e.StartTagToken=function(){function t(e,n,r,o,a,s){i(this,t),this.type="startTag",this.length=n,this.text="",this.tagName=e,this.attrs=r,this.booleanAttrs=o,this.html5Unary=!1,this.unary=a,this.rest=s}return t.prototype.toString=function(){return o.formatTag(this)},t}(),e.AtomicTagToken=function(){function t(e,n,r,o,a){i(this,t),this.type="atomicTag",this.length=n,this.text="",this.tagName=e,this.attrs=r,this.booleanAttrs=o,this.unary=!1,this.html5Unary=!1,this.content=a}return t.prototype.toString=function(){return o.formatTag(this,this.content)},t}(),e.EndTagToken=function(){function t(e,n){i(this,t),this.type="endTag",this.length=n,this.text="",this.tagName=e}return t.prototype.toString=function(){return"</"+this.tagName+">"},t}()},function(t,e){e.__esModule=!0,e.escapeQuotes=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t?t.replace(/([^"]*)"/g,(function(t,e){return/\\/.test(e)?e+'"':e+'\\"'})):e}},function(t,e){e.__esModule=!0,e.default=function(t,e,n){var a=function(){var t=[];return t.last=function(){return this[this.length-1]},t.lastTagNameEq=function(t){var e=this.last();return e&&e.tagName&&e.tagName.toUpperCase()===t.toUpperCase()},t.containsTagName=function(t){for(var e,n=0;e=this[n];n++)if(e.tagName===t)return!0;return!1},t}(),s={startTag:function(n){var i=n.tagName;"TR"===i.toUpperCase()&&a.lastTagNameEq("TABLE")?(t.prepend("<TBODY>"),c()):e.selfCloseFix&&r.test(i)&&a.containsTagName(i)?a.lastTagNameEq(i)?o(t,a):(t.prepend("</"+n.tagName+">"),c()):n.unary||a.push(n)},endTag:function(r){a.last()?e.tagSoupFix&&!a.lastTagNameEq(r.tagName)?o(t,a):a.pop():e.tagSoupFix&&(n(),c())}};function c(){var e=function(t,e){var n=t.stream,r=i(e());return t.stream=n,r}(t,n);e&&s[e.type]&&s[e.type](e)}return function(){return c(),i(n())}};var n=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,r=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i;function i(t){return t&&"startTag"===t.type&&(t.unary=n.test(t.tagName)||t.unary,t.html5Unary=!/\/>$/.test(t.text)),t}function o(t,e){var n=e.pop();t.prepend("</"+n.tagName+">")}}])},t.exports=r()},function(t,e){e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t){return null!=t}function i(t,e,n){var r=void 0,i=t&&t.length||0;for(r=0;r<i;r++)e.call(n,t[r],r)}function o(t,e,n){for(var r in t)t.hasOwnProperty(r)&&e.call(n,r,t[r])}function a(t,e){return!(!t||"startTag"!==t.type&&"atomicTag"!==t.type||!("tagName"in t)||!~t.tagName.toLowerCase().indexOf(e))}e.existy=r,e.isFunction=function(t){return"function"==typeof t},e.each=i,e.eachKey=o,e.defaults=function(t,e){return t=t||{},o(e,(function(e,n){r(t[e])||(t[e]=n)})),t},e.toArray=function(t){try{return Array.prototype.slice.call(t)}catch(o){var e=(r=[],i(t,(function(t){r.push(t)})),{v:r});if("object"===(void 0===e?"undefined":n(e)))return e.v}var r},e.last=function(t){return t[t.length-1]},e.isTag=a,e.isScript=function(t){return a(t,"script")},e.isStyle=function(t){return a(t,"style")}}])},t.exports=n()})),Kg=(Ng=pp("queryNonConstantManagedTagsAndShow"),Fg=pp("showManagedTag"),$f((Ug=function(){function t(e,n,r,i,o,a,s){mn(this,t),this.tracing=e,this.config=n,this.queue=r,this.location=i,this.document=o,this.debug=a,this.url=s}return wn(t,[{key:"queryNonConstantManagedTagsAndShowOnUrlChange",value:function(){var t=this;this.queryNonConstantManagedTagsAndShow(!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeQueryNonConstantManagedTagsAndShow",(function(){t.queryNonConstantManagedTagsAndShow(!1)}))}},{key:"showManagedTag",value:function(t){this.debug.log("Showing managed tag...",t);var e="definition"in t?t.definition:t.parametrized_definition;if("js"===t.type){var n;try{n=new Function(e)}catch(t){return this.debug.error("Syntax error in the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for syntax errors, such errors are usually\nhighlighted in the UI. The first line of the stack trace below should give you\na clue.\n\n",t)}try{n()}catch(t){this.debug.error("Error when executing the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for errors. This is not a syntax error and\nmay be hard to spot, but the first line of the stack trace below should give\nyou a clue.\n\n",t)}}else if("html"===t.type)try{Vg(this.document.body,e)}catch(t){this.debug.error("Error when applying an html managed tag.\n\nThere was an error when applying the html managed tag using\nPostscribe (https://github.com/krux/postscribe/).\n\n",t)}else this.debug.error('Unknown managed tag type "'.concat(t.type,'". The type\nmay only be "html" or "js".'))}},{key:"processDefinition",value:function(t){var e=this;this.debug.log("Processing managed tags...",t),this.removeOverlayAndShowManagedTags(t,!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeRemoveOverlayAndShowManagedTags",(function(){e.removeOverlayAndShowManagedTags(t,!1)}))}},{key:"removeOverlayAndShowManagedTags",value:function(t,e){if(e){var n=this.document.getElementById("__exponea__overlay__"),r=!n&&this.config.getOptions().modify.overlay&&!!window.exponea.__;this.filterAndShowManagedTags(t,r),n&&n.parentElement&&n.parentElement.removeChild(n)}else this.filterAndShowManagedTags(t,!1)}},{key:"queryNonConstantManagedTagsAndShow",value:function(t){var e=this,n=ph(this.config.getOptions().customer);this.queue.enqueue({name:gl.ManagedTagsShow,noBulk:!0,prepareData:function(){return e.debug.log("Getting non-constant managed tags"),n&&n.cookie||(n=ph(e.config.getOptions().customer)),{data:{company_id:e.config.getToken(),customer_ids:n,current_url:e.location.href}}},processResponse:function(n){e.removeOverlayAndShowManagedTags(n.data,t)},processError:function(t){e.debug.error("Error getting non-constant managed tags",t)}})}},{key:"filterAndShowManagedTags",value:function(t,e){var n,r=this,i=Gp(Fp.ManagedTag,this.debug);this.showManagedTags(Do(n=Do(t).call(t,i("overlay",(function(t){return!e||!t.uses_overlay})))).call(n,i("page",(function(t){return!("trigger"in t)||Zp.matches(r.location.href,t.trigger)}))))}},{key:"showManagedTags",value:function(t){var e=this;ln(t).call(t,(function(t){return e.showManagedTag(t)}))}}]),t}()).prototype,"queryNonConstantManagedTagsAndShowOnUrlChange",[Ng],Df(Ug.prototype,"queryNonConstantManagedTagsAndShowOnUrlChange"),Ug.prototype),$f(Ug.prototype,"showManagedTag",[Fg],Df(Ug.prototype,"showManagedTag"),Ug.prototype),Ug),Qg=(qg=pp("NewExperiments.initialize"),$f((Wg=function(){function t(e,n,r,i,o,a,s){mn(this,t),this.tracing=e,this.window=n,this.serviceWorkerManager=r,this.database=i,this.storageUtils=o,this.config=a,this.logger=s,this.webExperienceObject=this.getWebExperienceObject()}return wn(t,[{key:"initialize",value:function(){var t,e,n=this,r=this.config.getNewExperimentsOptions();if(r&&"sync"===r.mode&&this.serviceWorkerManager.isAvailable()&&this.database.isSupported()&&this.storageUtils.isStorageAvailable("localStorage")){var i=this.config.storeInIndexedDB().then((function(){return n.serviceWorkerManager.isRegistered()})).then((t=this.serviceWorkerManager,e=this.storageUtils,function(n){if(!n)return e.removeFromStorage("localStorage","__exponea__sync_modifications__"),t.register().then((function(){$g(e)}));$g(e)})).catch((function(t){n.logger.error('Failed to initialize the "sync" mode for the new experiments because of:',t),n.logger.error('The SDK will now use the new experiments in "async" mode. Note that the service worker is only required for the "sync" mode. If you don\'t want to use it, consider switching to the "async" mode. Read more in https://docs.exponea.com/docs/integrating-and-using-experiments.')}));this.tracing.tracePromise(i)}}},{key:"areAlreadyApplied",value:function(){return!(!this.webExperienceObject||!this.webExperienceObject.skipExperiments)}},{key:"getWebExperienceObject",value:function(){var t=this.window.exponea,e=t&&t.webxp,n=this.window.webxpClient;return e||n}}]),t}()).prototype,"initialize",[qg],Df(Wg.prototype,"initialize"),Wg.prototype),Wg);function $g(t){t.writeToStorage("localStorage","__exponea__sync_modifications__",!0)}var Jg=function(){function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Date;mn(this,t),this.window=e,this.config=n,this.debug=r,this.tracing=i,this.date=o}return wn(t,[{key:"trackPerformanceMetricsWhenAvailable",value:function(){var t=this,e=this.config.getNewExperimentsOptions();if(e){var n=this.window.exponea._performance;!function(t){if(!t)return!1;return!(!t.snippetStartTime||!t.nowFn)}(n)?this.debug.debug("Performance metrics are not available"):!function(t){return!(!t.fastExperimentsEndTime||!t.personalizedExperimentsEndTime)}(n)?n.callbackFn=function(){return t.trackMetricsSpans(n,e)}:this.trackMetricsSpans(n,e)}}},{key:"trackMetricsSpans",value:function(t,e){var n;t.callbackFn&&delete t.callbackFn;var r=t.fastExperimentsEndTime-t.snippetStartTime,i=t.personalizedExperimentsEndTime-t.snippetStartTime,o=function(t,e,n){if(n>1e9)return n;if(!t.performance)throw new Error("Unexpected condition failed: the snippet start time is a small number but window.performance is not available!");var r=t.performance.now();return e.now()-Math.round(r-n)}(this.window,this.date,t.snippetStartTime),a={id:yl(16),start_time:o/1e3,duration:r/1e3,operation:"modificationFast",tags:{status:r<=e.timeout?"success":"timeout"}},s={id:yl(16),start_time:o/1e3,duration:i/1e3,operation:"modificationPersonalized",tags:{status:i<=e.timeout?"success":"timeout"}};this.debug.log("Adding spans with performance metrics"),this.debug.log(Mr(n="Fast experiments: ".concat(r,"ms, slow experiments: ")).call(n,i,"ms")),this.tracing.addSerializedSpanToSend(a,s)}}]),t}();var Yg,Xg,Zg,tv,ev,nv,rv,iv={click:!0,key:!0,move:!0,scroll:!0},ov={click:["click","mousedown","pointerdown","touchstart"],move:["mousemove","pointermove"],key:["keydown"],scroll:["wheel","touchmove","scroll"]},av=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;mn(this,t),this.listenersRegistered=!1,this.window=e,this.activityCallback=r,this.options=Wl({},n,iv)}return wn(t,[{key:"registerActionListeners",value:function(){var t=this;this.listenersRegistered||(kh(ov,(function(e,n){ln(e).call(e,(function(e){zg(t.window,e,(function(){t.options[n]&&(t.lastActivity=n,t.activityCallback&&t.activityCallback(n))}))}))})),this.listenersRegistered=!0)}},{key:"setOptions",value:function(t){this.options=Wl({},t,this.options)}},{key:"getLastUserActivity",value:function(){return this.lastActivity}},{key:"resetActivity",value:function(){this.lastActivity=void 0}}]),t}(),sv=(Yg=pp({operation:"sendPing",onRoot:!0}),$f((Xg=function(){function t(e,n,r,i,o,a,s,c,u,l,h,f){var p=this;mn(this,t),this.tracing=e,this.config=n,this.timestamp=r,this.eventTracker=i,this.window=o,this.location=a,this.document=s,this.debug=c,this.cookies=u,this.storageUtils=l,this.unloader=h,this.url=f,this.activityHandler=new av(this.window,this.config.getActivityHandlerOptions(),(function(t){return p.resumePinging(t)})),this.config.getOptions().track.unloads&&this.unloader.addListener((function(){p.eventTracker.track("web_unload",p.getPingParams()||{})}))}return wn(t,[{key:"sendPing",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0,n=this.config.getOptions(),r=n.ping;if(!r||!r.enabled)return this.stopPinging();var i=!!r.activity;if(t&&i&&!this.activityHandler.getLastUserActivity())return this.debug.log("No user activity detected so not pinging"),void this.stopPinging();this.debug.log("Sending session ping");var o=this.getPingParams(e);o&&this.eventTracker.track("session_ping",o),this.onSessionPing(),this.activityHandler.resetActivity()}},{key:"restartPinging",value:function(){var t=this;this.stopPinging();var e=this.config.getOptions().ping;e&&e.enabled&&(this.debug.log("Session ping is enabled"),this.activityHandler.registerActionListeners(),this.sendPing(!1,"page_load"),this.intervalId=this.window.setInterval((function(){return t.sendPing(!0)}),1e3*e.interval))}},{key:"setOptions",value:function(t){this.debug.log("Changing ping configuration: ",t),this.config.extendOptions({ping:t}),this.setActivityHandlerOptions()}},{key:"onSessionPing",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime(),e=this.getLastSessionPing();this.storageUtils.isStorageAvailable("localStorage")&&((null===e||e<t-12e5)&&this.onSessionStart(t),this.setLastSessionPing(t))}},{key:"getPingParams",value:function(t){var e=this.config.getOptions();if(e.ping){var n={};e.utm_params&&(n=this.url.getParams(e.utm_params)),Ff(n,e.ping.properties),n.referrer=this.document.referrer,n.location=this.location.href,n.path=this.location.pathname,t?n.activity=t:this.activityHandler&&this.activityHandler.getLastUserActivity()&&(n.activity=this.activityHandler.getLastUserActivity());var r=this.cookies.getCookie("__exponea_etc__");return r&&(n.cookie=r),n}}},{key:"getLastSessionStart",value:function(){return this.timestamp.getStoredTimestamp("__exponea_last_session_start_timestamp__")}},{key:"setActivityHandlerOptions",value:function(){this.activityHandler.setOptions(this.config.getActivityHandlerOptions())}},{key:"onSessionStart",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime();this.setLastSessionStart(t)}},{key:"setLastSessionPing",value:function(t){this.timestamp.storeTimestamp("__exponea_last_session_ping_timestamp__",t)}},{key:"setLastSessionStart",value:function(t){this.timestamp.storeTimestamp("__exponea_last_session_start_timestamp__",t)}},{key:"stopPinging",value:function(){this.intervalId&&(this.window.clearInterval(this.intervalId),this.intervalId=void 0)}},{key:"resumePinging",value:function(t){var e=this,n=this.config.getOptions().ping;n&&n.enabled&&!this.intervalId&&(this.debug.log("Resuming session ping"),this.activityHandler.registerActionListeners(),this.sendPing(!1,t),this.intervalId=this.window.setInterval((function(){return e.sendPing(!0)}),1e3*n.interval))}},{key:"getLastSessionPing",value:function(){return this.timestamp.getStoredTimestamp("__exponea_last_session_ping_timestamp__")}}]),t}()).prototype,"sendPing",[Yg],Df(Xg.prototype,"sendPing"),Xg.prototype),Xg);function cv(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return function(n,r,i){var o=i.value,a=e+String(r);return i.value=function(){return uv(t,a,arguments),lv(t,a,arguments),o.apply(this,arguments)},i}}function uv(t,e,n){var r,i=jh(t,(function(t){return!t.optional})).length;if(n.length<i)throw new Eg("Invalid number of arguments when calling "+Mr(r="".concat("exponea",".")).call(r,String(e),", ")+"expected ".concat(i," ")+"but got ".concat(n.length))}function lv(t,e,n){wr(n,(function(n,r){var i=t[r];if(!i){var o;if(r>=t.length)return;throw new Eg("Missing definition for argument ".concat(r," ")+Mr(o="of ".concat("exponea",".")).call(o,e," in")+"the @".concat(cv.name," decorator!"))}if(void 0===n){if(i.optional)return;var a,s;throw new Eg(Mr(a="Missing argument ".concat(r," - ")).call(a,i.name)+Mr(s=" when calling ".concat("exponea",".")).call(s,e,", ")+fv(i)+" but got ".concat(Xa(n)))}var c,u=Xa(n);switch(u){case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":c=u;break;case"object":c=Un(n)?"array":n instanceof HTMLElement?"element":null===n?"null":"object";break;default:throw hv(e,r,i,Xa(n),n)}if("type"in i){if(c!==i.type)throw hv(e,r,i,c,n)}else if(!function(t,e,n){var r=Un(t)?ui:Ch;return n&&Fl(t,e,n)&&(e=void 0),r(t,co(e))}(i.oneOf,(function(t){return t===c})))throw hv(e,r,i,c,n)}))}function hv(t,e,n,r,i){var o,a;return new Eg(Mr(o="Invalid type of argument ".concat(e," - ")).call(o,n.name)+Mr(a=" when calling ".concat("exponea",".")).call(a,t,", ")+fv(n)+" but got ".concat(r,": ")+function(t,e){var n=String(t);"object"===e&&(n=ss(t));"array"===e&&(n="[".concat(n,"]"));if("element"===e){n="HTMLElement ".concat(t.tagName.toLowerCase())}n.length>128&&(n=n.substring(0,128)+"...");return n}(i,r))}function fv(t){return"type"in t?"expected ".concat(t.type):"expected one of ".concat(t.oneOf.join(", "))}var pv=(Zg=cv([{name:"callback",type:"function",optional:!0}],"notifications."),tv=cv([{name:"callback",type:"function",optional:!0}],"notifications."),ev=cv([{name:"callback",type:"function",optional:!0}],"notifications."),nv=cv([{name:"callback",type:"function"}],"notifications."),$f((rv=function(){function t(e,n){mn(this,t),this._=[],this.pushWebApi=e,this.pushSafariApi=n}return wn(t,[{key:"subscribe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.pushWebApi.isAvailable()?this.pushWebApi.subscribe(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.subscribe(t):t(Up.Unsupported)}},{key:"unsubscribe",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.pushWebApi.isAvailable()?this.pushWebApi.unsubscribe(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.unsubscribe(t):t(Up.Unsupported)}},{key:"isAvailable",value:function(t){var e=this.pushWebApi.isAvailable()||this.pushSafariApi.isAvailable();return t&&t(e),e}},{key:"isSubscribed",value:function(t){this.pushWebApi.isAvailable()?this.pushWebApi.isSubscribed(t):this.pushSafariApi.isAvailable()?this.pushSafariApi.isSubscribed(t):t(!1,!1)}}]),t}()).prototype,"subscribe",[Zg],Df(rv.prototype,"subscribe"),rv.prototype),$f(rv.prototype,"unsubscribe",[tv],Df(rv.prototype,"unsubscribe"),rv.prototype),$f(rv.prototype,"isAvailable",[ev],Df(rv.prototype,"isAvailable"),rv.prototype),$f(rv.prototype,"isSubscribed",[nv],Df(rv.prototype,"isSubscribed"),rv.prototype),rv);function dv(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function gv(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=dv(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=dv(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var vv=function(){function t(e,n,r,i,o){mn(this,t),this.window=e,this.config=n,this.customer=r,this.location=i,this.storageUtils=o}return wn(t,[{key:"subscribe",value:function(t){var e,n,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=gv({},this.config.getOptions().customer),a=this.getWebServiceUrl(),s=null===(e=this.config.getOptions().push.safari)||void 0===e?void 0:e.websitePushID;if(s&&(null===(n=this.window.safari)||void 0===n?void 0:n.pushNotification)){var c=this.window.safari.pushNotification.permission(s);if(c){var u=c.permission;"denied"!==u?this.window.safari.pushNotification.requestPermission(a,s,o,(function(e){var n=e.deviceToken,o=e.permission;"granted"===o&&(r.storageUtils.writeToStorage("localStorage","__exponea_safari_push_subscribed__",!0),r.customer.updateCustomer(gv({safari_push_notification:n},i))),t(r.getStatusForPermission(o))})):t(this.getStatusForPermission(u))}else t(Up.Error)}else t(Up.Unsupported)}},{key:"unsubscribe",value:function(t){this.storageUtils.writeToStorage("localStorage","__exponea_safari_push_subscribed__",!1),this.customer.updateCustomer({safari_push_notification:""},(function(){return t(Up.Unsubscribed)}),(function(){return t(Up.Error)}),!0)}},{key:"handleDeniedSubscription",value:function(){var t=this;this.isAvailable()&&this.isSafariSubscriptionEqual("denied")&&this.isPushTokenStoredInExponea((function(e){e&&t.unsubscribe((function(){}))}))}},{key:"isAvailable",value:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;return!(!(null===(t=this.window.safari)||void 0===t?void 0:t.pushNotification)||!(null===(e=this.config.getOptions().push.safari)||void 0===e?void 0:e.websitePushID)||"https:"!==n.protocol&&"localhost"!==n.hostname&&"127.0.0.1"!==n.hostname)}},{key:"isSubscribed",value:function(t){var e=this;this.isPushTokenStoredInExponea((function(n){t(e.isSafariSubscriptionEqual("granted")&&n,e.isSafariSubscriptionEqual("denied"))}))}},{key:"isPushTokenStoredInExponea",value:function(t){var e=this;Zf((function(){try{t(!!e.storageUtils.readBooleanFromStorage("localStorage","__exponea_safari_push_subscribed__"))}catch(e){t(!1)}}))}},{key:"isSafariSubscriptionEqual",value:function(t){var e,n,r=null===(e=this.window.safari)||void 0===e?void 0:e.pushNotification,i=null===(n=this.config.getOptions().push.safari)||void 0===n?void 0:n.websitePushID;return!(!r||!i)&&r.permission(i).permission===t}},{key:"getWebServiceUrl",value:function(){var t,e=this.config.getOptions().target,n=this.config.getToken(),r=e.replace(/\/$/,""),i=Mr(t="".concat(r,"/integrations/push/projects/")).call(t,n,"/safari");return/^\/\//.test(i)&&(i="https:"+i),i}},{key:"getStatusForPermission",value:function(t){switch(t){case"granted":return Up.Subscribed;case"denied":return Up.PermissionDenied;default:return Up.Default}}}]),t}();q({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(d(this)),n="",r=nt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});var mv=$("String").repeat,yv=String.prototype,bv=function(t){var e=t.repeat;return"string"==typeof t||t===yv||t instanceof String&&e===yv.repeat?mv:e};function wv(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function kv(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=wv(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=wv(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var _v,Sv,xv=function(){function t(e,n,r,i,o,a,s,c){var u=this;mn(this,t),this._setVapidKey=function(){},this.window=e,this.location=n,this.debug=r,this.logger=i,this.config=o,this.customer=a,this.queue=s,this.serviceWorkerManager=c,this.vapidKeyPromise=new Eu((function(t){return u._setVapidKey=t}))}return wn(t,[{key:"initialize",value:function(){this.isAvailable()&&this.requestVapidKey()}},{key:"subscribe",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Notification;"granted"===r.permission?this.subscribeServiceWorker(t,n):r.requestPermission((function(r){"granted"===r?e.subscribeServiceWorker(t,n):t("default"===r?Up.Default:Up.PermissionDenied)}))}},{key:"unsubscribe",value:function(t){var e=this;this.serviceWorkerManager.isReady().then((function(t){return t.pushManager.getSubscription()})).then((function(t){if(t)return t.unsubscribe().then((function(t){if(!t)throw new Error("Failed to unsubscribe");e.notifyServer(!1)}))})).then((function(){return t(Up.Unsubscribed)})).catch((function(){return t(Up.Error)}))}},{key:"isAvailable",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location,e=this.window;return"Notification"in e&&"PushManager"in e&&this.serviceWorkerManager.isAvailable()&&"showNotification"in e.ServiceWorkerRegistration.prototype&&("https:"===t.protocol||"localhost"===t.hostname||"127.0.0.1"===t.hostname)}},{key:"isSubscribed",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Notification,r=n.permission,i="denied"===r;"granted"===r&&this.serviceWorkerManager.isAvailable()?this.serviceWorkerManager.register().then((function(){return e.serviceWorkerManager.isReady()})).then((function(t){return t.pushManager.getSubscription()})).then((function(t){if(!t)throw new Error("Missing push notification subscription");return t})).then((function(){return e.config.storeInIndexedDB()})).then((function(){t(!0,i)})).catch((function(n){e.logger.error("Failed to check whether the user is subscribed:",n),t(!1,i)})):t(!1,i)}},{key:"notifyServer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){var n=t.data,r=t.vapidKey;e.browser_push_notification=n,e.browser_push_notification_vapid_key=r||""}else e.browser_push_notification="",e.browser_push_notification_vapid_key="";this.customer.updateCustomer(e,void 0,void 0,!0)}},{key:"subscribeServiceWorker",value:function(t,e){var n=this;this.serviceWorkerManager.register().then((function(){return n.serviceWorkerManager.isReady()})).then((function(t){return n.config.storeInIndexedDB().then((function(){return n.vapidKeyPromise})).then((function(t){if(void 0===t)return{vapidKey:void 0,vapidKeyUint8Array:void 0};try{return{vapidKey:t,vapidKeyUint8Array:Tv(t)}}catch(t){throw n.debug.error(new Error("Could not convert vapid key to Uint8Array. Maybe it is not in the Base64 format?")),t}})).then((function(e){var n=e.vapidKey,r=e.vapidKeyUint8Array;return t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r}).then((function(t){return{subscription:t,vapidKey:n}}))}))})).then((function(r){var i=r.subscription,o=r.vapidKey,a=kv(kv({},i.toJSON()),{},{vapidKey:!!o});n.notifyServer({data:a,vapidKey:o},e),t(Up.Subscribed)})).catch((function(e){n.logger.error("Failed to subscribe the push notifications because of:",e),t(Up.Error)}))}},{key:"requestVapidKey",value:function(){var t=this;this.queue.enqueue({name:dl.PushNotificationsVapidKey,prepareData:function(){return{data:{company_id:t.config.getToken()}}},processResponse:function(e){var n=e.data.vapidKey;t.debug.log("Vapid key for browser push notifications is ".concat(n)),t._setVapidKey(n)},processError:function(){t._setVapidKey(void 0)}})}}]),t}();function Tv(t){for(var e,n=(t+bv(e="=").call(e,(4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(n),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r.charCodeAt(o);return i}var Ev=(_v=pp("QueryTracking.initialize"),$f((Sv=function(){function t(e,n,r,i,o,a,s,c,u,l,h,f){mn(this,t),this.tracing=e,this.config=n,this.queue=r,this.debug=i,this.timestamp=o,this.automaticTracking=a,this.window=s,this.eventTracker=c,this.customer=u,this.liveEventHandler=l,this.storageUtils=h,this.url=f}return wn(t,[{key:"initialize",value:function(){this.config.getOptions().track.auto&&(this.liveEventHandler.initialize(),this._getTrackingDefinition())}},{key:"_getTrackingDefinition",value:function(){this.debug.log("attempting to get tracking definition");var t=this._getCachedTrackingDefinition();t?this._trackByRules(t):this._fetchTrackingDefinitionAndTrackByRules()}},{key:"_getCachedTrackingDefinition",value:function(){var t=this.storageUtils.readStringFromStorage("sessionStorage","__exponea_tracking_definition__");if(!t)return this.debug.log("tracking definition not found in session storage"),null;this.debug.log("tracking definition found in session storage",t);var e=null;try{e=JSON.parse(t)}catch(t){this.debug.error("failed parsing cached tracked definition")}if(e){if(e.expires>this.timestamp.getUnixTimestamp())return e.data;this.debug.warn("tracking definition from session storage is expired")}return null}},{key:"_fetchTrackingDefinitionAndTrackByRules",value:function(){var t=this;this.queue.enqueue({name:dl.Tracking,prepareData:function(){return t.debug.log("fetching automatic tracking definition"),{data:{company_id:t.config.getToken()}}},processResponse:function(e){var n=e.data;t._storeTrackingDefinitionIntoCache(n),t._trackByRules(n)},processError:function(e){t.debug.error("Error getting automatic tracking definition",e)}})}},{key:"_trackByRules",value:function(t){var e=this;this._doTrackByRules(t),this.config.isSpaReloadingEnabled("automatic_tracking")&&this.url.onChange("QueryTracking.doTrackByRulesOnUrlChange",(function(){e.liveEventHandler.clearLiveEventListeners(),e._doTrackByRules(t)}))}},{key:"_doTrackByRules",value:function(t){var e,n=this;ln(e=Do(t).call(t,(function(t){return Zp.matches(n.window.location.href,t.trigger)}))).call(e,(function(t){"visit"===t.trigger.type?n._doTrackAction(t.action,null):"click"===t.trigger.type?n._doBindOnClickHandlers(t.trigger.selector,t.action):"submit"===t.trigger.type&&n._doBindOnSubmitHandlers(t.trigger.selector,t.action)}))}},{key:"_doBindOnClickHandlers",value:function(t,e){var n=this;this.liveEventHandler.addLiveEventListener("click",t,(function(t){n._doTrackAction(e,t.target,{immediate:!Lg})}))}},{key:"_doBindOnSubmitHandlers",value:function(t,e){var n=this;this.liveEventHandler.addLiveEventListener("submit",t,(function(t){n._doTrackAction(e,t.target,{immediate:!Lg})}))}},{key:"_storeTrackingDefinitionIntoCache",value:function(t){this.storageUtils.writeToStorage("sessionStorage","__exponea_tracking_definition__",ss({expires:this.timestamp.getUnixTimestamp()+3600,data:t}))}},{key:"_doTrackAction",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"track"===t.type?this.automaticTracking.materializeProperties(t.properties,e,this.tracing.trace("trackEvent",(function(e){n.eventTracker.track(t.event_type,e,r)}))):"identify"===t.type?this.automaticTracking.materializeIds(t.as_who,e,this.tracing.trace("identifyCustomer",(function(t){n.customer.identifyCustomer(t,{},void 0,void 0,r.immediate)}))):"update"===t.type&&this.automaticTracking.materializeProperties(t.properties,e,this.tracing.trace("updateCustomer",(function(t){n.customer.updateCustomer(t,void 0,void 0,r.immediate)})))}}]),t}()).prototype,"initialize",[_v],Df(Sv.prototype,"initialize"),Sv.prototype),Sv),Av=c.f,Ov=function(t){return function(e){for(var n,r=g(e),i=de(r),a=i.length,s=0,c=[];a>s;)n=i[s++],o&&!Av.call(r,n)||c.push(t?[n,r[n]]:r[n]);return c}},Cv={entries:Ov(!0),values:Ov(!1)}.entries;q({target:"Object",stat:!0},{entries:function(t){return Cv(t)}});var jv=I.Object.entries,Pv={track:!1,callback:!0,retry:!0},Lv=function(){function t(e,n,r,i,o){mn(this,t),this.options=e,this.tracing=n,this.timestamp=r,this.debug=i,this.config=o,this.enqueuedAt=this.timestamp.getUnixTimestamp(),this.commandSpan=this.tracing.registerNewSpan("command"),this.commandSpan.addTags({command_name:e.name}),this.commandSpan.start(),this.requestSpan=this.tracing.registerNewSpan("httpRequest",this.commandSpan),this.commandSpan.end(),this.targetUrl=this.getCommandTargetUrl(),this.setApiCallPropertyOnRequestSpan()}return wn(t,[{key:"name",get:function(){return this.options.name}}]),wn(t,[{key:"processResponse",value:function(t,e,n){var r=this.options.processResponse;if(!r)return this.requestSpan.end();var i=this.tracing.registerNewSpan(this.requestSpan);op(this.debug,i,(function(){return r(t,e,n)}),!0),this.requestSpan.end()}},{key:"processError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((e=Wl(e,Pv)).track&&this.requestSpan.setError(t),e.callback&&this.options.processError){var n=this.tracing.registerNewSpan(this.requestSpan),r=this.options.processError;op(this.debug,n,(function(){return r(t)}),!0)}if(e.retry){var i=this.requestSpan;this.requestSpan=this.tracing.registerNewSpan("httpRequest",this.commandSpan),this.setApiCallPropertyOnRequestSpan(),i.end()}else this.requestSpan.end()}},{key:"prepareData",value:function(t){this.requestSpan.start();var e=this.options.prepareData;if(!e)return{state:void 0};try{return op(this.debug,this.commandSpan,(function(){return e(t)}))}catch(t){this.processError(t,{retry:!1})}}},{key:"cancel",value:function(){this.commandSpan.destroy()}},{key:"setApiCallPropertyOnRequestSpan",value:function(){this.requestSpan.setApiCall({method:this.getHttpRequestMethod(),url:this.targetUrl})}},{key:"getHttpRequestMethod",value:function(){return Bv(this)?"POST":"GET"}},{key:"getCommandTargetUrl",value:function(){var t;return Rv(this)?Iv(Mr(t="".concat(this.config.getOptions().target,"/")).call(t,this.name),this.config):Iv("".concat(this.config.getOptions().target,"/bulk"),this.config)}}]),t}();function Iv(t,e){var n=e.getToken();return t.replace(/<project_id>/g,n)}function Bv(t){return!Rv(t)||t.options.httpMethod!==mg.get}function Dv(t){return!t.options.noBulk}function Rv(t){return!!t.options.noBulk}function Mv(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return zv(t,e,n)}function zv(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return function(){return r++,void Zf((function(){var i=e*n;i>36e5&&(i=36e5);if(r>=100)return void t();var o=zv(t,i,n,r);t(o)}),e)}}var Nv=function(){function t(e){mn(this,t),this.takenTokens=0,this.capacity=e}return wn(t,[{key:"takeToken",value:function(){if(this.takenTokens===this.capacity)throw new Error("There is no free token to take");this.takenTokens++}},{key:"releaseToken",value:function(){if(!this.takenTokens)throw new Error("There are no taken tickets");this.takenTokens--}},{key:"hasFreeToken",value:function(){return this.takenTokens<this.capacity}}]),t}();function Fv(t,e){var n;if(void 0===Op||null==Ap(t)){if(Ep(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return Uv(t,e);var r=oa(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return vl(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uv(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=ws(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Uv(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var qv=jl({maxCommandsInQueue:1e3,maxCommandsProcessedInParallel:500,maxCommandsInBulkRequest:50,processDebounceTime:100}),Wv=jl({first:!1,process:Tf.defer}),Hv=function(){function t(e,n,r,i,o,a,s){var c=this,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:s.navigator;mn(this,t),this.commandsList=[],this.isProcessingBlockingCommands=!1,this.numberOfEnqueuedCommandsIgnored=0,this.tracing=e,this.config=n,this.http=r,this.debug=i,this.timestamp=o,this.unloader=a,this.window=s,this.navigator=l,this.options=jl(Wl(u,qv)),this.unloader.addAfterListener((function(){c.sendBulkWithBeacon()})),this.tokenSystem=new Nv(this.options.maxCommandsProcessedInParallel),this.debounceProcess=mh((function(){return c.process()}),this.options.processDebounceTime)}return wn(t,[{key:"length",get:function(){return this.commandsList.length}}]),wn(t,[{key:"enqueue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e=Wl(e,Wv),this.debug.log("Enqueuing command "+t.name),this.isQueueExceeded())return this.debounceProcess(),!1;var n=new Lv(t,this.tracing,this.timestamp,this.debug,this.config);return e.first?this.commandsList.unshift(n):this.commandsList.push(n),e.process===Tf.immediate?this.process():e.process===Tf.defer?this.debounceProcess():this.debug.debug("Queue is not processing the enqueued command because 'process' is false"),!0}},{key:"execute",value:function(t){var e,n=this;this.debug.log("Executing command "+t.name);var r=new Lv(t,this.tracing,this.timestamp,this.debug,this.config),i=Mv((function(t){var e;Kv(r,n.tokenSystem,n.debug,Z(e=n.sendSingle).call(e,n),t)}),this.options.processDebounceTime,1);Kv(r,this.tokenSystem,this.debug,Z(e=this.sendSingle).call(e,this),i)}},{key:"clear",value:function(){var t;ln(t=this.commandsList).call(t,(function(t){return t.cancel()})),this.commandsList=[]}},{key:"process",value:function(){var t=this;if(this.commandsList.length<=0)this.debug.debug("Queue is empty, there are no commands to process");else{if(this.isProcessingBlockingCommands)return this.debug.debug("Queue is currently processing blocking commands and has to wait"),void this.debounceProcess();this.debug.debug("Processing queue commands"),this.debug.debug("There are ".concat(this.length," enqueued commands"));for(var e=[],n=this.commandsList.shift();n;n=this.commandsList.shift()){if(Rv(n)){var r,i=Qv(n,this.tokenSystem,Z(r=this.sendSingle).call(r,this));i&&e.push(i)}else{var o,a=$v(n,this.commandsList,this.tokenSystem,this.debug,this.options,(function(){return t.isProcessingBlockingCommands=!0}),Z(o=this.sendBulk).call(o,this));e.push.apply(e,ip(a))}if(this.isProcessingBlockingCommands){this.debug.debug("Queue is now blocked and it cannot continue processing commands"),e.push.apply(e,ip(this.commandsList));break}}this.debug.debug("Queue commands have been processed"),this.debug.debug("There are ".concat(e.length," commands that will ")+"be processed in the next batch after a timeout",e),this.commandsList=e,this.commandsList.length>0&&this.debounceProcess()}}},{key:"sendBulkWithBeacon",value:function(){var t,e;if(0!==this.commandsList.length){var n=Do(t=this.commandsList).call(t,Dv);this.debug.log("Queue is sending "+n.length+"/"+this.commandsList.length+" commands with beacon",n);var r;if(this.commandsList=Do(e=this.commandsList).call(e,(r=Dv,function(t){return!r(t)})),0!==n.length){var i=this.config.getOptions().target+"/bulk",o=Vv(n,this.timestamp).bulkData,a=new Blob([ss({beacon:!0,commands:o})],{type:"application/json"});this.navigator.sendBeacon(i,a)||this.debug.warn("Beacon data has not been queued for transfer!")}}}},{key:"sendBulk",value:function(t,e){var n=this;if(t.length){var r="".concat(this.config.getOptions().target,"/bulk"),i=Vv(t,this.timestamp),o=i.bulkData,a=i.commandStates,s={sdk:"js-client",sdk_version:"v2.20.0",sdk_snippet_version:xg(this.window),commands:o};this.debug.log("Queue is sending ".concat(t.length," commands in bulk"),t),this.http.post(r,s).then((function(e){var r=e.body;ln(t).call(t,(function(t,e){t.options.isBlocking&&(n.isProcessingBlockingCommands=!1);var i=r.results[e];"ok"===i.status?t.processResponse(i,a[e],{start_time:r.start_time,end_time:r.end_time}):t.processError(new Error(i.errors.join(", ")),{retry:!1}),n.tokenSystem.releaseToken()}))})).catch((function(r){n.debug.warn("Queue bulk request failed with errors:",r),Gv(r)&&r.response.status<500?ln(t).call(t,(function(t){t.processError(r,{retry:!1}),n.tokenSystem.releaseToken()})):(ln(t).call(t,(function(t){return t.processError(r,{callback:!1})})),e?(n.debug.log("Retrying the request...",t),e()):ln(t).call(t,(function(t){return t.processError(new Error("Command queue retry limit reached!"))})))}))}}},{key:"sendSingle",value:function(t,e){var n=this,r=this.timestamp.getTimestamp(),i=t.prepareData(r);i&&(this.debug.log("Queue is sending a single command "+t.name,t),function(t,e,n){if(Bv(e))return t.post(e.targetUrl,n.data);return t.get(e.targetUrl)}(this.http,t,i).then((function(e){t.options.isBlocking&&(n.isProcessingBlockingCommands=!1),t.processResponse(e.body,i.state),n.tokenSystem.releaseToken()})).catch((function(r){if(n.debug.warn("Queue single command request failed with errors:",r),Gv(r)&&r.response.status<500){var i=new Error(function(t){var e,n=t.response.body;if("string"==typeof n)return n;return kf(e=jv(n.errors||{})).call(e,(function(t){var e,n=Us(t,2),r=n[0],i=n[1];return Mr(e="".concat(r,": ")).call(e,i.join(", "))})).join("; ")}(r));t.processError(i,{retry:!1}),n.tokenSystem.releaseToken()}else t.processError(r,{callback:!1}),e?(n.debug.log("Retrying the request...",t),e()):t.processError(new Error("Command queue retry limit reached!"))})))}},{key:"isQueueExceeded",value:function(){var t=this.commandsList.length>=this.options.maxCommandsInQueue;return t?(this.numberOfEnqueuedCommandsIgnored+=1,1===this.numberOfEnqueuedCommandsIgnored&&this.debug.warn("Maximum queue length has been exceeded, further commands will be ignored")):this.numberOfEnqueuedCommandsIgnored>0&&(this.debug.debug("Queue has been processed and it can receive commands again. There were ".concat(this.numberOfEnqueuedCommandsIgnored," commands that were ignored.")),this.numberOfEnqueuedCommandsIgnored=0),t}}]),t}();function Gv(t){return t instanceof vg}function Vv(t,e){var n,r=[],i=[],o=e.getTimestamp(),a=Fv(t);try{for(a.s();!(n=a.n()).done;){var s=n.value,c=s.prepareData(o);c&&(r.push({name:s.name,data:c.data}),i.push(c.state))}}catch(t){a.e(t)}finally{a.f()}return{bulkData:r,commandStates:i}}function Kv(t,e,n,r,i){if(Qv(t,e,r)){if(!i){var o="Max retry count reached for ".concat(t.name);return n.error(o),void t.processError(new Error(o))}n.log("Retry ".concat(t.name," execution later because there were no free tokens...")),i()}}function Qv(t,e,n){if(!e.hasFreeToken())return t;e.takeToken();var r=Mv((function(e){n(t,e)}));return n(t,r),null}function $v(t,e,n,r,i,o,a){for(var s=[],c=[],u=[];t;t=e.shift())if(Rv(t))c.push(t);else if(n.hasFreeToken()){if(n.takeToken(),t.options.isBlocking&&(o(),r.log("Queue encountered a blocking command"),r.log("Further requests will not be made until this one finishes")),s.push(t),s.length>=i.maxCommandsInBulkRequest)break}else u.push(t);e.unshift.apply(e,ip(c));var l=Mv((function(t){return a(s,t)}));return a(s,l),u}var Jv=function(){function t(e,n,r){mn(this,t),this.config=e,this.queue=n,this.debug=r}return wn(t,[{key:"fetch",value:function(t,e){var n,r=this;n=_h(t)?this.migrateOldGetRecommendationSignature.apply(this,e):t,this.queue.enqueue({name:gl.Recommendation,noBulk:!0,prepareData:function(){return r.debug.log("Get recommendations: ",n.recommendationId),{data:r.processGetRecommendationOptions(n)}},processResponse:function(t){tp((function(){n.callback(t.data)}))}})}},{key:"processGetRecommendationOptions",value:function(t){var e=this.config.getOptions(),n={project_id:this.config.getToken(),customer_ids:e.customer,engine_id:t.recommendationId,anti:!!t.anti,similarity:!!t.similarity,anonymous:!!t.anonymous,consider_known_items:!!t.considerKnowItems,fill_with_random:t.fillWithRandom,catalog_filter:t.catalogFilter,catalog_attributes_whitelist:t.catalogAttributesWhitelist,category_names:t.categoryNames};if(t.size&&(n.size=t.size),t.strategy&&(n.strategy=t.strategy),t.item)n.items={},n.items[t.item]=1;else if(Un(t.items)&&t.items.length>0){n.items={};for(var r=0;r<t.items.length;r++)n.items[t.items[r]]=1}else hr(t.items)&&!function(t){if(null==t)return!0;if(pr(t)&&(Un(t)||"string"==typeof t||"function"==typeof t.splice||Gn(t)||nr(t)||Fn(t)))return!t.length;var e=Di(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(ar(t))return!lr(t).length;for(var n in t)if(Oh.call(t,n))return!1;return!0}(t.items)&&(n.items=t.items);return t.noTrack&&(n.no_track=t.noTrack),n}},{key:"migrateOldGetRecommendationSignature",value:function(t,e,n,r,i){return{recommendationId:t,callback:e,size:n,strategy:r,item:i}}}]),t}(),Yv=function(){function t(e,n,r){mn(this,t),this.window=e,this.debug=n,this.config=r}return wn(t,[{key:"isAvailable",value:function(){return"serviceWorker"in this.window.navigator&&"ServiceWorkerRegistration"in this.window}},{key:"register",value:function(){var t=this;return this.serviceWorker.register(this.serviceWorkerPath,{updateViaCache:"none"}).catch((function(e){throw t.debug.error("Failed to the register service worker on '".concat(t.serviceWorkerPath,"' because of:"),e),e}))}},{key:"isReady",value:function(){return this.serviceWorker.ready}},{key:"isRegistered",value:function(){return this.serviceWorker.getRegistration(this.serviceWorkerPath).then((function(t){return!!t}))}},{key:"serviceWorker",get:function(){return this.window.navigator.serviceWorker}},{key:"serviceWorkerPath",get:function(){return this.config.getOptions().service_worker_path}}]),t}(),Xv=Ks.trim,Zv=r.parseInt,tm=/^[+-]?0[Xx]/,em=8!==Zv(qs+"08")||22!==Zv(qs+"0x16")?function(t,e){var n=Xv(String(t));return Zv(n,e>>>0||(tm.test(n)?16:10))}:Zv;q({global:!0,forced:parseInt!=em},{parseInt:em});var nm=I.parseInt,rm=function(){function t(e,n,r){mn(this,t),this.logger=e,this.localStorage=n,this.sessionStorage=r,this.isAvailable={localStorage:im(n),sessionStorage:im(r)}}return wn(t,[{key:"writeToStorage",value:function(t,e,n){if(!this.isStorageAvailable(t))return!1;try{return hr(n)?this.getStorage(t).setItem(e,ss(n)):this.getStorage(t).setItem(e,String(n)),!0}catch(t){return this.logger.error("Couldn't write to local storage, some features may be broken.",t),!1}}},{key:"removeFromStorage",value:function(t,e){return!!this.isStorageAvailable(t)&&(this.getStorage(t).removeItem(e),!0)}},{key:"readStringFromStorage",value:function(t,e){if(!this.isStorageAvailable(t))return null;try{return this.getStorage(t).getItem(e)}catch(t){return null}}},{key:"readNumberFromStorage",value:function(t,e){var n=this.readStringFromStorage(t,e);if(!n)return null;var r=nm(n,10);return isNaN(r)?null:r}},{key:"readBooleanFromStorage",value:function(t,e){var n=this.readStringFromStorage(t,e);return null===n?null:"true"===n}},{key:"isStorageAvailable",value:function(t){return this.isAvailable[t]}},{key:"getStorage",value:function(t){return this[t]}}]),t}();function im(t){try{var e="__".concat("exponea","_storage_test__");return t.setItem(e,e),t.removeItem(e),!0}catch(t){return!1}}var om=function(){function t(e,n,r,i){mn(this,t),this.timeInitialized=!1,this.timestamp=e,this.queue=n,this.cookies=r,this.debug=i}return wn(t,[{key:"isTimeInitialized",value:function(){return this.timeInitialized}},{key:"queryTime",value:function(t){var e=this;if(!this.timeInitialized){var n=this.cookies.getCookie("__exponea_time2__");if("string"==typeof n&&(this.debug.log("getting time offset from cookie",n),n=Number(n),!isNaN(n)))return this.debug.log("timestamp is valid number, choosing"),this.timestamp.timestampOffset=n,this.timeInitialized=!0,void this.cookies.setCookie("__exponea_time2__",n.toString(),"time");this.debug.log("no time offset stored, getting from server");var r=this.timestamp,i=this.cookies;this.queue.enqueue({name:dl.Time,prepareData:function(){var t=r.getTimestamp(),n={clientTS:t};return e.debug.log("getting server timestamp",n),{data:n,state:{clientTS:t}}},processResponse:function(n,o,a){var s=o.clientTS,c=r.getTimestamp();if(a&&a.start_time&&a.end_time){var u=c-s-(a.end_time-a.start_time);r.timestampOffset=a.end_time+u/2-c}else{e.debug.log("received time response",n);var l=n.time,h=c-(c-s)/2;r.timestampOffset=l-h}e.debug.log("time offset is ".concat(r.timestampOffset," ")),i.setCookie("__exponea_time2__",r.timestampOffset.toString(),"time"),t&&t()}},{first:!0})}}}]),t}(),am=function(){function t(e){mn(this,t),this.lastUsedTimestamp=null,this.timestampOffsetValue=0,this.storageUtils=e}return wn(t,[{key:"getUnixTimestamp",value:function(){return(new Date).getTime()/1e3}},{key:"storeTimestamp",value:function(t,e){this.storageUtils.writeToStorage("localStorage",t,e)}},{key:"getStoredTimestamp",value:function(t){return this.storageUtils.readNumberFromStorage("localStorage",t)}},{key:"getTimestamp",value:function(){var t=this.getUnixTimestamp();return null!=this.lastUsedTimestamp&&this.lastUsedTimestamp>=t&&(t=this.lastUsedTimestamp+.001),this.lastUsedTimestamp=t,t}},{key:"getTimestampWithOffset",value:function(){return this.getTimestamp()+this.timestampOffsetValue}},{key:"timestampOffset",set:function(t){this.timestampOffsetValue=t},get:function(){return this.timestampOffsetValue}}]),t}(),sm=Ze.every,cm=tn("every"),um=pt("every");q({target:"Array",proto:!0,forced:!cm||!um},{every:function(t){return sm(this,t,arguments.length>1?arguments[1]:void 0)}});var lm=$("Array").every,hm=Array.prototype,fm=function(t){var e=t.every;return t===hm||t instanceof Array&&e===hm.every?lm:e},pm=Ze.some,dm=tn("some"),gm=pt("some");q({target:"Array",proto:!0,forced:!dm||!gm},{some:function(t){return pm(this,t,arguments.length>1?arguments[1]:void 0)}});var vm,mm=$("Array").some,ym=Array.prototype,bm=function(t){var e=t.some;return t===ym||t instanceof Array&&e===ym.some?mm:e};function wm(){return"object"===Xa(window.performance)&&"function"==typeof window.performance.now?performance.now():cs()}!function(t){t[t.Enabled=1]="Enabled",t[t.DisabledByOptions=2]="DisabledByOptions",t[t.DisabledBecauseOfMissingToken=3]="DisabledBecauseOfMissingToken"}(vm||(vm={}));var km=function(){function t(e,n,r,i,o){var a;mn(this,t),this._sendingTraces=!1,this._update=mh(Z(a=this.sendTrace).call(a,this),4e3),this._target="//sdk-tracing.exponea.com/webxp-trace/record/browser/v1",this._serializedSpansToSend=[],this._children=[],this.config=e,this.debug=n,this.http=r,this.featureFlags=i,this.isTraceSampled=o,this._id=yl(32)}return wn(t,[{key:"children",get:function(){return this._children}},{key:"operationName",get:function(){return"traceRoot"}}]),wn(t,[{key:"serialize",value:function(){var t;return this.isTracingEnabled()!==vm.Enabled?(this._removeSerializableSpans(),null):{id:this._id,instance_id:"CIS",sdk_version:"v2.20.0",company_id:this.config.getToken(),spans:Mr(t=[]).call(t,ip(this._serializeSpans()),ip(this._serializedSpansToSend))}}},{key:"isTracingEnabled",value:function(){try{this.config.getToken()}catch(t){return vm.DisabledBecauseOfMissingToken}return!1!==this._getErrorReportingOption()?vm.Enabled:vm.DisabledByOptions}},{key:"sendTrace",value:function(){var t=this;if(!this._sendingTraces){var e=this.serialize();e&&e.spans.length?(this._sendingTraces=!0,this.debug.log("Sending trace",e),this._sendTrace(e).then((function(){var n;t._sendingTraces=!1,t._removeSpansById(kf(n=e.spans).call(n,(function(t){return t.id}))),t._serializedSpansToSend=[],t.debug.log("Trace was successfully sent")})).catch((function(e){t._sendingTraces=!1,t.debug.error("Error while sending the trace",e)}))):e||this.isTracingEnabled()!==vm.DisabledBecauseOfMissingToken||this.debug.warn('Trace won\'t be send because "token" is missing from the config object')}}},{key:"sendTraceWithBeacon",value:function(){if(!this._sendingTraces&&Lg){var t=this.serialize();if(t&&t.spans.length){this.debug.log("Sending trace with beacon",t);var e=new Blob([ss(t)],{type:"application/json"});navigator.sendBeacon(this._target,e)}}}},{key:"addSerializedSpanToSend",value:function(){for(var t,e=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=Do(r).call(r,(function(t){var n;return!Uo(n=e._serializedSpansToSend).call(n,(function(e){return e.id===t.id}))}));(t=this._serializedSpansToSend).push.apply(t,ip(o))}},{key:"_serializeSpans",value:function(){var t,e,n,r,i,o,a,s,c;return ln(t=Do(e=Do(n=this._children).call(n,(function(t){return t.canBeSerialized()}))).call(e,(a=this.isTraceSampled,s=this._getErrorReportingOption(),c=this.featureFlags,o=function(t){return"errors_only"===s?t.hasErrorDeep():s&&pd(c).sdk854_implement_trace_sampling?a||t.hasErrorDeep():s},function(){return!o.apply(void 0,arguments)}))).call(t,(function(t){return t.destroy()})),Uh(r=Do(i=this._children).call(i,(function(t){return t.canBeSerialized()}))).call(r,(function(t,e){return function t(e,n){var r,i=e.serialize();i&&n.push(i);return ln(r=e.children).call(r,(function(e){return t(e,n)})),n}(e,t)}),[])}},{key:"_addChildSpan",value:function(t){this.children.push(t)}},{key:"_removeSpansById",value:function(t){var e;this._children=Do(e=this._children).call(e,(function(e){var n=e.id;return-1===Jo(t).call(t,n)}))}},{key:"_sendTrace",value:function(t){return this.http.post(this._target,t,{responseType:"text",headers:{"Content-type":"application/json"},credentials:"omit"})}},{key:"_removeSerializableSpans",value:function(){var t,e;this._removeSpansById(kf(t=Do(e=this._children).call(e,(function(t){return t.canBeSerialized()}))).call(t,(function(t){return t.id})))}},{key:"_getErrorReportingOption",value:function(){return this.config.getOptions().error_reporting}}]),t}();function _m(t,e){var n=ul(t);if(Rf){var r=Rf(t);e&&(r=Do(r).call(r,(function(e){return Df(t,e).enumerable}))),n.push.apply(n,r)}return n}function Sm(t){for(var e=1;e<arguments.length;e++){var n,r=null!=arguments[e]?arguments[e]:{};if(e%2)ln(n=_m(Object(r),!0)).call(n,(function(e){Ef(t,e,r[e])}));else if(Lf)jf(t,Lf(r));else{var i;ln(i=_m(Object(r))).call(i,(function(e){H(t,e,Df(r,e))}))}}return t}var xm=function(){function t(e,n,r,i,o,a){var s;mn(this,t),this.children=[],this._getPrecisionTime=wm,this._state=ap.State.Waiting,this._tags={},this.parent=e,this.operation=n,this.debug=r,this.spanStack=i,this.id=yl(16),e._addChildSpan(this),this.debug.debug(Mr(s="Registered child span '".concat(this.operationName,"' of '")).call(s,e.operationName,"'"),this),this.isTransient()&&e instanceof km&&this.debug.warn("Registered transient span as a child of the root trace, this span will not be serialized and sent in trace.",this),this.addTags({url:o.href.split(/[?#]/)[0],host:o.hostname,is_sampled:a.toString()})}return wn(t,[{key:"tags",get:function(){return this._tags}},{key:"startTime",get:function(){return this._startTime}},{key:"startPrecisionTime",get:function(){return this._startPrecisionTime}},{key:"endPrecisionTimeSync",get:function(){return this._endPrecisionTimeSync}},{key:"endPrecisionTimeAsync",get:function(){return this._endPrecisionTimeAsync}},{key:"state",get:function(){return this._state}},{key:"name",get:function(){return this.operation}},{key:"duration",get:function(){if(!this.endPrecisionTimeAsync)throw new Error("Span ".concat(this.operationName," still has some async children running so cannot calculate async duration"));if(!this.startPrecisionTime)throw new Error("Span ".concat(this.operationName," wasn't started yet so cannot calculate duration"));return(this.endPrecisionTimeAsync-this.startPrecisionTime)/1e3}},{key:"syncDuration",get:function(){if(!this.endPrecisionTimeSync)throw new Error("Span ".concat(this.operationName," wasn't ended yet so cannot calculate duration"));if(!this.startPrecisionTime)throw new Error("Span ".concat(this.operationName," wasn't started yet so cannot calculate duration"));return(this.endPrecisionTimeSync-this.startPrecisionTime)/1e3}},{key:"parentSpan",get:function(){return this.parent}},{key:"operationName",get:function(){return"object"===Xa(this.operation)?"transientOperation":this.operation}}]),wn(t,[{key:"isChildOfTrace",value:function(){return this.parent instanceof km}},{key:"destroy",value:function(){var e=this.parent;e instanceof t?e._removeChildSpan(this):e._removeSpansById([this.id]),this.parent._update()}},{key:"start",value:function(){this.isWaiting()&&(this._state=ap.State.Running,this.spanStack.push(this),this._startTime=cs()/1e3,this._startPrecisionTime=this._getPrecisionTime(),this.debug.debug("Span '".concat(this.operationName,"' started"),this))}},{key:"hasError",value:function(t){return!!this._error&&(t instanceof Error?this._error.name===t.name&&this._error.message===t.message:this._error.message===String(t))}},{key:"hasErrorDeep",value:function(){var t;return!!this._error||bm(t=this.children).call(t,(function(t){return t.hasErrorDeep()}))}},{key:"isErrorAlreadyTracked",value:function(t){var e;return bm(e=this.children).call(e,(function(e){return e.isTransient()?e.isErrorAlreadyTracked(t):e.hasError(t)}))}},{key:"setError",value:function(t){var e;e=t instanceof Error?t:new Error(String(t)),this.isErrorAlreadyTracked(t)||(e.name||(e.name="Unknown Error"),this._error={name:e.name,message:e.message,stack:this._getErrorStack(e)})}},{key:"setApiCall",value:function(t){this._apiCall=t}},{key:"end",value:function(){var t;this.isRunning()&&(this._endPrecisionTimeSync=this._getPrecisionTime(),this.debug.debug(Mr(t="Span '".concat(this.operationName,"' ended in ")).call(t,this.syncDuration,"ms"),this),this._state=ap.State.EndedSync,this.spanStack.pop(),this._update())}},{key:"isTransient",value:function(){return"object"===Xa(this.operation)}},{key:"isRunning",value:function(){return this.state===ap.State.Running}},{key:"isWaiting",value:function(){return this.state===ap.State.Waiting}},{key:"isEndedSync",value:function(){return this.state===ap.State.EndedSync}},{key:"isEndedAsync",value:function(){return this.state===ap.State.EndedAsync}},{key:"canBeSerialized",value:function(){return this.isEndedAsync()}},{key:"serialize",value:function(){if(!this.canBeSerialized()||this.isTransient()||!this.startTime)return null;var e={id:this.id,start_time:this.startTime,duration:this.duration,operation:this.operation,tags:this.tags},n=this._getParentSpan();return n instanceof t&&(e.parent_span_id=n.id),this._error&&(e.error=this._error),this._apiCall&&(e.api_call=this._apiCall),e}},{key:"addTags",value:function(t){this._tags=Sm(Sm({},this.tags),t)}},{key:"getSpanStackTrace",value:function(){for(var e=[],n=this;n instanceof t&&e.length<10;)e.push(n.operationName),n=n.parent;return e}},{key:"_getParentSpan",value:function(){for(var e=this.parentSpan;e&&e instanceof t&&e.isTransient();)e=e.parent;return e}},{key:"_addChildSpan",value:function(t){this.children.push(t)}},{key:"_removeChildSpan",value:function(t){var e,n,r=Jo(e=this.children).call(e,t);-1!==r&&ko(n=this.children).call(n,r,1)}},{key:"_update",value:function(){var t,e;this.isEndedSync()&&(fm(t=this.children).call(t,(function(t){return t.isEndedAsync()}))&&(this._state=ap.State.EndedAsync,this._endPrecisionTimeAsync=this._getPrecisionTime(),this.debug.debug(Mr(e="Span '".concat(this.operationName,"' ended in ")).call(e,this.duration,"ms"),this),this.parent._update()))}},{key:"_getErrorStack",value:function(t){var e,n,r,i=kf(e=this.getSpanStackTrace()).call(e,(function(t){return"   at ".concat(t," (span:0:0)")})).join("\n");return Mr(n=Mr(r="".concat(t.name,": ")).call(r,t.message,"\n")).call(n,i)}}]),t}();var Tm=function(){function t(){mn(this,t),this.items=[]}return wn(t,[{key:"pop",value:function(){return this.items.pop()}},{key:"push",value:function(t){this.items.push(t)}},{key:"top",value:function(){if(this.items.length)return this.items[this.items.length-1]}},{key:"isEmpty",value:function(){return!this.top()}}]),t}(),Em=function(){function t(e,n,r,i){var o=this;mn(this,t),this.spanQueue=[],this.debug=n,this.tracing=r,this.parentSpan=i,this.tracedPromise=e.then((function(t){return Om(o.spanQueue,"then"),t})).catch((function(t){return Om(o.spanQueue,"catch"),Eu.reject(t)}))}return wn(t,[{key:"then",value:function(e){var n=this,r=this.tracing.registerNewSpan(this.parentSpan);return this.spanQueue.push({type:"then",spanObject:r}),new t(this.tracedPromise.then((function(i){var o;Am(n.spanQueue,r),n.spanQueue.shift(),r.start();try{o=e(i),r.end(),Om(n.spanQueue,"then")}catch(t){throw r.setError(t),r.end(),n.debug.error(t),Om(n.spanQueue,"catch"),t}return o instanceof t?o.tracedPromise:o})),this.debug,this.tracing,this.parentSpan)}},{key:"catch",value:function(e){var n=this,r=this.tracing.registerNewSpan(this.parentSpan);return this.spanQueue.push({type:"catch",spanObject:r}),new t(this.tracedPromise.catch((function(i){var o;Am(n.spanQueue,r),n.spanQueue.shift(),r.start();try{o=e(i),r.end(),Om(n.spanQueue,"then")}catch(t){throw r.setError(t),r.end(),n.debug.error(t),Om(n.spanQueue,"catch"),t}return o instanceof t?o.tracedPromise:o})),this.debug,this.tracing,this.parentSpan)}}]),t}();function Am(t,e){Cm(t,(function(t){return e===t.spanObject}))}function Om(t,e){Cm(t,(function(t){return e===t.type}))}function Cm(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(e(r))return;n--,t.shift(),r.spanObject.destroy()}}var jm=jl({onRoot:!1}),Pm=function(){function t(e,n,r,i,o,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.005;mn(this,t),this._executeWithinSpan=op,this.debug=e,this.location=i,this._isTraceSampled=o.random()<s,this._trace=new km(r,e,n,a,this._isTraceSampled),this._spanStack=new Tm}return wn(t,[{key:"trace",value:function(t,e,n){var r,i,o=jm,a=this._trace;return void 0!==n?(r=t,i=e,o=Wl(n,o)):"function"==typeof e?(r=t,i=e):(r=fp,i=t,o=Wl(e,o)),o.onRoot||(a=this.getActiveSpan()),this._traceFunction(r,i,a)}},{key:"sendTraceWithBeacon",value:function(){return this._trace.sendTraceWithBeacon()}},{key:"getActiveSpan",value:function(){return this._spanStack.top()||this._trace}},{key:"registerNewSpan",value:function(t,e){var n,r=fp;return"object"!==Xa(t)||t instanceof hp?t?(r=t,n=e||this.getActiveSpan()):n=this.getActiveSpan():n=t,new xm(n,r,this.debug,this._spanStack,this.location,this._isTraceSampled)}},{key:"tracePromise",value:function(t){return new Em(t,this.debug,this,this.getActiveSpan())}},{key:"addSerializedSpanToSend",value:function(){var t;(t=this._trace).addSerializedSpanToSend.apply(t,arguments)}},{key:"_traceFunction",value:function(t,e,n){var r=this.registerNewSpan(t,n),i=r.isChildOfTrace(),o=this;return function(){for(var t,n,a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return o._executeWithinSpan(o.debug,r,(t=Z(e)).call.apply(t,Mr(n=[e,this]).call(n,s)),i)}}}]),t}(),Lm=String.fromCharCode,Im=String.fromCodePoint,Bm=!!Im&&1!=Im.length;q({target:"String",stat:!0,forced:Bm},{fromCodePoint:function(t){for(var e,n=[],r=arguments.length,i=0;r>i;){if(e=+arguments[i++],st(e,1114111)!==e)throw RangeError(e+" is not a valid code point");n.push(e<65536?Lm(e):Lm(55296+((e-=65536)>>10),e%1024+56320))}return n.join("")}});var Dm=I.String.fromCodePoint,Rm={_keyStr:"1BGFYekyHP0tx4OKnQCIoUfMbhRaVEqrzLN._su96W5g3AcvXpZDlJdj78-mSi2wT",decode:function(t){var e="";t=t.replace(/[^A-Za-z0-9\._-]/g,"");for(var n=0;n<t.length;){var r,i,o,a,s=Jo(r=this._keyStr).call(r,t.charAt(n++)),c=Jo(i=this._keyStr).call(i,t.charAt(n++)),u=Jo(o=this._keyStr).call(o,t.charAt(n++)),l=Jo(a=this._keyStr).call(a,t.charAt(n++)),h=s<<2|c>>4,f=(15&c)<<4|u>>2,p=(3&u)<<6|l;e+=String.fromCharCode(h),64!==u&&(e+=String.fromCharCode(f)),64!==l&&(e+=String.fromCharCode(p))}return Rm._utf8_decode(e)},_utf8_decode:function(t){for(var e="",n=0,r="UTF-8 character cannot continue with: ";n<t.length;){var i=t.charCodeAt(n);if(i<128)e+=Dm(i),n++;else if(i>191&&i<224){var o=t.charCodeAt(n+1);if(o<128||o>191)throw RangeError(r+o);e+=Dm((31&i)<<6|63&o),n+=2}else if(i>223&&i<240){var a=t.charCodeAt(n+1),s=t.charCodeAt(n+2);if(a<128||a>191)throw RangeError(r+a);if(s<128||s>191)throw RangeError(r+s);e+=Dm((15&i)<<12|(63&a)<<6|63&s),n+=3}else{if(!(i>239&&i<248))throw RangeError("UTF-8 character cannot start with: "+i);var c=t.charCodeAt(n+1),u=t.charCodeAt(n+2),l=t.charCodeAt(n+3);if(c<128||c>191)throw RangeError(r+c);if(u<128||u>191)throw RangeError(r+u);if(l<128||l>191)throw RangeError(r+l);e+=Dm((7&i)<<18|(63&c)<<12|(63&u)<<6|63&l),n+=4}}return e}},Mm=function(){function t(e,n){mn(this,t),this.debug=e,this.location=n}return wn(t,[{key:"getCustomerIdentityFromUrl",value:function(){var t,e=this.getTransferIdentityToken();if(!e)return null;this.debug.log("found iitt token in URL",e);try{t=Rm.decode(e)}catch(t){return this.debug.error("iiit token is not valid base64 string"),null}this.debug.log("decoded token is",t);var n=Jo(t).call(t,":");if(n<0)return this.debug.log("iit token is not valid"),null;var r={};return r[t.substring(0,n)]=t.substring(n+1),this.debug.log("resulting transferred customer ID is",r),r}},{key:"getTransferIdentityFirstClickToken",value:function(){return this.getParameterValueFromUrl("xnpe_tifc")}},{key:"getTransferIdentityToken",value:function(){return this.getParameterValueFromUrl("iitt")}},{key:"getParameterValueFromUrl",value:function(t){var e=this.location.href.match(new RegExp("[?&]+"+t+"=([^&]*)","gi"));if(e){var n=e[e.length-1].match(/[?&]+[^=]+=([^&]*)/i);if(n)return n[1]}}}]),t}(),zm=function(){function t(e,n){mn(this,t),this.callbacks=[],this.afterCallbacks=[],this.tracing=e,this.window=n}return wn(t,[{key:"initialize",value:function(){var t=this;this.window.addEventListener("unload",(function(){Nm(t.tracing,t.callbacks),Nm(t.tracing,t.afterCallbacks),t.tracing.sendTraceWithBeacon()}))}},{key:"addListener",value:function(t){this.callbacks.push(t)}},{key:"addAfterListener",value:function(t){this.afterCallbacks.push(t)}}]),t}();function Nm(t,e){ln(e).call(e,(function(e){t.trace("unloaderCallback",e,{onRoot:!0})()}))}qd("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Kd);var Fm=I.Set;var Um=function(){function t(e,n,r,i,o,a){mn(this,t),this.onChangeListeners=new Fm,this.tracing=e,this.config=n,this.location=r,this.history=i,this.window=o,this.logger=a}return wn(t,[{key:"getParams",value:function(t){return function(t,e){var n={},r={};return ln(t).call(t,(function(t){r[t]=!0})),e.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(t,e,i){if(e in r)try{n[e]=decodeURIComponent(i)}catch(t){}return""})),n}(t,this.location.href)}},{key:"onChange",value:function(t,e){if(!this.onChangeListeners.has(t)){this.onChangeListeners.add(t);var n=mh(this.tracing.trace(t,e,{onRoot:!0}),10);!function(t,e,n,r,i){if(!(!0===t.spa_reloading||t.spa_reloading&&!1!==t.spa_reloading.on_url_change))return;var o=n.href.replace(n.hash,"");if(!r.pushState)return;var a=r.pushState;r.pushState=function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];a.apply(r,e),o=qm(n,o,i)},zg(e,"popstate",(function(){o=qm(n,o,i)}))}(this.config.getOptions(),this.window,this.location,this.history,n),function(t,e,n,r,i){if(!("object"===Xa(t.spa_reloading)&&!1!==t.spa_reloading.on_hash_change||!0===t.spa_reloading&&t.track_hash_changes))return;if(!("onhashchange"in e))return void r.warn("Browser is missing the HashChangeEvent support. The spa_reloading.on_hash_change option won't work.");zg(e,"hashchange",(o=n.hash,a=i,function(){n.hash!==o&&(o=n.hash,a())}));var o,a}(this.config.getOptions(),this.window,this.location,this.logger,n)}}}]),t}();function qm(t,e,n){var r=t.href.replace(t.hash,"");return e!==r&&n(),r}var Wm,Hm,Gm=function(){function t(e,n,r,i,o,a,s,c){var u=this;mn(this,t),this.activity={start:null,last:null},this.tracing=e,this.config=n,this.linkTracker=r,this.eventTracker=i,this.window=o,this.debug=a,this.documentContentLoaded=s,this.unloader=c,this._activityHandler=new av(this.window),this.config.getOptions().track.activity&&this.unloader.addListener((function(){u.trackActivityEvent(new Date)}))}return wn(t,[{key:"trackExitsWithDataAttribute",value:function(){var t=this,e=this.config.getOptions().track;e&&(!0===e.exits||fr(e.exits))&&this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((function(){var n=e.exits;fr(n)||(n=function(t){var e=t,n={location:e.href,current_location:window.location.href};return e.getAttribute("id")&&(n.element_id=e.getAttribute("id")),e.getAttribute("name")&&(n.element_name=e.getAttribute("name")),{type:"web_exit",properties:n}});for(var r=Za("a[data-exponea-track]"),i=0;i<r.length;i++)t.debug.log("Registering web exit link tracking for",r[i]),t.linkTracker.trackLink(r[i],n)}))}},{key:"startActivityTracking",value:function(){var t=this,e=this.config.getOptions().track;e&&e.activity&&(this.debug.log("Activity tracking enabled"),this._activityHandler.registerActionListeners(),this.window.setInterval((function(){return t.checkLastActivity()}),1e3))}},{key:"checkLastActivity",value:function(){if(this._activityHandler.getLastUserActivity()&&this._setUserWasActive(),this._activityHandler.resetActivity(),null!=this.activity.last){var t=new Date;t.getTime()-this.activity.last.getTime()>6e4&&(this.trackActivityEvent(t),this.activity={start:null,last:null})}}},{key:"trackActivityEvent",value:function(t){var e=this.config.getOptions().track;if(e&&e.activity&&null!=this.activity.start&&null!=this.activity.last){var n=this.activity.start.getTime()/1e3,r=this.activity.last.getTime()/1e3;this.debug.log("Tracking user activity event"),this.eventTracker.track("user_active",{start_client_timestamp:n,end_client_timestamp:r,now_client_timestamp:t.getTime(),duration:r-n})}}},{key:"_setUserWasActive",value:function(){this.activity.last=new Date,null==this.activity.start&&(this.activity.start=this.activity.last)}}]),t}();function Vm(t,e){var n;if(void 0===Op||null==Ap(t)){if(Ep(t)||(n=function(t,e){var n;if(!t)return;if("string"==typeof t)return Km(t,e);var r=oa(n=Object.prototype.toString.call(t)).call(n,8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return vl(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Km(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=ws(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Km(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Qm=(Wm=pp("WebLayers.showWebLayer"),$f((Hm=function(){function t(e,n,r,i,o,a,s,c,u,l,h,f,p){mn(this,t),this.showingWebLayersInProgress=!1,this.webLayerHiders=[],this.tracing=e,this.config=n,this.contextualBanditEventFilter=r,this.queue=i,this.timestamp=o,this.ping=a,this.tracker=s,this.location=c,this.debug=u,this.documentContentLoaded=l,this.initializeState=h,this.storageUtils=f,this.url=p,this.tracker.registerEventTrackingListener(function(t,e){return function(n,r){"banner"===n&&"banner_id"in r&&(r.interaction&&$m(t,e,r.banner_id,"interaction","_last_interaction"),"show"===r.action&&$m(t,e,r.banner_id,"show event","_last_show"))}}(this.debug,this.storageUtils))}return wn(t,[{key:"showWebLayer",value:function(t,e){var n,r;this.debug.log("Showing weblayer ".concat(e,"..."));try{n=new Function(t)}catch(t){return this.debug.error("Syntax error in the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ".concat(e,"\njavascript code. Check the web layer javascript code for syntax errors, such\nerrors are usually highlighted in the UI. The first line of the stack trace\nbelow should give you a clue.\n\n"),t)}try{r=n()}catch(t){return this.debug.error("Error when executing the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ".concat(e,"\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n"),t)}r.hasOwnProperty("contextual_personalization")&&this.updateContextualBanditEventFilter(r.contextual_personalization),"function"==typeof r&&r.hasOwnProperty("remove")&&"function"==typeof r.remove&&this.webLayerHiders.push(r.remove)}},{key:"queryAndShowWebLayer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;n||this.hideExistingWebLayers(),this.queryAndShowWebLayers([t],e,r)}},{key:"hideExistingWebLayers",value:function(){var t,e=Vm(this.webLayerHiders);try{for(e.s();!(t=e.n()).done;){var n=t.value;try{n()}catch(t){this.debug.error("Error from hide weblayer script",t)}}}catch(t){e.e(t)}finally{e.f()}this.webLayerHiders=[]}},{key:"processDefinition",value:function(t,e){var n=this;this.debug.log("Processing weblayers...",t),this.filterAndShowWebLayers(t,e,!1),this.config.isSpaReloadingEnabled("banners")&&this.url.onChange("onUrlChangeFilterAndShowWebLayers",(function(){n.filterAndShowWebLayers(t)}))}},{key:"filterAndShowWebLayers",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.showingWebLayersInProgress){n&&this.hideExistingWebLayers();var r=this.filterWebLayersForCustomer(t);if(0!==r.length){var i=kf(r).call(r,(function(t){return t._id}));this.showingWebLayersInProgress=!0,this.queryAndShowWebLayers(i,{},e)}else e&&tp(e)}}},{key:"filterWebLayersForCustomer",value:function(t){var e,n,r,i=this,o=Gp(Fp.WebLayer,this.debug);return Do(e=Do(n=Do(r=Do(t).call(t,o("page",(function(t){return Zp.matches(i.location.href,t.trigger)})))).call(r,o("date",(function(t){return Dp.matches(i.timestamp.getTimestamp(),t.date_filter)})))).call(n,o("device",(function(t){return qp.matches(t.device_target)})))).call(e,o("frequency",(function(t){return Wp.matches(i.ping,i.timestamp,i.storageUtils,t.frequency,t._id,"__exponea_banner_event__")})))}},{key:"queryAndShowWebLayers",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=ph(this.config.getOptions().customer);this.tracing.tracePromise(this.initializeState.whenInitialized()).then((function(){e.queue.enqueue({name:gl.BannersShow,noBulk:!0,prepareData:function(){return e.debug.log("Get filtered weblayers by IDs",t),i&&i.cookie||(i=ph(e.config.getOptions().customer)),{data:{company_id:e.config.getToken(),customer_ids:i,banner_ids:t,params:n}}},processResponse:function(n){var i=n.data;e.showWebLayers(i,t).then((function(){e.showingWebLayersInProgress=!1,r&&tp(r)}))},processError:function(t){e.showingWebLayersInProgress=!1,r&&tp(Z(r).call(r,void 0,t))}})}))}},{key:"showWebLayers",value:function(t,e){var n=this;return this.debug.log("Showing weblayers..."),this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((function(){ln(t).call(t,(function(t,r){return n.showWebLayer(t,e[r])}))}))}},{key:"updateContextualBanditEventFilter",value:function(t){var e,n,r,i=null===(e=t.optimization_target)||void 0===e?void 0:e.type,o=null===(n=t.optimization_target)||void 0===n?void 0:n.event_type,a=(null===(r=t.optimization_target)||void 0===r?void 0:r.event_filter)||[],s=t.reward_token,c=t.reward_value||1;"event_tracked"===i&&o&&s&&this.contextualBanditEventFilter.put(o,a,s,c)}}]),t}()).prototype,"showWebLayer",[Wm],Df(Hm.prototype,"showWebLayer"),Hm.prototype),Hm);function $m(t,e,n,r,i){var o;t.log(Mr(o="Recording ".concat(r," for weblayer ")).call(o,n)),e.writeToStorage("localStorage","__exponea_banner_event__"+n+i,(new Date).valueOf().toString())}var Jm,Ym,Xm,Zm,ty,ey,ny,ry,iy,oy,ay,sy,cy,uy,ly,hy,fy,py,dy,gy,vy,my,yy,by,wy,ky,_y,Sy,xy,Ty,Ey,Ay,Oy,Cy,jy=function(){function t(e){var n=this;mn(this,t),e&&wr(e,(function(t,e){n["_".concat(e)]=t}))}return wn(t,[{key:"location",get:function(){return this._location||(this._location=window.location),this._location}},{key:"document",get:function(){return this._document||(this._document=window.document),this._document}},{key:"date",get:function(){return this._date||(this._date=Date),this._date}},{key:"localStorage",get:function(){return this._localStorage||(this._localStorage=window.localStorage),this._localStorage}},{key:"sessionStorage",get:function(){return this._sessionStorage||(this._sessionStorage=window.sessionStorage),this._sessionStorage}},{key:"history",get:function(){return this._history||(this._history=window.history),this._history}},{key:"window",get:function(){return this._window||(this._window=window),this._window}},{key:"console",get:function(){return this._console||(this._console=window.console),this._console}},{key:"math",get:function(){return this._math||(this._math=Math),this._math}},{key:"config",get:function(){return this._config||(this._config=new Lh(this.database,this.logger)),this._config}},{key:"featureFlags",get:function(){return this._featureFlags||(this._featureFlags=new md(this.debug,this.window)),this._featureFlags}},{key:"contextualBandit",get:function(){return this._contextualBandit||(this._contextualBandit=new Ih(this.config,this.http)),this._contextualBandit}},{key:"timestamp",get:function(){return this._timestamp||(this._timestamp=new am(this.storageUtils)),this._timestamp}},{key:"http",get:function(){return this._http||(this._http=new bg(window)),this._http}},{key:"queue",get:function(){return this._queue||(this._queue=new Hv(this.tracing,this.config,this.http,this.debug,this.timestamp,this.unloader,this.window)),this._queue}},{key:"cookies",get:function(){return this._cookies||(this._cookies=new Of(this.config,this.debug,this.logger,this.queue,this.location,this.document)),this._cookies}},{key:"contextualBanditEventFilter",get:function(){return this._contextualBanditEventFilter||(this._contextualBanditEventFilter=new xf(this.contextualBandit,this.debug)),this._contextualBanditEventFilter}},{key:"time",get:function(){return this._time||(this._time=new om(this.timestamp,this.queue,this.cookies,this.debug)),this._time}},{key:"eventTracker",get:function(){return this._eventTracker||(this._eventTracker=new mp(this.tracing,this.config,this.contextualBanditEventFilter,this.time,this.timestamp,this.queue,this.debug,this.document,this.location,this.initializeState,this.window,this.url,this.browserExtension)),this._eventTracker}},{key:"ping",get:function(){return this._ping||(this._ping=new sv(this.tracing,this.config,this.timestamp,this.eventTracker,this.window,this.location,this.document,this.debug,this.cookies,this.storageUtils,this.unloader,this.url)),this._ping}},{key:"dependencyLoader",get:function(){return this._dependencyLoader||(this._dependencyLoader=new Pp(this.config,this.tracing)),this._dependencyLoader}},{key:"customer",get:function(){return this._customer||(this._customer=new kp(this.tracing,this.config,this.queue,this.debug,this.initializeState,this.window,this.cookies,this.browserExtension)),this._customer}},{key:"userActivityTracking",get:function(){return this._userActivityTracking||(this._userActivityTracking=new Gm(this.tracing,this.config,this.linkTracker,this.eventTracker,this.window,this.debug,this.documentContentLoaded,this.unloader)),this._userActivityTracking}},{key:"experimentsEditor",get:function(){return this._experimentsEditor||(this._experimentsEditor=new rd(this.http,this.config,this.location,this.document,this.history,this.window,this.debug,this.storageUtils)),this._experimentsEditor}},{key:"experimentsModifications",get:function(){return this._experimentsModifications||(this._experimentsModifications=new sd(this.eventTracker,this.experimentsEditor,this.document,this.debug)),this._experimentsModifications}},{key:"experiments",get:function(){return this._experiments||(this._experiments=new nd(this.tracing,this.config,this.queue,this.timestamp,this.ping,this.experimentsModifications,this.experimentsEditor,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.storageUtils,this.newExperiments,this.url)),this._experiments}},{key:"abTest",get:function(){return this._abTest||(this._abTest=new po(this.cookies)),this._abTest}},{key:"recommendations",get:function(){return this._recommendations||(this._recommendations=new Jv(this.config,this.queue,this.debug)),this._recommendations}},{key:"webLayers",get:function(){return this._webLayers||(this._webLayers=new Qm(this.tracing,this.config,this.contextualBanditEventFilter,this.queue,this.timestamp,this.ping,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.initializeState,this.storageUtils,this.url)),this._webLayers}},{key:"managedTags",get:function(){return this._managedTags||(this._managedTags=new Kg(this.tracing,this.config,this.queue,this.location,this.document,this.debug,this.url)),this._managedTags}},{key:"linkTracker",get:function(){return this._linkTracker||(this._linkTracker=new Mg(this.tracing,this.eventTracker,this.debug,this.documentContentLoaded)),this._linkTracker}},{key:"unloader",get:function(){return this._unloader||(this._unloader=new zm(this.tracing,this.window)),this._unloader}},{key:"campaignClicks",get:function(){return this._campaignClicks||(this._campaignClicks=new xl(this.location,this.queue,this.config,this.timestamp,this.time,this.debug,this.window,this.document)),this._campaignClicks}},{key:"notifications",get:function(){return this._notifications||(this._notifications=new pv(this.pushWebApi,this.pushSafariApi)),this._notifications}},{key:"pushWebApi",get:function(){return this._pushWebApi||(this._pushWebApi=new xv(this.window,this.location,this.debug,this.logger,this.config,this.customer,this.queue,this.serviceWorkerManager)),this._pushWebApi}},{key:"pushSafariApi",get:function(){return this._pushSafariApi||(this._pushSafariApi=new vv(this.window,this.config,this.customer,this.location,this.storageUtils)),this._pushSafariApi}},{key:"debug",get:function(){return this._debug||(this._debug=new Tp(this.config,this.location,this.logger,this.storageUtils)),this._debug}},{key:"tracing",get:function(){return this._tracing||(this._tracing=new Pm(this.debug,this.http,this.config,this.location,this.math,this.featureFlags)),this._tracing}},{key:"initializer",get:function(){return this._initializer||(this._initializer=new jg(this.tracing,this.debug,this.config,this.time,this.cookies,this.ping,this.customer,this.userActivityTracking,this.experimentsEditor,this.experiments,this.webLayers,this.managedTags,this.campaignClicks,this.eventTracker,this.queryTracking,this.window,this.unloader,this.initializeState,this.queue,this.pushWebApi,this.pushSafariApi,this.transferIdentity,this.http,this.logger,this.performanceTracker,this.newExperiments,this.featureFlags,this.browserExtension)),this._initializer}},{key:"queryTracking",get:function(){return this._queryTracking||(this._queryTracking=new Ev(this.tracing,this.config,this.queue,this.debug,this.timestamp,this.automaticTracking,this.window,this.eventTracker,this.customer,this.liveEventHandler,this.storageUtils,this.url)),this._queryTracking}},{key:"automaticTracking",get:function(){return this._automaticTracking||(this._automaticTracking=new ts(this.tracing,this.documentContentLoaded)),this._automaticTracking}},{key:"liveEventHandler",get:function(){return this._liveEventHandler||(this._liveEventHandler=new Hg(this.tracing,this.document)),this._liveEventHandler}},{key:"documentContentLoaded",get:function(){return this._documentContentLoaded||(this._documentContentLoaded=new Ip(this.window,this.document)),this._documentContentLoaded}},{key:"initializeState",get:function(){return this._initializeState||(this._initializeState=new Pg),this._initializeState}},{key:"transferIdentity",get:function(){return this._transferIdentity||(this._transferIdentity=new Mm(this.debug,this.location)),this._transferIdentity}},{key:"html",get:function(){return this._html||(this._html=new wd(this.config,this.debug,this.documentContentLoaded,this.queue)),this._html}},{key:"enhancedEcommerce",get:function(){return this._enhancedEcommerce||(this._enhancedEcommerce=new Lp.Tracker(this.debug,this.eventTracker)),this._enhancedEcommerce}},{key:"serviceWorkerManager",get:function(){return this._serviceWorkerManager||(this._serviceWorkerManager=new Yv(this.window,this.debug,this.config)),this._serviceWorkerManager}},{key:"logger",get:function(){return this._logger||(this._logger=new Gg(this.console,"Exponea")),this._logger}},{key:"performanceTracker",get:function(){return this._performanceTracker||(this._performanceTracker=new Jg(this.window,this.config,this.debug,this.tracing,this.date)),this._performanceTracker}},{key:"storageUtils",get:function(){return this._storageUtils||(this._storageUtils=new rm(this.logger,this.localStorage,this.sessionStorage)),this._storageUtils}},{key:"database",get:function(){return this._database||(this._database=new xp(this.window,this.logger)),this._database}},{key:"newExperiments",get:function(){return this._newExperiments||(this._newExperiments=new Qg(this.tracing,this.window,this.serviceWorkerManager,this.database,this.storageUtils,this.config,this.logger)),this._newExperiments}},{key:"url",get:function(){return this._url||(this._url=new Um(this.tracing,this.config,this.location,this.history,this.window,this.logger)),this._url}},{key:"browserExtension",get:function(){return this._browserExtension||(this._browserExtension=new hl.Handler(this.window,this.debug)),this._browserExtension}}]),t}(),Py=Mr(Jm=[]).call(Jm,["anonymize","initialize","identify","update","track","trackLink","trackEnhancedEcommerce","getHtml","showHtml","showBanner","showWebLayer","ping","getAbTest","loadDependency","getRecommendation","reloadWebLayers"],["_bootstrapEditor","_insertExperiment","_revertExperiments","_rewardBandit"]),Ly=(Ym=cv([{name:"options",oneOf:["boolean","object"]}]),Xm=cv([{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),Zm=pp("track"),ty=cv([{name:"customerIds",oneOf:["object","string","number"]},{name:"customerProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),ey=pp("identify"),ny=cv([{name:"customerProperties",type:"object"}]),ry=pp("update"),iy=cv([]),oy=cv([{name:"abTestName",type:"string"},{name:"variants",type:"object"},{name:"callback",type:"function",optional:!0}]),ay=pp("getAbTest"),sy=cv([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),cy=pp("showBanner"),uy=cv([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),ly=pp("showWebLayer"),hy=cv([{name:"options",type:"object"}]),fy=pp("getRecommendation"),py=cv([{name:"element",oneOf:["string","element"]},{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0}]),dy=pp("trackLink"),gy=cv([{name:"dependencyNameOrArray",oneOf:["string","array"]},{name:"callback",type:"function",optional:!0}]),vy=pp("loadDependency"),my=cv([{name:"pingOptions",type:"object",optional:!0}]),yy=pp("ping"),by=cv([{name:"callback",type:"function",optional:!0}]),wy=pp("reloadWebLayers"),ky=cv([]),_y=cv([{name:"experiment",type:"object"},{name:"trackEvent",type:"boolean",optional:!0}]),Sy=cv([]),xy=cv([{name:"banditRewardToken",type:"string"},{name:"banditRewardValue",type:"number"},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0}]),Ty=pp("_rewardBandit"),Ey=cv([{name:"ecommerceObject",type:"object"},{name:"kind",type:"string",optional:!0}]),Ay=pp("trackEnhancedEcommerce"),$f((Oy=function(){function t(e){var n=e.config,r=e.dependencyLoader,i=e.cookies,o=e.eventTracker,a=e.initializer,s=e.initializeState,c=e.customer,u=e.experimentsEditor,l=e.experiments,h=e.notifications,f=e.recommendations,p=e.abTest,d=e.webLayers,g=e.linkTracker,v=e.ping,m=e.tracing,y=e.contextualBandit,b=e.queue,w=e.debug,k=e.html,_=e.enhancedEcommerce,S=e.browserExtension;mn(this,t),this._=[],this.config=n,this.dependencyLoader=r,this.cookies=i,this.eventTracker=o,this.initializer=a,this.initializeState=s,this.customer=c,this.experimentsEditor=u,this.experiments=l,this.notifications=h,this.recommendations=f,this.abTest=p,this.webLayers=d,this.linkTracker=g,this.pingService=v,this.tracing=m,this.contextualBandit=y,this.queue=b,this.debug=w,this.html=k,this.enhancedEcommerce=_,this.browserExtension=S}return wn(t,[{key:"version",get:function(){return"v2.20.0"}},{key:"isLoaded",get:function(){return!0}},{key:"isInitialized",get:function(){return this.initializeState.isInitialized()}},{key:"configuration",get:function(){return this.tracing.sendTraceWithBeacon(),il(this.config.getOptions())}}]),wn(t,[{key:"initialize",value:function(t){return this.initializer.initialize(t)}},{key:"track",value:function(t,e,n,r,i){return this.eventTracker.track(t,e,{successCallback:n,errorCallback:r,immediate:i})}},{key:"identify",value:function(t,e,n,r,i){return this.customer.identifyCustomer(t,e,n,r,i)}},{key:"update",value:function(t){return this.customer.updateCustomer(t)}},{key:"anonymize",value:function(){var t=this.cookies.setFreshTrackingCookie();this.config.setNewCustomerIds({cookie:t}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:t}}),this.debug.log("sending new anonymized cookie to server"),this.cookies.sendCustomerCookieToServer(t),this.notifications.unsubscribe((function(){}))}},{key:"getAbTest",value:function(t,e,n){var r,i=Mr(r="".concat("__exponea_ab_")).call(r,t,"__"),o=this.cookies.getCookie(i),a=this.abTest.getAbTest(t,e);if(o||this.eventTracker.track("ab test",{name:t,variant:a}),!n)return a;tp((function(){return n(a)}))}},{key:"showBanner",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;return this.showWebLayer(t,e,n,r)}},{key:"showWebLayer",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;return this.webLayers.queryAndShowWebLayer(t,e,n,r)}},{key:"getRecommendation",value:function(t){return this.recommendations.fetch(t,arguments)}},{key:"trackLink",value:function(t,e,n){return this.linkTracker.trackLink(t,e,n)}},{key:"loadDependency",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return this.ensureThatSdkIsInitialized(),this.dependencyLoader.loadDependency(t).then((function(){return e()})).catch((function(t){return e(t)}))}},{key:"ping",value:function(t){return void 0===t?this.pingService.sendPing():(this.pingService.setOptions(t),this.pingService.restartPinging())}},{key:"reloadWebLayers",value:function(t){var e=this;this.tracing.tracePromise(_g(this.queue)).then((function(t){return e.webLayers.processDefinition(t.webLayers)})).then((function(){t&&tp(t)})).catch((function(e){t&&tp((function(){return t(e)}))}))}},{key:"_bootstrapEditor",value:function(){return this.experimentsEditor.bootstrapEditor()}},{key:"_insertExperiment",value:function(t,e){return this.experiments.applyExperimentModificationsAndTrackEvent(t,e)}},{key:"_revertExperiments",value:function(){return this.experiments.revertExistingExperiments()}},{key:"_rewardBandit",value:function(t,e,n,r){this.contextualBandit.rewardBandit(t,e,n,r)}},{key:"trackEnhancedEcommerce",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";this.enhancedEcommerce.trackEnhancedEcommerce(t,e)}},{key:"getHtml",value:function(t,e){this.html.getHtml(t,e)}},{key:"showHtml",value:function(t,e){this.html.showHtml(t,e)}},{key:"ensureThatSdkIsInitialized",value:function(){if(!this.initializeState.isInitialized())throw new Error("You have to call initialize before any other Exponea SDK method can be called")}}]),t}()).prototype,"initialize",[Ym],Df(Oy.prototype,"initialize"),Oy.prototype),$f(Oy.prototype,"track",[Xm,Zm],Df(Oy.prototype,"track"),Oy.prototype),$f(Oy.prototype,"identify",[ty,ey],Df(Oy.prototype,"identify"),Oy.prototype),$f(Oy.prototype,"update",[ny,ry],Df(Oy.prototype,"update"),Oy.prototype),$f(Oy.prototype,"anonymize",[iy],Df(Oy.prototype,"anonymize"),Oy.prototype),$f(Oy.prototype,"getAbTest",[oy,ay],Df(Oy.prototype,"getAbTest"),Oy.prototype),$f(Oy.prototype,"showBanner",[sy,cy],Df(Oy.prototype,"showBanner"),Oy.prototype),$f(Oy.prototype,"showWebLayer",[uy,ly],Df(Oy.prototype,"showWebLayer"),Oy.prototype),$f(Oy.prototype,"getRecommendation",[hy,fy],Df(Oy.prototype,"getRecommendation"),Oy.prototype),$f(Oy.prototype,"trackLink",[py,dy],Df(Oy.prototype,"trackLink"),Oy.prototype),$f(Oy.prototype,"loadDependency",[gy,vy],Df(Oy.prototype,"loadDependency"),Oy.prototype),$f(Oy.prototype,"ping",[my,yy],Df(Oy.prototype,"ping"),Oy.prototype),$f(Oy.prototype,"reloadWebLayers",[by,wy],Df(Oy.prototype,"reloadWebLayers"),Oy.prototype),$f(Oy.prototype,"_bootstrapEditor",[ky],Df(Oy.prototype,"_bootstrapEditor"),Oy.prototype),$f(Oy.prototype,"_insertExperiment",[_y],Df(Oy.prototype,"_insertExperiment"),Oy.prototype),$f(Oy.prototype,"_revertExperiments",[Sy],Df(Oy.prototype,"_revertExperiments"),Oy.prototype),$f(Oy.prototype,"_rewardBandit",[xy,Ty],Df(Oy.prototype,"_rewardBandit"),Oy.prototype),$f(Oy.prototype,"trackEnhancedEcommerce",[Ey,Ay],Df(Oy.prototype,"trackEnhancedEcommerce"),Oy.prototype),Oy);
/*! https://mths.be/fromcodepoint v0.2.1 by @mathias */
Dm||function(){var t=function(){try{var t={},e=H,n=e(t,t,t)&&e}catch(t){}return n}(),e=String.fromCharCode,n=Math.floor,r=function(t){var r,i,o=16384,a=[],s=-1,c=arguments.length;if(!c)return"";for(var u="";++s<c;){var l=Number(arguments[s]);if(!isFinite(l)||l<0||l>1114111||n(l)!=l)throw RangeError("Invalid code point: "+l);l<=65535?a.push(l):(r=55296+((l-=65536)>>10),i=l%1024+56320,a.push(r,i)),(s+1==c||a.length>o)&&(u+=e.apply(null,a),a.length=0)}return u};t?t(String,"fromCodePoint",{value:r,configurable:!0,writable:!0}):String.fromCodePoint=r}(),function(){function t(){null!==this.parentNode&&this.parentNode.removeChild(this)}[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:t})}))}();var Iy,By,Dy,Ry,My=new Gg(console,"Exponea");if(Ry=navigator.userAgent,new RegExp("Googlebot\\/|Googlebot-Mobile|Googlebot-Image|Googlebot-News|Googlebot-Video|AdsBot-Google([^-]|$)|AdsBot-Google-Mobile|Feedfetcher-Google|Mediapartners-Google|Mediapartners \\(Googlebot\\)|APIs-Google|bingbot|Slurp|[wW]get|LinkedInBot|Python-urllib|python-requests|libwww-perl|httpunit|nutch|Go-http-client|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|BIGLOTRON|Teoma|convera|seekbot|Gigabot|Gigablast|exabot|ia_archiver|GingerCrawler|webmon |HTTrack|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|findlink|msrbot|panscient|yacybot|AISearchBot|ips-agent|tagoobot|MJ12bot|woriobot|yanga|buzzbot|mlbot|YandexBot|YandexImages|YandexAccessibilityBot|YandexMobileBot|purebot|Linguee Bot|CyberPatrol|voilabot|Baiduspider|citeseerxbot|spbot|twengabot|postrank|TurnitinBot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|Ahrefs(Bot|SiteAudit)|fuelbot|CrunchBot|IndeedBot|mappydata|woobot|ZoominfoBot|PrivacyAwareBot|Multiviewbot|SWIMGBot|Grobbot|eright|Apercite|semanticbot|Aboundex|domaincrawler|wbsearchbot|summify|CCBot|edisterbot|seznambot|ec2linkfinder|gslfbot|aiHitBot|intelium_bot|facebookexternalhit|Yeti|RetrevoPageAnalyzer|lb-spider|Sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|OrangeBot\\/|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|S[eE][mM]rushBot|yoozBot|lipperhey|Y!J|Domain Re-Animator Bot|AddThis|Screaming Frog SEO Spider|MetaURI|Scrapy|Livelap[bB]ot|OpenHoseBot|CapsuleChecker|collection@infegy.com|IstellaBot|DeuSu\\/|betaBot|Cliqzbot\\/|MojeekBot\\/|netEstate NE Crawler|SafeSearch microdata crawler|Gluten Free Crawler\\/|Sonic|Sysomos|Trove|deadlinkchecker|Slack-ImgProxy|Embedly|RankActiveLinkBot|iskanie|SafeDNSBot|SkypeUriPreview|Veoozbot|Slackbot|redditbot|datagnionbot|Google-Adwords-Instant|adbeat_bot|WhatsApp|contxbot|pinterest.com.bot|electricmonk|GarlikCrawler|BingPreview\\/|vebidoobot|FemtosearchBot|Yahoo Link Preview|MetaJobBot|DomainStatsBot|mindUpBot|Daum\\/|Jugendschutzprogramm-Crawler|Xenu Link Sleuth|Pcore-HTTP|moatbot|KosmioBot|pingdom|AppInsights|PhantomJS|Gowikibot|PiplBot|Discordbot|TelegramBot|Jetslide|newsharecounts|James BOT|Bark[rR]owler|TinEye|SocialRankIOBot|trendictionbot|Ocarinabot|epicbot|Primalbot|DuckDuckGo-Favicons-Bot|GnowitNewsbot|Leikibot|LinkArchiver|YaK\\/|PaperLiBot|Digg Deeper|dcrawl|Snacktory|AndersPinkBot|Fyrebot|EveryoneSocialBot|Mediatoolkitbot|Luminator-robots|ExtLinksBot|SurveyBot|NING\\/|okhttp|Nuzzel|omgili|PocketParser|YisouSpider|um-LN|ToutiaoSpider|MuckRack|Jamie's Spider|AHC\\/|NetcraftSurveyAgent|Laserlikebot|^Apache-HttpClient|AppEngine-Google|Jetty|Upflow|Thinklab|Traackr.com|Twurly|Mastodon|http_get|DnyzBot|botify|007ac9 Crawler|BehloolBot|BrandVerity|check_http|BDCbot|ZumBot|EZID|ICC-Crawler|ArchiveBot|^LCC |filterdb.iss.net\\/crawler|BLP_bbot|BomboraBot|Buck\\/|Companybook-Crawler|Genieo|magpie-crawler|MeltwaterNews|Moreover|newspaper\\/|ScoutJet|(^| )sentry\\/|StorygizeBot|UptimeRobot|OutclicksBot|seoscanners|Hatena|Google Web Preview|MauiBot|AlphaBot|SBL-BOT|IAS crawler|adscanner|Netvibes|acapbot|Baidu-YunGuanCe|bitlybot|blogmuraBot|Bot.AraTurka.com|bot-pge.chlooe.com|BoxcarBot|BTWebClient|ContextAd Bot|Digincore bot|Disqus|Feedly|Fetch\\/|Fever|Flamingo_SearchEngine|FlipboardProxy|g2reader-bot|G2 Web Services|imrbot|K7MLWCBot|Kemvibot|Landau-Media-Spider|linkapediabot|vkShare|Siteimprove.com|BLEXBot\\/|DareBoost|ZuperlistBot\\/|Miniflux\\/|Feedspot|Diffbot\\/|SEOkicks|tracemyfile|Nimbostratus-Bot|zgrab|PR-CY.RU|AdsTxtCrawler|Datafeedwatch|Zabbix|TangibleeBot|google-xrawler|axios|Amazon CloudFront|Pulsepoint|CloudFlare-AlwaysOnline|Google-Structured-Data-Testing-Tool|WordupInfoSearch|WebDataStats|HttpUrlConnection|Seekport Crawler|ZoomBot|VelenPublicWebCrawler|MoodleBot|jpg-newsbot|outbrain|W3C_Validator|Validator\\.nu|W3C-checklink|W3C-mobileOK|W3C_I18n-Checker|FeedValidator|W3C_CSS_Validator|W3C_Unicorn|Google-PhysicalWeb|Blackboard|ICBot\\/|BazQux|Twingly|Rivva|Experibot|awesomecrawler|Dataprovider.com|GroupHigh\\/|theoldreader.com|AnyEvent|Uptimebot\\.org|Nmap Scripting Engine|2ip.ru|Clickagy|Caliperbot|MBCrawler|online-webceo-bot|B2B Bot|AddSearchBot|Google Favicon|HubSpot|Chrome-Lighthouse|HeadlessChrome|CheckMarkNetwork\\/|www\\.uptime\\.com|Streamline3Bot\\/|serpstatbot\\/|MixnodeCache\\/|^curl|SimpleScraper|RSSingBot|Jooblebot|fedoraplanet|Friendica|NextCloud|Tiny Tiny RSS|RegionStuttgartBot|Bytespider|Datanyze|Google-Site-Verification|TrendsmapResolver|tweetedtimes|NTENTbot|Gwene|SimplePie|SearchAtlas|Superfeedr|feedbot|UT-Dorkbot|Amazonbot|SerendeputyBot|Eyeotabot|officestorebot|Neticle Crawler|SurdotlyBot|LinkisBot|AwarioSmartBot|AwarioRssBot|RyteBot|FreeWebMonitoring SiteChecker|AspiegelBot|NAVER Blog Rssbot|zenback bot|SentiBot|Domains Project\\/|Pandalytics|VKRobot|bidswitchbot|tigerbot|NIXStatsbot|Atom Feed Robot|Curebot|PagePeeker\\/|Vigil\\/|rssbot\\/|startmebot\\/|JobboerseBot|seewithkids|NINJA bot|Cutbot|BublupBot|BrandONbot|RidderBot|YandexMetrika|YandexTurbo|YandexImageResizer|YandexVideoParser|Taboolabot|Dubbotbot|FindITAnswersbot|infoobot|Refindbot|BlogTraffic\\/\\d\\.\\d+ Feed-Fetcher|SeobilityBot|Cincraw|Dragonbot|VoluumDSP-content-bot|FreshRSS|BitBot","i").test(Ry))My.log("Crawler detected, not initializing SDK");else if(null===(Cy=window.exponea)||void 0===Cy?void 0:Cy.version)My.log("The SDK is already available on the window, maybe the SDK file is downloaded twice?");else{var zy=new jy;zy.debug.log("Creating SDK instance");var Ny=new Ly(zy),Fy=Ny.notifications,Uy=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;return t.exponea||(t.exponea={_:[]},t.exponea.notifications={_:[]}),t.exponea.notifications||(t.exponea.notifications={_:[]}),t.exponea}(),qy=Uy.notifications;gn(Uy,Ny,zy.debug),vn(Py,Uy,Ny),By=Uy,Dy=Ny,ln(Iy=["version","isLoaded","isInitialized","configuration"]).call(Iy,(function(t){H(By,t,{get:function(){return Dy[t]},configurable:!1,enumerable:!1})})),gn(qy,Fy,zy.debug),vn(["isAvailable","isSubscribed","subscribe","unsubscribe"],qy,Fy)}}();
//# sourceMappingURL=exponea.min.js.map
