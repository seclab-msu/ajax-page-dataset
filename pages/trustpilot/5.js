(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9870],{2252:function(e,t,n){"use strict";n.d(t,{zg:function(){return E},M0:function(){return c}});var i=n(67294),s=n(1411),r=n(74937),a=n(3620);var o;!function(e){e.Initial="initial",e.Success="success",e.Pending="pending",e.Closed="closed",e.Error="error",e.AwaitingConfirmation="awaitingconfirmation"}(o||(o={}));const c=()=>{const e=(()=>{const[e,t]=i.useState(!1),{isLoaded:n,isLoggedIn:o}=(0,s.xO)(),[c,l]=i.useState(!1),d=n&&o&&!e&&!c,{fetch:u}=(0,r.i)();return i.useEffect((()=>{d&&async function(){try{const e=await(await u("/api/businessunitprofile/consumer/email/marketing")).json();l(!0),e.success&&e.broadMarketing===a.Bm.undecided&&t(!0)}catch(e){}}()}),[d,u]),e})(),[t,n]=i.useState(o.Initial);return{isStatus:e=>t===e,setStatus:n,show:e}};var l,d=n(85893),u=n(48),m=n(57793),f=n(90824),p=n(62611),h=n(92596),g=n(54836),y=n(82327),v=n(4189),x=n(65424),w=n(8342),_=n.n(w),b=n(32979),j=n.n(b),k=n(14223),N=n(48081),C=n(91868),I=n(41199);!function(e){e.Current="current",e.Previous="previous"}(l||(l={}));var S=n(78486),D=n.n(S);const E=e=>{let{className:t,isStatus:n,setStatus:s,show:r}=e;const[c]=(0,u.T)(),{track:w}=i.useContext(f.AppContext),{optInMarketing:b,optOutMarketing:S}=(0,k.U)(),[E,U]=(()=>{const{locale:e}=i.useContext(f.AppContext),[{variationName:t,hasRun:n}]=(0,I.xM)((t=>t.create("MarketingOptIn Copy").setCondition((()=>e.startsWith("en-"))).addVariation({name:l.Current}).addVariation({name:l.Previous})),"consumer-site-ab-test-marketing-opt-in-copy");return[t||l.Current,n]})();if(!r||n(o.Closed)||!U)return null;const O=(0,C.$)("broadmarketing");return(0,d.jsxs)(p.Zb,{name:"marketing-invitation-box",className:(0,N.AK)(D().wrapper,t),noPadding:!0,children:[(0,d.jsx)("div",{className:D().innerWrapper,children:(0,d.jsxs)("button",{onClick:async()=>{if(n(o.Initial))try{await S(),w("Button Clicked",{name:"Opt-Out Marketing Emails"})}catch(e){}s(o.Closed)},className:D().dismissButton,children:[(0,d.jsx)("span",{style:{display:"none"},"aria-label":c["marketing-opt-in/dismiss"]}),(0,d.jsx)(h.J,{content:_(),width:16,height:16})]})}),(0,d.jsxs)(g.a,{className:D().content,children:[E===l.Current&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y.Z,{color:"black",variant:"h3",className:D().body,children:(0,d.jsx)(m.x,{id:"marketing-opt-in/header"})}),(0,d.jsx)(y.Z,{color:"gray-7",variant:"bodysmall",className:D().body,children:(0,d.jsx)(m.x,{id:O.translationKey})})]}),E===l.Previous&&(0,d.jsx)(y.Z,{color:"gray-7",variant:"bodysmall",className:D().body,children:"Click \u201cYes, update me\u201d to receive emails from Trustpilot about your reviews, inspiration, tips about businesses and products, information about Trustpilot, and new features. You can opt out at any time."}),n(o.Error)?(0,d.jsx)(v.w,{appearance:"warning",hideIcon:!0,className:D().notificationMessage,children:(0,d.jsx)(m.x,{id:"marketing-opt-in/notifications/errormessage"})}):null,n(o.AwaitingConfirmation)?(0,d.jsx)(v.w,{appearance:"info",hideIcon:!0,children:(0,d.jsx)(m.x,{id:"marketing-opt-in/notifications/marketingoptinconfirmationpending"})}):(0,d.jsx)(x.Sn,{kind:"primary",name:"Marketing Opt In",onClick:async()=>{s(o.Pending);try{const e=await b();if(w("Button Clicked",{action:"Accepted Marketing"}),!e.success)throw new Error("Unable to opt user into marketing");e.status===a.Bm.pending_confirmation?s(o.AwaitingConfirmation):(s(o.Success),setTimeout((()=>s(o.Closed)),3e3))}catch(e){s(o.Error)}},isBusy:n(o.Pending),isWide:!0,children:(0,d.jsx)(y.Z,{variant:"bodysmall",className:D().buttonText,children:n(o.Success)?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(h.J,{content:j(),color:"currentColor"}),(0,d.jsx)(m.x,{id:"marketing-opt-in/button/success"})]}):(0,d.jsx)(m.x,{id:"marketing-opt-in/button/accept"})})})]})]})}},20250:function(e,t,n){"use strict";n.d(t,{Z:function(){return O}});var i=n(85893),s=(n(67294),n(48)),r=n(62563),a=n(57793),o=n(1411),c=n(62611),l=n(59869),d=n(82327),u=n(80074),m=n(65424),f=n(92596),p=n(11944),h=n.n(p),g=n(67358),y=n.n(g),v=n(9538),x=n(80950),w=n.n(x),_=n(84779),b=n(61928),j=n(48081),k=n(23300),N=n.n(k);const C=e=>{let{children:t,icon:n,name:s}=e;return(0,i.jsxs)(d.Z,{variant:"bodysmall",as:"div",className:N().detailsIcon,color:"gray-6",children:[(0,i.jsx)(f.J,{content:n,color:"currentColor",width:14,height:14}),(0,i.jsx)(d.Z,{as:"span",name:s,children:t})]})},I=e=>{let{id:t,displayName:n,imageUrl:r,numberOfReviews:a,isVerified:o,countryCode:c}=e;const l=c,u=(0,j.Xg)(t),[m]=(0,s.T)();return(0,i.jsx)("aside",{className:N().consumerInfoWrapper,"aria-label":m["service-review-card/consumer-information/consumer-info-wrapper/aria-label"].replace("[USERNAME]",n),children:(0,i.jsxs)("div",{className:N().consumerDetailsWrapper,children:[(0,i.jsx)(_.s,{id:t,displayName:n,imageUrl:r,isVerified:o}),(0,i.jsxs)(v.g,{name:"consumer-profile",className:N().consumerDetails,href:u,trackingProps:{target:"Consumer profile",name:"consumer-info"},rel:"nofollow",children:[(0,i.jsx)(d.Z,{name:"consumer-name",as:"div",variant:"bodysmall",weight:"medium",className:N().consumerName,children:n}),(0,i.jsxs)("div",{className:N().consumerExtraDetails,"data-consumer-reviews-count":a,children:[(0,i.jsx)(d.Z,{variant:"bodysmall",as:"span",color:"gray-6",name:"consumer-reviews-count",children:(0,i.jsx)(b.A,{id:"service-review-card/consumer-information/review-count",pluralNumber:a})}),l?(0,i.jsx)(C,{icon:w(),name:"consumer-country",children:c.toUpperCase()}):null]})]})]})})};var S=n(61125),D=n.n(S);function E(e){let{review:t,onDelete:n,consumerVerified:p}=e;const[g]=(0,s.T)(),{consumer:v}=(0,o.xO)();return(0,i.jsxs)(c.Zb,{name:"draft-review",className:D().draftReviewCard,children:[(0,i.jsx)(I,{id:v.id,displayName:v.displayName,countryCode:v.country,numberOfReviews:v.numberOfReviews,imageUrl:v.imageUrl.large,isVerified:p}),(0,i.jsxs)("div",{className:D().content,children:[(0,i.jsxs)("div",{className:D().contentHeader,children:[(0,i.jsx)(l.Z,{variant:"review",rating:t.stars,size:"medium"}),(0,i.jsx)(d.Z,{variant:"bodysmall",color:"gray-6",as:"div",children:(0,i.jsx)(r.PS,{date:t.date,format:{day:"2-digit",month:"long",year:"numeric"}})})]}),t.title&&(0,i.jsx)(d.Z,{variant:"h4",as:"h2",color:"black",className:D().contentTitle,children:t.title}),t.review?(0,i.jsx)(d.Z,{variant:"body",color:"black",children:t.review}):(0,i.jsx)(u.rU,{name:"review-draft-finish",href:t.continueUrl,color:"gray-6",className:D().textPlaceholderLink,trackingProps:{name:"review-draft-finish",target:"Evaluate page"},children:(0,i.jsx)(a.x,{id:"shared/draft-reviews/text-placeholder"})})]}),(0,i.jsxs)("div",{className:D().actions,children:[(0,i.jsxs)(m.Sn,{className:D().deleteDraftButton,name:"review-draft-delete",trackingProps:{action:"Delete draft",name:"review-draft-delete"},onClick:function(){confirm(g["shared/draft-reviews/confirm-delete"])&&n(t.id)},children:[(0,i.jsx)(f.J,{content:h(),color:"currentColor",width:14,height:14}),(0,i.jsx)("span",{children:(0,i.jsx)(a.x,{id:"shared/draft-reviews/delete"})})]}),(0,i.jsxs)(u.rU,{className:D().finishDraftLink,name:"review-draft-finish",trackingProps:{name:"review-draft-finish",target:"Evaluate page"},href:t.continueUrl,children:[(0,i.jsx)(f.J,{content:y(),color:"currentColor",width:14,height:14}),(0,i.jsx)("span",{children:(0,i.jsx)(a.x,{id:"shared/draft-reviews/finish"})})]})]})]})}var U=n(7248);function O(e){let{review:t,onDelete:n,businessUnit:s,consumerVerified:r}=e;return s?(0,i.jsx)(U.Z,{id:t.id,businessUnit:{id:s.id,displayName:s.displayName,identifyingName:s.identifyingName},isDraft:!0,children:(0,i.jsx)(E,{review:t,onDelete:n,consumerVerified:r})},t.id):null}},7248:function(e,t,n){"use strict";var i=n(85893),s=(n(67294),n(57793)),r=n(41664),a=n.n(r),o=n(82327),c=n(80074),l=n(33613),d=n(48081),u=n(42414),m=n.n(u);t.Z=e=>{let{children:t,id:n,businessUnit:r,isDraft:u}=e;return(0,i.jsxs)("div",{className:m().reviewListItem,children:[(0,i.jsx)(o.Z,{variant:"bodysmall",className:m().reviewCompanyLabel,children:(0,i.jsx)(s.x,{id:u?"consumer-profile-page/reviews-list/draft-review-company-name":"consumer-profile-page/reviews-list/review-company-name",interpolations:{"COMPANY-NAME":(0,i.jsx)(a(),{passHref:!0,href:(0,d.nj)(r.identifyingName),children:(0,i.jsx)(c.rU,{children:r.displayName})},"company-profile-link")}})}),(0,i.jsx)(l.m,{businessUnit:r,children:t})]},n)}},9126:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n(41799),s=n(69396),r=n(67294),a=n(1411);const o=function(e){const t="ReviewDrafts";function n(e){const t=i(),n=r(t,a(e.id))[0];n&&(t.splice(t.indexOf(n),1),c(t))}function i(){const n=e.getItem(t);if(n)try{const e=JSON.parse(n);return e.forEach((e=>{e.date=new Date(e.date)})),e}catch(i){}return[]}function s(e,t){return r(i(),o(t),function(e){return t=>t.businessUnitId===e}(e))[0]}function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.reduce(((e,t)=>e.filter(t)),e)}function a(e){return t=>t.id===e}function o(e){return t=>null===t.consumerId||t.consumerId===e}function c(n){e.setItem(t,JSON.stringify(n))}return{add:function(e){const t=s(e.businessUnitId,e.consumerId);t&&n(t);const r=i();r.push(e),c(r)},getAll:i,getByBusinessUnitAndConsumerId:s,getByConsumerId:function(e){return r(i(),o(e))},getById:function(e){return r(i(),a(e))[0]},remove:n}}(n(44920).b);var c=o,l=n(74937);function d(){const{0:e,1:t}=(0,r.useState)([]),{0:n,1:o}=(0,r.useState)({}),{0:d,1:u}=(0,r.useState)(!1),{consumer:m}=(0,a.xO)(),{fetch:f}=(0,l.i)(),p=(0,r.useCallback)((()=>{const e=c.getAll();e&&m&&t(e.filter((e=>e.consumerId===m.id)))}),[m]),h=(0,r.useCallback)((e=>{const t=c.getById(e);t&&(c.remove(t),p())}),[p]);return(0,r.useEffect)((()=>{const t=Array.from(new Set(e.map((e=>e.businessUnitId)))).filter((e=>!n[e]));t.length&&async function(t){const n=await Promise.allSettled(t.map((e=>async function(e,t){const n=await e("/api/businessunitprofile/businessunit/".concat(t));if(200!==n.status)throw new Error("Failed to get business unit by id");return await n.json()}(f,e)))),r=n.map((e=>"fulfilled"===e.status&&e.value)).filter(Boolean);o((e=>(0,i.Z)({},e,r.reduce(((e,t)=>(0,s.Z)((0,i.Z)({},e),{[t.id]:{id:t.id,displayName:t.displayName,identifyingName:t.name.identifying}})),{})))),n.map(((e,n)=>"rejected"===e.status&&t[n])).filter(Boolean).map((t=>e.filter((e=>e.businessUnitId===t)))).flat().forEach((e=>h(e.id))),u(!0)}(t)}),[n,h,e,f]),(0,r.useEffect)((()=>{p()}),[p]),{draftReviews:e,deleteDraftReview:h,businessUnits:n,ready:d}}},14223:function(e,t,n){"use strict";n.d(t,{U:function(){return c}});var i=n(67294),s=n(87042),r=n(90824),a=n(74937),o=n(91868);const c=()=>{const{fetch:e}=(0,a.i)(),{locale:t}=i.useContext(r.AppContext),n=(()=>{const[e,t]=i.useState();return i.useEffect((()=>{!async function(){var e;await(0,s.N4)();const n=null===(e=window.Optanon.getGeolocationData())||void 0===e?void 0:e.country;n&&t(n)}()}),[]),e})();return{optInMarketing:i.useCallback((async()=>{const i=await e("/api/businessunitprofile/consumer/email/marketing",{method:"POST",body:JSON.stringify({subscribe:!0,locale:t,textVersion:(0,o.$)("broadmarketing").version,countryCode:n})});return i.ok?await i.json():{success:!1}}),[e,t,n]),optOutMarketing:i.useCallback((async()=>({success:(await e("/api/businessunitprofile/consumer/email/marketing",{method:"DELETE"})).ok})),[e])}}},3620:function(e,t,n){"use strict";var i,s,r,a;n.d(t,{$Z:function(){return s},Bm:function(){return r},LN:function(){return a}}),function(e){e.filtered="filtered",e.reported="reported",e.pending="pending",e.active="active"}(i||(i={})),function(e){e.verified="verified",e.notverified="not_verified",e.submitted="submitted",e.failed="failed"}(s||(s={})),function(e){e.in="in",e.out="out",e.undecided="undecided",e.pending_confirmation="pending_confirmation"}(r||(r={})),function(e){e.confirmed="confirmed",e.failed="failed",e.not_checked="not_checked"}(a||(a={}))},91868:function(e,t,n){"use strict";n.d(t,{$:function(){return s}});const i={broadmarketing:4},s=e=>({name:e,version:i[e],translationKey:"legaltext/".concat(e,"/v").concat(i[e])})},44920:function(e,t,n){"use strict";n.d(t,{b:function(){return s}});class i{clear(){this.dataStorage={}}getItem(e){return this.dataStorage[e]||null}key(e){return Object.keys(this.dataStorage)[e]}removeItem(e){delete this.dataStorage[e]}setItem(e,t){this.dataStorage[e]=t}get length(){return Object.keys(this.dataStorage).length}constructor(){this.dataStorage={}}}const s=(r=window.localStorage)&&function(e){const t=(new Date).toString();let n;try{return e.setItem(t,t),n=e.getItem(t)===t,e.removeItem(t),!(!n||!e)}catch(i){return!1}}(r)?r:new i;var r},78486:function(e){e.exports={wrapper:"styles_wrapper__ScnHE",innerWrapper:"styles_innerWrapper__zW1NF",dismissButton:"styles_dismissButton__4KufI",content:"styles_content__QCP9P",notificationMessage:"styles_notificationMessage__XNePJ",body:"styles_body__7dY2X",buttonText:"styles_buttonText__yr3HX"}},23300:function(e){e.exports={consumerInfoWrapper:"styles_consumerInfoWrapper__W__0R",consumerDetailsWrapper:"styles_consumerDetailsWrapper__QuWNz",consumerDetails:"styles_consumerDetails__JecKo",consumerName:"styles_consumerName__Y676n",consumerExtraDetails:"styles_consumerExtraDetails__0kG_g",detailsIcon:"styles_detailsIcon__Xw2Uw"}},61125:function(e){e.exports={draftReviewCard:"styles_draftReviewCard__2S9__",content:"styles_content__OiHcw",contentHeader:"styles_contentHeader__WJWY_",contentTitle:"styles_contentTitle__SeYom",textPlaceholderLink:"styles_textPlaceholderLink__pF4jG",actions:"styles_actions__kwWLl",withIcon:"styles_withIcon__uBLC6",finishDraftLink:"styles_finishDraftLink__YNphQ",deleteDraftButton:"styles_deleteDraftButton__c112I"}},42414:function(e){e.exports={reviewCompanyLabel:"styles_reviewCompanyLabel__9a9Qb",reviewListItem:"styles_reviewListItem__j2OA3"}}}]);
//# sourceMappingURL=9870-e12803b2213e5113.js.map